<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Iván Arribas (Depto. Análisis Económico. Universitat de València)" />


<title>Defunciones por Enfermedades Cerebrovasculares</title>

<script src="site_libs/header-attrs-2.5/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cerulean.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<script src="site_libs/navigation-1.1/sourceembed.js"></script>
<link href="site_libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="site_libs/anchor-sections-1.0/anchor-sections.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
#rmd-source-code {
  display: none;
}
</style>

<link rel="stylesheet" href="styles.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Series Temporales</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="01-Guia-curso.html">
    <span class="fa fa-graduation-cap"></span>
     
    Guía del curso
  </a>
</li>
<li>
  <a href="02-Logistica.html">
    <span class="fa fa-laptop"></span>
     
    Logística
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-book"></span>
     
    Diapos
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Teoría</li>
    <li>
      <a href="03-01-Tema1.html">Tema 1: Introducción</a>
    </li>
    <li>
      <a href="03-02-Tema2.html">Tema 2: Alisado</a>
    </li>
    <li>
      <a href="03-03-Tema3.html">Tema 3: Procesos estocásticos</a>
    </li>
    <li>
      <a href="03-04-Tema4.html">Tema 4: ARIMA</a>
    </li>
    <li>
      <a href="03-05-Tema5.html">Tema 5: SARIMA</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Ejemplo de aplicación</li>
    <li>
      <a href="03-06-Ejemplo1.html">Ejemplo Tema 1</a>
    </li>
    <li>
      <a href="03-07-Ejemplo2.html">Ejemplo Tema 2</a>
    </li>
    <li>
      <a href="03-08-Ejemplo3.html">Ejemplo Tema 3</a>
    </li>
    <li>
      <a href="03-09-Ejemplo4.html">Ejemplo Tema 4</a>
    </li>
    <li>
      <a href="03-10-Ejemplo5.html">Ejemplo Tema 5</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Otro ejemplo</li>
    <li>
      <a href="03-11-Ejemplo-Pasajeros.html">Ejemplo de Pasajeros</a>
    </li>
  </ul>
</li>
<li>
  <a href="04-Recursos-R.html">
    <span class="fa fa-code"></span>
     
    Recursos de R
  </a>
</li>
<li>
  <a href="05-Practica.html">
    <span class="fa fa-edit"></span>
     
    Practica
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-download"></span>
     
    Más
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">R</li>
    <li>
      <a href="https://cran.r-project.org">Dónde está R</a>
    </li>
    <li>
      <a href="https://rstudio.com">Donde está RStudio</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Markdown</li>
    <li>
      <a href="https://bookdown.org/yihui/rmarkdown/">Markdown</a>
    </li>
    <li>
      <a href="https://rmarkdown.rstudio.com/lesson-1.html">R Markdown</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Otros</li>
    <li>
      <a href="https://www.r-bloggers.com">Blog sobre R</a>
    </li>
    <li>
      <a href="https://bookdown.org">Libros online que debes conocer</a>
    </li>
  </ul>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-download-source" href="#">Download Rmd</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Defunciones por Enfermedades Cerebrovasculares</h1>
<h3 class="subtitle">Procesos ARIMA con estacionalidad</h3>
<h4 class="author">Iván Arribas (Depto. Análisis Económico. Universitat de València)</h4>

</div>

<div id="TOC">
<ul>
<li><a href="#introducción"><span class="toc-section-number">1</span> Introducción</a></li>
<li><a href="#identificación"><span class="toc-section-number">2</span> Identificación</a></li>
<li><a href="#estimación"><span class="toc-section-number">3</span> Estimación</a></li>
<li><a href="#validación"><span class="toc-section-number">4</span> Validación</a></li>
<li><a href="#ecuación-del-modelo-identificado"><span class="toc-section-number">5</span> Ecuación del modelo identificado</a></li>
<li><a href="#predicción-de-las-defunciones-por-enfermedad-cerebrovascular"><span class="toc-section-number">6</span> Predicción de las defunciones por enfermedad cerebrovascular</a></li>
<li><a href="#comparación-con-alisado-exponencial"><span class="toc-section-number">7</span> Comparación con Alisado Exponencial</a></li>
</ul>
</div>

<p><br />
<br />
</p>
<div id="introducción" class="section level1" number="1">
<h1 number="1"><span class="header-section-number">1</span> Introducción</h1>
<p>Consideremos de nuevo la serie temporal correspondiente al número de defunciones causadas por enfermedades cerebrovasculares, Esta serie está disponible en el Instituto Nacional de Estadística desde enero de 1980 hasta diciembre de 2018, un total de 39 años o 468 meses</p>
<p>En la descriptiva vimos que la descomposición revelaba la presencia de varios valores atípicos concentrados al inicio de la serie. Por este motivo, para su análisis por modelos ARIMA vamos a recortar la serie, que empezará el enero de 1988.</p>
<p>También hemos visto que para alcanzar la estacionariedad y verificar la hipótesis de ergodicidad es necesario diferenciar la serie tanto en la parte regular como estacional y decidimos usar la transformación logarítmica para linealizar la serie y ganar en interpretabilidad.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>DefEnfCer <span class="ot">&lt;-</span> <span class="fu">read.csv2</span>(<span class="st">&quot;./series/Enfermedades cerebrovasculares.csv&quot;</span>, <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>DefEnfCer <span class="ot">&lt;-</span> <span class="fu">ts</span>(DefEnfCer[,<span class="dv">2</span>], <span class="at">start =</span> <span class="dv">1980</span>, <span class="at">freq =</span> <span class="dv">12</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>DefEnfCer <span class="ot">&lt;-</span> <span class="fu">window</span>(DefEnfCer, <span class="at">start =</span> <span class="dv">1988</span>)</span></code></pre></div>
<p><br />
<br />
</p>
</div>
<div id="identificación" class="section level1" number="2">
<h1 number="2"><span class="header-section-number">2</span> Identificación</h1>
<p>Vamos a identificar los valores de <span class="math inline">\(p\)</span>, <span class="math inline">\(q\)</span>, <span class="math inline">\(P\)</span> y <span class="math inline">\(Q\)</span>. Para ello, analizaremos la FAC y la FACP, y solicitaremos con <code>auto.arima</code> y <code>seas</code> una identificación automática. Con <code>auto.arima</code> incluiremos un efecto calendario para el número de días del mes y otras variables ficticias para los tres valores atípicos ya identificados cuando aplicamos Alisado exponencial: febrero de 1999, enero de 2005 y febrero de 2012. La descriptiva realizada revelaba que las muertes por enfermedades cerebrovasculares está poco relacionada con el número de días del mes y más con la estación del año.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggtsdisplay</span>(<span class="fu">diff</span>(<span class="fu">diff</span>(<span class="fu">log</span>(DefEnfCer), <span class="at">lag =</span> <span class="dv">12</span>)), <span class="at">lag =</span> <span class="dv">48</span>,</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">main =</span> <span class="st">&quot;Figura 1. FAC y FACP para Defunciones. (log)&quot;</span>)</span></code></pre></div>
<p><img src="03-10-Ejemplo5_files/figure-html/unnamed-chunk-2-1.png" width="80%" style="display: block; margin: auto;" /></p>
<p>En la parte regular, la FAC muestra que la primera autocorrelación está por encima del IC95 y en la FACP se observa decrecimiento. En la parte estacional, la FAC muestra una autocorrelación significativa en el orden 12 y la FACP muestra decrecimiento. Así, podemos identificar el proceso como <span class="math inline">\(log(DefEnfCer_t) \sim ARIMA_{12}(0,1,1)(0,1,1)\)</span>.</p>
<p>Veamos ahora <code>auto.arima</code></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>DiasMes <span class="ot">&lt;-</span> <span class="fu">monthdays</span>(DefEnfCer)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>d0299 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">*</span>(<span class="fu">cycle</span>(DefEnfCer) <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">trunc</span>(<span class="fu">time</span>(DefEnfCer)) <span class="sc">==</span> <span class="dv">1999</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>d0105 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">*</span>(<span class="fu">cycle</span>(DefEnfCer) <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> <span class="fu">trunc</span>(<span class="fu">time</span>(DefEnfCer)) <span class="sc">==</span> <span class="dv">2005</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>d0212 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">*</span>(<span class="fu">cycle</span>(DefEnfCer) <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">trunc</span>(<span class="fu">time</span>(DefEnfCer)) <span class="sc">==</span> <span class="dv">2012</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="fu">auto.arima</span>(DefEnfCer, <span class="at">d =</span> <span class="dv">1</span>, <span class="at">D =</span> <span class="dv">1</span>,</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">lambda =</span> <span class="dv">0</span>,</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">xreg =</span> <span class="fu">cbind</span>(DiasMes, d0299, d0105, d0212))</span></code></pre></div>
<pre><code>Series: DefEnfCer 
Regression with ARIMA(2,1,2)(2,1,2)[12] errors 
Box Cox transformation: lambda= 0 

Coefficients:
         ar1      ar2      ma1     ma2     sar1     sar2     sma1     sma2
      0.8083  -0.0937  -1.5329  0.5557  -0.8925  -0.2432  -0.1314  -0.5405
s.e.  0.0271   0.0317   0.0317  0.0315   0.0308   0.0357   0.0387   0.0282
      DiasMes   d0299   d0105   d0212
      -0.0011  0.1842  0.1226  0.2028
s.e.   0.0174  0.0419  0.0416  0.0441

sigma^2 estimated as 0.002147:  log likelihood=589.08
AIC=-1152.16   AICc=-1151.11   BIC=-1101.68</code></pre>
<p>La función <code>auto.arima</code> identifica un complejo proceso <span class="math inline">\(ARIMA_{12}(2,1,2)(2,1,2)\)</span>, donde el coeficiente para para días del mes claramente no es significativo. La identificación alcanzada por <code>seas</code> es un proceso <span class="math inline">\(ARIMA_{12}(1,1,1)(1,1,1)\)</span>, con dos intervenciones en febrero de 1999 y 2012.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">seas</span>(DefEnfCer))</span></code></pre></div>
<pre><code>
Call:
seas(x = DefEnfCer)

Coefficients:
                  Estimate Std. Error z value Pr(&gt;|z|)    
AO1999.Feb         0.18751    0.04205   4.459 8.25e-06 ***
AO2012.Feb         0.20692    0.04231   4.891 1.00e-06 ***
AR-Nonseasonal-01  0.25258    0.05573   4.532 5.83e-06 ***
AR-Seasonal-12    -0.19962    0.05529  -3.611 0.000305 ***
MA-Nonseasonal-01  0.93923    0.02055  45.700  &lt; 2e-16 ***
MA-Seasonal-12     0.84122    0.03026  27.800  &lt; 2e-16 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

SEATS adj.  ARIMA: (1 1 1)(1 1 1)  Obs.: 372  Transform: log
AICc:  4560, BIC:  4587  QS (no seasonality in final):    0  
Box-Ljung (no autocorr.): 19.56   Shapiro (normality): 0.9848 ***</code></pre>
<p>Vamos a partir de la identificación obtenida por <code>seas</code> (más parsimoniosa que la de <code>auto.arima</code>), incluyendo las tres variables ficticias que afectan un único mes: <span class="math inline">\(log(DefEnfCer) \sim ARIMA_{12}(1,1,1)(1,1,1) + AI\)</span>.</p>
<p><br />
<br />
</p>
</div>
<div id="estimación" class="section level1" number="3">
<h1 number="3"><span class="header-section-number">3</span> Estimación</h1>
<p>La siguiente salida muestra el modelo estimado y la figura 2 permite analizar la presencia de más valores extremos.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>DefEnfCerArima1 <span class="ot">&lt;-</span> <span class="fu">Arima</span>(DefEnfCer, </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>),  </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">seasonal =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">lambda =</span> <span class="dv">0</span>,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">xreg =</span> <span class="fu">cbind</span>(d0299, d0105, d0212))</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>DefEnfCerArima1</span></code></pre></div>
<pre><code>Series: DefEnfCer 
Regression with ARIMA(1,1,1)(1,1,1)[12] errors 
Box Cox transformation: lambda= 0 

Coefficients:
         ar1      ma1     sar1     sma1   d0299   d0105   d0212
      0.2411  -0.9389  -0.1885  -0.8372  0.1868  0.1144  0.2066
s.e.  0.0595   0.0231   0.0616   0.0391  0.0427  0.0424  0.0424

sigma^2 estimated as 0.002152:  log likelihood=586.04
AIC=-1156.07   AICc=-1155.66   BIC=-1125.01</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>error <span class="ot">&lt;-</span> <span class="fu">residuals</span>(DefEnfCerArima1)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>sderror <span class="ot">&lt;-</span> <span class="fu">sd</span>(error)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(error, <span class="at">series=</span><span class="st">&quot;Error&quot;</span>,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">&quot;Error&quot;</span>,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">&quot;Figura 2. Error + Intervención&quot;</span>) <span class="sc">+</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>)<span class="sc">*</span>sderror, </span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour =</span> <span class="fu">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;green&quot;</span>, <span class="st">&quot;green&quot;</span>, <span class="st">&quot;red&quot;</span>), </span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span> <span class="fu">seq</span>(<span class="dv">1988</span>, <span class="dv">2018</span>, <span class="dv">2</span>)) </span></code></pre></div>
<p><img src="03-10-Ejemplo5_files/figure-html/unnamed-chunk-6-1.png" width="80%" style="display: block; margin: auto;" /> Se observan tres valores claramente atípicos en mayo de 2001, junio de 2003 y enero de 2015. Además, hay otros candidatos a valor extremo, entre los que destacan marzo de 1989 y agosto de 2003. Procederemos a incluirlos en el modelo. Además, vamos a incluir febrero de 2015 que en una ronda posterior del análisis del residuo supera las tres desviaciones típicas.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>d0501 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">*</span>(<span class="fu">cycle</span>(DefEnfCer) <span class="sc">==</span> <span class="dv">5</span> <span class="sc">&amp;</span> <span class="fu">trunc</span>(<span class="fu">time</span>(DefEnfCer)) <span class="sc">==</span> <span class="dv">2001</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>d0603 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">*</span>(<span class="fu">cycle</span>(DefEnfCer) <span class="sc">==</span> <span class="dv">6</span> <span class="sc">&amp;</span> <span class="fu">trunc</span>(<span class="fu">time</span>(DefEnfCer)) <span class="sc">==</span> <span class="dv">2003</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>d0115 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">*</span>(<span class="fu">cycle</span>(DefEnfCer) <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> <span class="fu">trunc</span>(<span class="fu">time</span>(DefEnfCer)) <span class="sc">==</span> <span class="dv">2015</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>d0215 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">*</span>(<span class="fu">cycle</span>(DefEnfCer) <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> <span class="fu">trunc</span>(<span class="fu">time</span>(DefEnfCer)) <span class="sc">==</span> <span class="dv">2015</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>d0389 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">*</span>(<span class="fu">cycle</span>(DefEnfCer) <span class="sc">==</span> <span class="dv">3</span> <span class="sc">&amp;</span> <span class="fu">trunc</span>(<span class="fu">time</span>(DefEnfCer)) <span class="sc">==</span> <span class="dv">1989</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>d0803 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">*</span>(<span class="fu">cycle</span>(DefEnfCer) <span class="sc">==</span> <span class="dv">8</span> <span class="sc">&amp;</span> <span class="fu">trunc</span>(<span class="fu">time</span>(DefEnfCer)) <span class="sc">==</span> <span class="dv">2003</span>)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>DefEnfCerArima2 <span class="ot">&lt;-</span> <span class="fu">Arima</span>(DefEnfCer, </span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>                         <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>),  </span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>                         <span class="at">seasonal =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>                         <span class="at">lambda =</span> <span class="dv">0</span>,</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>                         <span class="at">xreg =</span> <span class="fu">cbind</span>(d0299, d0105, d0215, d0212, d0501, </span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>                                      d0603, d0115, d0389, d0803))</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>DefEnfCerArima2</span></code></pre></div>
<pre><code>Series: DefEnfCer 
Regression with ARIMA(1,1,1)(1,1,1)[12] errors 
Box Cox transformation: lambda= 0 

Coefficients:
         ar1      ma1     sar1     sma1   d0299   d0105   d0215   d0212   d0501
      0.2103  -0.9418  -0.1609  -0.8270  0.1906  0.1244  0.1493  0.2216  0.1122
s.e.  0.0602   0.0216   0.0639   0.0391  0.0402  0.0400  0.0413  0.0402  0.0393
       d0603   d0115    d0389   d0803
      0.1511  0.1148  -0.0742  0.1477
s.e.  0.0396  0.0414   0.0412  0.0400

sigma^2 estimated as 0.001897:  log likelihood=612.4
AIC=-1196.81   AICc=-1195.59   BIC=-1142.44</code></pre>
<p>Aparentemente las variables de intervención incluidas son significativas, exceptuando la de marzo de 1989. Este hecho lo contrastaremos más adelante.</p>
<p>El análisis gráfico del residuo indica que aún hay candidatos a valores atípicos. Aunque ninguno alcanza las tres desviaciones típicas, al menos dos de ellos están muy cerca. Sin embargo, vamos a dar por concluido este proceso.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>error <span class="ot">&lt;-</span> <span class="fu">residuals</span>(DefEnfCerArima2)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>sderror <span class="ot">&lt;-</span> <span class="fu">sd</span>(error)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(error, <span class="at">series=</span><span class="st">&quot;Error&quot;</span>,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">&quot;Error&quot;</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">&quot;Figura 3. Error + Intervención&quot;</span>) <span class="sc">+</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>)<span class="sc">*</span>sderror, </span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour =</span> <span class="fu">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;green&quot;</span>, <span class="st">&quot;green&quot;</span>, <span class="st">&quot;red&quot;</span>), </span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span> <span class="fu">seq</span>(<span class="dv">1988</span>, <span class="dv">2018</span>, <span class="dv">2</span>)) </span></code></pre></div>
<p><img src="03-10-Ejemplo5_files/figure-html/unnamed-chunk-8-1.png" width="80%" style="display: block; margin: auto;" /></p>
<p>Se observa que tres de los valores atípicos corresponden al mes de febrero y que sus coeficientes estimados toman valores parecidos. También has dos meses de enero atípicos con similar efecto. Vamos a asumir que la causa que hay detrás del valor anómalo en los meses de febrero es la misma. Lo mismo asumiremos para los valores atípicos en enero. Esto nos permite <em>agrupar</em> variables de intervención y simplificar el modelo.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>d01aa <span class="ot">&lt;-</span> d0105 <span class="sc">+</span> d0115</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>d02aa <span class="ot">&lt;-</span> d0299 <span class="sc">+</span> d0215 <span class="sc">+</span> d0212</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>DefEnfCerArima3 <span class="ot">&lt;-</span> <span class="fu">Arima</span>(DefEnfCer, </span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>),  </span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">seasonal =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>                         <span class="at">lambda =</span> <span class="dv">0</span>,</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">xreg =</span> <span class="fu">cbind</span>(d01aa, d02aa, d0501, </span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>                                      d0603, d0389, d0803))</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>DefEnfCerArima3</span></code></pre></div>
<pre><code>Series: DefEnfCer 
Regression with ARIMA(1,1,1)(1,1,1)[12] errors 
Box Cox transformation: lambda= 0 

Coefficients:
         ar1      ma1     sar1     sma1   d01aa   d02aa   d0501   d0603
      0.2164  -0.9439  -0.1561  -0.8273  0.1248  0.1876  0.1124  0.1508
s.e.  0.0590   0.0211   0.0637   0.0391  0.0291  0.0246  0.0393  0.0397
        d0389   d0803
      -0.0744  0.1477
s.e.   0.0412  0.0400

sigma^2 estimated as 0.00189:  log likelihood=611.52
AIC=-1201.04   AICc=-1200.28   BIC=-1158.33</code></pre>
<p>Por último, veamos si todos los coeficientes del modelo son significativos.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>ancho <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">nchar</span>(<span class="fu">names</span>(<span class="fu">coef</span>(DefEnfCerArima3)))) <span class="sc">+</span> <span class="dv">2</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(<span class="fu">coef</span>(DefEnfCerArima3))) {</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  wt <span class="ot">&lt;-</span> <span class="fu">wald.test</span>(<span class="at">b =</span> <span class="fu">coef</span>(DefEnfCerArima3), </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Sigma =</span> <span class="fu">vcov</span>(DefEnfCerArima3), </span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Terms =</span> i)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">Coeficiente: &quot;</span>, <span class="fu">format</span>(<span class="fu">names</span>(<span class="fu">coef</span>(DefEnfCerArima3))[i], <span class="at">width =</span> ancho), <span class="st">&quot;valor de p: &quot;</span>,</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">formatC</span>(wt<span class="sc">$</span>result<span class="sc">$</span>chi2[<span class="dv">3</span>], <span class="at">digits =</span> <span class="dv">4</span>, <span class="at">format =</span> <span class="st">&quot;f&quot;</span>))</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>
Coeficiente:  ar1     valor de p:  0.0002
Coeficiente:  ma1     valor de p:  0.0000
Coeficiente:  sar1    valor de p:  0.0143
Coeficiente:  sma1    valor de p:  0.0000
Coeficiente:  d01aa   valor de p:  0.0000
Coeficiente:  d02aa   valor de p:  0.0000
Coeficiente:  d0501   valor de p:  0.0043
Coeficiente:  d0603   valor de p:  0.0001
Coeficiente:  d0389   valor de p:  0.0713
Coeficiente:  d0803   valor de p:  0.0002</code></pre>
<p>Aunque el coeficiente del efecto de marzo de 1989 no es significativo al 5%, si los es al 10% así que optamos por dejarlo.</p>
<p><br />
<br />
</p>
</div>
<div id="validación" class="section level1" number="4">
<h1 number="4"><span class="header-section-number">4</span> Validación</h1>
<p>Analizando los criterios de bondad de ajuste se tiene que: el error medio (ME), igual a -6.85, es prácticamente cero por lo que no parece que haya sesgo en las predicciones; en media nos equivocamos en 133 defunciones (RMSE); y el error porcentual medio es 3.2%, muy bajo.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(DefEnfCerArima3)</span></code></pre></div>
<pre><code>                ME   RMSE   MAE  MPE MAPE MASE  ACF1
Training set -6.92 133.14 98.16 -0.3 3.26 0.57 -0.01</code></pre>
<p><br />
</p>
<div id="incorrelación-homocedasticidad-y-normalidad" class="section level3 unnumbered">
<h3 class="unnumbered">Incorrelación, Homocedasticidad y Normalidad</h3>
<p>Veamos ahora si el residuo es ruido blanco.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>error <span class="ot">&lt;-</span> <span class="fu">residuals</span>(DefEnfCerArima3)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">Box.test</span>(error, <span class="at">lag =</span> <span class="dv">2</span>,<span class="at">type =</span> <span class="st">&quot;Ljung-Box&quot;</span>)</span></code></pre></div>
<pre><code>
    Box-Ljung test

data:  error
X-squared = 0.48502, df = 2, p-value = 0.7847</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Box.test</span>(error, <span class="at">lag =</span> <span class="dv">24</span>,<span class="at">type =</span> <span class="st">&quot;Ljung-Box&quot;</span>)</span></code></pre></div>
<pre><code>
    Box-Ljung test

data:  error
X-squared = 14.991, df = 24, p-value = 0.921</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Box.test</span>(error<span class="sc">^</span><span class="dv">2</span>, <span class="at">lag =</span> <span class="dv">2</span>, <span class="at">type =</span> <span class="st">&quot;Ljung-Box&quot;</span>)</span></code></pre></div>
<pre><code>
    Box-Ljung test

data:  error^2
X-squared = 0.71374, df = 2, p-value = 0.6999</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Box.test</span>(error<span class="sc">^</span><span class="dv">2</span>, <span class="at">lag =</span> <span class="dv">24</span>, <span class="at">type =</span> <span class="st">&quot;Ljung-Box&quot;</span>)</span></code></pre></div>
<pre><code>
    Box-Ljung test

data:  error^2
X-squared = 26.78, df = 24, p-value = 0.3148</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">jarque.bera.test</span>(error) </span></code></pre></div>
<pre><code>
    Jarque Bera Test

data:  error
X-squared = 1.7007, df = 2, p-value = 0.4273</code></pre>
<p>El error muestra ser incorrelado, homocedástico y seguir una distribución normal.</p>
<p><br />
<br />
</p>
</div>
</div>
<div id="ecuación-del-modelo-identificado" class="section level1" number="5">
<h1 number="5"><span class="header-section-number">5</span> Ecuación del modelo identificado</h1>
<p>Ahora que ya hemos dado por válido el modelo, veamos cuál es su ecuación.</p>
<p>El <strong>modelo teórico</strong> es <span class="math display">\[(1 - \phi_1 L)(1 - \phi_{12}L^{12})(1-L)(1-L^{12})log(DefEnfCer_t) =(1+\theta_1 L)(1 + \theta_{12}L^{12})\varepsilon_t +AI.\]</span> Debido a la complejidad del modelo, no vamos a desarrollarlo, ni interpretarlo en su parte estructural. Respecto de la intervención:</p>
<ul>
<li><p>En los dos meses de enero atípicos, la defunciones fueron un 12.5% mayores que las observadas en otros meses de enero.</p></li>
<li><p>De la misma forma, en los tres meses de febrero atípicos, la defunciones fueron un 18.8% mayores que las observadas en otros meses de febrero.</p></li>
<li><p>En mayo de 2001 hubo un aumento en las defunciones del 11.2% respecto de lo esperado; en junio de 2003 del 15.1% y en agosto de 2003 del 14.8%.</p></li>
<li><p>En marzo de 1989, las defunciones fueron un 7.4% menores de lo esperado.</p></li>
</ul>
<p><br />
<br />
</p>
</div>
<div id="predicción-de-las-defunciones-por-enfermedad-cerebrovascular" class="section level1" number="6">
<h1 number="6"><span class="header-section-number">6</span> Predicción de las defunciones por enfermedad cerebrovascular</h1>
<p>Una vez dado por válido el modelo, podemos pasar a realizar predicciones para los próximos años. Como la variables de intervención no son efectos calendario sus valores previstos serán cero.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>pDefEnfCerArima3 <span class="ot">&lt;-</span> <span class="fu">forecast</span>(DefEnfCerArima3, </span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>                             <span class="at">h =</span> <span class="dv">60</span>,</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>                             <span class="at">xreg =</span> <span class="fu">cbind</span>(<span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">60</span>), <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">60</span>), <span class="fu">rep</span>(<span class="dv">0</span> ,<span class="dv">60</span>), </span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>                                          <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">60</span>), <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">60</span>), <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">60</span>)), </span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>                             <span class="at">level =</span> <span class="dv">95</span>)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="fu">aggregate</span>(pDefEnfCerArima3<span class="sc">$</span>mean, <span class="at">FUN =</span> sum)</span></code></pre></div>
<pre><code>Time Series:
Start = 2019 
End = 2023 
Frequency = 1 
[1] 25754.52 25361.52 24914.63 24484.90 24061.15</code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(pDefEnfCerArima3, </span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">&#39;Defunciones&#39;</span>,</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">&#39;Figura 4. Defunciones (1988-2018) y predicción (2019-2024)&#39;</span>) <span class="sc">+</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span> <span class="fu">seq</span>(<span class="dv">1988</span>, <span class="dv">2024</span>, <span class="dv">4</span>)) </span></code></pre></div>
<p><img src="03-10-Ejemplo5_files/figure-html/unnamed-chunk-14-1.png" width="80%" style="display: block; margin: auto;" /></p>
<p>A partir de 2021 se espera que el total de defunciones por enfermedad cerebrovascular caiga por debajo de los 25000 casos.</p>
<p><br />
<br />
</p>
</div>
<div id="comparación-con-alisado-exponencial" class="section level1" number="7">
<h1 number="7"><span class="header-section-number">7</span> Comparación con Alisado Exponencial</h1>
<p>El método de Alisado exponencial, aplicado sobre el logaritmo de las defunciones identifica un proceso (A,A,A) con <span class="math inline">\(\alpha=0.18\)</span> y <span class="math inline">\(\beta = \gamma = 0\)</span>. La raíz del error cuadrático medio (RMSE) es de 159 casos y el error porcentual (MAPE) del 3.7%. Estos valores son algo superiores a los obtenidos con el modelo Arima (133 y 3.2%, respectivamente).</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">ets</span>(DefEnfCer, <span class="at">lambda =</span> <span class="dv">0</span>))</span></code></pre></div>
<pre><code>ETS(A,A,A) 

Call:
 ets(y = DefEnfCer, lambda = 0) 

  Box-Cox transformation: lambda= 0 

  Smoothing parameters:
    alpha = 0.1764 
    beta  = 1e-04 
    gamma = 1e-04 

  Initial states:
    l = 8.2094 
    b = -0.0015 
    s = 0.1293 -0.0094 -0.0463 -0.1695 -0.0921 -0.0536
           -0.0996 -0.0372 -0.0225 0.0957 0.0939 0.2113

  sigma:  0.0505

       AIC       AICc        BIC 
-1.6107137  0.1180998 65.0104818 

Training set error measures:
                   ME     RMSE      MAE        MPE     MAPE     MASE      ACF1
Training set 4.516472 158.6233 113.1012 -0.1049242 3.683735 0.659023 0.1622008</code></pre>
<p>Vamos a determinar si la aplicación de modelos Arima mejora la calidad de las predicciones lo suficiente como para justificar su uso –frente a los métodos de alisado, mucho más sencillos. Para ello, aplicaremos la metodología de origen de predicción móvil para estimar la capacidad predictiva del modelo Arima y compararla con el modelo de Alisado.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">120</span>                   </span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>h <span class="ot">&lt;-</span> <span class="dv">12</span>                    </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>T <span class="ot">&lt;-</span> <span class="fu">length</span>(DefEnfCer)     </span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> T <span class="sc">-</span> k <span class="sc">-</span> h               </span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>mapeArima <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, s <span class="sc">+</span> <span class="dv">1</span>, h)</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>mapeAlisado <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, s <span class="sc">+</span> <span class="dv">1</span>, h)</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">cbind</span>(d01aa, d02aa, d0501, d0603, d0389, d0803))</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">0</span><span class="sc">:</span>s) {</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>  train.set <span class="ot">&lt;-</span> <span class="fu">subset</span>(DefEnfCer, <span class="at">start =</span> i <span class="sc">+</span> <span class="dv">1</span>, <span class="at">end =</span> i <span class="sc">+</span> k)</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>  test.set <span class="ot">&lt;-</span>  <span class="fu">subset</span>(DefEnfCer, <span class="at">start =</span> i <span class="sc">+</span> k <span class="sc">+</span> <span class="dv">1</span>, <span class="at">end =</span> i <span class="sc">+</span> k <span class="sc">+</span> h) </span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>  X.train <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(X[(i <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>(i <span class="sc">+</span> k),])</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>  hay <span class="ot">&lt;-</span> <span class="fu">colSums</span>(X.train)</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>  X.train <span class="ot">&lt;-</span> X.train[, hay<span class="sc">&gt;</span><span class="dv">0</span>]</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>  X.test <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(X[(i <span class="sc">+</span> k <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>(i <span class="sc">+</span> k <span class="sc">+</span> h),])</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>  X.test <span class="ot">&lt;-</span> X.test[, hay<span class="sc">&gt;</span><span class="dv">0</span>]</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(X.train) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>    fit <span class="ot">&lt;-</span> <span class="fu">try</span>(<span class="fu">Arima</span>(train.set, </span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>                     <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>                     <span class="at">seasonal =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>), </span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>                     <span class="at">lambda =</span> <span class="dv">0</span>,</span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>                     <span class="at">xreg =</span> <span class="fu">as.matrix</span>(X.train)), <span class="at">silent =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a>    fit <span class="ot">&lt;-</span> <span class="fu">try</span>(<span class="fu">Arima</span>(train.set, </span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a>                     <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a>                     <span class="at">seasonal =</span>  <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a>                     <span class="at">lambda =</span> <span class="dv">0</span>), <span class="at">silent =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.element</span>(<span class="st">&quot;try-error&quot;</span>, <span class="fu">class</span>(fit))) {</span>
<span id="cb34-36"><a href="#cb34-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">length</span>(X.train) <span class="sc">&gt;</span> <span class="dv">0</span>) fcast <span class="ot">&lt;-</span> <span class="fu">forecast</span>(fit, <span class="at">h =</span> h, <span class="at">xreg =</span> <span class="fu">as.matrix</span>(X.test)) <span class="cf">else</span></span>
<span id="cb34-37"><a href="#cb34-37" aria-hidden="true" tabindex="-1"></a>      fcast <span class="ot">&lt;-</span> <span class="fu">forecast</span>(fit, <span class="at">h =</span> h)</span>
<span id="cb34-38"><a href="#cb34-38" aria-hidden="true" tabindex="-1"></a>    mapeArima[i <span class="sc">+</span> <span class="dv">1</span>,] <span class="ot">&lt;-</span> <span class="dv">100</span><span class="sc">*</span><span class="fu">abs</span>(test.set <span class="sc">-</span> fcast<span class="sc">$</span>mean)<span class="sc">/</span>test.set</span>
<span id="cb34-39"><a href="#cb34-39" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb34-40"><a href="#cb34-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-41"><a href="#cb34-41" aria-hidden="true" tabindex="-1"></a>  fit <span class="ot">&lt;-</span> <span class="fu">ets</span>(train.set, <span class="at">lambda =</span> <span class="dv">0</span>, <span class="at">model =</span> <span class="st">&quot;AAA&quot;</span>, <span class="at">damped =</span> <span class="cn">FALSE</span>)</span>
<span id="cb34-42"><a href="#cb34-42" aria-hidden="true" tabindex="-1"></a>  fcast<span class="ot">&lt;-</span><span class="fu">forecast</span>(fit, <span class="at">h =</span> h)</span>
<span id="cb34-43"><a href="#cb34-43" aria-hidden="true" tabindex="-1"></a>  mapeAlisado[i <span class="sc">+</span> <span class="dv">1</span>,] <span class="ot">&lt;-</span> <span class="dv">100</span><span class="sc">*</span><span class="fu">abs</span>(test.set <span class="sc">-</span> fcast<span class="sc">$</span>mean)<span class="sc">/</span>test.set</span>
<span id="cb34-44"><a href="#cb34-44" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb34-45"><a href="#cb34-45" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-46"><a href="#cb34-46" aria-hidden="true" tabindex="-1"></a>errorArima <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(mapeArima, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-47"><a href="#cb34-47" aria-hidden="true" tabindex="-1"></a>errorArima</span></code></pre></div>
<pre><code> [1] 3.412357 3.675783 3.723007 3.852703 3.920721 3.869289 3.822326 3.864354
 [9] 3.838264 3.839550 3.800431 3.852546</code></pre>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>errorAlisado <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(mapeAlisado)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>errorAlisado</span></code></pre></div>
<pre><code> [1] 3.895174 4.367106 4.482920 4.533209 4.615324 4.780622 4.806991 4.900013
 [9] 4.673138 4.577775 4.559047 4.578201</code></pre>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">y =</span> errorArima), <span class="at">colour =</span> <span class="st">&quot;Blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">y =</span> errorAlisado), <span class="at">colour =</span> <span class="st">&quot;Red&quot;</span>) <span class="sc">+</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Figura 5. Error de predicción (MAPE) según horizonte temporal&quot;</span>) <span class="sc">+</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Horizonte temporal de predicción&quot;</span>) <span class="sc">+</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;%&quot;</span>) <span class="sc">+</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>)</span></code></pre></div>
<p><img src="03-10-Ejemplo5_files/figure-html/unnamed-chunk-18-1.png" width="80%" style="display: block; margin: auto;" /></p>
<p>La figura 5 revela que Arima siempre es superior a Alisado en calidad de predicciones, con un error porcentual inferior entre medio y un punto porcentual según el horizonte temporal. Además, en el modelo Arima el error se mantiene prácticamente constante.</p>
<p><br />
<br />
<br />
<br />
</p>
</div>

<div id="rmd-source-code">LS0tCnRpdGxlOiAiRGVmdW5jaW9uZXMgcG9yIEVuZmVybWVkYWRlcyBDZXJlYnJvdmFzY3VsYXJlcyIKc3VidGl0bGU6ICJQcm9jZXNvcyBBUklNQSBjb24gZXN0YWNpb25hbGlkYWQiCmF1dGhvcjogIkl2w6FuIEFycmliYXMgKERlcHRvLiBBbsOhbGlzaXMgRWNvbsOzbWljby4gVW5pdmVyc2l0YXQgZGUgVmFsw6huY2lhKSIKb3V0cHV0OiAKICBodG1sX2RvY3VtZW50OgogICAgdGhlbWU6IGNlcnVsZWFuCiAgICBoaWdobGlnaHQ6IHB5Z21lbnRzIAogICAgZmlnX2NhcHRpb246IGZhbHNlCiAgICBkZl9wcmludDoga2FibGUKICAgIHRvYzogdHJ1ZQogICAgdG9jX2RlcHRoOiAyCiAgICBudW1iZXJfc2VjdGlvbnM6IHRydWUKICAgIHNlbGZfY29udGFpbmVkOiB0cnVlCiAgICBjb2RlX2Rvd25sb2FkOiB0cnVlCi0tLQoKYGBge3IgY2h1bmtfc2V0dXAsIGVjaG8gPSBGQUxTRX0Ka25pdHI6Om9wdHNfY2h1bmskc2V0KHdhcm5pbmcgPSBGQUxTRSwgCiAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlID0gRkFMU0UsIAogICAgICAgICAgICAgICAgICAgICAgY29tbWVudCA9ICIiLAogICAgICAgICAgICAgICAgICAgICAgZmlnLmFsaWduID0gImNlbnRlciIsIAogICAgICAgICAgICAgICAgICAgICAgZmlnLnNob3cgPSAiaG9sZCIsCiAgICAgICAgICAgICAgICAgICAgICBmaWcuaGVpZ2h0ID0gNCwKICAgICAgICAgICAgICAgICAgICAgIGZpZy53aWR0aCA9IDgsCiAgICAgICAgICAgICAgICAgICAgICBvdXQud2lkdGggPSAiODAlIikgCmBgYAoKYGBge3IgbGlicmVyaWFzLCBlY2hvID0gRkFMU0V9CmxpYnJhcnkoZm9yZWNhc3QpCmxpYnJhcnkoZ2dwbG90Mik7IHRoZW1lX3NldCh0aGVtZV9idygpKQpsaWJyYXJ5KGdyaWRFeHRyYSkKbGlicmFyeShncmlkKQpsaWJyYXJ5KHRzZXJpZXMpCmxpYnJhcnkoYW9kKQpsaWJyYXJ5KHNlYXNvbmFsKQpgYGAKClwKXAoKIyBJbnRyb2R1Y2Npw7NuCgpDb25zaWRlcmVtb3MgZGUgbnVldm8gbGEgc2VyaWUgdGVtcG9yYWwgY29ycmVzcG9uZGllbnRlIGFsIG7Dum1lcm8gZGUgZGVmdW5jaW9uZXMgY2F1c2FkYXMgcG9yIGVuZmVybWVkYWRlcyBjZXJlYnJvdmFzY3VsYXJlcywgRXN0YSBzZXJpZSBlc3TDoSBkaXNwb25pYmxlIGVuIGVsIEluc3RpdHV0byBOYWNpb25hbCBkZSBFc3RhZMOtc3RpY2EgZGVzZGUgZW5lcm8gZGUgMTk4MCBoYXN0YSBkaWNpZW1icmUgZGUgMjAxOCwgdW4gdG90YWwgZGUgMzkgYcOxb3MgbyA0NjggbWVzZXMKCkVuIGxhIGRlc2NyaXB0aXZhIHZpbW9zIHF1ZSBsYSBkZXNjb21wb3NpY2nDs24gcmV2ZWxhYmEgbGEgcHJlc2VuY2lhIGRlIHZhcmlvcyB2YWxvcmVzIGF0w61waWNvcyBjb25jZW50cmFkb3MgYWwgaW5pY2lvIGRlIGxhIHNlcmllLiBQb3IgZXN0ZSBtb3Rpdm8sIHBhcmEgc3UgYW7DoWxpc2lzIHBvciBtb2RlbG9zIEFSSU1BIHZhbW9zIGEgcmVjb3J0YXIgbGEgc2VyaWUsIHF1ZSBlbXBlemFyw6EgZWwgZW5lcm8gZGUgMTk4OC4KClRhbWJpw6luIGhlbW9zIHZpc3RvIHF1ZSBwYXJhIGFsY2FuemFyIGxhIGVzdGFjaW9uYXJpZWRhZCB5IHZlcmlmaWNhciBsYSBoaXDDs3Rlc2lzIGRlIGVyZ29kaWNpZGFkIGVzIG5lY2VzYXJpbyBkaWZlcmVuY2lhciBsYSBzZXJpZSB0YW50byBlbiBsYSBwYXJ0ZSByZWd1bGFyIGNvbW8gZXN0YWNpb25hbCB5IGRlY2lkaW1vcyB1c2FyIGxhIHRyYW5zZm9ybWFjacOzbiBsb2dhcsOtdG1pY2EgcGFyYSBsaW5lYWxpemFyIGxhIHNlcmllIHkgZ2FuYXIgZW4gaW50ZXJwcmV0YWJpbGlkYWQuCgpgYGB7cn0KRGVmRW5mQ2VyIDwtIHJlYWQuY3N2MigiLi9zZXJpZXMvRW5mZXJtZWRhZGVzIGNlcmVicm92YXNjdWxhcmVzLmNzdiIsIGhlYWRlciA9IFRSVUUpCkRlZkVuZkNlciA8LSB0cyhEZWZFbmZDZXJbLDJdLCBzdGFydCA9IDE5ODAsIGZyZXEgPSAxMikKRGVmRW5mQ2VyIDwtIHdpbmRvdyhEZWZFbmZDZXIsIHN0YXJ0ID0gMTk4OCkKYGBgCgpcClwKCiMgSWRlbnRpZmljYWNpw7NuCgpWYW1vcyBhIGlkZW50aWZpY2FyIGxvcyB2YWxvcmVzIGRlICRwJCwgJHEkLCAkUCQgeSAkUSQuIFBhcmEgZWxsbywgYW5hbGl6YXJlbW9zIGxhIEZBQyB5IGxhIEZBQ1AsIHkgc29saWNpdGFyZW1vcyBjb24gYGF1dG8uYXJpbWFgIHkgYHNlYXNgIHVuYSBpZGVudGlmaWNhY2nDs24gYXV0b23DoXRpY2EuIENvbiBgYXV0by5hcmltYWAgaW5jbHVpcmVtb3MgdW4gZWZlY3RvIGNhbGVuZGFyaW8gcGFyYSBlbCBuw7ptZXJvIGRlIGTDrWFzIGRlbCBtZXMgeSBvdHJhcyB2YXJpYWJsZXMgZmljdGljaWFzIHBhcmEgbG9zIHRyZXMgdmFsb3JlcyBhdMOtcGljb3MgeWEgaWRlbnRpZmljYWRvcyBjdWFuZG8gYXBsaWNhbW9zIEFsaXNhZG8gZXhwb25lbmNpYWw6IGZlYnJlcm8gZGUgMTk5OSwgZW5lcm8gZGUgMjAwNSB5IGZlYnJlcm8gZGUgMjAxMi4gTGEgZGVzY3JpcHRpdmEgcmVhbGl6YWRhIHJldmVsYWJhIHF1ZSBsYXMgbXVlcnRlcyBwb3IgZW5mZXJtZWRhZGVzIGNlcmVicm92YXNjdWxhcmVzIGVzdMOhIHBvY28gcmVsYWNpb25hZGEgY29uIGVsIG7Dum1lcm8gZGUgZMOtYXMgZGVsIG1lcyB5IG3DoXMgY29uIGxhIGVzdGFjacOzbiBkZWwgYcOxby4KCmBgYHtyfSAKZ2d0c2Rpc3BsYXkoZGlmZihkaWZmKGxvZyhEZWZFbmZDZXIpLCBsYWcgPSAxMikpLCBsYWcgPSA0OCwKICAgICAgICAgICAgbWFpbiA9ICJGaWd1cmEgMS4gRkFDIHkgRkFDUCBwYXJhIERlZnVuY2lvbmVzLiAobG9nKSIpCmBgYAoKRW4gbGEgcGFydGUgcmVndWxhciwgbGEgRkFDIG11ZXN0cmEgcXVlIGxhIHByaW1lcmEgYXV0b2NvcnJlbGFjacOzbiBlc3TDoSBwb3IgZW5jaW1hIGRlbCBJQzk1IHkgZW4gbGEgRkFDUCBzZSBvYnNlcnZhIGRlY3JlY2ltaWVudG8uIEVuIGxhIHBhcnRlIGVzdGFjaW9uYWwsIGxhIEZBQyBtdWVzdHJhIHVuYSBhdXRvY29ycmVsYWNpw7NuIHNpZ25pZmljYXRpdmEgZW4gZWwgb3JkZW4gMTIgeSBsYSBGQUNQIG11ZXN0cmEgZGVjcmVjaW1pZW50by4gQXPDrSwgcG9kZW1vcyBpZGVudGlmaWNhciBlbCBwcm9jZXNvIGNvbW8gJGxvZyhEZWZFbmZDZXJfdCkgXHNpbSBBUklNQV97MTJ9KDAsMSwxKSgwLDEsMSkkLgoKVmVhbW9zIGFob3JhIGBhdXRvLmFyaW1hYAoKYGBge3J9CkRpYXNNZXMgPC0gbW9udGhkYXlzKERlZkVuZkNlcikKCmQwMjk5IDwtIDEqKGN5Y2xlKERlZkVuZkNlcikgPT0gMiAmIHRydW5jKHRpbWUoRGVmRW5mQ2VyKSkgPT0gMTk5OSkKZDAxMDUgPC0gMSooY3ljbGUoRGVmRW5mQ2VyKSA9PSAxICYgdHJ1bmModGltZShEZWZFbmZDZXIpKSA9PSAyMDA1KQpkMDIxMiA8LSAxKihjeWNsZShEZWZFbmZDZXIpID09IDIgJiB0cnVuYyh0aW1lKERlZkVuZkNlcikpID09IDIwMTIpCgphdXRvLmFyaW1hKERlZkVuZkNlciwgZCA9IDEsIEQgPSAxLAogICAgICAgICAgIGxhbWJkYSA9IDAsCiAgICAgICAgICAgeHJlZyA9IGNiaW5kKERpYXNNZXMsIGQwMjk5LCBkMDEwNSwgZDAyMTIpKQpgYGAKCkxhIGZ1bmNpw7NuIGBhdXRvLmFyaW1hYCBpZGVudGlmaWNhIHVuIGNvbXBsZWpvIHByb2Nlc28gJEFSSU1BX3sxMn0oMiwxLDIpKDIsMSwyKSQsIGRvbmRlIGVsIGNvZWZpY2llbnRlIHBhcmEgcGFyYSBkw61hcyBkZWwgbWVzIGNsYXJhbWVudGUgbm8gZXMgc2lnbmlmaWNhdGl2by4gTGEgaWRlbnRpZmljYWNpw7NuIGFsY2FuemFkYSBwb3IgYHNlYXNgIGVzIHVuIHByb2Nlc28gJEFSSU1BX3sxMn0oMSwxLDEpKDEsMSwxKSQsIGNvbiBkb3MgaW50ZXJ2ZW5jaW9uZXMgZW4gZmVicmVybyBkZSAxOTk5IHkgMjAxMi4KCmBgYHtyfQpzdW1tYXJ5KHNlYXMoRGVmRW5mQ2VyKSkKYGBgCgpWYW1vcyBhIHBhcnRpciBkZSBsYSBpZGVudGlmaWNhY2nDs24gb2J0ZW5pZGEgcG9yIGBzZWFzYCAobcOhcyBwYXJzaW1vbmlvc2EgcXVlIGxhIGRlIGBhdXRvLmFyaW1hYCksIGluY2x1eWVuZG8gbGFzIHRyZXMgdmFyaWFibGVzIGZpY3RpY2lhcyBxdWUgYWZlY3RhbiB1biDDum5pY28gbWVzOiAkbG9nKERlZkVuZkNlcikgXHNpbSBBUklNQV97MTJ9KDEsMSwxKSgxLDEsMSkgKyBBSSQuCgpcClwKCiMgRXN0aW1hY2nDs24gCgpMYSBzaWd1aWVudGUgc2FsaWRhIG11ZXN0cmEgZWwgbW9kZWxvIGVzdGltYWRvIHkgbGEgZmlndXJhIDIgcGVybWl0ZSBhbmFsaXphciBsYSBwcmVzZW5jaWEgZGUgbcOhcyB2YWxvcmVzIGV4dHJlbW9zLgoKYGBge3J9CkRlZkVuZkNlckFyaW1hMSA8LSBBcmltYShEZWZFbmZDZXIsIAogICAgICAgICAgICAgICAgICAgICAgICAgb3JkZXIgPSBjKDEsIDEsIDEpLCAgCiAgICAgICAgICAgICAgICAgICAgICAgICBzZWFzb25hbCA9IGMoMSwgMSwgMSksCiAgICAgICAgICAgICAgICAgICAgICAgICBsYW1iZGEgPSAwLAogICAgICAgICAgICAgICAgICAgICAgICAgeHJlZyA9IGNiaW5kKGQwMjk5LCBkMDEwNSwgZDAyMTIpKQpEZWZFbmZDZXJBcmltYTEKYGBgIAoKCmBgYHtyfSAKZXJyb3IgPC0gcmVzaWR1YWxzKERlZkVuZkNlckFyaW1hMSkKc2RlcnJvciA8LSBzZChlcnJvcikKCmF1dG9wbG90KGVycm9yLCBzZXJpZXM9IkVycm9yIiwKICAgICAgICAgY29sb3VyID0gImJsYWNrIiwKICAgICAgICAgeGxhYiA9ICIiLAogICAgICAgICB5bGFiID0gIkVycm9yIiwKICAgICAgICAgbWFpbiA9ICJGaWd1cmEgMi4gRXJyb3IgKyBJbnRlcnZlbmNpw7NuIikgKwogIGdlb21faGxpbmUoeWludGVyY2VwdCA9IGMoLTMsIC0yLCAyLCAzKSpzZGVycm9yLCAKICAgICAgICAgICAgIGNvbG91ciA9IGMoInJlZCIsICJncmVlbiIsICJncmVlbiIsICJyZWQiKSwgCiAgICAgICAgICAgICBsdHkgPSAyKSArIAogIHNjYWxlX3hfY29udGludW91cyhicmVha3M9IHNlcSgxOTg4LCAyMDE4LCAyKSkgCmBgYApTZSBvYnNlcnZhbiB0cmVzIHZhbG9yZXMgY2xhcmFtZW50ZSBhdMOtcGljb3MgZW4gbWF5byBkZSAyMDAxLCBqdW5pbyBkZSAyMDAzIHkgZW5lcm8gZGUgMjAxNS4gQWRlbcOhcywgaGF5IG90cm9zIGNhbmRpZGF0b3MgYSB2YWxvciBleHRyZW1vLCBlbnRyZSBsb3MgcXVlIGRlc3RhY2FuIG1hcnpvIGRlIDE5ODkgeSBhZ29zdG8gZGUgMjAwMy4gUHJvY2VkZXJlbW9zIGEgaW5jbHVpcmxvcyBlbiBlbCBtb2RlbG8uIEFkZW3DoXMsIHZhbW9zIGEgaW5jbHVpciBmZWJyZXJvIGRlIDIwMTUgcXVlIGVuIHVuYSByb25kYSBwb3N0ZXJpb3IgZGVsIGFuw6FsaXNpcyBkZWwgcmVzaWR1byBzdXBlcmEgbGFzIHRyZXMgZGVzdmlhY2lvbmVzIHTDrXBpY2FzLgoKYGBge3J9CmQwNTAxIDwtIDEqKGN5Y2xlKERlZkVuZkNlcikgPT0gNSAmIHRydW5jKHRpbWUoRGVmRW5mQ2VyKSkgPT0gMjAwMSkKZDA2MDMgPC0gMSooY3ljbGUoRGVmRW5mQ2VyKSA9PSA2ICYgdHJ1bmModGltZShEZWZFbmZDZXIpKSA9PSAyMDAzKQpkMDExNSA8LSAxKihjeWNsZShEZWZFbmZDZXIpID09IDEgJiB0cnVuYyh0aW1lKERlZkVuZkNlcikpID09IDIwMTUpCmQwMjE1IDwtIDEqKGN5Y2xlKERlZkVuZkNlcikgPT0gMiAmIHRydW5jKHRpbWUoRGVmRW5mQ2VyKSkgPT0gMjAxNSkKZDAzODkgPC0gMSooY3ljbGUoRGVmRW5mQ2VyKSA9PSAzICYgdHJ1bmModGltZShEZWZFbmZDZXIpKSA9PSAxOTg5KQpkMDgwMyA8LSAxKihjeWNsZShEZWZFbmZDZXIpID09IDggJiB0cnVuYyh0aW1lKERlZkVuZkNlcikpID09IDIwMDMpCgoKRGVmRW5mQ2VyQXJpbWEyIDwtIEFyaW1hKERlZkVuZkNlciwgCiAgICAgICAgICAgICAgICAgICAgICAgICBvcmRlciA9IGMoMSwgMSwgMSksICAKICAgICAgICAgICAgICAgICAgICAgICAgIHNlYXNvbmFsID0gYygxLCAxLCAxKSwKICAgICAgICAgICAgICAgICAgICAgICAgIGxhbWJkYSA9IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICB4cmVnID0gY2JpbmQoZDAyOTksIGQwMTA1LCBkMDIxNSwgZDAyMTIsIGQwNTAxLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkMDYwMywgZDAxMTUsIGQwMzg5LCBkMDgwMykpCkRlZkVuZkNlckFyaW1hMgpgYGAgCgpBcGFyZW50ZW1lbnRlIGxhcyB2YXJpYWJsZXMgZGUgaW50ZXJ2ZW5jacOzbiBpbmNsdWlkYXMgc29uIHNpZ25pZmljYXRpdmFzLCBleGNlcHR1YW5kbyBsYSBkZSBtYXJ6byBkZSAxOTg5LiBFc3RlIGhlY2hvIGxvIGNvbnRyYXN0YXJlbW9zIG3DoXMgYWRlbGFudGUuIAoKRWwgYW7DoWxpc2lzIGdyw6FmaWNvIGRlbCByZXNpZHVvIGluZGljYSBxdWUgYcO6biBoYXkgY2FuZGlkYXRvcyBhIHZhbG9yZXMgYXTDrXBpY29zLiBBdW5xdWUgbmluZ3VubyBhbGNhbnphIGxhcyB0cmVzIGRlc3ZpYWNpb25lcyB0w61waWNhcywgYWwgbWVub3MgZG9zIGRlIGVsbG9zIGVzdMOhbiBtdXkgY2VyY2EuIFNpbiBlbWJhcmdvLCB2YW1vcyBhIGRhciBwb3IgY29uY2x1aWRvIGVzdGUgcHJvY2Vzby4KCmBgYHtyfSAKZXJyb3IgPC0gcmVzaWR1YWxzKERlZkVuZkNlckFyaW1hMikKc2RlcnJvciA8LSBzZChlcnJvcikKCmF1dG9wbG90KGVycm9yLCBzZXJpZXM9IkVycm9yIiwKICAgICAgICAgY29sb3VyID0gImJsYWNrIiwKICAgICAgICAgeGxhYiA9ICIiLAogICAgICAgICB5bGFiID0gIkVycm9yIiwKICAgICAgICAgbWFpbiA9ICJGaWd1cmEgMy4gRXJyb3IgKyBJbnRlcnZlbmNpw7NuIikgKwogIGdlb21faGxpbmUoeWludGVyY2VwdCA9IGMoLTMsIC0yLCAyLCAzKSpzZGVycm9yLCAKICAgICAgICAgICAgIGNvbG91ciA9IGMoInJlZCIsICJncmVlbiIsICJncmVlbiIsICJyZWQiKSwgCiAgICAgICAgICAgICBsdHkgPSAyKSArIAogIHNjYWxlX3hfY29udGludW91cyhicmVha3M9IHNlcSgxOTg4LCAyMDE4LCAyKSkgCmBgYAoKU2Ugb2JzZXJ2YSBxdWUgdHJlcyBkZSBsb3MgdmFsb3JlcyBhdMOtcGljb3MgY29ycmVzcG9uZGVuIGFsIG1lcyBkZSBmZWJyZXJvIHkgcXVlIHN1cyBjb2VmaWNpZW50ZXMgZXN0aW1hZG9zIHRvbWFuIHZhbG9yZXMgcGFyZWNpZG9zLiBUYW1iacOpbiBoYXMgZG9zIG1lc2VzIGRlIGVuZXJvIGF0w61waWNvcyBjb24gc2ltaWxhciBlZmVjdG8uIFZhbW9zIGEgYXN1bWlyIHF1ZSBsYSBjYXVzYSBxdWUgaGF5IGRldHLDoXMgZGVsIHZhbG9yIGFuw7NtYWxvIGVuIGxvcyBtZXNlcyBkZSBmZWJyZXJvIGVzIGxhIG1pc21hLiBMbyBtaXNtbyBhc3VtaXJlbW9zIHBhcmEgbG9zIHZhbG9yZXMgYXTDrXBpY29zIGVuIGVuZXJvLiBFc3RvIG5vcyBwZXJtaXRlIF9hZ3J1cGFyXyB2YXJpYWJsZXMgZGUgaW50ZXJ2ZW5jacOzbiB5IHNpbXBsaWZpY2FyIGVsIG1vZGVsby4gCgpgYGB7cn0KZDAxYWEgPC0gZDAxMDUgKyBkMDExNQpkMDJhYSA8LSBkMDI5OSArIGQwMjE1ICsgZDAyMTIKCkRlZkVuZkNlckFyaW1hMyA8LSBBcmltYShEZWZFbmZDZXIsIAogICAgICAgICAgICAgICAgICAgICAgICAgb3JkZXIgPSBjKDEsIDEsIDEpLCAgCiAgICAgICAgICAgICAgICAgICAgICAgICBzZWFzb25hbCA9IGMoMSwgMSwgMSksCiAgICAgICAgICAgICAgICAgICAgICAgICBsYW1iZGEgPSAwLAogICAgICAgICAgICAgICAgICAgICAgICAgeHJlZyA9IGNiaW5kKGQwMWFhLCBkMDJhYSwgZDA1MDEsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGQwNjAzLCBkMDM4OSwgZDA4MDMpKQpEZWZFbmZDZXJBcmltYTMKYGBgIAoKUG9yIMO6bHRpbW8sIHZlYW1vcyBzaSB0b2RvcyBsb3MgY29lZmljaWVudGVzIGRlbCBtb2RlbG8gc29uIHNpZ25pZmljYXRpdm9zLgoKYGBge3J9CmFuY2hvIDwtIG1heChuY2hhcihuYW1lcyhjb2VmKERlZkVuZkNlckFyaW1hMykpKSkgKyAyCmZvcihpIGluIDE6bGVuZ3RoKGNvZWYoRGVmRW5mQ2VyQXJpbWEzKSkpIHsKICB3dCA8LSB3YWxkLnRlc3QoYiA9IGNvZWYoRGVmRW5mQ2VyQXJpbWEzKSwgCiAgICAgICAgICAgICAgICAgIFNpZ21hID0gdmNvdihEZWZFbmZDZXJBcmltYTMpLCAKICAgICAgICAgICAgICAgICAgVGVybXMgPSBpKQogIGNhdCgiXG5Db2VmaWNpZW50ZTogIiwgZm9ybWF0KG5hbWVzKGNvZWYoRGVmRW5mQ2VyQXJpbWEzKSlbaV0sIHdpZHRoID0gYW5jaG8pLCAidmFsb3IgZGUgcDogIiwKICAgICAgZm9ybWF0Qyh3dCRyZXN1bHQkY2hpMlszXSwgZGlnaXRzID0gNCwgZm9ybWF0ID0gImYiKSkKfQpgYGAKCkF1bnF1ZSBlbCBjb2VmaWNpZW50ZSBkZWwgZWZlY3RvIGRlIG1hcnpvIGRlIDE5ODkgbm8gZXMgc2lnbmlmaWNhdGl2byBhbCA1JSwgc2kgbG9zIGVzIGFsIDEwJSBhc8OtIHF1ZSBvcHRhbW9zIHBvciBkZWphcmxvLgoKXApcCgojIFZhbGlkYWNpw7NuCgpBbmFsaXphbmRvIGxvcyBjcml0ZXJpb3MgZGUgYm9uZGFkIGRlIGFqdXN0ZSBzZSB0aWVuZSBxdWU6IGVsIGVycm9yIG1lZGlvIChNRSksIGlndWFsIGEgYHIgcm91bmQoYWNjdXJhY3koRGVmRW5mQ2VyQXJpbWEyKVsxXSwyKWAsIGVzIHByw6FjdGljYW1lbnRlIGNlcm8gcG9yIGxvIHF1ZSBubyBwYXJlY2UgcXVlIGhheWEgc2VzZ28gZW4gbGFzIHByZWRpY2Npb25lczsgZW4gbWVkaWEgbm9zIGVxdWl2b2NhbW9zIGVuIGByIHJvdW5kKGFjY3VyYWN5KERlZkVuZkNlckFyaW1hMilbMl0sMClgIGRlZnVuY2lvbmVzIChSTVNFKTsgeSBlbCBlcnJvciBwb3JjZW50dWFsIG1lZGlvIGVzIGByIHJvdW5kKGFjY3VyYWN5KERlZkVuZkNlckFyaW1hMilbNV0sMSlgJSwgbXV5IGJham8uCgpgYGB7cixldmFsPUZBTFNFfQphY2N1cmFjeShEZWZFbmZDZXJBcmltYTMpCmBgYAoKYGBge3IsZWNobz1GQUxTRX0Kcm91bmQoYWNjdXJhY3koRGVmRW5mQ2VyQXJpbWEzKSwyKQpgYGAKClwKCiMjIyBJbmNvcnJlbGFjacOzbiwgSG9tb2NlZGFzdGljaWRhZCB5IE5vcm1hbGlkYWQgey19CgpWZWFtb3MgYWhvcmEgc2kgZWwgcmVzaWR1byBlcyBydWlkbyBibGFuY28uCgpgYGB7cn0KZXJyb3IgPC0gcmVzaWR1YWxzKERlZkVuZkNlckFyaW1hMykKQm94LnRlc3QoZXJyb3IsIGxhZyA9IDIsdHlwZSA9ICJManVuZy1Cb3giKQpCb3gudGVzdChlcnJvciwgbGFnID0gMjQsdHlwZSA9ICJManVuZy1Cb3giKQpCb3gudGVzdChlcnJvcl4yLCBsYWcgPSAyLCB0eXBlID0gIkxqdW5nLUJveCIpCkJveC50ZXN0KGVycm9yXjIsIGxhZyA9IDI0LCB0eXBlID0gIkxqdW5nLUJveCIpCmphcnF1ZS5iZXJhLnRlc3QoZXJyb3IpIApgYGAKCkVsIGVycm9yIG11ZXN0cmEgc2VyIGluY29ycmVsYWRvLCBob21vY2Vkw6FzdGljbyB5IHNlZ3VpciB1bmEgZGlzdHJpYnVjacOzbiBub3JtYWwuIAoKXApcCgojIEVjdWFjacOzbiBkZWwgbW9kZWxvIGlkZW50aWZpY2FkbwoKQWhvcmEgcXVlIHlhIGhlbW9zIGRhZG8gcG9yIHbDoWxpZG8gZWwgbW9kZWxvLCB2ZWFtb3MgY3XDoWwgZXMgc3UgZWN1YWNpw7NuLiAKCkVsIF9fbW9kZWxvIHRlw7NyaWNvX18gZXMKJCQoMSAtIFxwaGlfMSBMKSgxIC0gXHBoaV97MTJ9TF57MTJ9KSgxLUwpKDEtTF57MTJ9KWxvZyhEZWZFbmZDZXJfdCkgPSgxK1x0aGV0YV8xIEwpKDEgKyBcdGhldGFfezEyfUxeezEyfSlcdmFyZXBzaWxvbl90ICtBSS4kJApEZWJpZG8gYSBsYSBjb21wbGVqaWRhZCBkZWwgbW9kZWxvLCBubyB2YW1vcyBhIGRlc2Fycm9sbGFybG8sIG5pIGludGVycHJldGFybG8gZW4gc3UgcGFydGUgZXN0cnVjdHVyYWwuIFJlc3BlY3RvIGRlIGxhIGludGVydmVuY2nDs246CgoqIEVuIGxvcyBkb3MgbWVzZXMgZGUgZW5lcm8gYXTDrXBpY29zLCBsYSBkZWZ1bmNpb25lcyBmdWVyb24gdW4gMTIuNSUgbWF5b3JlcyBxdWUgbGFzIG9ic2VydmFkYXMgZW4gb3Ryb3MgbWVzZXMgZGUgZW5lcm8uIAoKKiBEZSBsYSBtaXNtYSBmb3JtYSwgZW4gbG9zIHRyZXMgbWVzZXMgZGUgZmVicmVybyBhdMOtcGljb3MsIGxhIGRlZnVuY2lvbmVzIGZ1ZXJvbiB1biAxOC44JSBtYXlvcmVzIHF1ZSBsYXMgb2JzZXJ2YWRhcyBlbiBvdHJvcyBtZXNlcyBkZSBmZWJyZXJvLgoKKiBFbiBtYXlvIGRlIDIwMDEgaHVibyB1biBhdW1lbnRvIGVuIGxhcyBkZWZ1bmNpb25lcyBkZWwgMTEuMiUgcmVzcGVjdG8gZGUgbG8gZXNwZXJhZG87IGVuIGp1bmlvIGRlIDIwMDMgZGVsIDE1LjElIHkgZW4gYWdvc3RvIGRlIDIwMDMgZGVsIDE0LjglLgoKKiBFbiBtYXJ6byBkZSAxOTg5LCBsYXMgZGVmdW5jaW9uZXMgZnVlcm9uIHVuIDcuNCUgbWVub3JlcyBkZSBsbyBlc3BlcmFkby4KClwKXAoKIyBQcmVkaWNjacOzbiBkZSBsYXMgZGVmdW5jaW9uZXMgcG9yIGVuZmVybWVkYWQgY2VyZWJyb3Zhc2N1bGFyCgpVbmEgdmV6IGRhZG8gcG9yIHbDoWxpZG8gZWwgbW9kZWxvLCBwb2RlbW9zIHBhc2FyIGEgcmVhbGl6YXIgcHJlZGljY2lvbmVzIHBhcmEgbG9zIHByw7N4aW1vcyBhw7Fvcy4gQ29tbyBsYSB2YXJpYWJsZXMgZGUgaW50ZXJ2ZW5jacOzbiBubyBzb24gZWZlY3RvcyBjYWxlbmRhcmlvIHN1cyB2YWxvcmVzIHByZXZpc3RvcyBzZXLDoW4gY2Vyby4KCmBgYHtyfQpwRGVmRW5mQ2VyQXJpbWEzIDwtIGZvcmVjYXN0KERlZkVuZkNlckFyaW1hMywgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaCA9IDYwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIHhyZWcgPSBjYmluZChyZXAoMCwgNjApLCByZXAoMCwgNjApLCByZXAoMCAsNjApLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwKDAsIDYwKSwgcmVwKDAsIDYwKSwgcmVwKDAsIDYwKSksIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldmVsID0gOTUpCgphZ2dyZWdhdGUocERlZkVuZkNlckFyaW1hMyRtZWFuLCBGVU4gPSBzdW0pCgphdXRvcGxvdChwRGVmRW5mQ2VyQXJpbWEzLCAKICAgICAgICAgeGxhYiA9ICIiLAogICAgICAgICB5bGFiID0gJ0RlZnVuY2lvbmVzJywKICAgICAgICAgbWFpbiA9ICdGaWd1cmEgNC4gRGVmdW5jaW9uZXMgKDE5ODgtMjAxOCkgeSBwcmVkaWNjacOzbiAoMjAxOS0yMDI0KScpICsKICBzY2FsZV94X2NvbnRpbnVvdXMoYnJlYWtzPSBzZXEoMTk4OCwgMjAyNCwgNCkpIApgYGAKCkEgcGFydGlyIGRlIDIwMjEgc2UgZXNwZXJhIHF1ZSBlbCB0b3RhbCBkZSBkZWZ1bmNpb25lcyBwb3IgZW5mZXJtZWRhZCBjZXJlYnJvdmFzY3VsYXIgY2FpZ2EgcG9yIGRlYmFqbyBkZSBsb3MgMjUwMDAgY2Fzb3MuCgpcClwKCiMgQ29tcGFyYWNpw7NuIGNvbiBBbGlzYWRvIEV4cG9uZW5jaWFsCgpFbCBtw6l0b2RvIGRlIEFsaXNhZG8gZXhwb25lbmNpYWwsIGFwbGljYWRvIHNvYnJlIGVsIGxvZ2FyaXRtbyBkZSBsYXMgZGVmdW5jaW9uZXMgaWRlbnRpZmljYSB1biBwcm9jZXNvIChBLEEsQSkgY29uICRcYWxwaGE9MC4xOCQgeSAkXGJldGEgPSBcZ2FtbWEgPSAwJC4gTGEgcmHDrXogZGVsIGVycm9yIGN1YWRyw6F0aWNvIG1lZGlvIChSTVNFKSBlcyBkZSAxNTkgY2Fzb3MgeSBlbCBlcnJvciBwb3JjZW50dWFsIChNQVBFKSBkZWwgMy43JS4gRXN0b3MgdmFsb3JlcyBzb24gYWxnbyBzdXBlcmlvcmVzIGEgbG9zIG9idGVuaWRvcyBjb24gZWwgbW9kZWxvIEFyaW1hICgxMzMgeSAzLjIlLCByZXNwZWN0aXZhbWVudGUpLgoKYGBge3J9CnN1bW1hcnkoZXRzKERlZkVuZkNlciwgbGFtYmRhID0gMCkpCmBgYAoKVmFtb3MgYSBkZXRlcm1pbmFyIHNpIGxhIGFwbGljYWNpw7NuIGRlIG1vZGVsb3MgQXJpbWEgbWVqb3JhIGxhIGNhbGlkYWQgZGUgbGFzIHByZWRpY2Npb25lcyBsbyBzdWZpY2llbnRlIGNvbW8gcGFyYSBqdXN0aWZpY2FyIHN1IHVzbyAtLWZyZW50ZSBhIGxvcyBtw6l0b2RvcyBkZSBhbGlzYWRvLCBtdWNobyBtw6FzIHNlbmNpbGxvcy4gUGFyYSBlbGxvLCBhcGxpY2FyZW1vcyBsYSBtZXRvZG9sb2fDrWEgZGUgb3JpZ2VuIGRlIHByZWRpY2Npw7NuIG3Ds3ZpbCBwYXJhIGVzdGltYXIgbGEgY2FwYWNpZGFkIHByZWRpY3RpdmEgZGVsIG1vZGVsbyBBcmltYSB5IGNvbXBhcmFybGEgY29uIGVsIG1vZGVsbyBkZSBBbGlzYWRvLiAKCmBgYHtyfSAgCmsgPC0gMTIwICAgICAgICAgICAgICAgICAgIApoIDwtIDEyICAgICAgICAgICAgICAgICAgICAKVCA8LSBsZW5ndGgoRGVmRW5mQ2VyKSAgICAgCnMgPC0gVCAtIGsgLSBoICAgICAgICAgICAgICAgCgptYXBlQXJpbWEgPC0gbWF0cml4KE5BLCBzICsgMSwgaCkKbWFwZUFsaXNhZG8gPC0gbWF0cml4KE5BLCBzICsgMSwgaCkKClggPC0gZGF0YS5mcmFtZShjYmluZChkMDFhYSwgZDAyYWEsIGQwNTAxLCBkMDYwMywgZDAzODksIGQwODAzKSkKCmZvciAoaSBpbiAwOnMpIHsKICB0cmFpbi5zZXQgPC0gc3Vic2V0KERlZkVuZkNlciwgc3RhcnQgPSBpICsgMSwgZW5kID0gaSArIGspCiAgdGVzdC5zZXQgPC0gIHN1YnNldChEZWZFbmZDZXIsIHN0YXJ0ID0gaSArIGsgKyAxLCBlbmQgPSBpICsgayArIGgpIAogIAogIFgudHJhaW4gPC0gZGF0YS5mcmFtZShYWyhpICsgMSk6KGkgKyBrKSxdKQogIGhheSA8LSBjb2xTdW1zKFgudHJhaW4pCiAgWC50cmFpbiA8LSBYLnRyYWluWywgaGF5PjBdCiAgCiAgWC50ZXN0IDwtIGRhdGEuZnJhbWUoWFsoaSArIGsgKyAxKTooaSArIGsgKyBoKSxdKQogIFgudGVzdCA8LSBYLnRlc3RbLCBoYXk+MF0KICAKICBpZiAobGVuZ3RoKFgudHJhaW4pID4gMCkgewogICAgZml0IDwtIHRyeShBcmltYSh0cmFpbi5zZXQsIAogICAgICAgICAgICAgICAgICAgICBvcmRlciA9IGMoMSwgMSwgMSksCiAgICAgICAgICAgICAgICAgICAgIHNlYXNvbmFsID0gYygxLCAxLCAxKSwgCiAgICAgICAgICAgICAgICAgICAgIGxhbWJkYSA9IDAsCiAgICAgICAgICAgICAgICAgICAgIHhyZWcgPSBhcy5tYXRyaXgoWC50cmFpbikpLCBzaWxlbnQgPSBUUlVFKQogIH0gZWxzZSB7CiAgICBmaXQgPC0gdHJ5KEFyaW1hKHRyYWluLnNldCwgCiAgICAgICAgICAgICAgICAgICAgIG9yZGVyID0gYygxLCAxLCAxKSwKICAgICAgICAgICAgICAgICAgICAgc2Vhc29uYWwgPSAgYygxLCAxLCAxKSwKICAgICAgICAgICAgICAgICAgICAgbGFtYmRhID0gMCksIHNpbGVudCA9IFRSVUUpCiAgfQogIAogIGlmICghaXMuZWxlbWVudCgidHJ5LWVycm9yIiwgY2xhc3MoZml0KSkpIHsKICAgIGlmIChsZW5ndGgoWC50cmFpbikgPiAwKSBmY2FzdCA8LSBmb3JlY2FzdChmaXQsIGggPSBoLCB4cmVnID0gYXMubWF0cml4KFgudGVzdCkpIGVsc2UKICAgICAgZmNhc3QgPC0gZm9yZWNhc3QoZml0LCBoID0gaCkKICAgIG1hcGVBcmltYVtpICsgMSxdIDwtIDEwMCphYnModGVzdC5zZXQgLSBmY2FzdCRtZWFuKS90ZXN0LnNldAogIH0KICAKICBmaXQgPC0gZXRzKHRyYWluLnNldCwgbGFtYmRhID0gMCwgbW9kZWwgPSAiQUFBIiwgZGFtcGVkID0gRkFMU0UpCiAgZmNhc3Q8LWZvcmVjYXN0KGZpdCwgaCA9IGgpCiAgbWFwZUFsaXNhZG9baSArIDEsXSA8LSAxMDAqYWJzKHRlc3Quc2V0IC0gZmNhc3QkbWVhbikvdGVzdC5zZXQKfQogIAplcnJvckFyaW1hIDwtIGNvbE1lYW5zKG1hcGVBcmltYSwgbmEucm0gPSBUUlVFKQplcnJvckFyaW1hCgplcnJvckFsaXNhZG8gPC0gY29sTWVhbnMobWFwZUFsaXNhZG8pCmVycm9yQWxpc2FkbwpgYGAKCmBgYHtyLCBldmFsID0gRkFMU0V9CmdncGxvdCgpICsKICBnZW9tX2xpbmUoYWVzKHggPSAxOjEyLCB5ID0gZXJyb3JBcmltYSksIGNvbG91ciA9ICJCbHVlIikgKwogIGdlb21fbGluZShhZXMoeCA9IDE6MTIsIHkgPSBlcnJvckFsaXNhZG8pLCBjb2xvdXIgPSAiUmVkIikgKwogIGdndGl0bGUoIkZpZ3VyYSA1LiBFcnJvciBkZSBwcmVkaWNjacOzbiAoTUFQRSkgc2Vnw7puIGhvcml6b250ZSB0ZW1wb3JhbCIpICsKICB4bGFiKCJIb3Jpem9udGUgdGVtcG9yYWwgZGUgcHJlZGljY2nDs24iKSArCiAgeWxhYigiJSIpICsKICBzY2FsZV94X2NvbnRpbnVvdXMoYnJlYWtzPSAxOjEyKQpgYGAKCmBgYHtyLCBlY2hvID0gRkFMU0V9CmRhdG9zIDwtIGRhdGEuZnJhbWUoCiAgZmFjdG9yID0gYyhyZXAoIkFyaW1hIiwgMTIpLCByZXAoIkFsaXNhZG8iLCAxMikpLAogIHggPSBjKDE6MTIsMToxMiksCiAgeSA9IGMoZXJyb3JBcmltYSwgZXJyb3JBbGlzYWRvKQopCmdncGxvdChkYXRvcywgYWVzKHggPSB4LCB5ID0geSwgIGNvbG91cj0gZmFjdG9yKSkgKyAKICBnZW9tX2xpbmUoKSArCiAgZ2d0aXRsZSgiRmlndXJhIDUuIEVycm9yIGRlIHByZWRpY2Npw7NuIChNQVBFKSBzZWfDum4gaG9yaXpvbnRlIHRlbXBvcmFsIikgKwogIHhsYWIoIkhvcml6b250ZSB0ZW1wb3JhbCBkZSBwcmVkaWNjacOzbiIpICsKICB5bGFiKCIlIikgKwogIHNjYWxlX3hfY29udGludW91cyhicmVha3M9IDE6MTIpICsKICBndWlkZXMoY29sb3VyID0gZ3VpZGVfbGVnZW5kKHRpdGxlID0gIk3DqXRvZG9zIikpICsgCiAgdGhlbWUobGVnZW5kLnBvc2l0aW9uPWMoMC4wMiwwLjk4KSwgbGVnZW5kLmp1c3RpZmljYXRpb249YygwLDEpKSAKYGBgCgpMYSBmaWd1cmEgNSByZXZlbGEgcXVlIEFyaW1hIHNpZW1wcmUgZXMgc3VwZXJpb3IgYSBBbGlzYWRvIGVuIGNhbGlkYWQgZGUgcHJlZGljY2lvbmVzLCBjb24gdW4gZXJyb3IgcG9yY2VudHVhbCBpbmZlcmlvciBlbnRyZSBtZWRpbyB5IHVuIHB1bnRvIHBvcmNlbnR1YWwgc2Vnw7puIGVsIGhvcml6b250ZSB0ZW1wb3JhbC4gQWRlbcOhcywgZW4gZWwgbW9kZWxvIEFyaW1hIGVsIGVycm9yIHNlIG1hbnRpZW5lIHByw6FjdGljYW1lbnRlIGNvbnN0YW50ZS4KClwKXApcClwKCgoKCg==</div>
<footer class="footer">
  
<a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" /></a>
<br>
This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.  <div class="text-muted">Website created by Iv&aacute;n Arribas. &copy;  2020. If you find any bugs please report them to <a href="mailto:ivan.arribas@uv.es"> ivan.arribas@uv.es</a>.</div>
  
</footer>





</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeSourceEmbed("03-10-Ejemplo5.Rmd");
});
</script>


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
