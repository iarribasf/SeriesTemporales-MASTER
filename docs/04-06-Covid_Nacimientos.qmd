---
title: "Efecto de la Covid-19 sobre la serie Nacimientos"
author: "Iván Arribas (Depto. Análisis Económico. Universitat de València)"
subtitle: "Máster de Bioestadística (Modelización Estadística)"
toc: false
number-sections: true
bibliography: references.bib
crossref:
  fig-title: Figura
  tbl-title: Tabla
  fig-prefix: Figura
  tbl-prefix: Tabla
---

```{r}
#| echo: false
knitr::opts_chunk$set(warning = FALSE, 
                      message = FALSE, 
                      error = FALSE,
                      comment = "",
                      fig.align = "center", 
                      fig.show = "hold",
                      fig.height = 4,
                      fig.width = 8,
                      out.width = "80%")
```

```{r}
#| echo: false
library(forecast)
library(ggplot2); theme_set(theme_bw())
```

\
\

# Introducción

Existe un amplia y creciente literatura sobre el efecto de la Covid-19 en España en todos los ámbitos posibles: demográfico, laboral, económico, educación, salud... Dentro de la dimensión demográfica, vamos a centrarnos en el impacto de la Covid en la natalidad, concretamente, en el numero de nacimientos mensuales.

Durante 2020 en España se tomaron diferentes medidas de confinamiento que tuvieron un impacto directo sobre las familias, afectaron la tasa de fecundidad y, por tanto, el número de nacimientos. Repasemos brevemente estas medidas:

-   En 14 de marzo de 2020 se decreta el estado de alarma y todas las personas deben permanecer confinadas en sus hogares.
-   El 2 de mayo empieza el proceso de desconfinamiento, permitiéndose a la gente salir a pasear cerca del domicilio y hacer deporte. Este proceso se inició en momentos diferentes en cada comunidad, dependiendo de una serie de indicadores de gravedad.
-   En las semanas sucesivas cada territorio fue relajando las medidas de movilidad entre provincias y de aforo en los locales públicos.
-   El 21 de junio finaliza el estado de alarma y se acaban todas las restricciones de movilidad.

Resumiendo, podemos considerar que hubo un periodo duro de confinamiento en marzo y abril, seguido de otro periodo de confinamiento más leve en mayo y junio. Como a efectos del número de nacimientos es necesario esperar nueve meses desde el inicio del confinamiento para ver su impacto, su efecto se empezaría a notar a partir de noviembre de 2020 hasta febrero de 2021.

Por supuesto, hay mucha literatura que analiza el efecto de la Covid sobre la natalidad. Por ejemplo @Gonzalez21 estima que en diciembre de 2020 y enero de 2021 hubo un 21% menos de nacimientos de lo esperado; que entre noviembre de 2020 y febrero de 2021 se redujo el número de nacimientos en 13000 sobre lo esperado; y que en marzo de 2021 se volvió a los niveles prepandemia. Por otro lado, @Esteve21 estiman que la caída en diciembre de 2020 y enero de 2021 fue del 20%; que entre noviembre de 2020 y febrero de 2021 la reducción en el número de nacimientos fue de 8000 a 10000 bebés; y que en marzo y abril de 2021 hubo un ligero incremento en el número de nacimientos respecto del año previo. Las discrepancias entre los trabajos pueden deberse a la información de que disponían en el momento de su elaboración, los supuestos asumidos, la metodología empleada, etc.

¿Qué podemos decir nosotros? Con los conocimientos que disponemos de análisis y predicción de series temporales, ¿en cuánto cuantificamos la caída en los nacimientos a finales del año 2020 y principios del 2021? ¿Ha habido un efecto rebote, con un mayor número de concepciones tras el confinamiento? ¿Cuándo volvió el número de nacimientos a los niveles prepandemia?

# ¿Qué dicen los datos?

Como primera aproximación, vamos a ver el número de nacimientos en los años prepandemia, durante el año 2020 y en los años postpandemia. El INE nos da información consolidada sobre el número de nacimientos hasta diciembre de 2022. Además, se dispone de datos provisionales de nacimientos para 2023, pero vamos a asumir que en ese año el efecto de la pandemia ya había desaparecido totalmente. Por tanto, terminaremos en el año 2022 nuestro análisis del efecto de la pandemia sobre los nacimientos.

La @fig-NacimientosMes muestra el número mensual de nacimientos desde 2018 hasta diciembre de 2022. Lo primero que se observa es la tendencia decreciente en el número de nacimientos, que viene observándose desde la Gran Recesión. Con independencia del mes, los nacimientos en 2020 son inferiores a los de 2019, y estos inferiores a los de 2018.

En segundo lugar, claramente desde noviembre de 2020 hasta febrero de 2021, el número de nacimientos es muy inferior al esperado.

En tercer lugar, desde marzo 2021 el número de nacimientos alcanza una cifra similar a la observada en el mismo mes de 2020. Es decir, si que puede existir un efecto rebote.

```{r}
nacimientos <- read.csv2("./series/Nacimientos.csv",
                         header = TRUE)

nacimientos <- ts(nacimientos[, 2],
                  start = 1975,
                  frequency = 12)

nacimientos <- window(nacimientos, 
                      start = 2000,
                      end = c(2022, 12))
```

```{r}
#| label: fig-NacimientosMes
#| fig-cap: "Nacimientos mensuales (enero 2018 - diciembre 2022)"
ggseasonplot(window(nacimientos, start = 2018)) +
  ylab("Nacimientos") +
  xlab("") +
  ggtitle("") + 
  geom_point()
```

En cuarto y último lugar, los valores de 2022 parecen apuntar a que el número de nacimientos ya se ha normalizado y está en línea con la tendencia decreciente que se observaba antes de la pandemia.

Pero todas estas afirmaciones son meramente descriptivas y es necesario un análisis más riguroso para poder confirmarlas o descartarlas.

# ¿Qué hubiera pasado si...?

En los dos epígrafes previos hemos usado constantemente la coletilla *respecto de lo esperado*: los nacimientos en diciembre de 2020 son inferiores a lo esperado y en marzo de 2021 superiores a lo esperado. Pero ¿qué era lo esperado?

La forma óptima de ver el efecto del confinamiento sobre los nacimientos sería comparar lo que realmente ha ocurrido con lo que hubiera pasado en un hipotético mundo paralelo sin Covid. Pero claro, esto es imposible, solo podemos observar una realidad y en ella la Covid ha ocurrido.

Un forma de *construir* el mundo hipotético sin Covid es considerar la serie de nacimientos hasta mediados de 2020, ajustarla a un modelo y predecir los siguientes meses (desde finales de 2020 hasta diciembre de 2022). Podríamos interpretar estas predicciones como los nacimientos que hubieran tenido lugar en un mundo sin Covid, donde todo hubiera discurrido según la inercia de los años previos. Después, podemos comparar los nacimientos reales con las predicciones y responder a nuestra principal pregunta: ¿cómo ha afectado el confinamiento el número de nacidos?

## Ajuste a un modelo y predicción {-}

Vamos a considerar la serie de nacimientos desde enero de 2000 hasta octubre de 2020, ajustarla a un modelo ARIMA y predecir hasta diciembre de 2022.

El siguiente código estima el mismo modelo visto en el tema de ARIMA con estacionalidad para la serie nacimientos. La única diferencia es que en esta ocasión la serie alcanza hasta septiembre de 2020. El ajuste, con un error porcentual del 1.5% es muy bueno.

```{r}
nacimientos2 <- window(nacimientos, 
                       end = c(2020, 10))

DiasMes <- monthdays(nacimientos2)
SemanaSanta <- easter(nacimientos2)

d1206 <- 1*(cycle(nacimientos2) == 12 & trunc(time(nacimientos2)) == 2006)
d1210 <- 1*(cycle(nacimientos2) == 12 & trunc(time(nacimientos2)) == 2010)
d0111 <- 1*(cycle(nacimientos2) == 1 & trunc(time(nacimientos2)) == 2011)
d0416 <- 1*(cycle(nacimientos2) == 4 & trunc(time(nacimientos2)) == 2016)

d12100111 <- d1210 - d0111

modelo <- Arima(nacimientos2, 
                 order = c(0, 1, 1),
                 seasonal = c(0, 1, 1),
                 lambda = 0,
                 xreg = cbind(DiasMes, SemanaSanta, 
                              d1206, d12100111, d0416))

summary(modelo)
```

Ahora vamos a predecir la serie desde noviembre de 2020 hasta diciembre de 2022 (26 meses).

```{r}
tmp <- ts(rep(0, 26), start = c(2020, 11), freq = 12)
pdm <- monthdays(tmp)
pss <- easter(tmp)
prediccion <- forecast(modelo, 
                       h = 26,
                       xreg = cbind(pdm, pss, 
                                    rep(0, 26), rep(0, 26), rep(0, 26)))
```

La @fig-NacimientosPre muestra la serie original de nacimientos desde 2018 y la predicción. Por la metodología seguida, desde noviembre de 2020 disponemos para cada mes de dos datos: los nacimientos en el mundo real con Covid (observaciones) y los nacimientos en un mundo sin Covid (previsiones).

```{r}
#| label: fig-NacimientosPre
#| fig-cap: "Nacimientos mensuales (enero 2018 - diciembre 2022) y previsiones (noviembre 2020 - diciembre 2022)"
autoplot(nacimientos,
         xlab = "",
         ylab = "Nacimientos",
         main = "", 
         series = "Con Covid") + 
  xlim(2018, 2023) +
  ylim(20000, 35000) + 
  autolayer(prediccion, series = "Sin Covid", PI = FALSE) + 
  labs(colour = "Nacimientos") + 
  theme(legend.position=c(0.9,0.85)) 
```

Una lectura rápida de la @fig-NacimientosPre muestra que efectivamente, el número observado de nacimientos entre noviembre de 2020 y febrero de 2021 (en rojo) fue muy inferior a los valores esperados (en azul). Sin embargo, el resto del año 2021 el número de nacimientos fue superior al esperado, apuntando a un ligero efecto rebote. En 2022 el efecto de la pandemia no parece haber desaparecido totalmente, observándose que el número de nacimientos real superaba la mayoría de los meses el valor predicho. Veamos estas observaciones en detalle.

Efecto del confinamiento sobre los nacimientos {-}

En primer lugar veamos cuál ha sido la caída en el número de nacimientos entre noviembre de 2020 y febrero de 2021.

```{r}
Con_covid <- as.numeric(window(nacimientos, 
                               start = c(2020, 11), 
                               end = c(2021, 2)))
Sin_covid <- as.numeric(window(prediccion$mean, 
                               start = c(2020, 11), 
                               end = c(2021, 2)))

# Caida porcentual
round(100 * (Con_covid - Sin_covid)/Con_covid, 1)

#Caida en el total de nacidos
sum(Con_covid - Sin_covid)
```

La mayor caída porcentual en el número de nacimientos tuvo lugar en los meses de diciembre de 2020 y enero de 2021 (20.8% y 19.6%, respectivamente) y nuestras estimaciones coinciden con las aportadas en @Gonzalez21 y @Esteve21. Respecto del número de nacimientos, nosotros estimamos una reducción de 12300 nacidos, un valor algo inferior a la estimación en @Gonzalez21 y muy superior a la estimación en @Esteve21.

## Efecto rebote {-}

Una posibilidad es que el confinamiento no hizo que las parejas decidieran no tener hijos de forma permanente, sino que simplemente retrasó la decisión de tenerlos. Si esto es así, cabria esperar a mediados o finales de 2021 un número de nacimientos superior al esperado: por una lado tendríamos los nacimientos de las parejas que tenían pensado tener hijos en ese momento y por otro los de las parejas que habían retrasado el momento de la maternidad. Si es así, la Covid no habría reducido de forma permanente el número de nacimientos y el acumulado en el medio/largo plazo seria el mismo que si no hubiera habido Covid.

Para poder responder mejor a esta pregunta, vamos a calcular la diferencia acumulada entre el número de nacimientos esperado y el real desde noviembre de 2020 hasta diciembre de 2022. La diferencia acumulada crece hasta los 12300 bebés en febrero de 2021. Esta diferencia máxima se va reduciendo lentamente hasta los 3900 bebés en diciembre de 2021. Es decir, efectivamente parece que hay un efecto rebote que ha compensado a lo largo del año 2021 en un total de 8400 bebés la caída hasta febrero de ese año.

Durante el año 2022 la diferencia acumulada ha seguido reduciéndose hasta desaparecer hacia agosto de 2022. Sin embargo, en los siguientes meses esta diferencia se hace negativa, alcanzado los -2800 bebes en diciembre de 2022. Este último resultado apunta a que durante 2022 el número de nacimientos ha sido inferior al esperado. Es aun difícil identificar la causa, que puede ir desde el error propio de nuestras previsiones para 2022, al efecto que la inestabilidad política y económica pueda tener sobre la decisión de las parejas de tener hijos (guerra ruso-ucraniana, incremento de los precios energéticos, inflación...).


```{r}
#| label: fig-NacimientosAcu
#| fig-cap: "Déficit acumulado de nacimientos desde noviembre de 2020"
Con_covid <- window(nacimientos, start = c(2020, 11))
Sin_covid <- window(prediccion$mean, start = c(2020, 11))

Diferencia <- cumsum(Sin_covid - Con_covid)
Diferencia <- ts(Diferencia, 
                 start = c(2020, 11),
                 frequency = 12)


autoplot(Diferencia,
         xlab = "",
         ylab = "Nacimientos",
         main = "") + 
  geom_hline(yintercept = 0, col = "red") + 
  xlim(2020.7, 2023) +
   scale_x_continuous(breaks= seq(2020 + 11/12, 2022 + 11/12, 3/12),
                     label = c("Dic-20", 
                               "Mar-21", "Jun-21", "Sep-21", "Dic-21", 
                               "Mar-22", "Jun-22", "Sep-22", "Dic-22"))
```

\
\
\
\
