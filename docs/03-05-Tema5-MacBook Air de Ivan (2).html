<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Iván Arribas (Depto. Análisis Económico. Universitat de València)" />


<title>Series Temporales: Procesos ARIMA con estacionalidad</title>

<script src="site_libs/header-attrs-2.5/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cerulean.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<script src="site_libs/navigation-1.1/sourceembed.js"></script>
<link href="site_libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="site_libs/anchor-sections-1.0/anchor-sections.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
#rmd-source-code {
  display: none;
}
</style>

<link rel="stylesheet" href="styles.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Series Temporales</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="01-Guia-curso.html">
    <span class="fa fa-graduation-cap"></span>
     
    Guía del curso
  </a>
</li>
<li>
  <a href="02-Logistica.html">
    <span class="fa fa-laptop"></span>
     
    Logística
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-book"></span>
     
    Diapos
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Teoría</li>
    <li>
      <a href="03-01-Tema1.html">Tema 1: Introducción</a>
    </li>
    <li>
      <a href="03-02-Tema2.html">Tema 2: Alisado</a>
    </li>
    <li>
      <a href="03-03-Tema3.html">Tema 3: Procesos estocásticos</a>
    </li>
    <li>
      <a href="03-04-Tema4.html">Tema 4: ARIMA</a>
    </li>
    <li>
      <a href="03-05-Tema5.html">Tema 5: SARIMA</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Ejemplo de aplicación</li>
    <li>
      <a href="03-06-Ejemplo1.html">Ejemplo Tema 1</a>
    </li>
    <li>
      <a href="03-07-Ejemplo2.html">Ejemplo Tema 2</a>
    </li>
    <li>
      <a href="03-08-Ejemplo3.html">Ejemplo Tema 3</a>
    </li>
    <li>
      <a href="03-09-Ejemplo4.html">Ejemplo Tema 4</a>
    </li>
    <li>
      <a href="03-10-Ejemplo5.html">Ejemplo Tema 5</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Otro ejemplo</li>
    <li>
      <a href="03-11-Ejemplo-Pasajeros.html">Ejemplo de Pasajeros</a>
    </li>
  </ul>
</li>
<li>
  <a href="04-Recursos-R.html">
    <span class="fa fa-code"></span>
     
    Recursos de R
  </a>
</li>
<li>
  <a href="05-Practica.html">
    <span class="fa fa-edit"></span>
     
    Practica
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-download"></span>
     
    Más
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">R</li>
    <li>
      <a href="https://cran.r-project.org">Dónde está R</a>
    </li>
    <li>
      <a href="https://rstudio.com">Donde está RStudio</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Markdown</li>
    <li>
      <a href="https://bookdown.org/yihui/rmarkdown/">Markdown</a>
    </li>
    <li>
      <a href="https://rmarkdown.rstudio.com/lesson-1.html">R Markdown</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Otros</li>
    <li>
      <a href="https://www.r-bloggers.com">Blog sobre R</a>
    </li>
    <li>
      <a href="https://bookdown.org">Libros online que debes conocer</a>
    </li>
  </ul>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-download-source" href="#">Download Rmd</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Series Temporales: Procesos ARIMA con estacionalidad</h1>
<h3 class="subtitle">Máster de Bioestadística (Modelización Estadística)</h3>
<h4 class="author">Iván Arribas (Depto. Análisis Económico. Universitat de València)</h4>

</div>


<div id="introducción" class="section level1" number="1">
<h1 number="1"><span class="header-section-number">1</span> Introducción</h1>
<p>En general, la capacidad de toma de datos posibilita que el fechado de las series sea inferior al año, apareciendo la componente estacional. No es difícil disponer de series mensuales, trimestrales, diarias o incluso con frecuencia superior.</p>
<p>En este tema se revisan los conocimientos del tema previo, ampliándolos a fin de contemplar la presencia de estacionalidad en las series temporales</p>
<p>Se mantienen las hipótesis sobre el proceso generador de datos (<em>estacionario</em> y <em>ergódico</em>) y el vector de residuos (<em>ruido blanco</em>).</p>
<p>Recuerda que <span class="math inline">\(m\)</span> es el orden estacional.</p>
<p><br />
<br />
</p>
</div>
<div id="procesos-arima-con-estacionalidad" class="section level1" number="2">
<h1 number="2"><span class="header-section-number">2</span> Procesos ARIMA con estacionalidad</h1>
<p><br />
</p>
<div id="procesos-autorregresivos-ar_mp" class="section level2" number="2.1">
<h2 number="2.1"><span class="header-section-number">2.1</span> Procesos autorregresivos <span class="math inline">\(AR_m(P)\)</span></h2>
<div id="definición" class="section level3 unnumbered">
<h3 class="unnumbered">Definición</h3>
<p>El modelo general <strong>autorregresivo estacional de orden P</strong>, <span class="math inline">\(y_t \sim AR_m(P)\)</span> viene definido por <span class="math display">\[y_t=c + \phi_m y_{t-m} + \phi_{2m} y_{t-2m} + \ldots + \phi_{Pm} y_{t-Pm} + \varepsilon_t,\]</span> que usando el operador retardo queda <span class="math display">\[(1 - \phi_m L^m - \phi_{2m} L^{2m} - \ldots - \phi_{Pm} L^{Pm})y_t = c + \varepsilon_t.\]</span></p>
</div>
<div id="propiedades" class="section level3 unnumbered">
<h3 class="unnumbered">Propiedades</h3>
<p>El proceso es <strong>estacionario</strong> si quedan fuera del círculo de radio unidad todas las raíces del polinomio <span class="math display">\[\Phi_P(z) = 1 - \phi_m z^m - \phi_{2m} z^{2m} - \ldots - \phi_{Pm} z^{Pm}.\]</span></p>
<p>Es <strong>invertible</strong> siempre.</p>
<p><strong>Sobre todo</strong>,</p>
<ul>
<li>En la FAC las autocorrelaciones de <strong>orden múltiplo de m</strong> <span class="math inline">\((m,2m,\ldots)\)</span> decaen exponencialmente a partir del orden P.</li>
<li>En la FACP las autocorrelaciones parciales de <strong>orden múltiplo de m</strong> verifican que los P primeros valores son no nulos y todos los demás valen cero.</li>
</ul>
</div>
<div id="ejemplos" class="section level3 unnumbered">
<h3 class="unnumbered">Ejemplos</h3>
<ul>
<li><span class="math inline">\(y_t \sim AR_{12}(1):\;\;y_t = c + \phi_{12} y_{t-12} + \varepsilon_t\)</span> o <span class="math inline">\((1 - \phi_{12} L^{12})y_t = c + \varepsilon_t\)</span></li>
<li><span class="math inline">\(y_t \sim AR_7(2):\;\;y_t = c + \phi_7 y_{t-7} + \phi_{14} y_{t-14} + \varepsilon_t\)</span> o <span class="math inline">\((1 - \phi_7 L^7 - \phi_{14} L^{14})y_t = c + \varepsilon_t\)</span></li>
</ul>
</div>
<div id="simulaciones-de-procesos-autorregresivos-ar_mp" class="section level3 unnumbered">
<h3 class="unnumbered">Simulaciones de procesos autorregresivos <span class="math inline">\(AR_m(P)\)</span></h3>
<p>La figura 1 muestran una simulación del proceso <span class="math inline">\(AR_{4}(2)\)</span> <span class="math inline">\(y_t = 0.7y_{t-4} - 0.7y_{t-8} + \varepsilon_t\)</span>, y la figura 2 simula el proceso <span class="math inline">\(AR_{12}(1)\)</span> <span class="math inline">\(y_t = 0.6y_{t-12} + \varepsilon_t\)</span>. En ambos casos la muestra es de tamaño 500 y <span class="math inline">\(\varepsilon_t\)</span> se distribuye como una normal con media cero y varianza la unidad. (Todas las simulaciones se han realizado con la función <code>arima.sim</code> de la librería <code>stats</code>.)</p>
<p><img src="03-05-Tema5_files/figure-html/unnamed-chunk-1-1.png" width="80%" style="display: block; margin: auto;" /><img src="03-05-Tema5_files/figure-html/unnamed-chunk-1-2.png" width="80%" style="display: block; margin: auto;" /></p>
<p><br />
</p>
</div>
</div>
<div id="procesos-en-medias-móviles-ma_mq" class="section level2" number="2.2">
<h2 number="2.2"><span class="header-section-number">2.2</span> Procesos en medias móviles <span class="math inline">\(MA_m(Q)\)</span></h2>
<div id="definición-1" class="section level3 unnumbered">
<h3 class="unnumbered">Definición</h3>
<p>El modelo general <strong>en medias móviles estacional de orden Q</strong>, <span class="math inline">\(y_t \sim MA_m(Q)\)</span> viene definido por <span class="math display">\[y_t=c + \varepsilon_t + \theta_m \varepsilon_{t-m} + \theta_{2m} \varepsilon_{t-2m} + \ldots +
  \theta_{Qm} \varepsilon_{t-Qm},\]</span> que usando el operador retardo queda <span class="math display">\[y_t = c + (1 + \theta_m L^m + \theta_{2m} L^{2m} + \ldots + \theta_{Qm} L^{Qm}) \varepsilon_t.\]</span></p>
</div>
<div id="propiedades-1" class="section level3 unnumbered">
<h3 class="unnumbered">Propiedades</h3>
<p>El proceso es <strong>invertible</strong> si quedan fuera del círculo de radio unidad todas las raíces del polinomio <span class="math display">\[\Theta_Q(z) = 1 + \theta_m z^m + \theta_{2m} z^{2m} + \ldots + \theta_{Qm} z^{Qm}.\]</span></p>
<p>Es <strong>estacionario</strong> siempre.</p>
<p><strong>Sobre todo</strong>,</p>
<ul>
<li>En la FAC las autocorrelaciones de <strong>orden múltiplo de m</strong> verifican que los Q primeros valores son no nulos y todos los demás valen cero.</li>
<li>En la FACP las autocorrelaciones parciales de <strong>orden múltiplo de m</strong> decaen exponencialmente a partir del orden Q.</li>
</ul>
</div>
<div id="ejemplos-1" class="section level3 unnumbered">
<h3 class="unnumbered">Ejemplos</h3>
<ul>
<li><span class="math inline">\(y_t \sim MA_7(1):\;\;y_t = c + \varepsilon_t + \theta_7 \varepsilon_{t-7}\)</span> o <span class="math inline">\(y_t = c + (1 + \theta_7 L^7)\varepsilon_t\)</span></li>
<li><span class="math inline">\(y_t \sim MA_{12}(2):\;\;y_t=c + \varepsilon_t + \theta_{12} \varepsilon_{t-12} + \theta_{24} \varepsilon_{t-24}\)</span> o <span class="math inline">\(y_t = c + (1 + \theta_{12} L^{12} + \theta_{24} L^{24})\varepsilon_t\)</span></li>
</ul>
</div>
<div id="simulaciones-de-procesos-en-medias-móviles-ma_mq" class="section level3 unnumbered">
<h3 class="unnumbered">Simulaciones de procesos en medias móviles <span class="math inline">\(MA_m(Q)\)</span></h3>
<p>La figura 3 muestra una simulación del proceso <span class="math inline">\(MA_{4}(2)\)</span> <span class="math inline">\(y_t = 0.7\varepsilon_{t-4} - 0.7\varepsilon_{t-8} + \varepsilon_t\)</span>, y la figura 4 simula el proceso <span class="math inline">\(MA_{12}(1)\)</span> <span class="math inline">\(y_t = 0.6\varepsilon_{t-12} + \varepsilon_t\)</span>. En ambos casos la muestra es de tamaño 500 y <span class="math inline">\(\varepsilon_t\)</span> se distribuye como una normal con media cero y varianza la unidad.</p>
<p><img src="03-05-Tema5_files/figure-html/unnamed-chunk-2-1.png" width="80%" style="display: block; margin: auto;" /><img src="03-05-Tema5_files/figure-html/unnamed-chunk-2-2.png" width="80%" style="display: block; margin: auto;" /></p>
<p><br />
</p>
</div>
</div>
<div id="procesos-arma_mpq" class="section level2" number="2.3">
<h2 number="2.3"><span class="header-section-number">2.3</span> Procesos <span class="math inline">\(ARMA_m(P,Q)\)</span></h2>
<div id="definición-2" class="section level3 unnumbered">
<h3 class="unnumbered">Definición</h3>
<p>El modelo general <strong><span class="math inline">\(y_t \sim ARMA_m(P,Q)\)</span></strong> viene definido por <span class="math display">\[ y_t = c + \phi_m y_{t-m} + \phi_{2m} y_{t-2m} + \ldots + \phi_{Pm} y_{t-Pm}  + 
  \varepsilon_t + \theta_m \varepsilon_{t-m} + \theta_{2m} \varepsilon_{t-2m} + \ldots +
  \theta_{Qm} \varepsilon_{t-Qm},\]</span> que usando el operador retardo queda <span class="math display">\[(1 - \phi_m L^m - \ldots - \phi_{Pm} L^{Pm})y_t = c + (1 + \theta_m L^m + \ldots + \theta_{Qm} L^{Qm}) \varepsilon_t.\]</span></p>
<p>El proceso más simple es el <span class="math inline">\(ARMA_m(1,1)\)</span>: <span class="math inline">\(y_t = c + \phi_m y_{t-m} + \theta_m \varepsilon_{t-m} + \varepsilon_{t}.\)</span></p>
</div>
<div id="propiedades-2" class="section level3 unnumbered">
<h3 class="unnumbered">Propiedades</h3>
<p>El proceso es <strong>estacionario</strong> si quedan fuera del círculo de radio unidad todas las raíces del polinomio <span class="math display">\[\Phi_P(z) = 1 - \phi_m z^m - \phi_{2m} z^{2m} - \ldots - \phi_{Pm} z^{Pm}.\]</span></p>
<p>El proceso es <strong>invertible</strong> si quedan fuera del círculo de radio unidad todas las raíces del polinomio <span class="math display">\[\Theta_Q(z) = 1 + \theta_m z^m + \theta_{2m} z^{2m} + \ldots + \theta_{Qm} z^{Qm}.\]</span></p>
<p><strong>Sobre todo</strong>,</p>
<ul>
<li>En la FAC las autocorrelaciones de <strong>orden múltiplo de m</strong> decaen exponencialmente a partir del orden P.</li>
<li>En la FACP las autocorrelaciones parciales de <strong>orden múltiplo de m</strong> decaen exponencialmente a partir del orden Q.</li>
</ul>
</div>
<div id="ejemplos-2" class="section level3 unnumbered">
<h3 class="unnumbered">Ejemplos</h3>
<ul>
<li><span class="math inline">\(y_t \sim ARMA_7(1, 1):\;\;y_t = c + \phi_7 y_{t-7} + \theta_7 \varepsilon_{t-7} + \varepsilon_{t}\)</span> o <span class="math inline">\((1 - \phi_7 L^7)y_t = c + (1 + \theta_7 L^7)\varepsilon_t\)</span>.</li>
<li><span class="math inline">\(y_t \sim ARMA_{12}(1, 1):\;\;y_t = c + \phi_{12} y_{t-12} + \theta_{12} \varepsilon_{t-12} + \varepsilon_{t}\)</span> o <span class="math inline">\((1 - \phi_{12} L^{12})y_t = c + (1 + \theta_{12} L^{12})\varepsilon_t\)</span>.</li>
</ul>
</div>
<div id="simulación-de-un-proceso-arma_mpq" class="section level3 unnumbered">
<h3 class="unnumbered">Simulación de un proceso <span class="math inline">\(ARMA_m(P,Q)\)</span></h3>
<p>La figura 5 muestra una simulación de tamaño 500 para el proceso <span class="math inline">\(ARMA_7(1,1)\)</span> <span class="math inline">\(y_t = 0.7y_{t-7} - 0.5\varepsilon_{t-7} + \varepsilon_t\)</span>.</p>
<p><img src="03-05-Tema5_files/figure-html/unnamed-chunk-3-1.png" width="80%" style="display: block; margin: auto;" /></p>
<p><br />
</p>
</div>
</div>
<div id="procesos-arima_mpdq" class="section level2" number="2.4">
<h2 number="2.4"><span class="header-section-number">2.4</span> Procesos <span class="math inline">\(ARIMA_m(P,D,Q)\)</span></h2>
<p><strong>Si la serie <span class="math inline">\(y_t\)</span> no es estacionaria en su parte estacional, pero tras diferenciarla <span class="math inline">\(D\)</span> veces se hace estacionaria, diremos que la serie es integrada estacionalmente de orden <span class="math inline">\(D\)</span></strong>: <span class="math inline">\(y_t \sim I_m(D)\)</span>. Por tanto,</p>
<ul>
<li>una serie estacionaria estacionalmente se indicará como <span class="math inline">\(y_t \sim I_m(0)\)</span>.</li>
<li><span class="math inline">\(y_t \sim I_m(1)\)</span> es equivalente a <span class="math inline">\(\nabla_m y_t = (1 - L^m)y_t \sim I_m(0)\)</span></li>
</ul>
<p>Una serie <span class="math inline">\(y_t\)</span> sigue un proceso <strong><span class="math inline">\(ARIMA_m(P,D,Q)\)</span></strong> si:</p>
<ol style="list-style-type: decimal">
<li><span class="math inline">\(y_t \sim I_m(D)\)</span> (hay que diferenciarla estacionalmente <span class="math inline">\(D\)</span> veces para hacerla estacionaria), y</li>
<li><span class="math inline">\(\nabla_m^D y_t \sim ARMA_m(P,Q)\)</span>.</li>
</ol>
<p>Entonces, podemos escribir <span class="math inline">\(y_t \sim ARIMA_m(P,D,Q)\)</span> como <span class="math display">\[\begin{equation*}
\begin{array}{c@{\quad}ccc}
  (1 - \phi_m L^m - \ldots - \phi_{Pm} L^{Pm}) &amp; (1- L^m)^D y_t &amp; = &amp; c + (1 + \theta_m L^m + \ldots + \theta_{Qm} L^{Qm}) \varepsilon_t \\ 
  \uparrow                                     &amp; \uparrow       &amp;   &amp; \uparrow \\
   AR_m(P)                                     &amp; I_m(D)         &amp;   &amp; MA_m(Q) 
\end{array}
\end{equation*}\]</span></p>
<div id="ejemplo" class="section level3 unnumbered">
<h3 class="unnumbered">Ejemplo</h3>
<p><span class="math inline">\(y_t \sim ARIMA_{12}(1, 1, 1):\;\;(1 - \phi_{12} L^{12})(1- L^{12}) y_t = c + (1 + \theta_{12} L^{12}) \varepsilon_t\)</span> o</p>
<p><span class="math inline">\(y_t = c + y_{t-12} + \phi_{12}(y_{t-12} - y_{t-24}) + \theta_{12} \varepsilon_{t-12} + \varepsilon_t\)</span>.</p>
<p><br />
</p>
</div>
</div>
<div id="proceso-arima_mpdqpdq" class="section level2" number="2.5">
<h2 number="2.5"><span class="header-section-number">2.5</span> Proceso <span class="math inline">\(ARIMA_m(p,d,q)(P,D,Q)\)</span></h2>
<p>La realidad nos muestra que la mayoría de las series con estacionalidad se ajustan a una combinación de <em>procesos regulares y estacionales</em>.</p>
<p>El proceso <span class="math inline">\(ARIMA_m(p, d, q)(P, D, Q)\)</span> puede ser expresado de forma abreviada como <span class="math display">\[\Phi_p(L)\Phi_P(L^m)\nabla^d\nabla_m^D  y_t = c + \Theta_q(L)\Theta_Q(L^m)\varepsilon_t,\]</span><br />
o menos sucintamente como <span class="math display">\[\begin{equation*}
\begin{array}{ccccc}
  AR(p) &amp; AR_m(P) &amp; I(d) &amp; I_m(D) &amp;  \\
  \downarrow &amp; \downarrow &amp; \downarrow &amp; \downarrow  &amp;  \\
  (1 - \phi_1 L - \ldots - \phi_p L^p) &amp; (1 - \phi_m L^m - \ldots - \phi_{Pm} L^{Pm}) &amp; (1 - L)^d &amp; (1- L^m)^Dy_t &amp; = \\
  c + (1 + \theta_1 L + \ldots + \theta_q L^q) &amp; (1 + \theta_m L^m + \ldots + \theta_{Qm} L^{Qm}) \varepsilon_t &amp; &amp; &amp; \\
  \uparrow &amp; \uparrow &amp; &amp; &amp; \\
  MA(q) &amp; MA_m(Q)  &amp; &amp; &amp; 
\end{array}
\end{equation*}\]</span></p>
<p><span class="math display">\[ (1 - \phi_1 L - ... - \phi_p L^p)(1 - \phi_m L^m - ... - \phi_{Pm} L^{Pm})(1- L^m)^D(1 - L)^d y_t = \]</span> <span class="math display">\[c + (1 + \theta_1 L + ... + \theta_q L^q)(1 + \theta_m L^m + ... + \theta_{Qm} L^{Qm}) \varepsilon_t\]</span></p>
<p>Por ejemplo, entre las series mensuales uno de los procesos más comunes es <span class="math inline">\(ARIMA_{12}(0, 1, 1)(0, 1, 1)\)</span>, denominado <em>modelo de las aerolíneas</em> por ser el PGD de muchas series mensuales de transporte de pasajeros, en concreto la serie mensual de pasajeros de avión. La ecuación de este modelo es</p>
<p><span class="math display">\[(1-L)(1-L^{12})y_t = (1+ \theta_1L)(1 + \theta_{12}L^{12})\varepsilon_t\]</span> que si desarrollamos queda <span class="math display">\[y_t = y_{t-1} + (y_{t-12} - y_{t-13}) + \theta_1 \varepsilon_{t-1} + \theta_{12} \varepsilon_{t-12} + \theta_{13} \varepsilon_{t-13} + \varepsilon_t \]</span></p>
<ul>
<li>El número de pasajeros del mes <span class="math inline">\(t\)</span> es el mismo que el del mes previo <span class="math inline">\(t-1\)</span>, más la diferencia entre estos meses observada el año pasado.</li>
<li>Si en los meses usados para la predicción (<span class="math inline">\(t-1\)</span>, <span class="math inline">\(t-12\)</span> y <span class="math inline">\(t-12\)</span>) ha ocurrido algo extraordinario, hay que tenerlo en cuenta a la hora de afinar la predicción.</li>
</ul>
<div id="simulaciones-de-un-proceso-arima_mpdqpdq" class="section level3 unnumbered">
<h3 class="unnumbered">Simulaciones de un proceso <span class="math inline">\(ARIMA_m(p,d,q)(P,D,Q)\)</span></h3>
<p>La figura 6 muestra una simulación de tamaño 1000 para el modelo de las aerolíneas, donde se ha supuesto que <span class="math inline">\(\theta_1=0.7\)</span> y <span class="math inline">\(\theta_{12}=-0.5\)</span>.</p>
<p><img src="03-05-Tema5_files/figure-html/unnamed-chunk-4-1.png" width="80%" style="display: block; margin: auto;" /></p>
<p><br />
<br />
</p>
</div>
</div>
</div>
<div id="ejemplos-3" class="section level1" number="3">
<h1 number="3"><span class="header-section-number">3</span> Ejemplos</h1>
<p><br />
</p>
<div id="nacimientos" class="section level2" number="3.1">
<h2 number="3.1"><span class="header-section-number">3.1</span> Nacimientos</h2>
<p>Vamos a aplicar la metodología de Box-Jenkins a la serie de <strong>nacimientos en España</strong> desde el año 2000 (véase figura 7).</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>nacimientos <span class="ot">&lt;-</span> <span class="fu">read.csv2</span>(<span class="st">&quot;./series/nacimientos.csv&quot;</span>, <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>nacimientos <span class="ot">&lt;-</span> <span class="fu">ts</span>(nacimientos[, <span class="dv">2</span>],</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1975</span>, <span class="dv">1</span>),</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">freq =</span> <span class="dv">12</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>nacimientos <span class="ot">&lt;-</span> <span class="fu">window</span>(nacimientos, <span class="at">start =</span> <span class="dv">2000</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(nacimientos,</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">&quot;Nacimientos&quot;</span>,</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">&quot;Figura 7. Nacimientos en España&quot;</span>)</span></code></pre></div>
<p><img src="03-05-Tema5_files/figure-html/unnamed-chunk-5-1.png" width="80%" style="display: block; margin: auto;" /></p>
<div id="transformación-de-la-serie" class="section level3 unnumbered">
<h3 class="unnumbered">Transformación de la serie</h3>
<p>Ya vimos en el Tema 3 que para que la serie sea estacionaria y ergódica había que diferenciarla tanto regular como estacionalmente (d = D = 1). Además, trabajaremos con el logaritmo de la serie para reducir la posible heterocedasticidad y ganar en interpretabilidad. Es decir, trabajaremos con la siguiente serie transformada <span class="math display">\[\nabla\nabla_{12}\log(nacimientos_t) \sim I(0)I_{12}(0).\]</span></p>
</div>
<div id="identificación" class="section level3 unnumbered">
<h3 class="unnumbered">Identificación</h3>
<p>Tras transformar la serie, vamos a identificar los valores de <span class="math inline">\(p\)</span>, <span class="math inline">\(q\)</span>, <span class="math inline">\(P\)</span> y <span class="math inline">\(Q\)</span> a partir de la FAC y la FACP.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggtsdisplay</span>(<span class="fu">diff</span>(<span class="fu">diff</span>(<span class="fu">log</span>(nacimientos), <span class="at">lag =</span> <span class="dv">12</span>)), <span class="at">lag =</span> <span class="dv">48</span>,</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">main =</span> <span class="st">&quot;Figura 8. FAC y FACP para Nacimientos&quot;</span>)</span></code></pre></div>
<p><img src="03-05-Tema5_files/figure-html/unnamed-chunk-6-1.png" width="80%" style="display: block; margin: auto;" /></p>
<p>Analizando la FAC y la FACP podemos pensar que:</p>
<ul>
<li>FAC: decrecimiento en la parte regular y estacional</li>
<li>FACP: dos autocorrelaciones fuera del IC(95%) en la parte regular (<span class="math inline">\(r_1\)</span> y <span class="math inline">\(r_2\)</span>) y otras dos en la parte estacional (<span class="math inline">\(r_{12}\)</span> y <span class="math inline">\(r_{24}\)</span>).</li>
</ul>
<p>Pero sobre todo, observamos que no es fácil la identificación.</p>
<p><br />
</p>
<p>¿Qué nos indica <code>auto.arima</code>? Primero vamos a generar e incluir en el proceso de auto-identificación las variables asociadas a los efectos de intervención que hemos detectado en los temas previos. En concreto, hemos visto que el número de días del mes explica el número de nacimientos. Este efecto era muy claro para los meses de febrero bisiestos. Para el calculo de la variable que recoge el número de días del mes usaremos la función <code>monthdays</code> de la librería <code>forecast</code> que devuelve el número de días de cada mes o trimestre de una serie.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">monthdays</span>(nacimientos)</span></code></pre></div>
<pre><code>     Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec
2014  31  28  31  30  31  30  31  31  30  31  30  31
2015  31  28  31  30  31  30  31  31  30  31  30  31
2016  31  29  31  30  31  30  31  31  30  31  30  31
2017  31  28  31  30  31  30  31  31  30  31  30  31
2018  31  28  31  30  31  30  31  31  30  31  30  31</code></pre>
<p>Por otro lado, los periodos vacacionales pueden afectar la programación de las cesáreas e influir en el número de nacimientos. Como la Semana Santa es un periodo festivo que puede caer en marzo y abril, dependiendo del año, los nacimientos en estos dos meses pueden variar si recae en ellos la Semana Santa. Para capturar este efecto, usaremos la función <code>easter</code> de la librería <code>forecast</code> que devuelve para cada mes la proporción de días de la Semana santa que contiene (considerando solo del Viernes Santo al Domingo de Resurrección, tres días).</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">easter</span>(nacimientos)</span></code></pre></div>
<pre><code>      Jan  Feb  Mar  Apr  May  Jun  Jul  Aug  Sep  Oct  Nov  Dec
2014 0.00 0.00 0.00 1.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00
2015 0.00 0.00 0.00 1.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00
2016 0.00 0.00 1.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00
2017 0.00 0.00 0.00 1.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00
2018 0.00 0.00 0.67 0.33 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00</code></pre>
<p>Además, en enero de 2011 el número de nacimientos era atípico.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>DiasMes <span class="ot">&lt;-</span> <span class="fu">monthdays</span>(nacimientos)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>SemanaSanta <span class="ot">&lt;-</span> <span class="fu">easter</span>(nacimientos)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>d0111 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">*</span>(<span class="fu">cycle</span>(nacimientos) <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> <span class="fu">trunc</span>(<span class="fu">time</span>(nacimientos)) <span class="sc">==</span> <span class="dv">2011</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="fu">auto.arima</span>(nacimientos, </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">d =</span> <span class="dv">1</span>, </span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">D =</span> <span class="dv">1</span>, </span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">lambda =</span> <span class="dv">0</span>,</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">xreg =</span> <span class="fu">cbind</span>(DiasMes, SemanaSanta, d0111))</span></code></pre></div>
<pre><code>Series: nacimientos 
Regression with ARIMA(0,1,1)(0,1,2)[12] errors 
Box Cox transformation: lambda= 0 

Coefficients:
          ma1     sma1     sma2  DiasMes  SemanaSanta    d0111
      -0.4445  -0.6042  -0.1716   0.0346      -0.0171  -0.0695
s.e.   0.0684   0.0713   0.0689   0.0079       0.0048   0.0165

sigma^2 estimated as 0.0004471:  log likelihood=523.37
AIC=-1032.75   AICc=-1032.21   BIC=-1009.15</code></pre>
<p>Indica <span class="math inline">\(ARIMA_{12}(0,1,1)(0,1,2)\)</span>, aunque no está claro si coeficiente <code>sma2</code> es significativo (su valor a penas supera los dos errores estándar).</p>
<p><br />
</p>
<p>Una alternativa a <code>auto.arima</code> es la función <code>seas</code> de la librería <code>seasonal</code>. La función <code>seas</code> tiene como ventajas que también analiza la conveniencia de usar la transformación logarítmica, que identifica posibles efectos calendario y valores extremos, y que suele ser más parsimoniosa que <code>auto.arima</code>. Su desventaja es que sólo se puede aplicar para series mensuales o trimestrales. Veamos que identificación ofrece <code>seas</code>:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">seas</span>(nacimientos))</span></code></pre></div>
<pre><code>
Call:
seas(x = nacimientos)

Coefficients:
                    Estimate Std. Error z value             Pr(&gt;|z|)    
Weekday            0.0027529  0.0002808   9.803 &lt; 0.0000000000000002 ***
Easter[1]         -0.0137391  0.0039427  -3.485             0.000493 ***
AO2010.Dec         0.0657540  0.0136111   4.831         0.0000013590 ***
MA-Nonseasonal-01  0.3437010  0.0630616   5.450         0.0000000503 ***
MA-Seasonal-12     0.7436591  0.0505710  14.705 &lt; 0.0000000000000002 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

SEATS adj.  ARIMA: (0 1 1)(0 1 1)  Obs.: 228  Transform: log
AICc:  3421, BIC:  3441  QS (no seasonality in final):    0  
Box-Ljung (no autocorr.): 25.19   Shapiro (normality): 0.9927  
Messages generated by X-13:
Warnings:
- At least one visually significant trading day peak has been
  found in one or more of the estimated spectra.</code></pre>
<p>En primer lugar, la función identifica el modelo de las aerolíneas para la transformación logarítmica de Nacimientos. Este resultado está en consonancia con el alcanzado con la función <code>auto.arima</code>. Además, identifica un valor extremo en diciembre de 2010, un efecto calendario Semana Santa y un efecto calendario días laborables del mes (que podemos entender similar a nuestro efecto días del mes).</p>
<p>Tras estos análisis alternativos, concluimos que la identificación de partida es <span class="math inline">\(ARIMA_{12}(0,1,1)(0,1,2)+AI\)</span>, <span class="math display">\[(1 - L^{12})(1 - L)\log(nacimientos_t) = (1 + \theta_1 L)(1 + \theta_{12} L^{12} + \theta_{24} L^{24})\varepsilon_t + AI.\]</span> donde <em>AI</em> recoge todas las variables de intervención.</p>
</div>
<div id="estimación-y-valores-extremos" class="section level3 unnumbered">
<h3 class="unnumbered">Estimación (y valores extremos)</h3>
<p>Vamos a estimar el modelo identificado, incluidas las variables de intervención.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>d1210 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">*</span>(<span class="fu">cycle</span>(nacimientos) <span class="sc">==</span> <span class="dv">12</span> <span class="sc">&amp;</span> <span class="fu">trunc</span>(<span class="fu">time</span>(nacimientos)) <span class="sc">==</span> <span class="dv">2010</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>nac.ar1 <span class="ot">&lt;-</span> <span class="fu">Arima</span>(nacimientos, </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">seasonal =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>),</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">lambda =</span> <span class="dv">0</span>,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">xreg =</span> <span class="fu">cbind</span>(DiasMes, SemanaSanta, d1210,  d0111))</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>nac.ar1</span></code></pre></div>
<pre><code>Series: nacimientos 
Regression with ARIMA(0,1,1)(0,1,2)[12] errors 
Box Cox transformation: lambda= 0 

Coefficients:
          ma1     sma1     sma2  DiasMes  SemanaSanta   d1210    d0111
      -0.4742  -0.6144  -0.1505   0.0335      -0.0172  0.0576  -0.0533
s.e.   0.0668   0.0740   0.0724   0.0078       0.0047  0.0169   0.0167

sigma^2 estimated as 0.0004267:  log likelihood=529.16
AIC=-1042.32   AICc=-1041.62   BIC=-1015.35</code></pre>
<p>Ya tenemos un modelo de partida, veamos si es necesaria más intervención.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>error <span class="ot">&lt;-</span> <span class="fu">residuals</span>(nac.ar1)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>sderror <span class="ot">&lt;-</span> <span class="fu">sd</span>(error)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(error, <span class="at">series=</span><span class="st">&quot;Error&quot;</span>,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">&quot;Error&quot;</span>,</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">&quot;Figura 9. Error + Intervención&quot;</span>) <span class="sc">+</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="sc">-</span><span class="dv">2</span>,<span class="dv">2</span>, <span class="dv">3</span>)<span class="sc">*</span>sderror, </span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour =</span> <span class="fu">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;green&quot;</span>, <span class="st">&quot;green&quot;</span>, <span class="st">&quot;red&quot;</span>), </span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span> <span class="fu">seq</span>(<span class="dv">2000</span>, <span class="dv">2018</span>, <span class="dv">2</span>)) </span></code></pre></div>
<p><img src="03-05-Tema5_files/figure-html/unnamed-chunk-14-1.png" width="80%" style="display: block; margin: auto;" /></p>
<p>Se observa que hay tres candidatos a valores atípicos en diciembre 2006, abril de 2016 y junio de 2016, dado que los errores asociados se acercan o superan las 3 desviaciones típicas. Por tanto,</p>
<ul>
<li>Se crea una variable de intervención para cada caso</li>
<li>Se estima de nuevo el modelo incluyendo estas variables</li>
<li>Se vuelve a analizar si quedan valores atípicos</li>
</ul>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>d1206 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">*</span>(<span class="fu">cycle</span>(nacimientos) <span class="sc">==</span> <span class="dv">12</span> <span class="sc">&amp;</span> <span class="fu">trunc</span>(<span class="fu">time</span>(nacimientos)) <span class="sc">==</span> <span class="dv">2006</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>d0416 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">*</span>(<span class="fu">cycle</span>(nacimientos) <span class="sc">==</span> <span class="dv">4</span> <span class="sc">&amp;</span> <span class="fu">trunc</span>(<span class="fu">time</span>(nacimientos)) <span class="sc">==</span> <span class="dv">2016</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>d0616 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">*</span>(<span class="fu">cycle</span>(nacimientos) <span class="sc">==</span> <span class="dv">6</span> <span class="sc">&amp;</span> <span class="fu">trunc</span>(<span class="fu">time</span>(nacimientos)) <span class="sc">==</span> <span class="dv">2016</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>nac.ar2 <span class="ot">&lt;-</span> <span class="fu">Arima</span>(nacimientos, </span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>                 <span class="at">seasonal =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>), </span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>                 <span class="at">lambda =</span> <span class="dv">0</span>,</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>                 <span class="at">xreg =</span> <span class="fu">cbind</span>(DiasMes, SemanaSanta, d1206, d1210, d0111, d0416, d0616))</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>nac.ar2</span></code></pre></div>
<pre><code>Series: nacimientos 
Regression with ARIMA(0,1,1)(0,1,2)[12] errors 
Box Cox transformation: lambda= 0 

Coefficients:
          ma1     sma1     sma2  DiasMes  SemanaSanta    d1206   d1210    d0111
      -0.4277  -0.6321  -0.1422   0.0325      -0.0221  -0.0408  0.0549  -0.0546
s.e.   0.0714   0.0759   0.0752   0.0074       0.0047   0.0156  0.0160   0.0158
        d0416   d0616
      -0.0509  0.0274
s.e.   0.0162  0.0154

sigma^2 estimated as 0.0003934:  log likelihood=539.41
AIC=-1056.83   AICc=-1055.53   BIC=-1019.75</code></pre>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>error <span class="ot">&lt;-</span> <span class="fu">residuals</span>(nac.ar2)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>sderror <span class="ot">&lt;-</span> <span class="fu">sd</span>(error)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(error, <span class="at">series=</span><span class="st">&quot;Error&quot;</span>,</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">&quot;Error&quot;</span>,</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">&quot;Figura 10. Error + Intervención&quot;</span>) <span class="sc">+</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>)<span class="sc">*</span>sderror, </span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour =</span> <span class="fu">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;green&quot;</span>, <span class="st">&quot;green&quot;</span>, <span class="st">&quot;red&quot;</span>), </span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span> <span class="fu">seq</span>(<span class="dv">2000</span>, <span class="dv">2018</span>, <span class="dv">2</span>)) </span></code></pre></div>
<p><img src="03-05-Tema5_files/figure-html/unnamed-chunk-15-1.png" width="80%" style="display: block; margin: auto;" /></p>
<p>Es posible que alguno de los errores más elevados corresponda a un intervención, pero a fin de no alargar este ejemplo vamos a asumir que ya no hay valores extremos.</p>
<p>Por último, veamos si todos los coeficientes del modelo son significativos. Para ello, aplicamos la prueba de Wald.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>ancho <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">nchar</span>(<span class="fu">names</span>(<span class="fu">coef</span>(nac.ar2)))) <span class="sc">+</span> <span class="dv">2</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(<span class="fu">coef</span>(nac.ar2))) {</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  wt <span class="ot">&lt;-</span> <span class="fu">wald.test</span>(<span class="at">b =</span> <span class="fu">coef</span>(nac.ar2), </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Sigma =</span> <span class="fu">vcov</span>(nac.ar2), </span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Terms =</span> i)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">Coeficiente: &quot;</span>, <span class="fu">format</span>(<span class="fu">names</span>(<span class="fu">coef</span>(nac.ar2))[i], <span class="at">width =</span> ancho), <span class="st">&quot;valor de p: &quot;</span>,</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">formatC</span>(wt<span class="sc">$</span>result<span class="sc">$</span>chi2[<span class="dv">3</span>], <span class="at">digits =</span> <span class="dv">4</span>, <span class="at">format =</span> <span class="st">&quot;f&quot;</span>))</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>
Coeficiente:  ma1           valor de p:  0.0000
Coeficiente:  sma1          valor de p:  0.0000
Coeficiente:  sma2          valor de p:  0.0586
Coeficiente:  DiasMes       valor de p:  0.0000
Coeficiente:  SemanaSanta   valor de p:  0.0000
Coeficiente:  d1206         valor de p:  0.0086
Coeficiente:  d1210         valor de p:  0.0006
Coeficiente:  d0111         valor de p:  0.0006
Coeficiente:  d0416         valor de p:  0.0017
Coeficiente:  d0616         valor de p:  0.0749</code></pre>
<p>El coeficiente estacional en medias móviles de orden dos no resulta <em>individualmente</em> significativo al 5% (aunque si lo sería al 10%). Vamos a optar por eliminarlo. Tampoco es significativo el coeficiente de la intervención de junio de 2016, sin embargo su efecto (figura 9) es tan patente que vamos a dejarlo en el modelo.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>nac.ar2 <span class="ot">&lt;-</span> <span class="fu">Arima</span>(nacimientos, </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">seasonal =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">lambda =</span> <span class="dv">0</span>,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">xreg =</span> <span class="fu">cbind</span>(DiasMes, SemanaSanta, d1206, d1210, d0111, d0416, d0616))</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>nac.ar2</span></code></pre></div>
<pre><code>Series: nacimientos 
Regression with ARIMA(0,1,1)(0,1,1)[12] errors 
Box Cox transformation: lambda= 0 

Coefficients:
          ma1     sma1  DiasMes  SemanaSanta    d1206   d1210    d0111    d0416
      -0.4624  -0.7472   0.0322      -0.0224  -0.0473  0.0598  -0.0559  -0.0508
s.e.   0.0650   0.0518   0.0077       0.0050   0.0156  0.0164   0.0163   0.0167
       d0616
      0.0267
s.e.  0.0160

sigma^2 estimated as 0.000398:  log likelihood=537.64
AIC=-1055.29   AICc=-1054.21   BIC=-1021.58</code></pre>
</div>
<div id="validación" class="section level3 unnumbered">
<h3 class="unnumbered">Validación</h3>
<p>No se puede contrastar si el <strong>residuo tiene media cero</strong>, pero el error medio es -76, muy bajo en comparación con el valor medio de la serie.</p>
<p>Además, tenemos las diferentes medidas de bondad del ajuste. En media nos equivocamos en 716 bebés (RMSE) y el error porcentual medio es del 1.6%.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(nac.ar2)</span></code></pre></div>
<pre><code>                 ME   RMSE    MAE   MPE MAPE MASE ACF1
Training set -75.76 716.45 579.22 -0.22 1.55 0.41 0.02</code></pre>
<p><br />
</p>
<p><strong>Incorrelación, Homocedasticidad y Normalidad</strong></p>
<p>Veamos ahora si el residuo es ruido blanco.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Box.test</span>(error, <span class="at">lag =</span> <span class="dv">2</span>,<span class="at">type =</span> <span class="st">&quot;Ljung-Box&quot;</span>)</span></code></pre></div>
<pre><code>
    Box-Ljung test

data:  error
X-squared = 2.2433, df = 2, p-value = 0.3257</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Box.test</span>(error, <span class="at">lag =</span> <span class="dv">24</span>,<span class="at">type =</span> <span class="st">&quot;Ljung-Box&quot;</span>)</span></code></pre></div>
<pre><code>
    Box-Ljung test

data:  error
X-squared = 86.941, df = 24, p-value = 0.000000004598</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Box.test</span>(error<span class="sc">^</span><span class="dv">2</span>, <span class="at">lag =</span> <span class="dv">2</span>, <span class="at">type =</span> <span class="st">&quot;Ljung-Box&quot;</span>)</span></code></pre></div>
<pre><code>
    Box-Ljung test

data:  error^2
X-squared = 0.46494, df = 2, p-value = 0.7926</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Box.test</span>(error<span class="sc">^</span><span class="dv">2</span>, <span class="at">lag =</span> <span class="dv">24</span>, <span class="at">type =</span> <span class="st">&quot;Ljung-Box&quot;</span>)</span></code></pre></div>
<pre><code>
    Box-Ljung test

data:  error^2
X-squared = 25.591, df = 24, p-value = 0.3742</code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">jarque.bera.test</span>(error) </span></code></pre></div>
<pre><code>
    Jarque Bera Test

data:  error
X-squared = 1.7776, df = 2, p-value = 0.4111</code></pre>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggAcf</span>(error, <span class="at">lag =</span> <span class="dv">36</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.3</span>, <span class="fl">0.3</span>), </span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">main =</span> <span class="st">&quot;Figura 11. FAC del error del modelo&quot;</span>)</span></code></pre></div>
<p><img src="03-05-Tema5_files/figure-html/unnamed-chunk-20-1.png" width="80%" style="display: block; margin: auto;" /></p>
<p>Claramente hay autocorrelaciones significativas, pero en retardos no relevantes (véase figura 11). El error muestra ser homocedástico y seguir una distribución normal.</p>
</div>
<div id="interpretación" class="section level3 unnumbered">
<h3 class="unnumbered">Interpretación</h3>
<p>El <em>modelo teórico</em> es <span class="math inline">\(log(nacimientos) \sim ARIMA_{12}(0, 1, 1)(0, 1, 1) + AI\)</span>, <span class="math display">\[(1 - L^{12})(1 - L)\log(nacimientos_t) = (1 + \theta_1 L)(1 + \theta_{12} L^{12})\varepsilon_t + AI.\]</span> Si sustituimos <span class="math inline">\((1 - L^{12})\log(nacimientos_t)\)</span> por <span class="math inline">\(TVA_{nacimientos_t}\)</span>, la tasa de variación anual de los nacimientos, y desarrollamos queda <span class="math display">\[TVA_{nacimientos_t} = TVA_{nacimientos_{t-1}} + \theta_1 \varepsilon_{t-1} + \theta_{12} \varepsilon_{t-12} + \theta_1\theta_{12} \varepsilon_{t-13} +  \varepsilon_{t}+\]</span> <span class="math display">\[\gamma_1 \cdot DiasMes_t + \gamma_2 \cdot SemanaSanta +\gamma_3 \cdot d1206_t + \gamma_4 \cdot d1210_t +\gamma_5 \cdot d0111_t + \gamma_6 \cdot d0416_t + \gamma_7 \cdot d0616_t.\]</span></p>
<p>Finalmente, el <em>modelo estimado</em> es, <span class="math display">\[\widehat{TVA}_{nacimientos_{t}} = TVA_{nacimientos_{t-1}}  - 0.46\varepsilon_{t-1} - 0.75\varepsilon_{t-12} + 0.35\varepsilon_{t-13} + \]</span> <span class="math display">\[0.032 \cdot DiasMes_t - 0.022 \cdot SemanaSanta - 0.047 \cdot d1206_t + 0.06 \cdot d1210_t - 0.056 \cdot d0111_t - 0.051 \cdot d0416_t + 0.027 \cdot d0616_t.\]</span></p>
<ul>
<li><p>En cada mes, <strong>la tasa de variación anual de los nacimientos es la misma que la del mes pasado</strong> (<span class="math inline">\(\widehat{TVA}_{nacimientos_t} = TVA_{nacimientos_{t-1}}\)</span>).</p></li>
<li><p>Además, si algunos de los meses necesarios para predecir fue anómalo, el error hay que tenerlo en cuenta para afinar la previsión.</p></li>
<li><p>Respecto de la intervención, cada día adicional de un mes nacen un 3.2% más bebés. El mes en que cae la Semana Santa los nacimientos caen un 2.2%. Por alguna razón, en diciembre de 2006 hubo un 4.7% menos de nacimientos de lo esperado; en diciembre de 2010 hubo un 6% más de nacimientos de lo esperado; en enero de 2011 hubo un 5.6% menos de nacimientos de lo esperado; en abril de 2016 hubo un 5.1% menos de nacimientos de lo esperado.; y en junio de 2016 hubo un 2.7% más de nacimientos de lo esperado.</p></li>
</ul>
</div>
<div id="predicción-de-la-serie" class="section level3 unnumbered">
<h3 class="unnumbered">Predicción de la serie</h3>
<p>Una vez dado por válido el modelo podemos pasar a realizar predicciones. Hay que tener en cuenta que hay siete variables de intervención, dos de ellas son efectos calendario (DiasMes y SemanaSanta), para las que debemos indicar qué valores tomarán en el periodo de predicción. Vamos a fijar el horizonte de predicción en cuatro años y mostrar los resultados numérica (solo para el primer año) y gráficamente (figura 12).</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>pdm <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">*</span> <span class="fu">monthdays</span>(<span class="fu">ts</span>(<span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">48</span>), <span class="at">start =</span> <span class="dv">2019</span>, <span class="at">freq =</span> <span class="dv">12</span>))</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>pss <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">*</span> <span class="fu">easter</span>(<span class="fu">ts</span>(<span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">48</span>), <span class="at">start =</span> <span class="dv">2019</span>, <span class="at">freq =</span> <span class="dv">12</span>))</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>pnac.ar2 <span class="ot">&lt;-</span> <span class="fu">forecast</span>(nac.ar2, </span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">h =</span> <span class="dv">48</span>,</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">xreg =</span> <span class="fu">cbind</span>(pdm, pss, <span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">48</span>), <span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">48</span>), <span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">48</span>), <span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">48</span>), <span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">48</span>)), </span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">level =</span> <span class="dv">95</span>)</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>pnac.ar2</span></code></pre></div>
<pre><code>         Point Forecast    Lo 95    Hi 95
Jan 2019       30416.36 29250.02 31629.22
Feb 2019       29959.22 28658.37 31319.13
Mar 2019       30151.93 28706.76 31669.86
Apr 2019       30106.15 28539.95 31758.31
May 2019       29982.55 28309.71 31754.24
Jun 2019       30233.94 28440.89 32140.03
Jul 2019       31226.31 29271.42 33311.76
Aug 2019       31243.97 29190.58 33441.81
Sep 2019       32048.24 29847.06 34411.74
Oct 2019       31726.73 29457.97 34170.23
Nov 2019       30831.93 28543.69 33303.61
Dec 2019       29644.82 27367.59 32111.54</code></pre>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(pnac.ar2, </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&#39;Nacimientos&#39;</span>,</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&#39;Figura 12. Nacimientos (2000-2018) y predicción (2019-2022)&#39;</span>) <span class="sc">+</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span> <span class="fu">seq</span>(<span class="dv">2000</span>, <span class="dv">2022</span>, <span class="dv">4</span>)) </span></code></pre></div>
<p><img src="03-05-Tema5_files/figure-html/unnamed-chunk-23-1.png" width="80%" style="display: block; margin: auto;" /></p>
</div>
<div id="error-de-predicción-extra-muestral-según-horizonte-temporal" class="section level3 unnumbered">
<h3 class="unnumbered">Error de predicción extra-muestral según horizonte temporal</h3>
<p>Asumimos que se precisan diez años para hacer una buena estimación, <span class="math inline">\(k = 120\)</span>, y fijaremos el horizonte temporal en un año, <span class="math inline">\(h = 12\)</span> meses.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">120</span>                   </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>h <span class="ot">&lt;-</span> <span class="dv">12</span>                    </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>T <span class="ot">&lt;-</span> <span class="fu">length</span>(nacimientos)   </span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>s<span class="ot">&lt;-</span>T <span class="sc">-</span> k <span class="sc">-</span> h               </span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>mapeArima <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, s <span class="sc">+</span> <span class="dv">1</span>, h)</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">cbind</span>(DiasMes, SemanaSanta, d1206, d1210, d0111, d0416, d0616)</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">0</span><span class="sc">:</span>s) {</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>  train.set <span class="ot">&lt;-</span> <span class="fu">subset</span>(nacimientos, <span class="at">start =</span> i <span class="sc">+</span> <span class="dv">1</span>, <span class="at">end =</span> i <span class="sc">+</span> k)</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>  test.set <span class="ot">&lt;-</span>  <span class="fu">subset</span>(nacimientos, <span class="at">start =</span> i <span class="sc">+</span> k <span class="sc">+</span> <span class="dv">1</span>, <span class="at">end =</span> i <span class="sc">+</span> k <span class="sc">+</span> h) </span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>  X.train <span class="ot">&lt;-</span> X[(i <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>(i <span class="sc">+</span> k),]</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>  hay <span class="ot">&lt;-</span> <span class="fu">colSums</span>(X.train)</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>  X.train <span class="ot">&lt;-</span> X.train[, hay<span class="sc">&gt;</span><span class="dv">0</span>]</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>  X.test <span class="ot">&lt;-</span> X[(i <span class="sc">+</span> k <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>(i <span class="sc">+</span> k <span class="sc">+</span> h),]</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>  X.test <span class="ot">&lt;-</span> X.test[, hay<span class="sc">&gt;</span><span class="dv">0</span>]</span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>  fit <span class="ot">&lt;-</span> <span class="fu">Arima</span>(train.set, </span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>               <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>               <span class="at">seasonal =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>               <span class="at">lambda =</span> <span class="dv">0</span>,</span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>               <span class="at">xreg =</span> X.train)</span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>  fcast <span class="ot">&lt;-</span> <span class="fu">forecast</span>(fit, <span class="at">h =</span> h, <span class="at">xreg =</span> X.test) </span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a>  mapeArima[i <span class="sc">+</span> <span class="dv">1</span>,] <span class="ot">&lt;-</span> <span class="dv">100</span><span class="sc">*</span><span class="fu">abs</span>(test.set <span class="sc">-</span> fcast<span class="sc">$</span>mean)<span class="sc">/</span>test.set</span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a>errorArima <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(mapeArima)</span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a>errorArima</span></code></pre></div>
<pre><code> [1] 1.894985 2.110367 2.256633 2.655027 2.691905 2.750383 2.902887 2.902539
 [9] 3.016537 3.217432 3.381909 3.534072</code></pre>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">y =</span> errorArima), <span class="at">colour =</span> <span class="st">&quot;Blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Figura 13. Error de predicción (MAPE) según horizonte temporal&quot;</span>) <span class="sc">+</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Horizonte temporal de predicción&quot;</span>) <span class="sc">+</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;%&quot;</span>) <span class="sc">+</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>)</span></code></pre></div>
<p><img src="03-05-Tema5_files/figure-html/unnamed-chunk-25-1.png" width="80%" style="display: block; margin: auto;" /></p>
<p>La figura 13 revela que el error de predicción aumenta de forma regular según aumenta el horizonte de predicción, pero incluso a un año vista, se mantiene bajo.</p>
<p><br />
</p>
</div>
</div>
<div id="chocolate" class="section level2" number="3.2">
<h2 number="3.2"><span class="header-section-number">3.2</span> Chocolate</h2>
<p>Vamos a aplicar la metodología de Box-Jenkins a la serie mensual de <strong>producción de chocolate en Australia</strong> desde enero de 1958 hasta diciembre de 1994, 444 meses.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>chocolate <span class="ot">&lt;-</span> <span class="fu">read.csv2</span>(<span class="st">&quot;./series/Chocolate.csv&quot;</span>, <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>chocolate <span class="ot">&lt;-</span> <span class="fu">ts</span>(chocolate, <span class="at">start =</span> <span class="dv">1958</span>, <span class="at">freq =</span> <span class="dv">12</span>)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(chocolate, </span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">&quot;&quot;</span>, </span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">&quot;Toneladas&quot;</span>,</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">&quot;Figura 14. Producción de Chocolate (Australia)&quot;</span>)</span></code></pre></div>
<p><img src="03-05-Tema5_files/figure-html/unnamed-chunk-26-1.png" width="80%" style="display: block; margin: auto;" /></p>
<p>La producción de chocolate presenta una tendencia creciente, especialmente desde los años 80 del siglo pasado, una marcada componente estacional (donde la máxima producción se da en el invierno austral, meses de mayo a agosto, y la menor producción en enero), combinados en un esquema multiplicativo. Trabajaremos con el logaritmo de la serie para linealizar las componentes y reducir la posible heterocedasticidad.</p>
<div id="transformación-de-la-serie-1" class="section level3 unnumbered">
<h3 class="unnumbered">Transformación de la serie</h3>
<p>La figura 15 muestra que solo la doble diferenciación regular y estacional consigue que la transformación logarítmica de Chocolate sea estacionaria y ergódica.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggAcf</span>(<span class="fu">log</span>(chocolate), <span class="at">lag =</span> <span class="dv">48</span>, </span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;d = D = 0&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Figura 14. FAC&quot;</span>)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggAcf</span>(<span class="fu">diff</span>(<span class="fu">log</span>(chocolate)), <span class="at">lag =</span> <span class="dv">48</span>, </span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;d = 1 - D = 0&quot;</span>, <span class="at">main =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggAcf</span>(<span class="fu">diff</span>(<span class="fu">log</span>(chocolate), <span class="at">lag =</span> <span class="dv">12</span>), <span class="at">lag =</span> <span class="dv">48</span>, </span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;d = 0 - D = 1&quot;</span>, <span class="at">main =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggAcf</span>(<span class="fu">diff</span>(<span class="fu">diff</span>(<span class="fu">log</span>(chocolate), <span class="at">lag =</span> <span class="dv">12</span>)), <span class="at">lag =</span> <span class="dv">48</span>, </span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;d = 1 - D = 1&quot;</span>, <span class="at">main =</span> <span class="st">&quot;&quot;</span>)</span></code></pre></div>
<p><img src="03-05-Tema5_files/figure-html/unnamed-chunk-28-1.png" width="80%" style="display: block; margin: auto;" /></p>
<p>Estos resultados son confirmados a través de las funciones <code>ndiffs</code> y <code>nsdiffs</code></p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ndiffs</span>(<span class="fu">log</span>(chocolate))</span></code></pre></div>
<pre><code>[1] 1</code></pre>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nsdiffs</span>(<span class="fu">log</span>(chocolate))</span></code></pre></div>
<pre><code>[1] 1</code></pre>
<p>Podemos concluir que <span class="math inline">\(d = 1\)</span> y <span class="math inline">\(D = 1\)</span> o <span class="math inline">\(\log(chocolate_t) \sim I(1)I_{12}(1)\)</span>.</p>
</div>
<div id="identificación-1" class="section level3 unnumbered">
<h3 class="unnumbered">Identificación</h3>
<p>Tras transformar la serie, vamos a identificar los valores de <span class="math inline">\(p\)</span>, <span class="math inline">\(q\)</span>, <span class="math inline">\(P\)</span> y <span class="math inline">\(Q\)</span> a partir de FAC y FACP de la serie doblemente diferenciada.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggtsdisplay</span>(<span class="fu">diff</span>(<span class="fu">diff</span>(<span class="fu">log</span>(chocolate), <span class="at">lag =</span> <span class="dv">12</span>)), <span class="at">lag =</span> <span class="dv">48</span>,</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">main =</span> <span class="st">&quot;Figura 16. FAC y FACP para Chocolate (log)&quot;</span>)</span></code></pre></div>
<p><img src="03-05-Tema5_files/figure-html/unnamed-chunk-30-1.png" width="80%" style="display: block; margin: auto;" /></p>
<p>Analizando la FAC y FACP (figura 15), tenemos que:</p>
<ul>
<li>FAC: un pico en la parte regular y decrecimiento en la estacional.</li>
<li>FACP: decrecimiento en la parte regular y estacional.</li>
</ul>
<p>Parece ser un ARIMA(0, 1, 1)(1, 1, 1).</p>
<p><br />
</p>
<p>¿Qué nos indica <code>auto.arima</code>? Para ayudar a esta función lo máximo posible vamos a definir una variable de intervención que pueden ser relevante:</p>
<ul>
<li><strong>Días laborables</strong>: al tratarse de datos de producción, el número de días laborables de cada mes puede ser un determinante del valor de la serie. Entenderemos por días laborables los lunes a viernes de cada mes, menos los días festivos. Este valor se puede obtener con la función <code>bizdays</code>. Un inconveniente de esta función, es que su valor depende de los festivos de cada país. Por ejemplo, en Australia el día del trabajador se celebra el primer lunes de octubre y en España el 1 de noviembre. Por proximidad cultural, histórica y política, usaremos el calendario de Londres para Australia. (<code>R</code> permite crear tu propio calendario de festivos y existen otras librerías que extienden las opciones de <code>bizdays</code>.)</li>
</ul>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bizdays</span>(chocolate, <span class="at">FinCenter =</span> <span class="st">&quot;London&quot;</span>)</span></code></pre></div>
<pre><code>     Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec
1958  23  20  21  20  21  21  23  20  22  23  20  21
1959  22  20  20  22  20  22  23  20  22  22  21  22
1960  21  21  23  19  22  21  21  22  22  21  22  21
1961  22  20  22  19  22  22  21  22  21  22  22  19
1962  23  20  22  19  23  20  22  22  20  23  22  19</code></pre>
<p>Vamos a crear esta variable y a incluirla en la auto-identificación.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Efecto año días laborables</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>DiasLaborables <span class="ot">&lt;-</span> <span class="fu">bizdays</span>(chocolate, <span class="at">FinCenter =</span> <span class="st">&quot;London&quot;</span>)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="fu">auto.arima</span>(chocolate, <span class="at">d =</span> <span class="dv">1</span>, <span class="at">D =</span> <span class="dv">1</span>, </span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">lambda =</span> <span class="dv">0</span>,</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">xreg =</span> DiasLaborables)</span></code></pre></div>
<pre><code>Series: chocolate 
Regression with ARIMA(1,1,1)(0,1,2)[12] errors 
Box Cox transformation: lambda= 0 

Coefficients:
         ar1      ma1     sma1     sma2    xreg
      0.3032  -0.9078  -0.6174  -0.0922  0.0339
s.e.  0.0619   0.0326   0.0501   0.0487  0.0040

sigma^2 estimated as 0.009433:  log likelihood=391.34
AIC=-770.68   AICc=-770.48   BIC=-746.28</code></pre>
<p>Indica <span class="math inline">\(ARIMA_{12}(1,1,1)(0,1,2)\)</span>, donde el parámetro <span class="math inline">\(\theta_{24}\)</span> no está claro si es significativo. Además, hay un efecto días laborables significativo.</p>
<p><br />
</p>
<p>Por último, la función <code>seas</code> (también con un poco de ayuda) identifica un proceso similar <span class="math inline">\(ARIMA_{12}(1,1,1)(0,1,1)\)</span>, con un efecto Semana Santa, (de quince días) un efecto día de la semana y un efecto año bisiesto, que globalmente se asemejan al efecto días laborables.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">seas</span>(<span class="fu">diff</span>(<span class="fu">diff</span>(<span class="fu">log</span>(chocolate), <span class="at">lag =</span> <span class="dv">12</span>))))</span></code></pre></div>
<pre><code>
Call:
seas(x = diff(diff(log(chocolate), lag = 12)))

Coefficients:
                   Estimate Std. Error z value             Pr(&gt;|z|)    
Leap Year          0.037906   0.031418   1.207             0.227622    
Mon                0.021718   0.017931   1.211             0.225819    
Tue                0.007760   0.018019   0.431             0.666733    
Wed                0.025674   0.018144   1.415             0.157080    
Thu               -0.002852   0.018096  -0.158             0.874763    
Fri               -0.015197   0.018124  -0.838             0.401771    
Sat               -0.063503   0.018205  -3.488             0.000486 ***
Easter[15]        -0.095747   0.045962  -2.083             0.037234 *  
AR-Nonseasonal-01  0.226982   0.056597   4.010            0.0000606 ***
MA-Nonseasonal-01  0.879176   0.027636  31.812 &lt; 0.0000000000000002 ***
MA-Seasonal-12     0.650157   0.040017  16.247 &lt; 0.0000000000000002 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

SEATS adj.  ARIMA: (1 0 1)(0 0 1)  Obs.: 431  Transform: none
AICc: -737.6, BIC: -689.5  QS (no seasonality in final):    0  
Box-Ljung (no autocorr.): 16.86   Shapiro (normality): 0.9879 ***
Messages generated by X-13:
Warnings:
- Automatic transformation selection cannot be done on a series
  with zero or negative values.
- At least one visually significant seasonal peak has been found
  in one or more of the estimated spectra.
- Series should not be a candidate for seasonal adjustment
  because the spectrum of the prior adjusted series (Table B1)
  has no visually significant seasonal peaks.</code></pre>
<p>Aparentemente ambas funciones identifican el mismo modelo, si del modelo identificado con <code>auto.arima</code> excluimos el parámetro no significativo. Te en cuenta que los días laborables ya descuentan el efecto de la Semana Santa, así que no es necesario incluir el efecto Semana Santa de forma independiente.</p>
</div>
<div id="estimación" class="section level3 unnumbered">
<h3 class="unnumbered">Estimación</h3>
<p>Vamos a realizar la primera estimación.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>choco.ar1 <span class="ot">&lt;-</span> <span class="fu">Arima</span>(chocolate, <span class="at">order=</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">seasonal =</span>  <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">lambda =</span> <span class="dv">0</span>,</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">xreg =</span> DiasLaborables)</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>choco.ar1</span></code></pre></div>
<pre><code>Series: chocolate 
Regression with ARIMA(1,1,1)(0,1,1)[12] errors 
Box Cox transformation: lambda= 0 

Coefficients:
         ar1      ma1     sma1    xreg
      0.2844  -0.8972  -0.6718  0.0339
s.e.  0.0620   0.0333   0.0462  0.0038

sigma^2 estimated as 0.009501:  log likelihood=389.55
AIC=-769.1   AICc=-768.96   BIC=-748.77</code></pre>
<p>Ya tenemos un modelo de partida, veamos si es necesaria más intervención.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>error <span class="ot">&lt;-</span> <span class="fu">residuals</span>(choco.ar1)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>sderror <span class="ot">&lt;-</span> <span class="fu">sd</span>(error)</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(error, <span class="at">series=</span><span class="st">&quot;Error&quot;</span>,</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">&quot;Error&quot;</span>,</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">&quot;Figura 17. Error + Intervención&quot;</span>) <span class="sc">+</span></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>)<span class="sc">*</span>sderror, </span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour =</span> <span class="fu">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;green&quot;</span>, <span class="st">&quot;green&quot;</span>, <span class="st">&quot;red&quot;</span>), </span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span> <span class="fu">seq</span>(<span class="dv">1958</span>, <span class="dv">1994</span>, <span class="dv">2</span>)) </span></code></pre></div>
<p><img src="03-05-Tema5_files/figure-html/unnamed-chunk-36-1.png" width="80%" style="display: block; margin: auto;" /></p>
<p>Se observan tres valores claramente atípicos en enero de 1986, 1991 y 1994. Además, hay otro candidatos a valor extremo, por superar las 2.5 desviaciones típicas, en septiembre de 1975. Por tanto,</p>
<ul>
<li>Se crea una variable de intervención para cada caso</li>
<li>Se estima de nuevo el modelo incluyendo estas variables</li>
<li>Se vuelve a analizar si quedan valores atípicos</li>
</ul>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>d0975 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">*</span>(<span class="fu">cycle</span>(chocolate) <span class="sc">==</span> <span class="dv">9</span> <span class="sc">&amp;</span> <span class="fu">trunc</span>(<span class="fu">time</span>(chocolate)) <span class="sc">==</span> <span class="dv">1975</span>)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>d0186 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">*</span>(<span class="fu">cycle</span>(chocolate) <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> <span class="fu">trunc</span>(<span class="fu">time</span>(chocolate)) <span class="sc">==</span> <span class="dv">1986</span>)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>d0191 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">*</span>(<span class="fu">cycle</span>(chocolate) <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> <span class="fu">trunc</span>(<span class="fu">time</span>(chocolate)) <span class="sc">==</span> <span class="dv">1991</span>)</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>d0194 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">*</span>(<span class="fu">cycle</span>(chocolate) <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> <span class="fu">trunc</span>(<span class="fu">time</span>(chocolate)) <span class="sc">==</span> <span class="dv">1994</span>)</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>choco.ar2 <span class="ot">&lt;-</span> <span class="fu">Arima</span>(chocolate, <span class="at">order=</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">seasonal =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">lambda =</span> <span class="dv">0</span>,</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>                   <span class="at">xreg =</span> <span class="fu">cbind</span>(DiasLaborables, d0975, d0186, d0191, d0194))</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>choco.ar2</span></code></pre></div>
<pre><code>Series: chocolate 
Regression with ARIMA(1,1,1)(0,1,1)[12] errors 
Box Cox transformation: lambda= 0 

Coefficients:
         ar1      ma1     sma1  DiasLaborables    d0975   d0186    d0191
      0.3052  -0.8889  -0.6778          0.0363  -0.1630  0.1291  -0.3385
s.e.  0.0646   0.0355   0.0413          0.0035   0.0753  0.0755   0.0769
       d0194
      0.5128
s.e.  0.0838

sigma^2 estimated as 0.008197:  log likelihood=423.4
AIC=-828.8   AICc=-828.37   BIC=-792.2</code></pre>
<p>Ahora debemos volver a verificar si en el nuevo modelo hay valores extremos. Observamos que no hay.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>error <span class="ot">&lt;-</span> <span class="fu">residuals</span>(choco.ar2)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>sderror <span class="ot">&lt;-</span> <span class="fu">sd</span>(error)</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(error, <span class="at">series=</span><span class="st">&quot;Error&quot;</span>,</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">&quot;Error&quot;</span>,</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">&quot;Figura 18. Error + Intervención&quot;</span>) <span class="sc">+</span></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>)<span class="sc">*</span>sderror, </span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour =</span> <span class="fu">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;green&quot;</span>, <span class="st">&quot;green&quot;</span>, <span class="st">&quot;red&quot;</span>), </span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span> <span class="fu">seq</span>(<span class="dv">1958</span>, <span class="dv">1994</span>, <span class="dv">2</span>)) </span></code></pre></div>
<p><img src="03-05-Tema5_files/figure-html/unnamed-chunk-38-1.png" width="80%" style="display: block; margin: auto;" /> Por último, veamos si todos los coeficientes del modelo son significativos. Aunque uno de ellos (enero 1986) no lo es al 5%, si lo es al 10% así que optamos por dejarlo.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>ancho <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">nchar</span>(<span class="fu">names</span>(<span class="fu">coef</span>(choco.ar2)))) <span class="sc">+</span> <span class="dv">2</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(<span class="fu">coef</span>(choco.ar2))) {</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  wt <span class="ot">&lt;-</span> <span class="fu">wald.test</span>(<span class="at">b =</span> <span class="fu">coef</span>(choco.ar2), </span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Sigma =</span> <span class="fu">vcov</span>(choco.ar2), </span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Terms =</span> i)</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">Coeficiente: &quot;</span>, <span class="fu">format</span>(<span class="fu">names</span>(<span class="fu">coef</span>(choco.ar2))[i], <span class="at">width =</span> ancho), <span class="st">&quot;valor de p: &quot;</span>,</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">formatC</span>(wt<span class="sc">$</span>result<span class="sc">$</span>chi2[<span class="dv">3</span>], <span class="at">digits =</span> <span class="dv">4</span>, <span class="at">format =</span> <span class="st">&quot;f&quot;</span>))</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>
Coeficiente:  ar1              valor de p:  0.0000
Coeficiente:  ma1              valor de p:  0.0000
Coeficiente:  sma1             valor de p:  0.0000
Coeficiente:  DiasLaborables   valor de p:  0.0000
Coeficiente:  d0975            valor de p:  0.0303
Coeficiente:  d0186            valor de p:  0.0874
Coeficiente:  d0191            valor de p:  0.0000
Coeficiente:  d0194            valor de p:  0.0000</code></pre>
</div>
<div id="validación-1" class="section level3 unnumbered">
<h3 class="unnumbered">Validación</h3>
<p>Analizando los criterios de bondad de ajuste se tiene que: el error medio es 3, prácticamente cero, por lo que no parece que haya sesgo en las predicciones; en media nos equivocamos en 488 toneladas (RMSE); y el error porcentual medio es 7%, razonable.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(choco.ar2)</span></code></pre></div>
<pre><code>             ME   RMSE    MAE   MPE MAPE MASE  ACF1
Training set  3 488.05 360.71 -0.33 6.99 0.69 -0.05</code></pre>
<p><br />
</p>
<p><strong>Incorrelación, Homocedasticidad y Normalidad</strong></p>
<p>Veamos ahora si el residuo es ruido blanco.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Box.test</span>(error, <span class="at">lag =</span> <span class="dv">2</span>,<span class="at">type =</span> <span class="st">&quot;Ljung-Box&quot;</span>)</span></code></pre></div>
<pre><code>
    Box-Ljung test

data:  error
X-squared = 3.8081, df = 2, p-value = 0.149</code></pre>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Box.test</span>(error, <span class="at">lag =</span> <span class="dv">24</span>,<span class="at">type =</span> <span class="st">&quot;Ljung-Box&quot;</span>)</span></code></pre></div>
<pre><code>
    Box-Ljung test

data:  error
X-squared = 27.763, df = 24, p-value = 0.2701</code></pre>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Box.test</span>(error<span class="sc">^</span><span class="dv">2</span>, <span class="at">lag =</span> <span class="dv">2</span>, <span class="at">type =</span> <span class="st">&quot;Ljung-Box&quot;</span>)</span></code></pre></div>
<pre><code>
    Box-Ljung test

data:  error^2
X-squared = 0.077789, df = 2, p-value = 0.9619</code></pre>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Box.test</span>(error<span class="sc">^</span><span class="dv">2</span>, <span class="at">lag =</span> <span class="dv">24</span>, <span class="at">type =</span> <span class="st">&quot;Ljung-Box&quot;</span>)</span></code></pre></div>
<pre><code>
    Box-Ljung test

data:  error^2
X-squared = 29.658, df = 24, p-value = 0.1964</code></pre>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">jarque.bera.test</span>(error) </span></code></pre></div>
<pre><code>
    Jarque Bera Test

data:  error
X-squared = 1.0924, df = 2, p-value = 0.5791</code></pre>
<p>El error muestra ser incorrelado, homocedástico y seguir una distribución normal.</p>
</div>
<div id="interpretación-1" class="section level3 unnumbered">
<h3 class="unnumbered">Interpretación</h3>
<p>El <em>modelo teórico</em> es <span class="math inline">\(log(chocolate) \sim ARIMA_{12}(1, 1, 1)(0, 1, 1) + AI\)</span>, <span class="math display">\[(1 - \phi_1 L)(1 - L^{12})(1 - L)\log(chocolate_t) = (1 + \theta_1 L)(1 + \theta_{12} L^{12})\varepsilon_t + AI.\]</span> Si sustituimos <span class="math inline">\((1 - L^{12})\log(chocolate_t)\)</span> por <span class="math inline">\(TVA_{chocolate_t}\)</span>, desarrollamos el modelo y sustituimos los parámetros por sus estimaciones, queda <span class="math display">\[\widehat{TVA}_{chocolate_t} = TVA_{chocolate_{t-1}} + 0.31(TVA_{chocolate_{t-1}} - TVA_{chocolate_{t-2}})\]</span> <span class="math display">\[- 0.89\varepsilon_{t-1} - 0.68\varepsilon_{t-12} + 0.60\varepsilon_{t-13}\]</span> <span class="math display">\[+0.036\cdot DiasLaborables - 0.16\cdot d0975 + 0.13 \cdot d0186-0.34 \cdot d0191 + 0.51\cdot d0194.\]</span> Por tanto:</p>
<ul>
<li>La tasa de variación anual en la producción de chocolate para un mes es la misma que la del mes pasado más un 31% del último incremento observado.</li>
<li>Si en los meses pasados el valor esperado en la tasa de variación se alejó de la real, hay que tenerlo en cuenta para corregir las previsiones.</li>
<li>Cada día laborable adicional en un mes supone un incremento del 3.6% en la producción.</li>
<li>En determinados meses hubo unos valores de producción muy alejados de los esperado.</li>
</ul>
</div>
<div id="predicción-de-la-serie-1" class="section level3 unnumbered">
<h3 class="unnumbered">Predicción de la serie</h3>
<p>Una vez dado por válido el modelo podemos pasar a realizar predicciones. Hay que tener en cuenta que hay una variable de intervención de efecto calendario (Días laborables), para la que debemos indicar qué valores tomará en el periodo de predicción. Vamos a fijar el horizonte de predicción en cuatro años (1995 a 1998).</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>dummy <span class="ot">&lt;-</span> <span class="fu">ts</span>(<span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">48</span>), <span class="at">start =</span> <span class="dv">1995</span>, <span class="at">frequency =</span> <span class="dv">12</span>)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>pdl <span class="ot">&lt;-</span> <span class="fu">bizdays</span>(dummy, <span class="at">FinCenter =</span> <span class="st">&quot;London&quot;</span>)</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>pchoco.ar2 <span class="ot">&lt;-</span> <span class="fu">forecast</span>(choco.ar2, </span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">h =</span> <span class="dv">48</span>,</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">xreg =</span> <span class="fu">cbind</span>(pdl, <span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">48</span>), <span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">48</span>), <span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">48</span>), <span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">48</span>)), </span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">level =</span> <span class="dv">95</span>)</span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(pchoco.ar2, </span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">&#39;Toneladas&#39;</span>,</span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">&#39;Figura 19. Chocolate (1958-1994) y predicción (1995-1998)&#39;</span>) <span class="sc">+</span></span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span> <span class="fu">seq</span>(<span class="dv">1958</span>, <span class="dv">1998</span>, <span class="dv">4</span>)) </span></code></pre></div>
<p><img src="03-05-Tema5_files/figure-html/unnamed-chunk-43-1.png" width="80%" style="display: block; margin: auto;" /></p>
</div>
<div id="error-de-predicción-extra-muestral-según-horizonte-temporal-1" class="section level3 unnumbered">
<h3 class="unnumbered">Error de predicción extra-muestral según horizonte temporal</h3>
<p>Asumimos que se precisan veinte años para hacer una buena estimación, <span class="math inline">\(k = 240\)</span>, y fijaremos el horizonte temporal en un año, <span class="math inline">\(h = 12\)</span> meses.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">240</span>                </span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>h <span class="ot">&lt;-</span> <span class="dv">12</span>                 </span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>T <span class="ot">&lt;-</span> <span class="fu">length</span>(chocolate)  </span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>s<span class="ot">&lt;-</span>T <span class="sc">-</span> k <span class="sc">-</span> h            </span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>mapeArima <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, s <span class="sc">+</span> <span class="dv">1</span>, h)</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">cbind</span>(DiasLaborables, d0975, d0186, d0191, d0194))</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">0</span><span class="sc">:</span>s) {</span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>  train.set <span class="ot">&lt;-</span> <span class="fu">subset</span>(chocolate, <span class="at">start =</span> i <span class="sc">+</span> <span class="dv">1</span>, <span class="at">end =</span> i <span class="sc">+</span> k)</span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>  test.set <span class="ot">&lt;-</span>  <span class="fu">subset</span>(chocolate, <span class="at">start =</span> i <span class="sc">+</span> k <span class="sc">+</span> <span class="dv">1</span>, <span class="at">end =</span> i <span class="sc">+</span> k <span class="sc">+</span> h) </span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a>  X.train <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(X[(i <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>(i <span class="sc">+</span> k),])</span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a>  hay <span class="ot">&lt;-</span> <span class="fu">colSums</span>(X.train)</span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a>  X.train <span class="ot">&lt;-</span> X.train[, hay<span class="sc">&gt;</span><span class="dv">0</span>]</span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb74-18"><a href="#cb74-18" aria-hidden="true" tabindex="-1"></a>  X.test <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(X[(i <span class="sc">+</span> k <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>(i <span class="sc">+</span> k <span class="sc">+</span> h),])</span>
<span id="cb74-19"><a href="#cb74-19" aria-hidden="true" tabindex="-1"></a>  X.test <span class="ot">&lt;-</span> X.test[, hay<span class="sc">&gt;</span><span class="dv">0</span>]</span>
<span id="cb74-20"><a href="#cb74-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb74-21"><a href="#cb74-21" aria-hidden="true" tabindex="-1"></a>  fit <span class="ot">&lt;-</span> <span class="fu">Arima</span>(train.set, </span>
<span id="cb74-22"><a href="#cb74-22" aria-hidden="true" tabindex="-1"></a>               <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb74-23"><a href="#cb74-23" aria-hidden="true" tabindex="-1"></a>               <span class="at">seasonal =</span> <span class="fu">list</span>(<span class="at">order =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>), <span class="at">period =</span> <span class="dv">12</span>),</span>
<span id="cb74-24"><a href="#cb74-24" aria-hidden="true" tabindex="-1"></a>               <span class="at">lambda =</span> <span class="dv">0</span>,</span>
<span id="cb74-25"><a href="#cb74-25" aria-hidden="true" tabindex="-1"></a>               <span class="at">xreg =</span> <span class="fu">as.matrix</span>(X.train))</span>
<span id="cb74-26"><a href="#cb74-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb74-27"><a href="#cb74-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb74-28"><a href="#cb74-28" aria-hidden="true" tabindex="-1"></a>  fcast <span class="ot">&lt;-</span> <span class="fu">forecast</span>(fit, <span class="at">h =</span> h, <span class="at">xreg =</span> <span class="fu">as.matrix</span>(X.test)) </span>
<span id="cb74-29"><a href="#cb74-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb74-30"><a href="#cb74-30" aria-hidden="true" tabindex="-1"></a>  mapeArima[i <span class="sc">+</span> <span class="dv">1</span>,] <span class="ot">&lt;-</span> <span class="dv">100</span><span class="sc">*</span><span class="fu">abs</span>(test.set <span class="sc">-</span> fcast<span class="sc">$</span>mean)<span class="sc">/</span>test.set</span>
<span id="cb74-31"><a href="#cb74-31" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb74-32"><a href="#cb74-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb74-33"><a href="#cb74-33" aria-hidden="true" tabindex="-1"></a>errorArima <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(mapeArima)</span>
<span id="cb74-34"><a href="#cb74-34" aria-hidden="true" tabindex="-1"></a>errorArima</span></code></pre></div>
<pre><code> [1] 8.377471 8.600894 8.872539 9.262283 9.405912 9.251936 9.321219 9.354090
 [9] 9.070492 9.241635 9.157093 9.303983</code></pre>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">y =</span> errorArima), <span class="at">colour =</span> <span class="st">&quot;Blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Figura 20. Error de predicción (MAPE) según horizonte temporal&quot;</span>) <span class="sc">+</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Horizonte temporal de predicción&quot;</span>) <span class="sc">+</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;%&quot;</span>) <span class="sc">+</span></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>)</span></code></pre></div>
<p><img src="03-05-Tema5_files/figure-html/unnamed-chunk-45-1.png" width="80%" style="display: block; margin: auto;" /></p>
<p>La figura 20 revela que el error de predicción a un periodo vista es 1.4 puntos porcentuales superior al error de ajuste. Hasta los 5 meses el error aumenta según aumenta el horizonte de predicción. Desde el sexto mes, el error se mantiene estable en torno al 9%-9.4%.</p>
<p><br />
<br />
</p>
</div>
</div>
</div>
<div id="comparación-con-alisado-exponencial" class="section level1" number="4">
<h1 number="4"><span class="header-section-number">4</span> Comparación con alisado exponencial</h1>
<p>Veamos una comparativa, para los dos ejemplos vistos, entre los resultados obtenidos con ARIMA y con Alisado exponencial</p>
<div id="nacimientos-log" class="section level3 unnumbered">
<h3 class="unnumbered">Nacimientos (log)</h3>
<table>
<thead>
<tr class="header">
<th align="left">Método</th>
<th align="left">Modelo</th>
<th align="center">MAPE</th>
<th align="center"></th>
<th align="center"></th>
<th align="center"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"></td>
<td align="left"></td>
<td align="center">Ajuste</td>
<td align="center">Extra h = 1</td>
<td align="center">Extra h = 6</td>
<td align="center">Extra h = 12</td>
</tr>
<tr class="even">
<td align="left">ARIMA</td>
<td align="left">ARIMA(0,1,1)(0,1,2) + AI</td>
<td align="center">1.55</td>
<td align="center">1.90</td>
<td align="center">2.77</td>
<td align="center">3.60</td>
</tr>
<tr class="odd">
<td align="left">Alisado</td>
<td align="left">ETS(A,Ad,A)</td>
<td align="center">1.75</td>
<td align="center">1.91</td>
<td align="center">2.90</td>
<td align="center">3.83</td>
</tr>
</tbody>
</table>
<p>Para Nacimientos, la mejora en los indicadores de calidad con ARIMA respecto de Alisado es tan pequeña que no justifica su aplicación. Incluso para previsiones extra-muestrales a 12 meses vista, Alisado sólo es inferior en medio punto porcentual a ARIMA.</p>
</div>
<div id="chocolate-log" class="section level3 unnumbered">
<h3 class="unnumbered">Chocolate (log)</h3>
<table>
<thead>
<tr class="header">
<th align="left">Método</th>
<th align="left">Modelo</th>
<th align="center">MAPE</th>
<th align="center"></th>
<th align="center"></th>
<th align="center"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"></td>
<td align="left"></td>
<td align="center">Ajuste</td>
<td align="center">Extra h = 1</td>
<td align="center">Extra h = 6</td>
<td align="center">Extra h = 12</td>
</tr>
<tr class="even">
<td align="left">ARIMA</td>
<td align="left">ARIMA(1,1,1)(0,1,1) + AI</td>
<td align="center">6.99</td>
<td align="center">8.38</td>
<td align="center">9.25</td>
<td align="center">9.30</td>
</tr>
<tr class="odd">
<td align="left">Alisado</td>
<td align="left">ETS(A,A,A)</td>
<td align="center">8.15</td>
<td align="center">9.36</td>
<td align="center">11.07</td>
<td align="center">9.39</td>
</tr>
</tbody>
</table>
<p>En el caso de Chocolate, la mejora en la calidad del ajuste con ARIMA respecto de Alisado es de 1 a 2 puntos porcentuales en previsiones a unos pocos meses vista. Sin embargo, a doce meses vista ambos métodos ofrecen igual calidad en sus predicciones.</p>
<p><br />
<br />
<br />
<br />
</p>
</div>
</div>

<div id="rmd-source-code">LS0tCnRpdGxlOiAiU2VyaWVzIFRlbXBvcmFsZXM6IFByb2Nlc29zIEFSSU1BIGNvbiBlc3RhY2lvbmFsaWRhZCIKc3VidGl0bGU6ICJNw6FzdGVyIGRlIEJpb2VzdGFkw61zdGljYSAoTW9kZWxpemFjacOzbiBFc3RhZMOtc3RpY2EpIgphdXRob3I6ICJJdsOhbiBBcnJpYmFzIChEZXB0by4gQW7DoWxpc2lzIEVjb27Ds21pY28uIFVuaXZlcnNpdGF0IGRlIFZhbMOobmNpYSkiCm91dHB1dDogCiAgaHRtbF9kb2N1bWVudDoKICAgIHRoZW1lOiBjZXJ1bGVhbgogICAgaGlnaGxpZ2h0OiBweWdtZW50cyAKICAgIGZpZ19jYXB0aW9uOiBmYWxzZQogICAgZGZfcHJpbnQ6IGthYmxlCiAgICB0b2M6IHRydWUKICAgIHRvY19kZXB0aDogMgogICAgdG9jX2Zsb2F0OiAKICAgICAgY29sbGFwc2VkOiB0cnVlCiAgICBudW1iZXJfc2VjdGlvbnM6IHRydWUKICAgIHNlbGZfY29udGFpbmVkOiB0cnVlCiAgICBjb2RlX2Rvd25sb2FkOiB0cnVlCi0tLQoKYGBge3IgY2h1bmtfc2V0dXAsIGVjaG8gPSBGQUxTRX0Ka25pdHI6Om9wdHNfY2h1bmskc2V0KHdhcm5pbmcgPSBGQUxTRSwgCiAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlID0gRkFMU0UsIAogICAgICAgICAgICAgICAgICAgICAgY29tbWVudCA9ICIiLAogICAgICAgICAgICAgICAgICAgICAgZmlnLmFsaWduID0gImNlbnRlciIsIAogICAgICAgICAgICAgICAgICAgICAgZmlnLnNob3cgPSAiaG9sZCIsCiAgICAgICAgICAgICAgICAgICAgICBmaWcuaGVpZ2h0ID0gNCwKICAgICAgICAgICAgICAgICAgICAgIGZpZy53aWR0aCA9IDgsCiAgICAgICAgICAgICAgICAgICAgICBvdXQud2lkdGggPSAiODAlIikgCmBgYAoKYGBge3Igb3B0aW9uc19zZXR1cCwgZWNobyA9IEZBTFNFfQpvcHRpb25zKHNjaXBlbiA9IDk5OSkgIy0gcGFyYSBxdWl0YXIgbGEgbm90YWNpb24gY2llbnRpZmljYQpgYGAKCmBgYHtyIGxpYnJlcmlhcywgZWNobyA9IEZBTFNFfQpsaWJyYXJ5KGZvcmVjYXN0KQpsaWJyYXJ5KGdncGxvdDIpOyB0aGVtZV9zZXQodGhlbWVfYncoKSkKbGlicmFyeShncmlkRXh0cmEpCmxpYnJhcnkoZ3JpZCkKbGlicmFyeSh0c2VyaWVzKQpsaWJyYXJ5KGFvZCkKbGlicmFyeShzZWFzb25hbCkKYGBgCgojIEludHJvZHVjY2nDs24KCkVuIGdlbmVyYWwsIGxhIGNhcGFjaWRhZCBkZSB0b21hIGRlIGRhdG9zIHBvc2liaWxpdGEgcXVlIGVsIGZlY2hhZG8gZGUgbGFzIHNlcmllcyBzZWEgaW5mZXJpb3IgYWwgYcOxbywgYXBhcmVjaWVuZG8gbGEgY29tcG9uZW50ZSBlc3RhY2lvbmFsLiBObyBlcyBkaWbDrWNpbCBkaXNwb25lciBkZSBzZXJpZXMgbWVuc3VhbGVzLCB0cmltZXN0cmFsZXMsIGRpYXJpYXMgbyBpbmNsdXNvIGNvbiBmcmVjdWVuY2lhIHN1cGVyaW9yLgoKRW4gZXN0ZSB0ZW1hIHNlIHJldmlzYW4gbG9zIGNvbm9jaW1pZW50b3MgZGVsIHRlbWEgcHJldmlvLCBhbXBsacOhbmRvbG9zIGEgZmluIGRlIGNvbnRlbXBsYXIgbGEgcHJlc2VuY2lhIGRlIGVzdGFjaW9uYWxpZGFkIGVuIGxhcyBzZXJpZXMgdGVtcG9yYWxlcwoKU2UgbWFudGllbmVuIGxhcyBoaXDDs3Rlc2lzIHNvYnJlIGVsIHByb2Nlc28gZ2VuZXJhZG9yIGRlIGRhdG9zIChfZXN0YWNpb25hcmlvXyB5IF9lcmfDs2RpY29fKSB5IGVsIHZlY3RvciBkZSByZXNpZHVvcyAoX3J1aWRvIGJsYW5jb18pLgoKUmVjdWVyZGEgcXVlICRtJCBlcyBlbCBvcmRlbiBlc3RhY2lvbmFsLgoKXApcCgojIFByb2Nlc29zIEFSSU1BIGNvbiBlc3RhY2lvbmFsaWRhZAoKXAoKIyMgUHJvY2Vzb3MgYXV0b3JyZWdyZXNpdm9zICRBUl9tKFApJAoKIyMjIERlZmluaWNpw7NuIHstfQoKRWwgbW9kZWxvIGdlbmVyYWwgX19hdXRvcnJlZ3Jlc2l2byBlc3RhY2lvbmFsIGRlIG9yZGVuIFBfXywgJHlfdCBcc2ltIEFSX20oUCkkIHZpZW5lIGRlZmluaWRvIHBvcgokJHlfdD1jICsgXHBoaV9tIHlfe3QtbX0gKyBccGhpX3sybX0geV97dC0ybX0gKyBcbGRvdHMgKyBccGhpX3tQbX0geV97dC1QbX0gKyBcdmFyZXBzaWxvbl90LCQkClxub2luZGVudCBxdWUgdXNhbmRvIGVsIG9wZXJhZG9yIHJldGFyZG8gcXVlZGEKICAkJCgxIC0gXHBoaV9tIExebSAtIFxwaGlfezJtfSBMXnsybX0gLSBcbGRvdHMgLSBccGhpX3tQbX0gTF57UG19KXlfdCA9IGMgKyBcdmFyZXBzaWxvbl90LiQkCgojIyMgUHJvcGllZGFkZXMgey19CgpFbCBwcm9jZXNvIGVzIF9fZXN0YWNpb25hcmlvX18gc2kgcXVlZGFuIGZ1ZXJhIGRlbCBjw61yY3VsbyBkZSByYWRpbyB1bmlkYWQgdG9kYXMgbGFzIHJhw61jZXMgZGVsIHBvbGlub21pbwokJFxQaGlfUCh6KSA9IDEgLSBccGhpX20gel5tIC0gXHBoaV97Mm19IHpeezJtfSAtIFxsZG90cyAtIFxwaGlfe1BtfSB6XntQbX0uJCQKCkVzIF9faW52ZXJ0aWJsZV9fIHNpZW1wcmUuCgpfX1NvYnJlIHRvZG9fXywKCiogRW4gbGEgRkFDIGxhcyBhdXRvY29ycmVsYWNpb25lcyBkZSBfX29yZGVuIG3Dumx0aXBsbyBkZSBtX18gJChtLDJtLFxsZG90cykkIGRlY2FlbiBleHBvbmVuY2lhbG1lbnRlIGEgcGFydGlyIGRlbCBvcmRlbiBQLgoqIEVuIGxhIEZBQ1AgbGFzIGF1dG9jb3JyZWxhY2lvbmVzIHBhcmNpYWxlcyBkZSBfX29yZGVuIG3Dumx0aXBsbyBkZSBtX18gdmVyaWZpY2FuIHF1ZSBsb3MgUCBwcmltZXJvcyB2YWxvcmVzIHNvbiBubyBudWxvcyB5IHRvZG9zIGxvcyBkZW3DoXMgdmFsZW4gY2Vyby4KCiMjIyBFamVtcGxvcyB7LX0KCiogJHlfdCBcc2ltIEFSX3sxMn0oMSk6XDtcO3lfdCA9IGMgKyBccGhpX3sxMn0geV97dC0xMn0gKyBcdmFyZXBzaWxvbl90JCBvICQoMSAtIFxwaGlfezEyfSBMXnsxMn0peV90ID0gYyArIFx2YXJlcHNpbG9uX3QkCiogJHlfdCBcc2ltIEFSXzcoMik6XDtcO3lfdCA9IGMgKyBccGhpXzcgeV97dC03fSArIFxwaGlfezE0fSB5X3t0LTE0fSArIFx2YXJlcHNpbG9uX3QkIG8gJCgxIC0gXHBoaV83IExeNyAtIFxwaGlfezE0fSBMXnsxNH0peV90ID0gYyArIFx2YXJlcHNpbG9uX3QkCgojIyMgU2ltdWxhY2lvbmVzIGRlIHByb2Nlc29zIGF1dG9ycmVncmVzaXZvcyAkQVJfbShQKSQgey19CgpMYSBmaWd1cmEgMSBtdWVzdHJhbiB1bmEgc2ltdWxhY2nDs24gZGVsIHByb2Nlc28gJEFSX3s0fSgyKSQgJHlfdCA9IDAuN3lfe3QtNH0gLSAwLjd5X3t0LTh9ICsgXHZhcmVwc2lsb25fdCQsIHkgbGEgZmlndXJhIDIgc2ltdWxhIGVsIHByb2Nlc28gJEFSX3sxMn0oMSkkICR5X3QgPSAwLjZ5X3t0LTEyfSArIFx2YXJlcHNpbG9uX3QkLiBFbiBhbWJvcyBjYXNvcyBsYSBtdWVzdHJhIGVzIGRlIHRhbWHDsW8gNTAwIHkgJFx2YXJlcHNpbG9uX3QkIHNlIGRpc3RyaWJ1eWUgY29tbyB1bmEgbm9ybWFsIGNvbiBtZWRpYSBjZXJvIHkgdmFyaWFuemEgbGEgdW5pZGFkLiAoVG9kYXMgbGFzIHNpbXVsYWNpb25lcyBzZSBoYW4gcmVhbGl6YWRvIGNvbiBsYSBmdW5jacOzbiBgYXJpbWEuc2ltYCBkZSBsYSBsaWJyZXLDrWEgYHN0YXRzYC4pCgoKYGBge3IsIGVjaG8gPSBGQUxTRX0Kc2V0LnNlZWQoMzE0MTY1OTIpCnlhcjRfMiA8LSBhcmltYS5zaW0obiA9IDUwMCwgbW9kZWwgPSBsaXN0KG9yZGVyID0gYyg4LDAsMCksIGFyID0gYygwLDAsMCwwLjcsMCwwLDAsLTAuNykpLCBpbm5vdiA9IHJub3JtKDUwMCkpCmdndHNkaXNwbGF5KHlhcjRfMiwgbWFpbiA9ICJGaWd1cmEgMS4gQVI0KDIpIC0gbiA9IDUwMCIsIGxhZyA9IDIwKQoKeWFyMTJfMSA8LSBhcmltYS5zaW0obiA9IDUwMCwgbW9kZWwgPSBsaXN0KG9yZGVyID0gYygxMiwwLDApLCBhciA9IGMoMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAuNikpLCBpbm5vdiA9IHJub3JtKDUwMCkpCmdndHNkaXNwbGF5KHlhcjEyXzEsIG1haW4gPSAiRmlndXJhIDIuIEFSMTIoMSkgLSBuID0gNTAwIiwgbGFnID0gNDgpCmBgYAoKXAoKIyMgUHJvY2Vzb3MgZW4gbWVkaWFzIG3Ds3ZpbGVzICRNQV9tKFEpJAoKIyMjIERlZmluaWNpw7NuIHstfQoKRWwgbW9kZWxvIGdlbmVyYWwgX19lbiBtZWRpYXMgbcOzdmlsZXMgZXN0YWNpb25hbCBkZSBvcmRlbiBRX18sICR5X3QgXHNpbSBNQV9tKFEpJCB2aWVuZSBkZWZpbmlkbyBwb3IKJCR5X3Q9YyArIFx2YXJlcHNpbG9uX3QgKyBcdGhldGFfbSBcdmFyZXBzaWxvbl97dC1tfSArIFx0aGV0YV97Mm19IFx2YXJlcHNpbG9uX3t0LTJtfSArIFxsZG90cyArCiAgXHRoZXRhX3tRbX0gXHZhcmVwc2lsb25fe3QtUW19LCQkClxub2luZGVudCBxdWUgdXNhbmRvIGVsIG9wZXJhZG9yIHJldGFyZG8gcXVlZGEKJCR5X3QgPSBjICsgKDEgKyBcdGhldGFfbSBMXm0gKyBcdGhldGFfezJtfSBMXnsybX0gKyBcbGRvdHMgKyBcdGhldGFfe1FtfSBMXntRbX0pIFx2YXJlcHNpbG9uX3QuJCQKICAKIyMjIFByb3BpZWRhZGVzIHstfQogIApFbCBwcm9jZXNvIGVzIF9faW52ZXJ0aWJsZV9fIHNpIHF1ZWRhbiBmdWVyYSBkZWwgY8OtcmN1bG8gZGUgcmFkaW8gdW5pZGFkIHRvZGFzIGxhcyByYcOtY2VzIGRlbCBwb2xpbm9taW8KJCRcVGhldGFfUSh6KSA9IDEgKyBcdGhldGFfbSB6Xm0gKyBcdGhldGFfezJtfSB6XnsybX0gKyBcbGRvdHMgKyBcdGhldGFfe1FtfSB6XntRbX0uJCQKICAKRXMgX19lc3RhY2lvbmFyaW9fXyBzaWVtcHJlLgoKX19Tb2JyZSB0b2RvX18sCgoqIEVuIGxhIEZBQyBsYXMgYXV0b2NvcnJlbGFjaW9uZXMgZGUgX19vcmRlbiBtw7psdGlwbG8gZGUgbV9fIHZlcmlmaWNhbiBxdWUgbG9zIFEgcHJpbWVyb3MgdmFsb3JlcyBzb24gbm8gbnVsb3MgeSB0b2RvcyBsb3MgZGVtw6FzIHZhbGVuIGNlcm8uCiogRW4gbGEgRkFDUCBsYXMgYXV0b2NvcnJlbGFjaW9uZXMgcGFyY2lhbGVzIGRlIF9fb3JkZW4gbcO6bHRpcGxvIGRlIG1fXyBkZWNhZW4gZXhwb25lbmNpYWxtZW50ZSBhIHBhcnRpciBkZWwgb3JkZW4gUS4KCiMjIyBFamVtcGxvcyB7LX0KCiogJHlfdCBcc2ltIE1BXzcoMSk6XDtcO3lfdCA9IGMgKyBcdmFyZXBzaWxvbl90ICsgXHRoZXRhXzcgXHZhcmVwc2lsb25fe3QtN30kIG8gJHlfdCA9IGMgKyAoMSArIFx0aGV0YV83IExeNylcdmFyZXBzaWxvbl90JAoqICR5X3QgXHNpbSBNQV97MTJ9KDIpOlw7XDt5X3Q9YyArIFx2YXJlcHNpbG9uX3QgKyBcdGhldGFfezEyfSBcdmFyZXBzaWxvbl97dC0xMn0gKyBcdGhldGFfezI0fSBcdmFyZXBzaWxvbl97dC0yNH0kIG8gJHlfdCA9IGMgKyAoMSArIFx0aGV0YV97MTJ9IExeezEyfSArIFx0aGV0YV97MjR9IExeezI0fSlcdmFyZXBzaWxvbl90JAoKIyMjIFNpbXVsYWNpb25lcyBkZSBwcm9jZXNvcyBlbiBtZWRpYXMgbcOzdmlsZXMgJE1BX20oUSkkIHstfQoKTGEgZmlndXJhIDMgbXVlc3RyYSB1bmEgc2ltdWxhY2nDs24gZGVsIHByb2Nlc28gJE1BX3s0fSgyKSQgJHlfdCA9IDAuN1x2YXJlcHNpbG9uX3t0LTR9IC0gMC43XHZhcmVwc2lsb25fe3QtOH0gKyBcdmFyZXBzaWxvbl90JCwgeSBsYSBmaWd1cmEgNCBzaW11bGEgZWwgcHJvY2VzbyAkTUFfezEyfSgxKSQgJHlfdCA9IDAuNlx2YXJlcHNpbG9uX3t0LTEyfSArIFx2YXJlcHNpbG9uX3QkLiBFbiBhbWJvcyBjYXNvcyBsYSBtdWVzdHJhIGVzIGRlIHRhbWHDsW8gNTAwIHkgJFx2YXJlcHNpbG9uX3QkIHNlIGRpc3RyaWJ1eWUgY29tbyB1bmEgbm9ybWFsIGNvbiBtZWRpYSBjZXJvIHkgdmFyaWFuemEgbGEgdW5pZGFkLgoKYGBge3IsIGVjaG8gPSBGQUxTRX0Kc2V0LnNlZWQoMzE0MTY1OTIpCnltYTRfMiA8LSBhcmltYS5zaW0obiA9IDUwMCwgbW9kZWwgPSBsaXN0KG9yZGVyID0gYygwLDAsOCksIG1hID0gYygwLDAsMCwwLjcsMCwwLDAsLTAuNykpLCBpbm5vdiA9IHJub3JtKDUwMCkpCmdndHNkaXNwbGF5KHltYTRfMiwgbWFpbiA9ICJGaWd1cmEgMy4gTUE0KDIpIC0gbiA9IDUwMCIsIGxhZyA9IDIwKQoKeW1hMTJfMSA8LSBhcmltYS5zaW0obiA9IDUwMCwgbW9kZWwgPSBsaXN0KG9yZGVyID0gYygwLDAsMTIpLCBtYSA9IGMoMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAuNikpLCBpbm5vdiA9IHJub3JtKDUwMCkpCmdndHNkaXNwbGF5KHltYTEyXzEsIG1haW4gPSAiRmlndXJhIDQuIE1BMTIoMSkgLSBuID0gNTAwIiwgbGFnID0gNDgpCmBgYAoKXAoKIyMgUHJvY2Vzb3MgJEFSTUFfbShQLFEpJAoKIyMjIERlZmluaWNpw7NuIHstfQoKRWwgbW9kZWxvIGdlbmVyYWwgX18keV90IFxzaW0gQVJNQV9tKFAsUSkkX18gdmllbmUgZGVmaW5pZG8gcG9yCiQkIHlfdCA9IGMgKyBccGhpX20geV97dC1tfSArIFxwaGlfezJtfSB5X3t0LTJtfSArIFxsZG90cyArIFxwaGlfe1BtfSB5X3t0LVBtfSAgKyAKICBcdmFyZXBzaWxvbl90ICsgXHRoZXRhX20gXHZhcmVwc2lsb25fe3QtbX0gKyBcdGhldGFfezJtfSBcdmFyZXBzaWxvbl97dC0ybX0gKyBcbGRvdHMgKwogIFx0aGV0YV97UW19IFx2YXJlcHNpbG9uX3t0LVFtfSwkJApxdWUgdXNhbmRvIGVsIG9wZXJhZG9yIHJldGFyZG8gcXVlZGEKJCQoMSAtIFxwaGlfbSBMXm0gLSBcbGRvdHMgLSBccGhpX3tQbX0gTF57UG19KXlfdCA9IGMgKyAoMSArIFx0aGV0YV9tIExebSArIFxsZG90cyArIFx0aGV0YV97UW19IExee1FtfSkgXHZhcmVwc2lsb25fdC4kJAogIApFbCBwcm9jZXNvIG3DoXMgc2ltcGxlIGVzIGVsICRBUk1BX20oMSwxKSQ6ICR5X3QgPSBjICArIFxwaGlfbSB5X3t0LW19ICsgXHRoZXRhX20gXHZhcmVwc2lsb25fe3QtbX0gKyBcdmFyZXBzaWxvbl97dH0uJAogIAojIyMgUHJvcGllZGFkZXMgey19CiAgCkVsIHByb2Nlc28gZXMgX19lc3RhY2lvbmFyaW9fXyBzaSBxdWVkYW4gZnVlcmEgZGVsIGPDrXJjdWxvIGRlIHJhZGlvIHVuaWRhZCB0b2RhcyBsYXMgcmHDrWNlcyBkZWwgcG9saW5vbWlvCiQkXFBoaV9QKHopID0gMSAtIFxwaGlfbSB6Xm0gLSBccGhpX3sybX0gel57Mm19IC0gXGxkb3RzIC0gXHBoaV97UG19IHpee1BtfS4kJAoKRWwgcHJvY2VzbyBlcyBfX2ludmVydGlibGVfXyBzaSBxdWVkYW4gZnVlcmEgZGVsIGPDrXJjdWxvIGRlIHJhZGlvIHVuaWRhZCB0b2RhcyBsYXMgcmHDrWNlcyBkZWwgcG9saW5vbWlvCiQkXFRoZXRhX1EoeikgPSAxICsgXHRoZXRhX20gel5tICsgXHRoZXRhX3sybX0gel57Mm19ICsgXGxkb3RzICsgXHRoZXRhX3tRbX0gel57UW19LiQkCgoKX19Tb2JyZSB0b2RvX18sCgoqIEVuIGxhIEZBQyBsYXMgYXV0b2NvcnJlbGFjaW9uZXMgZGUgX19vcmRlbiBtw7psdGlwbG8gZGUgbV9fIGRlY2FlbiBleHBvbmVuY2lhbG1lbnRlIGEgcGFydGlyIGRlbCBvcmRlbiBQLgoqIEVuIGxhIEZBQ1AgbGFzIGF1dG9jb3JyZWxhY2lvbmVzIHBhcmNpYWxlcyBkZSBfX29yZGVuIG3Dumx0aXBsbyBkZSBtX18gZGVjYWVuIGV4cG9uZW5jaWFsbWVudGUgYSBwYXJ0aXIgZGVsIG9yZGVuIFEuCgojIyMgRWplbXBsb3Mgey19CgoqICR5X3QgXHNpbSBBUk1BXzcoMSwgMSk6XDtcO3lfdCA9IGMgICsgXHBoaV83IHlfe3QtN30gKyBcdGhldGFfNyBcdmFyZXBzaWxvbl97dC03fSArIFx2YXJlcHNpbG9uX3t0fSQgbyAkKDEgLSBccGhpXzcgTF43KXlfdCA9IGMgKyAoMSArIFx0aGV0YV83IExeNylcdmFyZXBzaWxvbl90JC4KKiAkeV90IFxzaW0gQVJNQV97MTJ9KDEsIDEpOlw7XDt5X3QgPSBjICArIFxwaGlfezEyfSB5X3t0LTEyfSArIFx0aGV0YV97MTJ9IFx2YXJlcHNpbG9uX3t0LTEyfSArIFx2YXJlcHNpbG9uX3t0fSQgbyAkKDEgLSBccGhpX3sxMn0gTF57MTJ9KXlfdCA9IGMgKyAoMSArIFx0aGV0YV97MTJ9IExeezEyfSlcdmFyZXBzaWxvbl90JC4KCiMjIyBTaW11bGFjacOzbiBkZSB1biBwcm9jZXNvICRBUk1BX20oUCxRKSQgey19CgpMYSBmaWd1cmEgNSBtdWVzdHJhIHVuYSBzaW11bGFjacOzbiBkZSB0YW1hw7FvIDUwMCBwYXJhIGVsIHByb2Nlc28gJEFSTUFfNygxLDEpJCAkeV90ID0gMC43eV97dC03fSAtIDAuNVx2YXJlcHNpbG9uX3t0LTd9ICsgXHZhcmVwc2lsb25fdCQuCgpgYGB7ciwgZWNobyA9IEZBTFNFfQpzZXQuc2VlZCgzMTQxNjU5MikKeWFybWE3XzFfMSA8LSBhcmltYS5zaW0obiA9IDUwMCwgbW9kZWwgPSBsaXN0KG9yZGVyID0gYyg3LDAsNyksIGFyID0gYygwLDAsMCwwLDAsMCwwLjcpLCBtYSA9IGMoMCwwLDAsMCwwLDAsLTAuNSkpLCBpbm5vdiA9IHJub3JtKDUwMCkpCmdndHNkaXNwbGF5KHlhcm1hN18xXzEsIG1haW4gPSAiRmlndXJhIDUuIEFSTUE3KDEsMSkgLSBuID0gNTAwIiwgbGFnID0gMzUpCmBgYAoKXAoKIyMgUHJvY2Vzb3MgJEFSSU1BX20oUCxELFEpJAoKX19TaSBsYSBzZXJpZSAkeV90JCBubyBlcyBlc3RhY2lvbmFyaWEgZW4gc3UgcGFydGUgZXN0YWNpb25hbCwgcGVybyB0cmFzIGRpZmVyZW5jaWFybGEgJEQkIHZlY2VzIHNlIGhhY2UgZXN0YWNpb25hcmlhLCBkaXJlbW9zIHF1ZSBsYSBzZXJpZSBlcyBpbnRlZ3JhZGEgZXN0YWNpb25hbG1lbnRlIGRlIG9yZGVuICREJF9fOiAkeV90IFxzaW0gSV9tKEQpJC4gUG9yIHRhbnRvLAoKKiB1bmEgc2VyaWUgZXN0YWNpb25hcmlhIGVzdGFjaW9uYWxtZW50ZSBzZSBpbmRpY2Fyw6EgY29tbyAkeV90IFxzaW0gSV9tKDApJC4KKiAkeV90IFxzaW0gSV9tKDEpJCBlcyBlcXVpdmFsZW50ZSBhICRcbmFibGFfbSB5X3QgPSAoMSAtIExebSl5X3QgXHNpbSBJX20oMCkkIAoKVW5hIHNlcmllICR5X3QkIHNpZ3VlIHVuIHByb2Nlc28gX18kQVJJTUFfbShQLEQsUSkkX18gc2k6CgoxLiAkeV90IFxzaW0gSV9tKEQpJCAoaGF5IHF1ZSBkaWZlcmVuY2lhcmxhIGVzdGFjaW9uYWxtZW50ZSAkRCQgdmVjZXMgcGFyYSBoYWNlcmxhIGVzdGFjaW9uYXJpYSksIHkKMi4gJFxuYWJsYV9tXkQgeV90IFxzaW0gQVJNQV9tKFAsUSkkLgoKRW50b25jZXMsIHBvZGVtb3MgZXNjcmliaXIgJHlfdCBcc2ltIEFSSU1BX20oUCxELFEpJCBjb21vClxiZWdpbntlcXVhdGlvbip9ClxiZWdpbnthcnJheX17Y0B7XHF1YWR9Y2NjfQogICgxIC0gXHBoaV9tIExebSAtIFxsZG90cyAtIFxwaGlfe1BtfSBMXntQbX0pICYgKDEtIExebSleRCB5X3QgJiA9ICYgYyArICgxICsgXHRoZXRhX20gTF5tICsgXGxkb3RzICsgXHRoZXRhX3tRbX0gTF57UW19KSBcdmFyZXBzaWxvbl90IFxcIAogIFx1cGFycm93ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICYgXHVwYXJyb3cgICAgICAgJiAgICYgXHVwYXJyb3cgXFwKICAgQVJfbShQKSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAmIElfbShEKSAgICAgICAgICYgICAmIE1BX20oUSkgClxlbmR7YXJyYXl9ClxlbmR7ZXF1YXRpb24qfQoKCiMjIyBFamVtcGxvIHstfSAKCiR5X3QgXHNpbSBBUklNQV97MTJ9KDEsIDEsIDEpOlw7XDsoMSAtIFxwaGlfezEyfSBMXnsxMn0pKDEtIExeezEyfSkgeV90ID0gYyArICgxICsgXHRoZXRhX3sxMn0gTF57MTJ9KSBcdmFyZXBzaWxvbl90JCBvIAoKJHlfdCA9IGMgKyB5X3t0LTEyfSArIFxwaGlfezEyfSh5X3t0LTEyfSAtIHlfe3QtMjR9KSArIFx0aGV0YV97MTJ9IFx2YXJlcHNpbG9uX3t0LTEyfSArIFx2YXJlcHNpbG9uX3QkLgoKXAoKIyMgUHJvY2VzbyAkQVJJTUFfbShwLGQscSkoUCxELFEpJAogIApMYSByZWFsaWRhZCBub3MgbXVlc3RyYSBxdWUgbGEgbWF5b3LDrWEgZGUgbGFzIHNlcmllcyBjb24gZXN0YWNpb25hbGlkYWQgc2UgYWp1c3RhbiBhIHVuYSBjb21iaW5hY2nDs24gZGUgX3Byb2Nlc29zIHJlZ3VsYXJlcyB5IGVzdGFjaW9uYWxlc18uCgpFbCBwcm9jZXNvICRBUklNQV9tKHAsIGQsIHEpKFAsIEQsIFEpJCBwdWVkZSBzZXIgZXhwcmVzYWRvIGRlIGZvcm1hIGFicmV2aWFkYSBjb21vCiQkXFBoaV9wKEwpXFBoaV9QKExebSlcbmFibGFeZFxuYWJsYV9tXkQgIHlfdCA9IGMgKyBcVGhldGFfcShMKVxUaGV0YV9RKExebSlcdmFyZXBzaWxvbl90LCQkICAKXG5vaW5kZW50IG8gbWVub3Mgc3VjaW50YW1lbnRlIGNvbW8KXGJlZ2lue2VxdWF0aW9uKn0KXGJlZ2lue2FycmF5fXtjY2NjY30KICBBUihwKSAmIEFSX20oUCkgJiBJKGQpICYgSV9tKEQpICYgIFxcCiAgXGRvd25hcnJvdyAmIFxkb3duYXJyb3cgJiBcZG93bmFycm93ICYgXGRvd25hcnJvdyAgJiAgXFwKICAoMSAtIFxwaGlfMSBMIC0gXGxkb3RzIC0gXHBoaV9wIExecCkgJiAoMSAtIFxwaGlfbSBMXm0gLSBcbGRvdHMgLSBccGhpX3tQbX0gTF57UG19KSAmICgxIC0gTCleZCAmICgxLSBMXm0pXkR5X3QgJiA9IFxcCiAgYyArICgxICsgXHRoZXRhXzEgTCArIFxsZG90cyArIFx0aGV0YV9xIExecSkgJiAoMSArIFx0aGV0YV9tIExebSArIFxsZG90cyArIFx0aGV0YV97UW19IExee1FtfSkgXHZhcmVwc2lsb25fdCAmICYgJiBcXAogIFx1cGFycm93ICYgXHVwYXJyb3cgJiAmICYgXFwKICBNQShxKSAmIE1BX20oUSkgICYgJiAmIApcZW5ke2FycmF5fQpcZW5ke2VxdWF0aW9uKn0KCiQkICgxIC0gXHBoaV8xIEwgLSAuLi4gLSBccGhpX3AgTF5wKSgxIC0gXHBoaV9tIExebSAtIC4uLiAtIFxwaGlfe1BtfSBMXntQbX0pKDEtIExebSleRCgxIC0gTCleZCB5X3QgPSAkJAokJGMgKyAoMSArIFx0aGV0YV8xIEwgKyAuLi4gKyBcdGhldGFfcSBMXnEpKDEgKyBcdGhldGFfbSBMXm0gKyAuLi4gKyBcdGhldGFfe1FtfSBMXntRbX0pIFx2YXJlcHNpbG9uX3QkJAogIApQb3IgZWplbXBsbywgZW50cmUgbGFzIHNlcmllcyBtZW5zdWFsZXMgdW5vIGRlIGxvcyBwcm9jZXNvcyBtw6FzIGNvbXVuZXMgZXMgJEFSSU1BX3sxMn0oMCwgMSwgMSkoMCwgMSwgMSkkLCBkZW5vbWluYWRvICptb2RlbG8gZGUgbGFzIGFlcm9sw61uZWFzKiBwb3Igc2VyIGVsIFBHRCBkZSBtdWNoYXMgc2VyaWVzIG1lbnN1YWxlcyBkZSB0cmFuc3BvcnRlIGRlIHBhc2FqZXJvcywgZW4gY29uY3JldG8gbGEgc2VyaWUgbWVuc3VhbCBkZSBwYXNhamVyb3MgZGUgYXZpw7NuLiBMYSBlY3VhY2nDs24gZGUgZXN0ZSBtb2RlbG8gZXMKCiQkKDEtTCkoMS1MXnsxMn0peV90ID0gKDErIFx0aGV0YV8xTCkoMSArIFx0aGV0YV97MTJ9TF57MTJ9KVx2YXJlcHNpbG9uX3QkJApxdWUgc2kgZGVzYXJyb2xsYW1vcyBxdWVkYQokJHlfdCA9IHlfe3QtMX0gKyAoeV97dC0xMn0gLSB5X3t0LTEzfSkgKyBcdGhldGFfMSBcdmFyZXBzaWxvbl97dC0xfSArIFx0aGV0YV97MTJ9IFx2YXJlcHNpbG9uX3t0LTEyfSArIFx0aGV0YV97MTN9IFx2YXJlcHNpbG9uX3t0LTEzfSArIFx2YXJlcHNpbG9uX3QgJCQKCiogRWwgbsO6bWVybyBkZSBwYXNhamVyb3MgZGVsIG1lcyAkdCQgZXMgZWwgbWlzbW8gcXVlIGVsIGRlbCBtZXMgcHJldmlvICR0LTEkLCBtw6FzIGxhIGRpZmVyZW5jaWEgZW50cmUgZXN0b3MgbWVzZXMgb2JzZXJ2YWRhIGVsIGHDsW8gcGFzYWRvLiAKKiBTaSBlbiBsb3MgbWVzZXMgdXNhZG9zIHBhcmEgbGEgcHJlZGljY2nDs24gKCR0LTEkLCAkdC0xMiQgeSAkdC0xMiQpIGhhIG9jdXJyaWRvIGFsZ28gZXh0cmFvcmRpbmFyaW8sIGhheSBxdWUgdGVuZXJsbyBlbiBjdWVudGEgYSBsYSBob3JhIGRlIGFmaW5hciBsYSBwcmVkaWNjacOzbi4KCgojIyMgU2ltdWxhY2lvbmVzIGRlIHVuIHByb2Nlc28gJEFSSU1BX20ocCxkLHEpKFAsRCxRKSQgey19CgpMYSBmaWd1cmEgNiBtdWVzdHJhIHVuYSBzaW11bGFjacOzbiBkZSB0YW1hw7FvIDEwMDAgcGFyYSBlbCBtb2RlbG8gZGUgbGFzIGFlcm9sw61uZWFzLCBkb25kZSBzZSBoYSBzdXB1ZXN0byBxdWUgJFx0aGV0YV8xPTAuNyQgeSAkXHRoZXRhX3sxMn09LTAuNSQuCgpgYGB7ciwgZWNobz1GQUxTRX0Kc2V0LnNlZWQoMTEyMjMzNDQpCmVycm9yIDwtIHJub3JtKDIwMDApCnkgPC0gcmVwKDAsIDIwMDApIAp0MSA8LSAwLjcKdDIgPC0gLTAuNQoKZm9yIChpIGluIDE0OjIwMDApIHlbaV0gPC0geVtpLTFdICsgeVtpLTEyXSAtIHlbaS0xM10gKyB0MSplcnJvcltpLTFdICsgdDIqZXJyb3JbaS0xMl0gKyB0MSp0MiplcnJvcltpLTEzXSArIGVycm9yW2ldCnkgPC0gdHMoeSwgc3RhcnQgPSBjKDEsMSksIGZyZXEgPSAxMikKeSA8LSB5WzEwMDE6MjAwMF0KCmdndHNkaXNwbGF5KGRpZmYoZGlmZih5KSwgbGFnID0gMTIpLCBtYWluID0gIkZpZ3VyYSA2LiBBUklNQTEyKDAsMSwxKSgwLDEsMSkgLSBuID0gMTAwMCIsIGxhZyA9IDQ4KQpgYGAKClwKXAoKIyBFamVtcGxvcwoKXAoKIyMgTmFjaW1pZW50b3MKICAKVmFtb3MgYSBhcGxpY2FyIGxhIG1ldG9kb2xvZ8OtYSBkZSBCb3gtSmVua2lucyBhIGxhIHNlcmllIGRlIF9fbmFjaW1pZW50b3MgZW4gRXNwYcOxYV9fIGRlc2RlIGVsIGHDsW8gMjAwMCAodsOpYXNlIGZpZ3VyYSA3KS4KCmBgYHtyfQpuYWNpbWllbnRvcyA8LSByZWFkLmNzdjIoIi4vc2VyaWVzL25hY2ltaWVudG9zLmNzdiIsIGhlYWRlciA9IFRSVUUpCm5hY2ltaWVudG9zIDwtIHRzKG5hY2ltaWVudG9zWywgMl0sCiAgICAgICAgICAgICAgICAgIHN0YXJ0ID0gYygxOTc1LCAxKSwKICAgICAgICAgICAgICAgICAgZnJlcSA9IDEyKQpuYWNpbWllbnRvcyA8LSB3aW5kb3cobmFjaW1pZW50b3MsIHN0YXJ0ID0gMjAwMCkKCmF1dG9wbG90KG5hY2ltaWVudG9zLAogICAgICAgICB4bGFiID0gIiIsCiAgICAgICAgIHlsYWIgPSAiTmFjaW1pZW50b3MiLAogICAgICAgICBtYWluID0gIkZpZ3VyYSA3LiBOYWNpbWllbnRvcyBlbiBFc3Bhw7FhIikKYGBgCgoKIyMjIFRyYW5zZm9ybWFjacOzbiBkZSBsYSBzZXJpZSB7LX0KCllhIHZpbW9zIGVuIGVsIFRlbWEgMyBxdWUgcGFyYSBxdWUgbGEgc2VyaWUgc2VhIGVzdGFjaW9uYXJpYSB5IGVyZ8OzZGljYSBoYWLDrWEgcXVlIGRpZmVyZW5jaWFybGEgdGFudG8gcmVndWxhciBjb21vCmVzdGFjaW9uYWxtZW50ZSAoZCA9IEQgPSAxKS4gQWRlbcOhcywgdHJhYmFqYXJlbW9zIGNvbiBlbCBsb2dhcml0bW8gZGUgbGEgc2VyaWUgcGFyYSByZWR1Y2lyIGxhIHBvc2libGUgaGV0ZXJvY2VkYXN0aWNpZGFkIHkgZ2FuYXIgZW4gaW50ZXJwcmV0YWJpbGlkYWQuIEVzIGRlY2lyLCB0cmFiYWphcmVtb3MgY29uIGxhIHNpZ3VpZW50ZSBzZXJpZSB0cmFuc2Zvcm1hZGEgCiQkXG5hYmxhXG5hYmxhX3sxMn1cbG9nKG5hY2ltaWVudG9zX3QpIFxzaW0gSSgwKUlfezEyfSgwKS4kJAoKCiMjIyBJZGVudGlmaWNhY2nDs24gey19CgpUcmFzIHRyYW5zZm9ybWFyIGxhIHNlcmllLCB2YW1vcyBhIGlkZW50aWZpY2FyIGxvcyB2YWxvcmVzIGRlICRwJCwgJHEkLCAkUCQgeSAkUSQgYSBwYXJ0aXIgZGUgbGEgRkFDIHkgbGEgRkFDUC4KICAKYGBge3J9IApnZ3RzZGlzcGxheShkaWZmKGRpZmYobG9nKG5hY2ltaWVudG9zKSwgbGFnID0gMTIpKSwgbGFnID0gNDgsCiAgICAgICAgICAgIG1haW4gPSAiRmlndXJhIDguIEZBQyB5IEZBQ1AgcGFyYSBOYWNpbWllbnRvcyIpCmBgYAoKQW5hbGl6YW5kbyBsYSBGQUMgeSBsYSBGQUNQIHBvZGVtb3MgcGVuc2FyIHF1ZToKCiogRkFDOiBkZWNyZWNpbWllbnRvIGVuIGxhIHBhcnRlIHJlZ3VsYXIgeSBlc3RhY2lvbmFsCiogRkFDUDogZG9zIGF1dG9jb3JyZWxhY2lvbmVzIGZ1ZXJhIGRlbCBJQyg5NSUpIGVuIGxhIHBhcnRlIHJlZ3VsYXIgKCRyXzEkIHkgJHJfMiQpIHkgb3RyYXMgZG9zIGVuIGxhIHBhcnRlIGVzdGFjaW9uYWwgKCRyX3sxMn0kIHkgJHJfezI0fSQpLiAKClBlcm8gc29icmUgdG9kbywgb2JzZXJ2YW1vcyBxdWUgbm8gZXMgZsOhY2lsIGxhIGlkZW50aWZpY2FjacOzbi4KClwKCsK/UXXDqSBub3MgaW5kaWNhIGBhdXRvLmFyaW1hYD8gUHJpbWVybyB2YW1vcyBhIGdlbmVyYXIgZSBpbmNsdWlyIGVuIGVsIHByb2Nlc28gZGUgYXV0by1pZGVudGlmaWNhY2nDs24gbGFzIHZhcmlhYmxlcyBhc29jaWFkYXMgYSBsb3MgZWZlY3RvcyBkZSBpbnRlcnZlbmNpw7NuIHF1ZSBoZW1vcyBkZXRlY3RhZG8gZW4gbG9zIHRlbWFzIHByZXZpb3MuIEVuIGNvbmNyZXRvLCBoZW1vcyB2aXN0byBxdWUgZWwgbsO6bWVybyBkZSBkw61hcyBkZWwgbWVzIGV4cGxpY2EgZWwgbsO6bWVybyBkZSBuYWNpbWllbnRvcy4gRXN0ZSBlZmVjdG8gZXJhIG11eSBjbGFybyBwYXJhIGxvcyBtZXNlcyBkZSBmZWJyZXJvIGJpc2llc3Rvcy4gUGFyYSBlbCBjYWxjdWxvIGRlIGxhIHZhcmlhYmxlIHF1ZSByZWNvZ2UgZWwgbsO6bWVybyBkZSBkw61hcyBkZWwgbWVzIHVzYXJlbW9zIGxhIGZ1bmNpw7NuIGBtb250aGRheXNgIGRlIGxhIGxpYnJlcsOtYSBgZm9yZWNhc3RgIHF1ZSBkZXZ1ZWx2ZSBlbCBuw7ptZXJvIGRlIGTDrWFzIGRlIGNhZGEgbWVzIG8gdHJpbWVzdHJlIGRlIHVuYSBzZXJpZS4KYGBge3IsIGV2YWwgPSBGQUxTRX0KbW9udGhkYXlzKG5hY2ltaWVudG9zKQpgYGAKCmBgYHtyLCBlY2hvID0gRkFMU0V9CnRhaWwobW9udGhkYXlzKG5hY2ltaWVudG9zKSwgbiA9IDYwKQpgYGAKClBvciBvdHJvIGxhZG8sIGxvcyBwZXJpb2RvcyB2YWNhY2lvbmFsZXMgcHVlZGVuIGFmZWN0YXIgbGEgcHJvZ3JhbWFjacOzbiBkZSBsYXMgY2Vzw6FyZWFzIGUgaW5mbHVpciBlbiBlbCBuw7ptZXJvIGRlIG5hY2ltaWVudG9zLiBDb21vIGxhIFNlbWFuYSBTYW50YSBlcyB1biBwZXJpb2RvIGZlc3Rpdm8gcXVlIHB1ZWRlIGNhZXIgZW4gbWFyem8geSBhYnJpbCwgZGVwZW5kaWVuZG8gZGVsIGHDsW8sIGxvcyBuYWNpbWllbnRvcyBlbiBlc3RvcyBkb3MgbWVzZXMgcHVlZGVuIHZhcmlhciBzaSByZWNhZSBlbiBlbGxvcyBsYSBTZW1hbmEgU2FudGEuIFBhcmEgY2FwdHVyYXIgZXN0ZSBlZmVjdG8sIHVzYXJlbW9zIGxhIGZ1bmNpw7NuIGBlYXN0ZXJgIGRlIGxhIGxpYnJlcsOtYSBgZm9yZWNhc3RgIHF1ZSBkZXZ1ZWx2ZSBwYXJhIGNhZGEgbWVzIGxhIHByb3BvcmNpw7NuIGRlIGTDrWFzIGRlIGxhIFNlbWFuYSBzYW50YSBxdWUgY29udGllbmUgKGNvbnNpZGVyYW5kbyBzb2xvIGRlbCBWaWVybmVzIFNhbnRvIGFsIERvbWluZ28gZGUgUmVzdXJyZWNjacOzbiwgdHJlcyBkw61hcykuCmBgYHtyLCBldmFsID0gRkFMU0V9CmVhc3RlcihuYWNpbWllbnRvcykKYGBgCgpgYGB7ciwgZWNobyA9IEZBTFNFfQp0YWlsKGVhc3RlcihuYWNpbWllbnRvcyksIG4gPSA2MCkKYGBgCgpBZGVtw6FzLCBlbiBlbmVybyBkZSAyMDExIGVsIG7Dum1lcm8gZGUgbmFjaW1pZW50b3MgZXJhIGF0w61waWNvLgoKYGBge3J9IApEaWFzTWVzIDwtIG1vbnRoZGF5cyhuYWNpbWllbnRvcykKU2VtYW5hU2FudGEgPC0gZWFzdGVyKG5hY2ltaWVudG9zKQpkMDExMSA8LSAxKihjeWNsZShuYWNpbWllbnRvcykgPT0gMSAmIHRydW5jKHRpbWUobmFjaW1pZW50b3MpKSA9PSAyMDExKQoKYXV0by5hcmltYShuYWNpbWllbnRvcywgCiAgICAgICAgICAgZCA9IDEsIAogICAgICAgICAgIEQgPSAxLCAKICAgICAgICAgICBsYW1iZGEgPSAwLAogICAgICAgICAgIHhyZWcgPSBjYmluZChEaWFzTWVzLCBTZW1hbmFTYW50YSwgZDAxMTEpKQpgYGAgICAKCkluZGljYSAkQVJJTUFfezEyfSgwLDEsMSkoMCwxLDIpJCwgYXVucXVlIG5vIGVzdMOhIGNsYXJvIHNpIGNvZWZpY2llbnRlIGBzbWEyYCBlcyBzaWduaWZpY2F0aXZvIChzdSB2YWxvciBhIHBlbmFzIHN1cGVyYSBsb3MgZG9zIGVycm9yZXMgZXN0w6FuZGFyKS4KClwKClVuYSBhbHRlcm5hdGl2YSBhIGBhdXRvLmFyaW1hYCBlcyBsYSBmdW5jacOzbiBgc2Vhc2AgZGUgbGEgbGlicmVyw61hIGBzZWFzb25hbGAuIExhIGZ1bmNpw7NuIGBzZWFzYCB0aWVuZSBjb21vIHZlbnRhamFzIHF1ZSB0YW1iacOpbiBhbmFsaXphIGxhIGNvbnZlbmllbmNpYSBkZSB1c2FyIGxhIHRyYW5zZm9ybWFjacOzbiBsb2dhcsOtdG1pY2EsIHF1ZSBpZGVudGlmaWNhIHBvc2libGVzIGVmZWN0b3MgY2FsZW5kYXJpbyB5IHZhbG9yZXMgZXh0cmVtb3MsIHkgcXVlIHN1ZWxlIHNlciBtw6FzIHBhcnNpbW9uaW9zYSBxdWUgYGF1dG8uYXJpbWFgLiBTdSBkZXN2ZW50YWphIGVzIHF1ZSBzw7NsbyBzZSBwdWVkZSBhcGxpY2FyIHBhcmEgc2VyaWVzIG1lbnN1YWxlcyBvIHRyaW1lc3RyYWxlcy4gVmVhbW9zIHF1ZSBpZGVudGlmaWNhY2nDs24gb2ZyZWNlIGBzZWFzYDoKYGBge3J9IApzdW1tYXJ5KHNlYXMobmFjaW1pZW50b3MpKQpgYGAgCgpFbiBwcmltZXIgbHVnYXIsIGxhIGZ1bmNpw7NuIGlkZW50aWZpY2EgZWwgbW9kZWxvIGRlIGxhcyBhZXJvbMOtbmVhcyBwYXJhIGxhIHRyYW5zZm9ybWFjacOzbiBsb2dhcsOtdG1pY2EgZGUgTmFjaW1pZW50b3MuIEVzdGUgcmVzdWx0YWRvIGVzdMOhIGVuIGNvbnNvbmFuY2lhIGNvbiBlbCBhbGNhbnphZG8gY29uIGxhIGZ1bmNpw7NuIGBhdXRvLmFyaW1hYC4gQWRlbcOhcywgaWRlbnRpZmljYSB1biB2YWxvciBleHRyZW1vIGVuIGRpY2llbWJyZSBkZSAyMDEwLCB1biBlZmVjdG8gY2FsZW5kYXJpbyBTZW1hbmEgU2FudGEgeSB1biBlZmVjdG8gY2FsZW5kYXJpbyBkw61hcyBsYWJvcmFibGVzIGRlbCBtZXMgKHF1ZSBwb2RlbW9zIGVudGVuZGVyIHNpbWlsYXIgYSBudWVzdHJvIGVmZWN0byBkw61hcyBkZWwgbWVzKS4KClRyYXMgZXN0b3MgYW7DoWxpc2lzIGFsdGVybmF0aXZvcywgY29uY2x1aW1vcyBxdWUgbGEgaWRlbnRpZmljYWNpw7NuIGRlIHBhcnRpZGEgZXMgJEFSSU1BX3sxMn0oMCwxLDEpKDAsMSwyKStBSSQsCiQkKDEgLSBMXnsxMn0pKDEgLSBMKVxsb2cobmFjaW1pZW50b3NfdCkgPSAoMSArIFx0aGV0YV8xIEwpKDEgKyBcdGhldGFfezEyfSBMXnsxMn0gKyBcdGhldGFfezI0fSBMXnsyNH0pXHZhcmVwc2lsb25fdCArIEFJLiQkCmRvbmRlIF9BSV8gcmVjb2dlIHRvZGFzIGxhcyB2YXJpYWJsZXMgZGUgaW50ZXJ2ZW5jacOzbi4KCiMjIyBFc3RpbWFjacOzbiAoeSB2YWxvcmVzIGV4dHJlbW9zKSB7LX0KClZhbW9zIGEgZXN0aW1hciBlbCBtb2RlbG8gaWRlbnRpZmljYWRvLCBpbmNsdWlkYXMgIGxhcyB2YXJpYWJsZXMgZGUgaW50ZXJ2ZW5jacOzbi4KCmBgYHtyfQpkMTIxMCA8LSAxKihjeWNsZShuYWNpbWllbnRvcykgPT0gMTIgJiB0cnVuYyh0aW1lKG5hY2ltaWVudG9zKSkgPT0gMjAxMCkKbmFjLmFyMSA8LSBBcmltYShuYWNpbWllbnRvcywgCiAgICAgICAgICAgICAgICAgb3JkZXIgPSBjKDAsIDEsIDEpLAogICAgICAgICAgICAgICAgIHNlYXNvbmFsID0gYygwLCAxLCAyKSwKICAgICAgICAgICAgICAgICBsYW1iZGEgPSAwLAogICAgICAgICAgICAgICAgIHhyZWcgPSBjYmluZChEaWFzTWVzLCBTZW1hbmFTYW50YSwgZDEyMTAsICBkMDExMSkpCm5hYy5hcjEKYGBgCgpZYSB0ZW5lbW9zIHVuIG1vZGVsbyBkZSBwYXJ0aWRhLCB2ZWFtb3Mgc2kgZXMgbmVjZXNhcmlhIG3DoXMgaW50ZXJ2ZW5jacOzbi4KCmBgYHtyfSAKZXJyb3IgPC0gcmVzaWR1YWxzKG5hYy5hcjEpCnNkZXJyb3IgPC0gc2QoZXJyb3IpCgphdXRvcGxvdChlcnJvciwgc2VyaWVzPSJFcnJvciIsCiAgICAgICAgIGNvbG91ciA9ICJibGFjayIsCiAgICAgICAgIHhsYWIgPSAiIiwKICAgICAgICAgeWxhYiA9ICJFcnJvciIsCiAgICAgICAgIG1haW4gPSAiRmlndXJhIDkuIEVycm9yICsgSW50ZXJ2ZW5jacOzbiIpICsKICBnZW9tX2hsaW5lKHlpbnRlcmNlcHQgPSBjKC0zLCAtMiwyLCAzKSpzZGVycm9yLCAKICAgICAgICAgICAgIGNvbG91ciA9IGMoInJlZCIsICJncmVlbiIsICJncmVlbiIsICJyZWQiKSwgCiAgICAgICAgICAgICBsdHkgPSAyKSArIAogIHNjYWxlX3hfY29udGludW91cyhicmVha3M9IHNlcSgyMDAwLCAyMDE4LCAyKSkgCmBgYAoKU2Ugb2JzZXJ2YSBxdWUgaGF5IHRyZXMgY2FuZGlkYXRvcyBhIHZhbG9yZXMgYXTDrXBpY29zIGVuIGRpY2llbWJyZSAyMDA2LCBhYnJpbCBkZSAyMDE2IHkganVuaW8gZGUgMjAxNiwgZGFkbyBxdWUgbG9zIGVycm9yZXMgYXNvY2lhZG9zIHNlIGFjZXJjYW4gbyBzdXBlcmFuIGxhcyAzIGRlc3ZpYWNpb25lcyB0w61waWNhcy4gUG9yIHRhbnRvLAoKKiBTZSBjcmVhIHVuYSB2YXJpYWJsZSBkZSBpbnRlcnZlbmNpw7NuIHBhcmEgY2FkYSBjYXNvCiogU2UgZXN0aW1hIGRlIG51ZXZvIGVsIG1vZGVsbyBpbmNsdXllbmRvIGVzdGFzIHZhcmlhYmxlcwoqIFNlIHZ1ZWx2ZSBhIGFuYWxpemFyIHNpIHF1ZWRhbiB2YWxvcmVzIGF0w61waWNvcwoKYGBge3J9CmQxMjA2IDwtIDEqKGN5Y2xlKG5hY2ltaWVudG9zKSA9PSAxMiAmIHRydW5jKHRpbWUobmFjaW1pZW50b3MpKSA9PSAyMDA2KQpkMDQxNiA8LSAxKihjeWNsZShuYWNpbWllbnRvcykgPT0gNCAmIHRydW5jKHRpbWUobmFjaW1pZW50b3MpKSA9PSAyMDE2KQpkMDYxNiA8LSAxKihjeWNsZShuYWNpbWllbnRvcykgPT0gNiAmIHRydW5jKHRpbWUobmFjaW1pZW50b3MpKSA9PSAyMDE2KQoKCm5hYy5hcjIgPC0gQXJpbWEobmFjaW1pZW50b3MsIAogICAgICAgICAgICAgICAgIG9yZGVyID0gYygwLDEsMSksCiAgICAgICAgICAgICAgICAgc2Vhc29uYWwgPSBjKDAsIDEsIDIpLCAKICAgICAgICAgICAgICAgICBsYW1iZGEgPSAwLAogICAgICAgICAgICAgICAgIHhyZWcgPSBjYmluZChEaWFzTWVzLCBTZW1hbmFTYW50YSwgZDEyMDYsIGQxMjEwLCBkMDExMSwgZDA0MTYsIGQwNjE2KSkKbmFjLmFyMgogCmVycm9yIDwtIHJlc2lkdWFscyhuYWMuYXIyKQpzZGVycm9yIDwtIHNkKGVycm9yKQoKYXV0b3Bsb3QoZXJyb3IsIHNlcmllcz0iRXJyb3IiLAogICAgICAgICBjb2xvdXIgPSAiYmxhY2siLAogICAgICAgICB4bGFiID0gIiIsCiAgICAgICAgIHlsYWIgPSAiRXJyb3IiLAogICAgICAgICBtYWluID0gIkZpZ3VyYSAxMC4gRXJyb3IgKyBJbnRlcnZlbmNpw7NuIikgKwogIGdlb21faGxpbmUoeWludGVyY2VwdCA9IGMoLTMsIC0yLCAyLCAzKSpzZGVycm9yLCAKICAgICAgICAgICAgIGNvbG91ciA9IGMoInJlZCIsICJncmVlbiIsICJncmVlbiIsICJyZWQiKSwgCiAgICAgICAgICAgICBsdHkgPSAyKSArIAogIHNjYWxlX3hfY29udGludW91cyhicmVha3M9IHNlcSgyMDAwLCAyMDE4LCAyKSkgCmBgYAoKRXMgcG9zaWJsZSBxdWUgYWxndW5vIGRlIGxvcyBlcnJvcmVzIG3DoXMgZWxldmFkb3MgY29ycmVzcG9uZGEgYSB1biBpbnRlcnZlbmNpw7NuLCBwZXJvIGEgZmluIGRlIG5vIGFsYXJnYXIgZXN0ZSBlamVtcGxvIHZhbW9zIGEgYXN1bWlyIHF1ZSB5YSBubyBoYXkgdmFsb3JlcyBleHRyZW1vcy4KClBvciDDumx0aW1vLCB2ZWFtb3Mgc2kgdG9kb3MgbG9zIGNvZWZpY2llbnRlcyBkZWwgbW9kZWxvIHNvbiBzaWduaWZpY2F0aXZvcy4gUGFyYSBlbGxvLCBhcGxpY2Ftb3MgbGEgcHJ1ZWJhIGRlIFdhbGQuCgpgYGB7cn0KYW5jaG8gPC0gbWF4KG5jaGFyKG5hbWVzKGNvZWYobmFjLmFyMikpKSkgKyAyCmZvcihpIGluIDE6bGVuZ3RoKGNvZWYobmFjLmFyMikpKSB7CiAgd3QgPC0gd2FsZC50ZXN0KGIgPSBjb2VmKG5hYy5hcjIpLCAKICAgICAgICAgICAgICAgICAgU2lnbWEgPSB2Y292KG5hYy5hcjIpLCAKICAgICAgICAgICAgICAgICAgVGVybXMgPSBpKQogIGNhdCgiXG5Db2VmaWNpZW50ZTogIiwgZm9ybWF0KG5hbWVzKGNvZWYobmFjLmFyMikpW2ldLCB3aWR0aCA9IGFuY2hvKSwgInZhbG9yIGRlIHA6ICIsCiAgICAgIGZvcm1hdEMod3QkcmVzdWx0JGNoaTJbM10sIGRpZ2l0cyA9IDQsIGZvcm1hdCA9ICJmIikpCn0KYGBgCgpFbCBjb2VmaWNpZW50ZSBlc3RhY2lvbmFsIGVuIG1lZGlhcyBtw7N2aWxlcyBkZSBvcmRlbiBkb3Mgbm8gcmVzdWx0YSBfaW5kaXZpZHVhbG1lbnRlXyBzaWduaWZpY2F0aXZvIGFsIDUlIChhdW5xdWUgc2kgbG8gc2Vyw61hIGFsIDEwJSkuIFZhbW9zIGEgb3B0YXIgcG9yIGVsaW1pbmFybG8uIFRhbXBvY28gZXMgc2lnbmlmaWNhdGl2byBlbCBjb2VmaWNpZW50ZSBkZSBsYSBpbnRlcnZlbmNpw7NuIGRlIGp1bmlvIGRlIDIwMTYsIHNpbiBlbWJhcmdvIHN1IGVmZWN0byAoZmlndXJhIDkpIGVzIHRhbiBwYXRlbnRlIHF1ZSB2YW1vcyBhIGRlamFybG8gZW4gZWwgbW9kZWxvLgoKYGBge3J9Cm5hYy5hcjIgPC0gQXJpbWEobmFjaW1pZW50b3MsIAogICAgICAgICAgICAgICAgIG9yZGVyID0gYygwLDEsMSksCiAgICAgICAgICAgICAgICAgc2Vhc29uYWwgPSBjKDAsIDEsIDEpLAogICAgICAgICAgICAgICAgIGxhbWJkYSA9IDAsCiAgICAgICAgICAgICAgICAgeHJlZyA9IGNiaW5kKERpYXNNZXMsIFNlbWFuYVNhbnRhLCBkMTIwNiwgZDEyMTAsIGQwMTExLCBkMDQxNiwgZDA2MTYpKQpuYWMuYXIyCmBgYAoKCiMjIyBWYWxpZGFjacOzbiB7LX0KCk5vIHNlIHB1ZWRlIGNvbnRyYXN0YXIgc2kgZWwgX19yZXNpZHVvIHRpZW5lIG1lZGlhIGNlcm9fXywgcGVybyBlbCBlcnJvciBtZWRpbyBlcyBgciByb3VuZChhY2N1cmFjeShuYWMuYXIyKVsxXSwwKWAsIG11eSBiYWpvIGVuIGNvbXBhcmFjacOzbiBjb24gZWwgdmFsb3IgbWVkaW8gZGUgbGEgc2VyaWUuCgpBZGVtw6FzLCB0ZW5lbW9zIGxhcyBkaWZlcmVudGVzIG1lZGlkYXMgZGUgYm9uZGFkIGRlbCBhanVzdGUuIEVuIG1lZGlhIG5vcyBlcXVpdm9jYW1vcyBlbiBgciByb3VuZChhY2N1cmFjeShuYWMuYXIyKVsyXSwwKWAgYmViw6lzIChSTVNFKSB5IGVsIGVycm9yIHBvcmNlbnR1YWwgbWVkaW8gZXMgZGVsIGByIHJvdW5kKGFjY3VyYWN5KG5hYy5hcjIpWzVdLDEpYCUuCgpgYGB7cixldmFsPUZBTFNFfQphY2N1cmFjeShuYWMuYXIyKQpgYGAKCmBgYHtyLGVjaG89RkFMU0V9CnJvdW5kKGFjY3VyYWN5KG5hYy5hcjIpLDIpCmBgYAoKXAoKX19JbmNvcnJlbGFjacOzbiwgSG9tb2NlZGFzdGljaWRhZCB5IE5vcm1hbGlkYWRfXwoKVmVhbW9zIGFob3JhIHNpIGVsIHJlc2lkdW8gZXMgcnVpZG8gYmxhbmNvLgoKYGBge3J9CkJveC50ZXN0KGVycm9yLCBsYWcgPSAyLHR5cGUgPSAiTGp1bmctQm94IikKQm94LnRlc3QoZXJyb3IsIGxhZyA9IDI0LHR5cGUgPSAiTGp1bmctQm94IikKQm94LnRlc3QoZXJyb3JeMiwgbGFnID0gMiwgdHlwZSA9ICJManVuZy1Cb3giKQpCb3gudGVzdChlcnJvcl4yLCBsYWcgPSAyNCwgdHlwZSA9ICJManVuZy1Cb3giKQpqYXJxdWUuYmVyYS50ZXN0KGVycm9yKSAKZ2dBY2YoZXJyb3IsIGxhZyA9IDM2LCB5bGltID0gYygtMC4zLCAwLjMpLCAKICAgICAgbWFpbiA9ICJGaWd1cmEgMTEuIEZBQyBkZWwgZXJyb3IgZGVsIG1vZGVsbyIpCmBgYAoKQ2xhcmFtZW50ZSBoYXkgYXV0b2NvcnJlbGFjaW9uZXMgc2lnbmlmaWNhdGl2YXMsIHBlcm8gZW4gcmV0YXJkb3Mgbm8gcmVsZXZhbnRlcyAodsOpYXNlIGZpZ3VyYSAxMSkuIEVsIGVycm9yIG11ZXN0cmEgc2VyIGhvbW9jZWTDoXN0aWNvIHkgc2VndWlyIHVuYSBkaXN0cmlidWNpw7NuIG5vcm1hbC4KCiMjIyBJbnRlcnByZXRhY2nDs24gey19CgpFbCBfbW9kZWxvIHRlw7NyaWNvXyBlcyAkbG9nKG5hY2ltaWVudG9zKSBcc2ltIEFSSU1BX3sxMn0oMCwgMSwgMSkoMCwgMSwgMSkgKyBBSSQsCiQkKDEgLSBMXnsxMn0pKDEgLSBMKVxsb2cobmFjaW1pZW50b3NfdCkgPSAoMSArIFx0aGV0YV8xIEwpKDEgKyBcdGhldGFfezEyfSBMXnsxMn0pXHZhcmVwc2lsb25fdCArIEFJLiQkClNpIHN1c3RpdHVpbW9zICQoMSAtIExeezEyfSlcbG9nKG5hY2ltaWVudG9zX3QpJCBwb3IgJFRWQV97bmFjaW1pZW50b3NfdH0kLCBsYSB0YXNhIGRlIHZhcmlhY2nDs24gYW51YWwgZGUgbG9zIG5hY2ltaWVudG9zLCB5IGRlc2Fycm9sbGFtb3MgcXVlZGEKJCRUVkFfe25hY2ltaWVudG9zX3R9ID0gVFZBX3tuYWNpbWllbnRvc197dC0xfX0gKyBcdGhldGFfMSBcdmFyZXBzaWxvbl97dC0xfSArIFx0aGV0YV97MTJ9IFx2YXJlcHNpbG9uX3t0LTEyfSArIFx0aGV0YV8xXHRoZXRhX3sxMn0gXHZhcmVwc2lsb25fe3QtMTN9ICsgIFx2YXJlcHNpbG9uX3t0fSskJAokJFxnYW1tYV8xIFxjZG90IERpYXNNZXNfdCArIFxnYW1tYV8yIFxjZG90IFNlbWFuYVNhbnRhICtcZ2FtbWFfMyBcY2RvdCBkMTIwNl90ICsgXGdhbW1hXzQgXGNkb3QgZDEyMTBfdCArXGdhbW1hXzUgXGNkb3QgZDAxMTFfdCArIFxnYW1tYV82IFxjZG90IGQwNDE2X3QgKyBcZ2FtbWFfNyBcY2RvdCBkMDYxNl90LiQkCgpGaW5hbG1lbnRlLCBlbCBfbW9kZWxvIGVzdGltYWRvXyBlcywKJCRcd2lkZWhhdHtUVkF9X3tuYWNpbWllbnRvc197dH19ID0gVFZBX3tuYWNpbWllbnRvc197dC0xfX0gIC0gMC40Nlx2YXJlcHNpbG9uX3t0LTF9IC0gMC43NVx2YXJlcHNpbG9uX3t0LTEyfSArIDAuMzVcdmFyZXBzaWxvbl97dC0xM30gKyAkJAokJDAuMDMyIFxjZG90IERpYXNNZXNfdCAtIDAuMDIyIFxjZG90IFNlbWFuYVNhbnRhIC0gMC4wNDcgXGNkb3QgZDEyMDZfdCArIDAuMDYgXGNkb3QgZDEyMTBfdCAtIDAuMDU2IFxjZG90IGQwMTExX3QgLSAwLjA1MSBcY2RvdCBkMDQxNl90ICsgMC4wMjcgXGNkb3QgZDA2MTZfdC4kJAogIAoqIEVuIGNhZGEgbWVzLCBfX2xhIHRhc2EgZGUgdmFyaWFjacOzbiBhbnVhbCBkZSBsb3MgbmFjaW1pZW50b3MgZXMgbGEgbWlzbWEgcXVlIGxhIGRlbCBtZXMgcGFzYWRvX18gKCRcd2lkZWhhdHtUVkF9X3tuYWNpbWllbnRvc190fSA9IFRWQV97bmFjaW1pZW50b3Nfe3QtMX19JCkuIAoKKiBBZGVtw6FzLCBzaSBhbGd1bm9zIGRlIGxvcyBtZXNlcyBuZWNlc2FyaW9zIHBhcmEgcHJlZGVjaXIgZnVlIGFuw7NtYWxvLCBlbCBlcnJvciBoYXkgcXVlIHRlbmVybG8gZW4gY3VlbnRhIHBhcmEgYWZpbmFyIGxhIHByZXZpc2nDs24uCiAgICAKKiBSZXNwZWN0byBkZSBsYSBpbnRlcnZlbmNpw7NuLCBjYWRhIGTDrWEgYWRpY2lvbmFsIGRlIHVuIG1lcyBuYWNlbiB1biAzLjIlIG3DoXMgYmViw6lzLiBFbCBtZXMgZW4gcXVlIGNhZSBsYSBTZW1hbmEgU2FudGEgbG9zIG5hY2ltaWVudG9zIGNhZW4gIHVuIDIuMiUuIFBvciBhbGd1bmEgcmF6w7NuLCBlbiBkaWNpZW1icmUgZGUgMjAwNiBodWJvIHVuIDQuNyUgbWVub3MgZGUgbmFjaW1pZW50b3MgZGUgbG8gZXNwZXJhZG87IGVuIGRpY2llbWJyZSBkZSAyMDEwIGh1Ym8gdW4gNiUgbcOhcyBkZSBuYWNpbWllbnRvcyBkZSBsbyBlc3BlcmFkbzsgZW4gZW5lcm8gZGUgMjAxMSBodWJvIHVuIDUuNiUgbWVub3MgZGUgbmFjaW1pZW50b3MgZGUgbG8gZXNwZXJhZG87IGVuIGFicmlsIGRlIDIwMTYgaHVibyB1biA1LjElIG1lbm9zIGRlIG5hY2ltaWVudG9zIGRlIGxvIGVzcGVyYWRvLjsgeSBlbiBqdW5pbyBkZSAyMDE2IGh1Ym8gdW4gMi43JSBtw6FzIGRlIG5hY2ltaWVudG9zIGRlIGxvIGVzcGVyYWRvLgoKIyMjIFByZWRpY2Npw7NuIGRlIGxhIHNlcmllIHstfQoKVW5hIHZleiBkYWRvIHBvciB2w6FsaWRvIGVsIG1vZGVsbyBwb2RlbW9zIHBhc2FyIGEgcmVhbGl6YXIgcHJlZGljY2lvbmVzLiBIYXkgcXVlIHRlbmVyIGVuIGN1ZW50YSBxdWUgaGF5IHNpZXRlIHZhcmlhYmxlcyBkZSBpbnRlcnZlbmNpw7NuLCBkb3MgZGUgZWxsYXMgc29uIGVmZWN0b3MgY2FsZW5kYXJpbyAoRGlhc01lcyB5IFNlbWFuYVNhbnRhKSwgcGFyYSBsYXMgcXVlIGRlYmVtb3MgaW5kaWNhciBxdcOpIHZhbG9yZXMgdG9tYXLDoW4gZW4gZWwgcGVyaW9kbyBkZSBwcmVkaWNjacOzbi4gVmFtb3MgYSBmaWphciBlbCBob3Jpem9udGUgZGUgcHJlZGljY2nDs24gZW4gY3VhdHJvIGHDsW9zIHkgbW9zdHJhciBsb3MgcmVzdWx0YWRvcyBudW3DqXJpY2EgKHNvbG8gcGFyYSBlbCBwcmltZXIgYcOxbykgeSBncsOhZmljYW1lbnRlIChmaWd1cmEgMTIpLgoKCmBgYHtyLCByZXN1bHRzID0gImhpZGUifQpwZG0gPC0gMSogbW9udGhkYXlzKHRzKHJlcCgwLCA0OCksIHN0YXJ0ID0gMjAxOSwgZnJlcSA9IDEyKSkKcHNzIDwtIDEqIGVhc3Rlcih0cyhyZXAoMCwgNDgpLCBzdGFydCA9IDIwMTksIGZyZXEgPSAxMikpCnBuYWMuYXIyIDwtIGZvcmVjYXN0KG5hYy5hcjIsIAogICAgICAgICAgICAgICAgICAgICBoID0gNDgsCiAgICAgICAgICAgICAgICAgICAgIHhyZWcgPSBjYmluZChwZG0sIHBzcywgcmVwKDAsNDgpLCByZXAoMCw0OCksIHJlcCgwLDQ4KSwgcmVwKDAsNDgpLCByZXAoMCw0OCkpLCAKICAgICAgICAgICAgICAgICAgICAgbGV2ZWwgPSA5NSkKcG5hYy5hcjIKYGBgCgpgYGB7ciwgZWNobyA9IEZBTFNFfQpmb3JlY2FzdChuYWMuYXIyLCAKICAgICAgICAgaCA9IDEyLAogICAgICAgICB4cmVnID0gY2JpbmQocGRtWzEyXSwgcHNzWzEyXSwgcmVwKDAsMTIpLCByZXAoMCwxMiksIHJlcCgwLDEyKSwgcmVwKDAsMTIpLCByZXAoMCwxMikpLCAKICAgICAgICAgbGV2ZWwgPSA5NSkKYGBgCgpgYGB7cn0KYXV0b3Bsb3QocG5hYy5hcjIsIAogICAgIHlsYWIgPSAnTmFjaW1pZW50b3MnLAogICAgIG1haW4gPSAnRmlndXJhIDEyLiBOYWNpbWllbnRvcyAoMjAwMC0yMDE4KSB5IHByZWRpY2Npw7NuICgyMDE5LTIwMjIpJykgKwogIHNjYWxlX3hfY29udGludW91cyhicmVha3M9IHNlcSgyMDAwLCAyMDIyLCA0KSkgCmBgYAoKIyMjIEVycm9yIGRlIHByZWRpY2Npw7NuIGV4dHJhLW11ZXN0cmFsIHNlZ8O6biBob3Jpem9udGUgdGVtcG9yYWwgey19CgpBc3VtaW1vcyBxdWUgc2UgcHJlY2lzYW4gZGlleiBhw7FvcyBwYXJhIGhhY2VyIHVuYSBidWVuYSBlc3RpbWFjacOzbiwgJGsgPSAxMjAkLCB5IGZpamFyZW1vcyBlbCBob3Jpem9udGUgdGVtcG9yYWwgZW4gdW4gYcOxbywgJGggPSAxMiQgbWVzZXMuCgpgYGB7cn0gIAprIDwtIDEyMCAgICAgICAgICAgICAgICAgICAKaCA8LSAxMiAgICAgICAgICAgICAgICAgICAgClQgPC0gbGVuZ3RoKG5hY2ltaWVudG9zKSAgIApzPC1UIC0gayAtIGggICAgICAgICAgICAgICAKCm1hcGVBcmltYSA8LSBtYXRyaXgoTkEsIHMgKyAxLCBoKQoKWCA8LSBjYmluZChEaWFzTWVzLCBTZW1hbmFTYW50YSwgZDEyMDYsIGQxMjEwLCBkMDExMSwgZDA0MTYsIGQwNjE2KQoKZm9yIChpIGluIDA6cykgewogIHRyYWluLnNldCA8LSBzdWJzZXQobmFjaW1pZW50b3MsIHN0YXJ0ID0gaSArIDEsIGVuZCA9IGkgKyBrKQogIHRlc3Quc2V0IDwtICBzdWJzZXQobmFjaW1pZW50b3MsIHN0YXJ0ID0gaSArIGsgKyAxLCBlbmQgPSBpICsgayArIGgpIAogIAogIFgudHJhaW4gPC0gWFsoaSArIDEpOihpICsgayksXQogIGhheSA8LSBjb2xTdW1zKFgudHJhaW4pCiAgWC50cmFpbiA8LSBYLnRyYWluWywgaGF5PjBdCiAgCiAgWC50ZXN0IDwtIFhbKGkgKyBrICsgMSk6KGkgKyBrICsgaCksXQogIFgudGVzdCA8LSBYLnRlc3RbLCBoYXk+MF0KICAKICBmaXQgPC0gQXJpbWEodHJhaW4uc2V0LCAKICAgICAgICAgICAgICAgb3JkZXIgPSBjKDAsIDEsIDEpLAogICAgICAgICAgICAgICBzZWFzb25hbCA9IGMoMCwgMSwgMSksCiAgICAgICAgICAgICAgIGxhbWJkYSA9IDAsCiAgICAgICAgICAgICAgIHhyZWcgPSBYLnRyYWluKQogIAogIGZjYXN0IDwtIGZvcmVjYXN0KGZpdCwgaCA9IGgsIHhyZWcgPSBYLnRlc3QpIAogIAogIG1hcGVBcmltYVtpICsgMSxdIDwtIDEwMCphYnModGVzdC5zZXQgLSBmY2FzdCRtZWFuKS90ZXN0LnNldAp9CiAgCmVycm9yQXJpbWEgPC0gY29sTWVhbnMobWFwZUFyaW1hKQplcnJvckFyaW1hCmBgYAoKYGBge3J9CmdncGxvdCgpICsKICBnZW9tX2xpbmUoYWVzKHggPSAxOjEyLCB5ID0gZXJyb3JBcmltYSksIGNvbG91ciA9ICJCbHVlIikgKwogIGdndGl0bGUoIkZpZ3VyYSAxMy4gRXJyb3IgZGUgcHJlZGljY2nDs24gKE1BUEUpIHNlZ8O6biBob3Jpem9udGUgdGVtcG9yYWwiKSArCiAgeGxhYigiSG9yaXpvbnRlIHRlbXBvcmFsIGRlIHByZWRpY2Npw7NuIikgKwogIHlsYWIoIiUiKSArCiAgc2NhbGVfeF9jb250aW51b3VzKGJyZWFrcz0gMToxMikKYGBgCgpMYSBmaWd1cmEgMTMgcmV2ZWxhIHF1ZSBlbCBlcnJvciBkZSBwcmVkaWNjacOzbiBhdW1lbnRhIGRlIGZvcm1hIHJlZ3VsYXIgc2Vnw7puIGF1bWVudGEgZWwgaG9yaXpvbnRlIGRlIHByZWRpY2Npw7NuLCBwZXJvIGluY2x1c28gYSB1biBhw7FvIHZpc3RhLCBzZSBtYW50aWVuZSBiYWpvLgoKXAoKIyMgQ2hvY29sYXRlCgpWYW1vcyBhIGFwbGljYXIgbGEgbWV0b2RvbG9nw61hIGRlIEJveC1KZW5raW5zIGEgbGEgc2VyaWUgbWVuc3VhbCBkZSBfX3Byb2R1Y2Npw7NuIGRlIGNob2NvbGF0ZSBlbiBBdXN0cmFsaWFfXyBkZXNkZSBlbmVybyBkZSAxOTU4IGhhc3RhIGRpY2llbWJyZSBkZSAxOTk0LCA0NDQgbWVzZXMuCgoKYGBge3J9CmNob2NvbGF0ZSA8LSByZWFkLmNzdjIoIi4vc2VyaWVzL0Nob2NvbGF0ZS5jc3YiLCBoZWFkZXIgPSBUUlVFKQpjaG9jb2xhdGUgPC0gdHMoY2hvY29sYXRlLCBzdGFydCA9IDE5NTgsIGZyZXEgPSAxMikKCmF1dG9wbG90KGNob2NvbGF0ZSwgCiAgICAgICAgIHhsYWIgPSAiIiwgCiAgICAgICAgIHlsYWIgPSAiVG9uZWxhZGFzIiwKICAgICAgICAgbWFpbiA9ICJGaWd1cmEgMTQuIFByb2R1Y2Npw7NuIGRlIENob2NvbGF0ZSAoQXVzdHJhbGlhKSIpCmBgYAoKTGEgcHJvZHVjY2nDs24gZGUgY2hvY29sYXRlIHByZXNlbnRhIHVuYSB0ZW5kZW5jaWEgY3JlY2llbnRlLCBlc3BlY2lhbG1lbnRlIGRlc2RlIGxvcyBhw7FvcyA4MCBkZWwgc2lnbG8gcGFzYWRvLCB1bmEgbWFyY2FkYSBjb21wb25lbnRlIGVzdGFjaW9uYWwgKGRvbmRlIGxhIG3DoXhpbWEgcHJvZHVjY2nDs24gc2UgZGEgZW4gZWwgaW52aWVybm8gYXVzdHJhbCwgbWVzZXMgZGUgbWF5byBhIGFnb3N0bywgeSBsYSBtZW5vciBwcm9kdWNjacOzbiBlbiBlbmVybyksIGNvbWJpbmFkb3MgZW4gdW4gZXNxdWVtYSBtdWx0aXBsaWNhdGl2by4gVHJhYmFqYXJlbW9zIGNvbiBlbCBsb2dhcml0bW8gZGUgbGEgc2VyaWUgcGFyYSBsaW5lYWxpemFyIGxhcyBjb21wb25lbnRlcyB5IHJlZHVjaXIgbGEgcG9zaWJsZSBoZXRlcm9jZWRhc3RpY2lkYWQuCgojIyMgVHJhbnNmb3JtYWNpw7NuIGRlIGxhIHNlcmllIHstfQoKTGEgZmlndXJhIDE1IG11ZXN0cmEgcXVlIHNvbG8gbGEgZG9ibGUgZGlmZXJlbmNpYWNpw7NuIHJlZ3VsYXIgeSBlc3RhY2lvbmFsIGNvbnNpZ3VlIHF1ZSBsYSB0cmFuc2Zvcm1hY2nDs24gbG9nYXLDrXRtaWNhIGRlIENob2NvbGF0ZSBzZWEgZXN0YWNpb25hcmlhIHkgZXJnw7NkaWNhLgoKYGBge3IsIGV2YWwgPSBGQUxTRX0KZ2dBY2YobG9nKGNob2NvbGF0ZSksIGxhZyA9IDQ4LCAKICAgICAgeGxhYiA9ICIiLCB5bGFiID0gImQgPSBEID0gMCIsIG1haW4gPSAiRmlndXJhIDE0LiBGQUMiKQpnZ0FjZihkaWZmKGxvZyhjaG9jb2xhdGUpKSwgbGFnID0gNDgsIAogICAgICB4bGFiID0gIiIsIHlsYWIgPSAiZCA9IDEgLSBEID0gMCIsIG1haW4gPSAiIikKZ2dBY2YoZGlmZihsb2coY2hvY29sYXRlKSwgbGFnID0gMTIpLCBsYWcgPSA0OCwgCiAgICAgIHhsYWIgPSAiIiwgeWxhYiA9ICJkID0gMCAtIEQgPSAxIiwgbWFpbiA9ICIiKQpnZ0FjZihkaWZmKGRpZmYobG9nKGNob2NvbGF0ZSksIGxhZyA9IDEyKSksIGxhZyA9IDQ4LCAKICAgICAgeGxhYiA9ICIiLCB5bGFiID0gImQgPSAxIC0gRCA9IDEiLCBtYWluID0gIiIpCmBgYAoKCmBgYHtyLCBlY2hvID0gRkFMU0V9CmdyaWQuYXJyYW5nZSgKICBnZ0FjZihsb2coY2hvY29sYXRlKSwgbGFnID0gNDgsIHhsYWIgPSAiIiwgeWxhYiA9ICJkID0gRCA9IDAiLCBtYWluID0gIkZpZ3VyYSAxNS4gRkFDIiksCiAgZ2dBY2YoZGlmZihsb2coY2hvY29sYXRlKSksIGxhZyA9IDQ4LCB4bGFiID0gIiIsIHlsYWIgPSAiZCA9IDEgLSBEID0gMCIsIG1haW4gPSAiIiksCiAgZ2dBY2YoZGlmZihsb2coY2hvY29sYXRlKSwgbGFnID0gMTIpLCBsYWcgPSA0OCwgeGxhYiA9ICIiLCB5bGFiID0gImQgPSAwIC0gRCA9IDEiLCBtYWluID0gIiIpLAogIGdnQWNmKGRpZmYoZGlmZihsb2coY2hvY29sYXRlKSwgbGFnID0gMTIpKSwgbGFnID0gNDgsIHhsYWIgPSAiIiwgeWxhYiA9ICJkID0gIEQgPSAxIiwgbWFpbiA9ICIiKSwKICBucm93ID0gMgopCmBgYAoKRXN0b3MgcmVzdWx0YWRvcyBzb24gY29uZmlybWFkb3MgYSB0cmF2w6lzIGRlIGxhcyBmdW5jaW9uZXMgYG5kaWZmc2AgeSBgbnNkaWZmc2AKYGBge3J9Cm5kaWZmcyhsb2coY2hvY29sYXRlKSkKbnNkaWZmcyhsb2coY2hvY29sYXRlKSkKYGBgCgpQb2RlbW9zIGNvbmNsdWlyIHF1ZSAkZCA9IDEkIHkgJEQgPSAxJCBvICRcbG9nKGNob2NvbGF0ZV90KSBcc2ltIEkoMSlJX3sxMn0oMSkkLgoKIyMjIElkZW50aWZpY2FjacOzbiB7LX0KClRyYXMgdHJhbnNmb3JtYXIgbGEgc2VyaWUsIHZhbW9zIGEgaWRlbnRpZmljYXIgbG9zIHZhbG9yZXMgZGUgJHAkLCAkcSQsICRQJCB5ICRRJCBhIHBhcnRpciBkZSBGQUMgeSBGQUNQIGRlIGxhIHNlcmllIGRvYmxlbWVudGUgZGlmZXJlbmNpYWRhLgogIApgYGB7cn0gCmdndHNkaXNwbGF5KGRpZmYoZGlmZihsb2coY2hvY29sYXRlKSwgbGFnID0gMTIpKSwgbGFnID0gNDgsCiAgICAgICAgICAgIG1haW4gPSAiRmlndXJhIDE2LiBGQUMgeSBGQUNQIHBhcmEgQ2hvY29sYXRlIChsb2cpIikKYGBgCgpBbmFsaXphbmRvIGxhIEZBQyB5IEZBQ1AgKGZpZ3VyYSAxNSksIHRlbmVtb3MgcXVlOgoKKiBGQUM6IHVuIHBpY28gZW4gbGEgcGFydGUgcmVndWxhciB5IGRlY3JlY2ltaWVudG8gZW4gbGEgZXN0YWNpb25hbC4KKiBGQUNQOiBkZWNyZWNpbWllbnRvIGVuIGxhIHBhcnRlIHJlZ3VsYXIgeSBlc3RhY2lvbmFsLgoKUGFyZWNlIHNlciB1biBBUklNQSgwLCAxLCAxKSgxLCAxLCAxKS4KClwKCsK/UXXDqSBub3MgaW5kaWNhIGBhdXRvLmFyaW1hYD8gUGFyYSBheXVkYXIgYSBlc3RhIGZ1bmNpw7NuIGxvIG3DoXhpbW8gcG9zaWJsZSB2YW1vcyBhIGRlZmluaXIgdW5hIHZhcmlhYmxlIGRlIGludGVydmVuY2nDs24gcXVlIHB1ZWRlbiBzZXIgcmVsZXZhbnRlOgoKKiBfX0TDrWFzIGxhYm9yYWJsZXNfXzogYWwgdHJhdGFyc2UgZGUgZGF0b3MgZGUgcHJvZHVjY2nDs24sIGVsIG7Dum1lcm8gZGUgZMOtYXMgbGFib3JhYmxlcyBkZSBjYWRhIG1lcyBwdWVkZSBzZXIgdW4gZGV0ZXJtaW5hbnRlIGRlbCB2YWxvciBkZSBsYSBzZXJpZS4gRW50ZW5kZXJlbW9zIHBvciBkw61hcyBsYWJvcmFibGVzIGxvcyBsdW5lcyBhIHZpZXJuZXMgZGUgY2FkYSBtZXMsIG1lbm9zIGxvcyBkw61hcyBmZXN0aXZvcy4gRXN0ZSB2YWxvciBzZSBwdWVkZSBvYnRlbmVyIGNvbiBsYSBmdW5jacOzbiBgYml6ZGF5c2AuIFVuIGluY29udmVuaWVudGUgZGUgZXN0YSBmdW5jacOzbiwgZXMgcXVlIHN1IHZhbG9yIGRlcGVuZGUgZGUgbG9zIGZlc3Rpdm9zIGRlIGNhZGEgcGHDrXMuIFBvciBlamVtcGxvLCBlbiBBdXN0cmFsaWEgZWwgZMOtYSBkZWwgdHJhYmFqYWRvciBzZSBjZWxlYnJhIGVsIHByaW1lciBsdW5lcyBkZSBvY3R1YnJlIHkgZW4gRXNwYcOxYSBlbCAxIGRlIG5vdmllbWJyZS4gUG9yIHByb3hpbWlkYWQgY3VsdHVyYWwsIGhpc3TDs3JpY2EgeSBwb2zDrXRpY2EsIHVzYXJlbW9zIGVsIGNhbGVuZGFyaW8gZGUgTG9uZHJlcyBwYXJhIEF1c3RyYWxpYS4gKGBSYCBwZXJtaXRlIGNyZWFyIHR1IHByb3BpbyBjYWxlbmRhcmlvIGRlIGZlc3Rpdm9zIHkgZXhpc3RlbiBvdHJhcyBsaWJyZXLDrWFzIHF1ZSBleHRpZW5kZW4gbGFzIG9wY2lvbmVzIGRlIGBiaXpkYXlzYC4pCgpgYGB7ciwgZXZhbCA9IEZBTFNFfQpiaXpkYXlzKGNob2NvbGF0ZSwgRmluQ2VudGVyID0gIkxvbmRvbiIpCmBgYAoKYGBge3IsIGVjaG8gPSBGQUxTRX0Kc3Vic2V0KGJpemRheXMoY2hvY29sYXRlLCBGaW5DZW50ZXIgPSAiTG9uZG9uIiksIGVuZCA9IDYwKQpgYGAKClZhbW9zIGEgY3JlYXIgZXN0YSB2YXJpYWJsZSB5IGEgaW5jbHVpcmxhIGVuIGxhIGF1dG8taWRlbnRpZmljYWNpw7NuLgoKYGBge3J9CiMgRWZlY3RvIGHDsW8gZMOtYXMgbGFib3JhYmxlcwpEaWFzTGFib3JhYmxlcyA8LSBiaXpkYXlzKGNob2NvbGF0ZSwgRmluQ2VudGVyID0gIkxvbmRvbiIpCgphdXRvLmFyaW1hKGNob2NvbGF0ZSwgZCA9IDEsIEQgPSAxLCAKICAgICAgICAgICBsYW1iZGEgPSAwLAogICAgICAgICAgIHhyZWcgPSBEaWFzTGFib3JhYmxlcykKYGBgCgpJbmRpY2EgJEFSSU1BX3sxMn0oMSwxLDEpKDAsMSwyKSQsIGRvbmRlIGVsIHBhcsOhbWV0cm8gJFx0aGV0YV97MjR9JCBubyBlc3TDoSBjbGFybyBzaSBlcyBzaWduaWZpY2F0aXZvLiBBZGVtw6FzLCBoYXkgdW4gZWZlY3RvIGTDrWFzIGxhYm9yYWJsZXMgc2lnbmlmaWNhdGl2by4KClwKClBvciDDumx0aW1vLCBsYSBmdW5jacOzbiBgc2Vhc2AgKHRhbWJpw6luIGNvbiB1biBwb2NvIGRlIGF5dWRhKSBpZGVudGlmaWNhIHVuIHByb2Nlc28gc2ltaWxhciAkQVJJTUFfezEyfSgxLDEsMSkoMCwxLDEpJCwgY29uIHVuIGVmZWN0byBTZW1hbmEgU2FudGEsIChkZSBxdWluY2UgZMOtYXMpIHVuIGVmZWN0byBkw61hIGRlIGxhIHNlbWFuYSB5IHVuIGVmZWN0byBhw7FvIGJpc2llc3RvLCBxdWUgZ2xvYmFsbWVudGUgc2UgYXNlbWVqYW4gYWwgZWZlY3RvIGTDrWFzIGxhYm9yYWJsZXMuCgpgYGB7cn0Kc3VtbWFyeShzZWFzKGRpZmYoZGlmZihsb2coY2hvY29sYXRlKSwgbGFnID0gMTIpKSkpCmBgYAoKQXBhcmVudGVtZW50ZSBhbWJhcyBmdW5jaW9uZXMgaWRlbnRpZmljYW4gZWwgbWlzbW8gbW9kZWxvLCBzaSBkZWwgbW9kZWxvIGlkZW50aWZpY2FkbyBjb24gYGF1dG8uYXJpbWFgIGV4Y2x1aW1vcyBlbCBwYXLDoW1ldHJvIG5vIHNpZ25pZmljYXRpdm8uIFRlIGVuIGN1ZW50YSBxdWUgbG9zIGTDrWFzIGxhYm9yYWJsZXMgeWEgZGVzY3VlbnRhbiBlbCBlZmVjdG8gZGUgbGEgU2VtYW5hIFNhbnRhLCBhc8OtIHF1ZSBubyBlcyBuZWNlc2FyaW8gaW5jbHVpciBlbCBlZmVjdG8gU2VtYW5hIFNhbnRhIGRlIGZvcm1hIGluZGVwZW5kaWVudGUuCgoKIyMjIEVzdGltYWNpw7NuICB7LX0KClZhbW9zIGEgcmVhbGl6YXIgbGEgcHJpbWVyYSBlc3RpbWFjacOzbi4KCmBgYHtyfQpjaG9jby5hcjEgPC0gQXJpbWEoY2hvY29sYXRlLCBvcmRlcj1jKDEsIDEsIDEpLAogICAgICAgICAgICAgICAgICAgc2Vhc29uYWwgPSAgYygwLCAxLCAxKSwKICAgICAgICAgICAgICAgICAgIGxhbWJkYSA9IDAsCiAgICAgICAgICAgICAgICAgICB4cmVnID0gRGlhc0xhYm9yYWJsZXMpCmNob2NvLmFyMQpgYGAKCllhIHRlbmVtb3MgdW4gbW9kZWxvIGRlIHBhcnRpZGEsIHZlYW1vcyBzaSBlcyBuZWNlc2FyaWEgbcOhcyBpbnRlcnZlbmNpw7NuLgoKYGBge3J9IAplcnJvciA8LSByZXNpZHVhbHMoY2hvY28uYXIxKQpzZGVycm9yIDwtIHNkKGVycm9yKQoKYXV0b3Bsb3QoZXJyb3IsIHNlcmllcz0iRXJyb3IiLAogICAgICAgICBjb2xvdXIgPSAiYmxhY2siLAogICAgICAgICB4bGFiID0gIiIsCiAgICAgICAgIHlsYWIgPSAiRXJyb3IiLAogICAgICAgICBtYWluID0gIkZpZ3VyYSAxNy4gRXJyb3IgKyBJbnRlcnZlbmNpw7NuIikgKwogIGdlb21faGxpbmUoeWludGVyY2VwdCA9IGMoLTMsIC0yLCAyLCAzKSpzZGVycm9yLCAKICAgICAgICAgICAgIGNvbG91ciA9IGMoInJlZCIsICJncmVlbiIsICJncmVlbiIsICJyZWQiKSwgCiAgICAgICAgICAgICBsdHkgPSAyKSArIAogIHNjYWxlX3hfY29udGludW91cyhicmVha3M9IHNlcSgxOTU4LCAxOTk0LCAyKSkgCmBgYAoKU2Ugb2JzZXJ2YW4gdHJlcyB2YWxvcmVzIGNsYXJhbWVudGUgYXTDrXBpY29zIGVuIGVuZXJvIGRlIDE5ODYsIDE5OTEgeSAxOTk0LiBBZGVtw6FzLCBoYXkgb3RybyBjYW5kaWRhdG9zIGEgdmFsb3IgZXh0cmVtbywgcG9yIHN1cGVyYXIgbGFzIDIuNSBkZXN2aWFjaW9uZXMgdMOtcGljYXMsIGVuIHNlcHRpZW1icmUgZGUgMTk3NS4gUG9yIHRhbnRvLAoKKiBTZSBjcmVhIHVuYSB2YXJpYWJsZSBkZSBpbnRlcnZlbmNpw7NuIHBhcmEgY2FkYSBjYXNvCiogU2UgZXN0aW1hIGRlIG51ZXZvIGVsIG1vZGVsbyBpbmNsdXllbmRvIGVzdGFzIHZhcmlhYmxlcwoqIFNlIHZ1ZWx2ZSBhIGFuYWxpemFyIHNpIHF1ZWRhbiB2YWxvcmVzIGF0w61waWNvcwoKYGBge3J9CmQwOTc1IDwtIDEqKGN5Y2xlKGNob2NvbGF0ZSkgPT0gOSAmIHRydW5jKHRpbWUoY2hvY29sYXRlKSkgPT0gMTk3NSkKZDAxODYgPC0gMSooY3ljbGUoY2hvY29sYXRlKSA9PSAxICYgdHJ1bmModGltZShjaG9jb2xhdGUpKSA9PSAxOTg2KQpkMDE5MSA8LSAxKihjeWNsZShjaG9jb2xhdGUpID09IDEgJiB0cnVuYyh0aW1lKGNob2NvbGF0ZSkpID09IDE5OTEpCmQwMTk0IDwtIDEqKGN5Y2xlKGNob2NvbGF0ZSkgPT0gMSAmIHRydW5jKHRpbWUoY2hvY29sYXRlKSkgPT0gMTk5NCkKCmNob2NvLmFyMiA8LSBBcmltYShjaG9jb2xhdGUsIG9yZGVyPWMoMSwgMSwgMSksCiAgICAgICAgICAgICAgICAgICBzZWFzb25hbCA9IGMoMCwgMSwgMSksCiAgICAgICAgICAgICAgICAgICBsYW1iZGEgPSAwLAogICAgICAgICAgICAgICAgICAgeHJlZyA9IGNiaW5kKERpYXNMYWJvcmFibGVzLCBkMDk3NSwgZDAxODYsIGQwMTkxLCBkMDE5NCkpCmNob2NvLmFyMgpgYGAKCkFob3JhIGRlYmVtb3Mgdm9sdmVyIGEgdmVyaWZpY2FyIHNpIGVuIGVsIG51ZXZvIG1vZGVsbyBoYXkgdmFsb3JlcyBleHRyZW1vcy4gT2JzZXJ2YW1vcyBxdWUgbm8gaGF5LgpgYGB7cn0gCmVycm9yIDwtIHJlc2lkdWFscyhjaG9jby5hcjIpCnNkZXJyb3IgPC0gc2QoZXJyb3IpCgphdXRvcGxvdChlcnJvciwgc2VyaWVzPSJFcnJvciIsCiAgICAgICAgIGNvbG91ciA9ICJibGFjayIsCiAgICAgICAgIHhsYWIgPSAiIiwKICAgICAgICAgeWxhYiA9ICJFcnJvciIsCiAgICAgICAgIG1haW4gPSAiRmlndXJhIDE4LiBFcnJvciArIEludGVydmVuY2nDs24iKSArCiAgZ2VvbV9obGluZSh5aW50ZXJjZXB0ID0gYygtMywgLTIsIDIsIDMpKnNkZXJyb3IsIAogICAgICAgICAgICAgY29sb3VyID0gYygicmVkIiwgImdyZWVuIiwgImdyZWVuIiwgInJlZCIpLCAKICAgICAgICAgICAgIGx0eSA9IDIpICsKICBzY2FsZV94X2NvbnRpbnVvdXMoYnJlYWtzPSBzZXEoMTk1OCwgMTk5NCwgMikpIApgYGAKUG9yIMO6bHRpbW8sIHZlYW1vcyBzaSB0b2RvcyBsb3MgY29lZmljaWVudGVzIGRlbCBtb2RlbG8gc29uIHNpZ25pZmljYXRpdm9zLiBBdW5xdWUgdW5vIGRlIGVsbG9zIChlbmVybyAxOTg2KSBubyBsbyBlcyBhbCA1JSwgc2kgbG8gZXMgYWwgMTAlIGFzw60gcXVlIG9wdGFtb3MgcG9yIGRlamFybG8uCgpgYGB7cn0KYW5jaG8gPC0gbWF4KG5jaGFyKG5hbWVzKGNvZWYoY2hvY28uYXIyKSkpKSArIDIKZm9yKGkgaW4gMTpsZW5ndGgoY29lZihjaG9jby5hcjIpKSkgewogIHd0IDwtIHdhbGQudGVzdChiID0gY29lZihjaG9jby5hcjIpLCAKICAgICAgICAgICAgICAgICAgU2lnbWEgPSB2Y292KGNob2NvLmFyMiksIAogICAgICAgICAgICAgICAgICBUZXJtcyA9IGkpCiAgY2F0KCJcbkNvZWZpY2llbnRlOiAiLCBmb3JtYXQobmFtZXMoY29lZihjaG9jby5hcjIpKVtpXSwgd2lkdGggPSBhbmNobyksICJ2YWxvciBkZSBwOiAiLAogICAgICBmb3JtYXRDKHd0JHJlc3VsdCRjaGkyWzNdLCBkaWdpdHMgPSA0LCBmb3JtYXQgPSAiZiIpKQp9CmBgYAoKCiMjIyBWYWxpZGFjacOzbiB7LX0KCkFuYWxpemFuZG8gbG9zIGNyaXRlcmlvcyBkZSBib25kYWQgZGUgYWp1c3RlIHNlIHRpZW5lIHF1ZTogZWwgZXJyb3IgbWVkaW8gZXMgYHIgcm91bmQoYWNjdXJhY3koY2hvY28uYXIyKVsxXSwyKWAsIHByw6FjdGljYW1lbnRlIGNlcm8sIHBvciBsbyBxdWUgbm8gcGFyZWNlIHF1ZSBoYXlhIHNlc2dvIGVuIGxhcyBwcmVkaWNjaW9uZXM7IGVuIG1lZGlhIG5vcyBlcXVpdm9jYW1vcyBlbiBgciByb3VuZChhY2N1cmFjeShjaG9jby5hcjIpWzJdLDApYCB0b25lbGFkYXMgKFJNU0UpOyB5IGVsIGVycm9yIHBvcmNlbnR1YWwgbWVkaW8gZXMgYHIgcm91bmQoYWNjdXJhY3koY2hvY28uYXIyKVs1XSwxKWAlLCByYXpvbmFibGUuCgpgYGB7cixldmFsPUZBTFNFfQphY2N1cmFjeShjaG9jby5hcjIpCmBgYAoKYGBge3IsZWNobz1GQUxTRX0Kcm91bmQoYWNjdXJhY3koY2hvY28uYXIyKSwyKQpgYGAKClwKCl9fSW5jb3JyZWxhY2nDs24sIEhvbW9jZWRhc3RpY2lkYWQgeSBOb3JtYWxpZGFkX18KClZlYW1vcyBhaG9yYSBzaSBlbCByZXNpZHVvIGVzIHJ1aWRvIGJsYW5jby4KCmBgYHtyfQpCb3gudGVzdChlcnJvciwgbGFnID0gMix0eXBlID0gIkxqdW5nLUJveCIpCkJveC50ZXN0KGVycm9yLCBsYWcgPSAyNCx0eXBlID0gIkxqdW5nLUJveCIpCkJveC50ZXN0KGVycm9yXjIsIGxhZyA9IDIsIHR5cGUgPSAiTGp1bmctQm94IikKQm94LnRlc3QoZXJyb3JeMiwgbGFnID0gMjQsIHR5cGUgPSAiTGp1bmctQm94IikKamFycXVlLmJlcmEudGVzdChlcnJvcikgCmBgYAoKRWwgZXJyb3IgbXVlc3RyYSBzZXIgaW5jb3JyZWxhZG8sIGhvbW9jZWTDoXN0aWNvIHkgc2VndWlyIHVuYSBkaXN0cmlidWNpw7NuIG5vcm1hbC4KCiMjIyBJbnRlcnByZXRhY2nDs24gey19CgpFbCBfbW9kZWxvIHRlw7NyaWNvXyBlcyAkbG9nKGNob2NvbGF0ZSkgXHNpbSBBUklNQV97MTJ9KDEsIDEsIDEpKDAsIDEsIDEpICsgQUkkLAokJCgxIC0gXHBoaV8xIEwpKDEgLSBMXnsxMn0pKDEgLSBMKVxsb2coY2hvY29sYXRlX3QpID0gKDEgKyBcdGhldGFfMSBMKSgxICsgXHRoZXRhX3sxMn0gTF57MTJ9KVx2YXJlcHNpbG9uX3QgKyBBSS4kJApTaSBzdXN0aXR1aW1vcyAkKDEgLSBMXnsxMn0pXGxvZyhjaG9jb2xhdGVfdCkkIHBvciAkVFZBX3tjaG9jb2xhdGVfdH0kLCBkZXNhcnJvbGxhbW9zIGVsIG1vZGVsbyB5IHN1c3RpdHVpbW9zIGxvcyBwYXLDoW1ldHJvcyBwb3Igc3VzIGVzdGltYWNpb25lcywgcXVlZGEKJCRcd2lkZWhhdHtUVkF9X3tjaG9jb2xhdGVfdH0gPSBUVkFfe2Nob2NvbGF0ZV97dC0xfX0gKyAwLjMxKFRWQV97Y2hvY29sYXRlX3t0LTF9fSAtIFRWQV97Y2hvY29sYXRlX3t0LTJ9fSkkJAokJC0gMC44OVx2YXJlcHNpbG9uX3t0LTF9IC0gMC42OFx2YXJlcHNpbG9uX3t0LTEyfSArIDAuNjBcdmFyZXBzaWxvbl97dC0xM30kJAokJCswLjAzNlxjZG90IERpYXNMYWJvcmFibGVzIC0gMC4xNlxjZG90IGQwOTc1ICsgMC4xMyBcY2RvdCBkMDE4Ni0wLjM0IFxjZG90IGQwMTkxICsgMC41MVxjZG90IGQwMTk0LiQkClBvciB0YW50bzoKCiogTGEgdGFzYSBkZSB2YXJpYWNpw7NuIGFudWFsIGVuIGxhIHByb2R1Y2Npw7NuIGRlIGNob2NvbGF0ZSBwYXJhIHVuIG1lcyBlcyBsYSBtaXNtYSBxdWUgbGEgZGVsIG1lcyBwYXNhZG8gbcOhcyB1biAzMSUgZGVsIMO6bHRpbW8gaW5jcmVtZW50byBvYnNlcnZhZG8uCiogU2kgZW4gbG9zIG1lc2VzIHBhc2Fkb3MgZWwgdmFsb3IgZXNwZXJhZG8gZW4gbGEgdGFzYSBkZSB2YXJpYWNpw7NuIHNlIGFsZWrDsyBkZSBsYSByZWFsLCBoYXkgcXVlIHRlbmVybG8gZW4gY3VlbnRhIHBhcmEgY29ycmVnaXIgbGFzIHByZXZpc2lvbmVzLgoqIENhZGEgZMOtYSBsYWJvcmFibGUgYWRpY2lvbmFsIGVuIHVuIG1lcyBzdXBvbmUgdW4gaW5jcmVtZW50byBkZWwgMy42JSBlbiBsYSBwcm9kdWNjacOzbi4KKiBFbiBkZXRlcm1pbmFkb3MgbWVzZXMgaHVibyB1bm9zIHZhbG9yZXMgZGUgcHJvZHVjY2nDs24gbXV5IGFsZWphZG9zIGRlIGxvcyBlc3BlcmFkby4KCiMjIyBQcmVkaWNjacOzbiBkZSBsYSBzZXJpZSB7LX0KClVuYSB2ZXogZGFkbyBwb3IgdsOhbGlkbyBlbCBtb2RlbG8gcG9kZW1vcyBwYXNhciBhIHJlYWxpemFyIHByZWRpY2Npb25lcy4gSGF5IHF1ZSB0ZW5lciBlbiBjdWVudGEgcXVlIGhheSB1bmEgdmFyaWFibGUgZGUgaW50ZXJ2ZW5jacOzbiBkZSBlZmVjdG8gY2FsZW5kYXJpbyAoRMOtYXMgbGFib3JhYmxlcyksIHBhcmEgbGEgcXVlIGRlYmVtb3MgaW5kaWNhciBxdcOpIHZhbG9yZXMgdG9tYXLDoSBlbiBlbCBwZXJpb2RvIGRlIHByZWRpY2Npw7NuLiBWYW1vcyBhIGZpamFyIGVsIGhvcml6b250ZSBkZSBwcmVkaWNjacOzbiBlbiBjdWF0cm8gYcOxb3MgKDE5OTUgYSAxOTk4KS4KCmBgYHtyfQpkdW1teSA8LSB0cyhyZXAoMCwgNDgpLCBzdGFydCA9IDE5OTUsIGZyZXF1ZW5jeSA9IDEyKQpwZGwgPC0gYml6ZGF5cyhkdW1teSwgRmluQ2VudGVyID0gIkxvbmRvbiIpCgpwY2hvY28uYXIyIDwtIGZvcmVjYXN0KGNob2NvLmFyMiwgCiAgICAgICAgICAgICAgICAgICAgIGggPSA0OCwKICAgICAgICAgICAgICAgICAgICAgeHJlZyA9IGNiaW5kKHBkbCwgcmVwKDAsNDgpLCByZXAoMCw0OCksIHJlcCgwLDQ4KSwgcmVwKDAsNDgpKSwgCiAgICAgICAgICAgICAgICAgICAgIGxldmVsID0gOTUpCmF1dG9wbG90KHBjaG9jby5hcjIsIAogICAgICAgICB4bGFiID0gIiIsCiAgICAgICAgIHlsYWIgPSAnVG9uZWxhZGFzJywKICAgICAgICAgbWFpbiA9ICdGaWd1cmEgMTkuIENob2NvbGF0ZSAoMTk1OC0xOTk0KSB5IHByZWRpY2Npw7NuICgxOTk1LTE5OTgpJykgKwogIHNjYWxlX3hfY29udGludW91cyhicmVha3M9IHNlcSgxOTU4LCAxOTk4LCA0KSkgCmBgYAoKIyMjIEVycm9yIGRlIHByZWRpY2Npw7NuIGV4dHJhLW11ZXN0cmFsIHNlZ8O6biBob3Jpem9udGUgdGVtcG9yYWwgey19CgpBc3VtaW1vcyBxdWUgc2UgcHJlY2lzYW4gdmVpbnRlIGHDsW9zIHBhcmEgaGFjZXIgdW5hIGJ1ZW5hIGVzdGltYWNpw7NuLCAkayA9IDI0MCQsIHkgZmlqYXJlbW9zIGVsIGhvcml6b250ZSB0ZW1wb3JhbCBlbiB1biBhw7FvLCAkaCA9IDEyJCBtZXNlcy4KCmBgYHtyfSAgCmsgPC0gMjQwICAgICAgICAgICAgICAgIApoIDwtIDEyICAgICAgICAgICAgICAgICAKVCA8LSBsZW5ndGgoY2hvY29sYXRlKSAgCnM8LVQgLSBrIC0gaCAgICAgICAgICAgIAoKbWFwZUFyaW1hIDwtIG1hdHJpeChOQSwgcyArIDEsIGgpCgpYIDwtIGRhdGEuZnJhbWUoY2JpbmQoRGlhc0xhYm9yYWJsZXMsIGQwOTc1LCBkMDE4NiwgZDAxOTEsIGQwMTk0KSkKCmZvciAoaSBpbiAwOnMpIHsKICB0cmFpbi5zZXQgPC0gc3Vic2V0KGNob2NvbGF0ZSwgc3RhcnQgPSBpICsgMSwgZW5kID0gaSArIGspCiAgdGVzdC5zZXQgPC0gIHN1YnNldChjaG9jb2xhdGUsIHN0YXJ0ID0gaSArIGsgKyAxLCBlbmQgPSBpICsgayArIGgpIAogIAogIFgudHJhaW4gPC0gZGF0YS5mcmFtZShYWyhpICsgMSk6KGkgKyBrKSxdKQogIGhheSA8LSBjb2xTdW1zKFgudHJhaW4pCiAgWC50cmFpbiA8LSBYLnRyYWluWywgaGF5PjBdCiAgCiAgWC50ZXN0IDwtIGRhdGEuZnJhbWUoWFsoaSArIGsgKyAxKTooaSArIGsgKyBoKSxdKQogIFgudGVzdCA8LSBYLnRlc3RbLCBoYXk+MF0KICAKICBmaXQgPC0gQXJpbWEodHJhaW4uc2V0LCAKICAgICAgICAgICAgICAgb3JkZXIgPSBjKDEsIDEsIDEpLAogICAgICAgICAgICAgICBzZWFzb25hbCA9IGxpc3Qob3JkZXIgPSBjKDAsIDEsIDEpLCBwZXJpb2QgPSAxMiksCiAgICAgICAgICAgICAgIGxhbWJkYSA9IDAsCiAgICAgICAgICAgICAgIHhyZWcgPSBhcy5tYXRyaXgoWC50cmFpbikpCiAgCiAgCiAgZmNhc3QgPC0gZm9yZWNhc3QoZml0LCBoID0gaCwgeHJlZyA9IGFzLm1hdHJpeChYLnRlc3QpKSAKICAKICBtYXBlQXJpbWFbaSArIDEsXSA8LSAxMDAqYWJzKHRlc3Quc2V0IC0gZmNhc3QkbWVhbikvdGVzdC5zZXQKfQogIAplcnJvckFyaW1hIDwtIGNvbE1lYW5zKG1hcGVBcmltYSkKZXJyb3JBcmltYQpgYGAKCmBgYHtyfQpnZ3Bsb3QoKSArCiAgZ2VvbV9saW5lKGFlcyh4ID0gMToxMiwgeSA9IGVycm9yQXJpbWEpLCBjb2xvdXIgPSAiQmx1ZSIpICsKICBnZ3RpdGxlKCJGaWd1cmEgMjAuIEVycm9yIGRlIHByZWRpY2Npw7NuIChNQVBFKSBzZWfDum4gaG9yaXpvbnRlIHRlbXBvcmFsIikgKwogIHhsYWIoIkhvcml6b250ZSB0ZW1wb3JhbCBkZSBwcmVkaWNjacOzbiIpICsKICB5bGFiKCIlIikgKwogIHNjYWxlX3hfY29udGludW91cyhicmVha3M9IDE6MTIpCmBgYAoKTGEgZmlndXJhIDIwIHJldmVsYSBxdWUgZWwgZXJyb3IgZGUgcHJlZGljY2nDs24gYSB1biBwZXJpb2RvIHZpc3RhIGVzIDEuNCBwdW50b3MgcG9yY2VudHVhbGVzIHN1cGVyaW9yIGFsIGVycm9yIGRlIGFqdXN0ZS4gSGFzdGEgbG9zIDUgbWVzZXMgZWwgZXJyb3IgYXVtZW50YSBzZWfDum4gYXVtZW50YSBlbCBob3Jpem9udGUgZGUgcHJlZGljY2nDs24uIERlc2RlIGVsIHNleHRvIG1lcywgZWwgZXJyb3Igc2UgbWFudGllbmUgZXN0YWJsZSBlbiB0b3JubyBhbCA5JS05LjQlLgoKXApcCgojIENvbXBhcmFjacOzbiBjb24gYWxpc2FkbyBleHBvbmVuY2lhbAoKVmVhbW9zIHVuYSBjb21wYXJhdGl2YSwgcGFyYSBsb3MgZG9zIGVqZW1wbG9zIHZpc3RvcywgZW50cmUgbG9zIHJlc3VsdGFkb3Mgb2J0ZW5pZG9zIGNvbiBBUklNQSB5IGNvbiBBbGlzYWRvIGV4cG9uZW5jaWFsCgojIyMgTmFjaW1pZW50b3MgKGxvZykgey19Cgp8TcOpdG9kbyAgIHxNb2RlbG8gICAgICAgICAgICAgICAgICAgfE1BUEUgICAgICAgICAgICAgIHwKfDotLS0tLS0tLXw6LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tfDotLS0tLTp8Oi0tLS0tLS0tLS06fDotLS0tLS0tLS0tOnw6LS0tLS0tLS0tLS06fAp8ICAgICAgICAgfCAgICAgICAgICAgICAgICAgICAgICAgICB8QWp1c3RlIHxFeHRyYSBoID0gMSB8RXh0cmEgaCA9IDYgfEV4dHJhIGggPSAxMiB8CnwgQVJJTUEgICB8QVJJTUEoMCwxLDEpKDAsMSwyKSArIEFJIHwgMS41NSAgfCAxLjkwICAgICAgIHwgMi43NyAgICAgICB8IDMuNjAgICAgICAgIHwKfCBBbGlzYWRvIHxFVFMoQSxBZCxBKSAgICAgICAgICAgICAgfCAxLjc1ICB8IDEuOTEgICAgICAgfCAyLjkwICAgICAgIHwgMy44MyAgICAgICAgfAoKUGFyYSBOYWNpbWllbnRvcywgbGEgbWVqb3JhIGVuIGxvcyBpbmRpY2Fkb3JlcyBkZSBjYWxpZGFkIGNvbiBBUklNQSByZXNwZWN0byBkZSBBbGlzYWRvIGVzIHRhbiBwZXF1ZcOxYSBxdWUgbm8ganVzdGlmaWNhIHN1IGFwbGljYWNpw7NuLiBJbmNsdXNvIHBhcmEgcHJldmlzaW9uZXMgZXh0cmEtbXVlc3RyYWxlcyBhIDEyIG1lc2VzIHZpc3RhLCBBbGlzYWRvIHPDs2xvIGVzIGluZmVyaW9yIGVuIG1lZGlvIHB1bnRvIHBvcmNlbnR1YWwgYSBBUklNQS4KCiMjIyBDaG9jb2xhdGUgKGxvZykgey19Cgp8TcOpdG9kbyAgIHxNb2RlbG8gICAgICAgICAgICAgICAgICAgfE1BUEUgICAgICAgICAgICAgIHwKfDotLS0tLS0tLXw6LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tfDotLS0tLTp8Oi0tLS0tLS0tLS06fDotLS0tLS0tLS0tOnw6LS0tLS0tLS0tLS06fAp8ICAgICAgICAgfCAgICAgICAgICAgICAgICAgICAgICAgICB8QWp1c3RlIHxFeHRyYSBoID0gMSB8RXh0cmEgaCA9IDYgfEV4dHJhIGggPSAxMiB8CnwgQVJJTUEgICB8QVJJTUEoMSwxLDEpKDAsMSwxKSArIEFJIHwgNi45OSAgfCA4LjM4ICAgICAgIHwgOS4yNSAgICAgICB8IDkuMzAgICAgICAgIHwKfCBBbGlzYWRvIHxFVFMoQSxBLEEpICAgICAgICAgICAgICAgfCA4LjE1ICB8IDkuMzYgICAgICAgfCAxMS4wNyAgICAgIHwgOS4zOSAgICAgICB8CgpFbiBlbCBjYXNvIGRlIENob2NvbGF0ZSwgbGEgbWVqb3JhIGVuIGxhIGNhbGlkYWQgZGVsIGFqdXN0ZSBjb24gQVJJTUEgcmVzcGVjdG8gZGUgQWxpc2FkbyBlcyBkZSAxIGEgMiBwdW50b3MgcG9yY2VudHVhbGVzIGVuIHByZXZpc2lvbmVzIGEgdW5vcyBwb2NvcyBtZXNlcyB2aXN0YS4gU2luIGVtYmFyZ28sIGEgZG9jZSBtZXNlcyB2aXN0YSBhbWJvcyBtw6l0b2RvcyBvZnJlY2VuIGlndWFsIGNhbGlkYWQgZW4gc3VzIHByZWRpY2Npb25lcy4KCgpcClwKXApcCgo=</div>
<footer class="footer">
  
<a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" /></a>
<br>
This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.  <div class="text-muted">Website created by Iv&aacute;n Arribas. &copy;  2020. If you find any bugs please report them to <a href="mailto:ivan.arribas@uv.es"> ivan.arribas@uv.es</a>.</div>
  
</footer>




</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeSourceEmbed("03-05-Tema5.Rmd");
});
</script>

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
