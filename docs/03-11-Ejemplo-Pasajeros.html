<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.36">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Iván Arribas (Depto. Análisis Económico. Universitat de València)">

<title>Series Temporales - Series Temporales: Análisis de la serie Pasajeros en transporte urbano</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Series Temporales</span>
  </a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html">Inicio</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.html">About</a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="./01-Guia-curso.html">Guía del curso</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./02-Logistica.html">Logística</a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-diapos" role="button" data-bs-toggle="dropdown" aria-expanded="false">Diapos</a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-diapos">    
        <li class="dropdown-header">Teoría</li>
        <li>
    <a class="dropdown-item" href="./03-01-Tema1.html">
 <span class="dropdown-text">Tema 1: Definicion y Componentes</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-02-Tema2.html">
 <span class="dropdown-text">Tema 2: Alisado</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-03-Tema3.html">
 <span class="dropdown-text">Tema 3: Procesos estocásticos</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-04-Tema4.html">
 <span class="dropdown-text">Tema 4: ARIMA</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-05-Tema5.html">
 <span class="dropdown-text">Tema 5: SARIMA</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Ejemplo de aplicación</li>
        <li>
    <a class="dropdown-item" href="./03-06-Ejemplo1.html">
 <span class="dropdown-text">Ejemplo Tema 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-07-Ejemplo2.html">
 <span class="dropdown-text">Ejemplo Tema 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-08-Ejemplo3.html">
 <span class="dropdown-text">Ejemplo Tema 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-09-Ejemplo4.html">
 <span class="dropdown-text">Ejemplo Tema 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-10-Ejemplo5.html">
 <span class="dropdown-text">Ejemplo Tema 5</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Otro ejemplo</li>
        <li>
    <a class="dropdown-item" href="./03-11-Ejemplo-Pasajeros.html">
 <span class="dropdown-text">Ejemplo de Pasajeros</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-píldoras" role="button" data-bs-toggle="dropdown" aria-expanded="false">Píldoras</a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-píldoras">    
        <li>
    <a class="dropdown-item" href="./04-01-Bootstrapping.html">
 <span class="dropdown-text">Bootstrapping para IC</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./04-02-Multiples_CS.html">
 <span class="dropdown-text">Múltiples componentes estacionales</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./04-03-Redes_neuronales.html">
 <span class="dropdown-text">Predicción con Redes Neuronales</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./04-04-Series_acotadas.html">
 <span class="dropdown-text">Series acotadas</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./04-05-Valores_perdidos_Outliers.html">
 <span class="dropdown-text">Valores perdidos y outliers</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./04-06-Covid_Nacimientos.html">
 <span class="dropdown-text">Efecto de la Covid-19 en Nacimientos</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="./05-Recursos-R.html">Recursos de la asignatura</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./06-Practica.html">Practica</a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-más" role="button" data-bs-toggle="dropdown" aria-expanded="false">Más</a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-más">    
        <li class="dropdown-header">R</li>
        <li>
    <a class="dropdown-item" href="https://cran.r-project.org">
 <span class="dropdown-text">Dónde está R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://rstudio.com">
 <span class="dropdown-text">Donde está RStudio</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Markdown</li>
        <li>
    <a class="dropdown-item" href="https://bookdown.org/yihui/rmarkdown/">
 <span class="dropdown-text">Markdown</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://rmarkdown.rstudio.com/lesson-1.html">
 <span class="dropdown-text">R Markdown</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://www.rstudio.com/wp-content/uploads/2015/03/rmarkdown-reference.pdf">
 <span class="dropdown-text">R Markdown (pdf)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://quarto.org/docs/tools/rstudio.html">
 <span class="dropdown-text">Quatro</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Otros</li>
        <li>
    <a class="dropdown-item" href="https://www.r-bloggers.com">
 <span class="dropdown-text">Blog sobre R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://bookdown.org">
 <span class="dropdown-text">Libros online que debes conocer</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">Índice</h2>
   
  <ul>
  <li><a href="#antecedentes" id="toc-antecedentes" class="nav-link active" data-scroll-target="#antecedentes">Antecedentes</a></li>
  <li><a href="#pasajeros-en-transporte-urbano" id="toc-pasajeros-en-transporte-urbano" class="nav-link" data-scroll-target="#pasajeros-en-transporte-urbano"> <span class="header-section-number">1</span> Pasajeros en transporte urbano</a></li>
  <li><a href="#descriptiva" id="toc-descriptiva" class="nav-link" data-scroll-target="#descriptiva"> <span class="header-section-number">2</span> Descriptiva</a>
  <ul class="collapse">
  <li><a href="#análisis-de-la-tendencia" id="toc-análisis-de-la-tendencia" class="nav-link" data-scroll-target="#análisis-de-la-tendencia"> <span class="header-section-number">2.1</span> Análisis de la tendencia</a></li>
  <li><a href="#análisis-de-la-estacionalidad" id="toc-análisis-de-la-estacionalidad" class="nav-link" data-scroll-target="#análisis-de-la-estacionalidad"> <span class="header-section-number">2.2</span> Análisis de la estacionalidad</a>
  <ul class="collapse">
  <li><a href="#días-laborables-de-cada-mes" id="toc-días-laborables-de-cada-mes" class="nav-link" data-scroll-target="#días-laborables-de-cada-mes">Días laborables de cada mes</a></li>
  <li><a href="#análisis-gráfico-de-la-estacionalidad" id="toc-análisis-gráfico-de-la-estacionalidad" class="nav-link" data-scroll-target="#análisis-gráfico-de-la-estacionalidad">Análisis gráfico de la estacionalidad</a></li>
  <li><a href="#análisis-numérico-de-la-estacionalidad" id="toc-análisis-numérico-de-la-estacionalidad" class="nav-link" data-scroll-target="#análisis-numérico-de-la-estacionalidad">Análisis numérico de la estacionalidad</a></li>
  </ul></li>
  <li><a href="#descomposición-de-la-serie" id="toc-descomposición-de-la-serie" class="nav-link" data-scroll-target="#descomposición-de-la-serie"> <span class="header-section-number">2.3</span> Descomposición de la serie</a></li>
  <li><a href="#conclusión" id="toc-conclusión" class="nav-link" data-scroll-target="#conclusión"> <span class="header-section-number">2.4</span> Conclusión</a></li>
  </ul></li>
  <li><a href="#un-predicción-rápida-y-sencilla" id="toc-un-predicción-rápida-y-sencilla" class="nav-link" data-scroll-target="#un-predicción-rápida-y-sencilla"> <span class="header-section-number">3</span> Un predicción rápida y sencilla</a></li>
  <li><a href="#alisado-exponencial" id="toc-alisado-exponencial" class="nav-link" data-scroll-target="#alisado-exponencial"> <span class="header-section-number">4</span> Alisado Exponencial</a>
  <ul class="collapse">
  <li><a href="#análisis-de-la-serie-pasajeros" id="toc-análisis-de-la-serie-pasajeros" class="nav-link" data-scroll-target="#análisis-de-la-serie-pasajeros"> <span class="header-section-number">4.1</span> Análisis de la serie Pasajeros</a>
  <ul class="collapse">
  <li><a href="#estimación-e-interpretación" id="toc-estimación-e-interpretación" class="nav-link" data-scroll-target="#estimación-e-interpretación">Estimación e interpretación</a></li>
  <li><a href="#predicción" id="toc-predicción" class="nav-link" data-scroll-target="#predicción">Predicción</a></li>
  <li><a href="#análisis-del-error" id="toc-análisis-del-error" class="nav-link" data-scroll-target="#análisis-del-error">Análisis del error</a></li>
  </ul></li>
  <li><a href="#otras-alternativas-de-análisis" id="toc-otras-alternativas-de-análisis" class="nav-link" data-scroll-target="#otras-alternativas-de-análisis"> <span class="header-section-number">4.2</span> Otras alternativas de análisis</a></li>
  <li><a href="#conclusión-1" id="toc-conclusión-1" class="nav-link" data-scroll-target="#conclusión-1"> <span class="header-section-number">4.3</span> Conclusión</a></li>
  </ul></li>
  <li><a href="#modelos-arima" id="toc-modelos-arima" class="nav-link" data-scroll-target="#modelos-arima"> <span class="header-section-number">5</span> Modelos Arima</a>
  <ul class="collapse">
  <li><a href="#transformación-de-la-serie-pasajeros" id="toc-transformación-de-la-serie-pasajeros" class="nav-link" data-scroll-target="#transformación-de-la-serie-pasajeros"> <span class="header-section-number">5.1</span> Transformación de la serie Pasajeros</a></li>
  <li><a href="#identificación-de-la-serie-pasajeros" id="toc-identificación-de-la-serie-pasajeros" class="nav-link" data-scroll-target="#identificación-de-la-serie-pasajeros"> <span class="header-section-number">5.2</span> Identificación de la serie Pasajeros</a>
  <ul class="collapse">
  <li><a href="#identificación-automática-con-auto.arima" id="toc-identificación-automática-con-auto.arima" class="nav-link" data-scroll-target="#identificación-automática-con-auto.arima">Identificación automática con <code>auto.arima</code></a></li>
  <li><a href="#identificación-automática-con-seas" id="toc-identificación-automática-con-seas" class="nav-link" data-scroll-target="#identificación-automática-con-seas">Identificación automática con <code>seas</code></a></li>
  </ul></li>
  <li><a href="#estimación-del-modelo-e-identificación-de-otras-componentes-de-intervención" id="toc-estimación-del-modelo-e-identificación-de-otras-componentes-de-intervención" class="nav-link" data-scroll-target="#estimación-del-modelo-e-identificación-de-otras-componentes-de-intervención"> <span class="header-section-number">5.3</span> Estimación del modelo e identificación de otras componentes de intervención</a></li>
  <li><a href="#validación-del-modelo" id="toc-validación-del-modelo" class="nav-link" data-scroll-target="#validación-del-modelo"> <span class="header-section-number">5.4</span> Validación del modelo</a>
  <ul class="collapse">
  <li><a href="#incorrelación-homocedasticidad-y-normalidad" id="toc-incorrelación-homocedasticidad-y-normalidad" class="nav-link" data-scroll-target="#incorrelación-homocedasticidad-y-normalidad">Incorrelación, Homocedasticidad y Normalidad</a></li>
  <li><a href="#calidad-del-ajuste" id="toc-calidad-del-ajuste" class="nav-link" data-scroll-target="#calidad-del-ajuste">Calidad del ajuste</a></li>
  <li><a href="#calidad-de-las-predicciones" id="toc-calidad-de-las-predicciones" class="nav-link" data-scroll-target="#calidad-de-las-predicciones">Calidad de las predicciones</a></li>
  </ul></li>
  <li><a href="#interpretación-del-modelo-estimado" id="toc-interpretación-del-modelo-estimado" class="nav-link" data-scroll-target="#interpretación-del-modelo-estimado"> <span class="header-section-number">5.5</span> Interpretación del modelo estimado</a></li>
  <li><a href="#predicción-del-número-de-pasajeros-en-transporte-urbano" id="toc-predicción-del-número-de-pasajeros-en-transporte-urbano" class="nav-link" data-scroll-target="#predicción-del-número-de-pasajeros-en-transporte-urbano"> <span class="header-section-number">5.6</span> Predicción del número de pasajeros en transporte urbano</a></li>
  </ul></li>
  <li><a href="#comparación-entre-modelos" id="toc-comparación-entre-modelos" class="nav-link" data-scroll-target="#comparación-entre-modelos"> <span class="header-section-number">6</span> Comparación entre modelos</a></li>
  <li><a href="#lista-de-funciones-utilizadas" id="toc-lista-de-funciones-utilizadas" class="nav-link" data-scroll-target="#lista-de-funciones-utilizadas"> <span class="header-section-number">7</span> Lista de funciones utilizadas</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Series Temporales: Análisis de la serie Pasajeros en transporte urbano</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Iván Arribas (Depto. Análisis Económico. Universitat de València) </p>
          </div>
  </div>
    
    
  </div>
  

</header>

<div class="cell">

</div>
<p><br>
<br>
</p>
<section id="antecedentes" class="level1 unnumbered">
<h1 class="unnumbered">Antecedentes</h1>
<p>En este curso hemos aprendido a describir una serie temporal, estimar su proceso generador de datos y realizar predicciones, tanto puntuales como por intervalo. Para ello, hemos estudiado los principales aspectos teóricos relacionados con las series temporales, sus componentes, modelos de ajuste, predicción, criterios de calidad, etc. También hemos practicado la aplicación de estos conceptos a través de diferentes series temporales: Títulos publicados, Nacimientos, Aforo de vehículos, Consumo de alimentos per cápita, Exportaciones, Producción de chocolate y Pernoctaciones de turistas extranjeros, entre otras.</p>
<p>El programa de estadística utilizado <code>R</code> ha servido con dos propósitos entremezclados durante el curso. En primer lugar, para ilustrar los aspectos teóricos que se iban presentando. En este caso, <code>R</code> tenía un uso más instrumental y en general se mostraba la salida obtenida sin enseñar el código. En segundo lugar, hemos aprendido a usar <code>R</code> para analizar y predecir una serie temporal real. Los ejemplos vistos en cada tema y el ejemplo transversal utilizado durante el curso de <em>Pernoctaciones en alojamientos turísticos de turistas extranjeros</em> son buenos exponentes de este uso de <code>R</code>.</p>
<p>Ahora bien, ambos usos de <code>R</code> –ilustrar aspectos teóricos y analizar una serie– han quedado distribuidos a lo largo de los temas vistos. El ejemplo <strong>Pasajeros en transporte urbano</strong>, desarrollado aquí, tiene como objetivo disponer en un único documento y de forma organizada del análisis completo de una serie temporal. En este informe se mostrará siempre el código completo empleado para las salidas, se hará hincapié en la aplicación práctica de los conceptos teóricos, se insistirá en los diferentes enfoques que se pueden y deben emplear para analizar una serie temporal y se justificarán todas las decisiones adoptadas.</p>
<p>Este es, por tanto, un ejemplo que se extiende más allá de lo que un informe de análisis de una serie temporal precisa.</p>
<p>Para el código de este ejemplo se utilizarán funciones de las librerías básicas de <code>R</code> y de otras que se pueden encontrar en las siguientes librerías:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forecast)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2); <span class="fu">theme_set</span>(<span class="fu">theme_bw</span>())</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(seasonal)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(aod)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(timeDate)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tseries)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="pasajeros-en-transporte-urbano" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Pasajeros en transporte urbano</h1>
<p>La serie que se va a analizar corresponde al número de pasajeros en transporte urbano en España. Es una serie mensual que puede ser consultada en el <a href="\http://www.ine.es">Instituto Nacional de Estadística</a> y para la que se dispone de datos desde enero de 1996 hasta diciembre de 2021.</p>
<p>Por transporte urbano de pasajeros se hace referencia a los servicios de transporte terrestre de pasajeros, urbano y suburbano, por itinerarios regulares, con horario establecido y con paradas fijas, realizados por autobuses, tranvías, trolebuses, metros y metros ligeros. También se incluyen las líneas de servicio al aeropuerto y a las estaciones y la explotación de funiculares y teleféricos si forman parte de los sistemas de tránsito urbanos e interurbanos.</p>
<p>Los datos de la serie, que denominaremos de forma abreviada Pasajeros, han sido descargados en el fichero <em>Pasajeros.csv</em> y aunque en origen la unidad es miles de pasajeros, la cambiaremos a millones de pasajeros.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>meses <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Ene"</span>, <span class="st">"Feb"</span>, <span class="st">"Mar"</span>, <span class="st">"Abr"</span>, <span class="st">"May"</span>, <span class="st">"Jun"</span>, </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Jul"</span>, <span class="st">"Ago"</span>, <span class="st">"Sep"</span>, <span class="st">"Oct"</span>, <span class="st">"Nov"</span>, <span class="st">"Dic"</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>Pasajeros <span class="ot">&lt;-</span> <span class="fu">read.csv2</span>(<span class="st">"./series/Pasajeros.csv"</span>,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>Pasajeros <span class="ot">&lt;-</span> <span class="fu">ts</span>(Pasajeros<span class="sc">/</span><span class="dv">1000</span>, </span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">start =</span> <span class="dv">1996</span>, </span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">freq =</span> <span class="dv">12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="descriptiva" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Descriptiva</h1>
<p>La <a href="#fig-Pasajeros">Figura&nbsp;1</a> muestra la evolución de la serie Pasajeros en transporte urbano desde 1996 hasta 2021 Destaca que la tendencia de la serie ha seguido el ciclo económico. Durante el periodo de crecimiento de finales del siglo pasado y principios de este, el número de pasajeros en transporte urbano creció de forma sostenida. Con la Gran Recesión (2008 - 2014) se observa un cambio en la tendencia y el número de pasajeros se reduce. No es hasta el final la crisis, en 2014, que la tendencia vuelve a cambiar y pasar a ser creciente de nuevo. Al final del periodo se observa el tremendo efecto que tuvo sobre la serie el confinamiento por la Covid-19 (marzo a junio de 2020) y el incremento del trabajo en casa, con una brusca caída y lenta recuperación.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(Pasajeros, <span class="at">colour =</span> <span class="st">"darkblue"</span>,</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"Millones de pasajeros"</span>,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span> <span class="fu">seq</span>(<span class="dv">1996</span>, <span class="dv">2022</span>, <span class="dv">2</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-Pasajeros" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="03-11-Ejemplo-Pasajeros_files/figure-html/fig-Pasajeros-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
<p></p><figcaption class="figure-caption">Figura 1: Pasajeros en transporte urbano (datos mensuales)</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>La serie presenta una acusada estacionalidad, causada principalmente por la distribución de las vacaciones a lo largo de un año y el número de días laborables de cada mes. Pensemos que el principal uso del transporte urbano es el traslado hasta y desde el lugar de trabajo o estudio, seguido del ocio (ir de compras, al cine, a restaurantes, etc.). Así, cada año el mes con menor número de pasajeros es agosto (los valles en la <a href="#fig-Pasajeros">Figura&nbsp;1</a>) por estar la mayoría de la gente de vacaciones, fuera de sus ciudades de residencia habituales, y no usar tan intensamente el transporte urbano.</p>
<p>El esquema parece ser aditivo porque no se aprecia que la amplitud estacional se amplíe conforme el número de pasajeros aumenta.</p>
<p>En los siguientes epígrafes se hará una descriptiva de la tendencia y la estacionalidad más detallada.</p>
<div class="callout-important callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Serie recortada
</div>
</div>
<div class="callout-body-container callout-body">
<p>Como el propósito de este ejemplo es didáctico, vamos a simplificar el análisis y <em>cortar</em> la serie Pasajeros hasta diciembre de 2019, antes de la Covid-19. A lo largo de los siguientes epígrafes usaremos la serie recortada.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>Pasajeros <span class="ot">&lt;-</span> <span class="fu">window</span>(Pasajeros, <span class="at">end =</span> <span class="fu">c</span>(<span class="dv">2019</span>, <span class="dv">12</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p><br>
</p>
<section id="análisis-de-la-tendencia" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="análisis-de-la-tendencia"><span class="header-section-number">2.1</span> Análisis de la tendencia</h2>
<p>Si anualizamos la serie podemos, por un lado, identificar mejor en que años se producen los cambios en la tendencia y, por otro lado, poner cifras al volumen de pasajeros en transporte urbano.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>PasajerosAnual <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(Pasajeros, <span class="at">FUN =</span> sum)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(PasajerosAnual, <span class="at">colour =</span> <span class="st">"darkblue"</span>,</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"Millones de pasajeros"</span>,</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span> <span class="fu">seq</span>(<span class="dv">1996</span>, <span class="dv">2020</span>, <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-PasajerosTendencia" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="03-11-Ejemplo-Pasajeros_files/figure-html/fig-PasajerosTendencia-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
<p></p><figcaption class="figure-caption">Figura 2: Pasajeros en transporte urbano (datos anuales)</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>La <a href="#fig-PasajerosTendencia">Figura&nbsp;2</a> muestra el volumen anual de pasajeros en transporte urbano. El crecimiento continuado, posiblemente iniciado antes de 1996 y que permitió superar los 3000 millones de pasajeros en 2007, se ve interrumpido con el inicio de la pasada crisis económica. La caída en el número de pasajeros se interrumpe en 2014, año que marca la salida de la Gran recesión y el inicio de la recuperación en el serie. En 2019 se superaron los 3100 millones de pasajeros.</p>
<p>El incremento en el uso del transporte urbano observado antes y después de la crisis puede tener distintas causas: un uso más intensivo del transporte urbano en detrimento de otros medios de transporte, una reorganización de los servicios de transporte urbano que haya mejorado la conectividad dentro de los municipios, o un aumento en el número de líneas de autobús, tranvía o metro en determinadas ciudades.</p>
<p>La causa del repunte aislado observado el año 2011, en plena crisis, fue una ligera recuperación de la economía que tuvo lugar a finales de 2010 y principios de 2011.</p>
<p><br>
</p>
</section>
<section id="análisis-de-la-estacionalidad" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="análisis-de-la-estacionalidad"><span class="header-section-number">2.2</span> Análisis de la estacionalidad</h2>
<p>La principal causa de la estacionalidad observada en la serie es la estructura vacacional de la sociedad, especialmente caracterizada por las vacaciones de verano (julio a septiembre) y las vacaciones de Semana Santa (en marzo y/o abril, según el año). Además, debido a que el transporte urbano se usa principalmente para ir a trabajar, también influye el número de días laborables del mes. Por ejemplo, en 2017 el mes de junio tuvo 22 días laborables, mientras que en 2019 tuvo 20 días laborables. Esta diferencia de dos días tendrá un efecto sobre el volumen de pasajeros.</p>
<p>El número de días laborables de un mes viene marcado por los fines de semana del mes y por las festividades nacionales. Es cierto que el sábado se trabaja en diversos sectores (comercio, ocio, distribución) pero la caída en el número de trabajadores respecto de los días entre semana (lunes a viernes) es muy notable. También es cierto que, además de las festividades nacionales, hay muchas festividades autonómicas o municipales que podrían afectar al volumen de pasajeros en transporte urbano. Por ejemplo, las festividades regionales en comunidades como Madrid o Cataluña pueden tener un efecto significativo sobre la serie Pasajeros. Sin embargo, las festividades no nacionales no se van a tener en cuenta.</p>
<p>Por tanto, para realizar un análisis detallado de la estacionalidad, es necesario crear una serie con el número de días laborables de cada mes. Además, esta serie se usará más adelante para modelizar y predecir la serie Pasajeros.</p>
<section id="días-laborables-de-cada-mes" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="días-laborables-de-cada-mes">Días laborables de cada mes</h3>
<p>La librería <code>timeData</code> proporciona una serie de funciones que permiten definir un calendario de festividades, identificar los fines de semana y, a partir de aquí, crear la serie de días laborables (véase código más abajo).</p>
<ul>
<li><p>Con <code>timeCalendar</code> se definen las festividades nacionales que vamos a considerar: Año nuevo (1 de enero), Reyes (6 de enero), Viernes Santo (fecha variable), Día del Trabajo (1 de mayo), Día de la Asunción (15 de agosto), Día de la Hispanidad (12 de octubre), Día de Todos los Santos (1 de noviembre), la Constitución (6 de diciembre) la Inmaculada Concepción (8 de diciembre) y Navidad (25 de diciembre).</p>
<p>Por claridad, cada festivo se ha definido de forma independiente para después crear una variable con todas las festividades (<em>FestivosNacionales</em>).</p>
<p>El rango para todos los cálculos va desde 1996 hasta 2024, que incluye el rango de la serie Pasajeros más cinco años de predicción.</p>
<p>La función utilizada <code>Easter</code> de la librería <code>timeDate</code> difiere de la función <code>easter</code> de <code>forecast</code>.</p></li>
<li><p>A continuación, con <code>timeSequence</code> se crea una serie diaria desde el 1 de enero de 1996 hasta el 31 de diciembre de 2024.</p></li>
<li><p>Las dos siguientes líneas eliminan de la serie diaria los festivos y los fines de semana, (función <code>isBizday</code>), para después dar a esta nueva serie el formato año-mes eliminando el día. De esta forma, la serie de días laborales tendrá el mismo identificador para todos los días del mismo mes.</p></li>
<li><p>Después, se crea una tabla que, por la naturaleza de la serie de días laborales, tendrá para cada año-mes el numero de días laborables. Por último fechamos la tabla, que es nuestra serie de días laborables y mostramos algunos datos.</p></li>
<li><p>Las dos últimas líneas de código dividen la serie en el periodo muestral y el de predicción.</p></li>
</ul>
<p><br>
</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>AnoNuevo <span class="ot">&lt;-</span> <span class="fu">timeCalendar</span>(<span class="at">d =</span> <span class="dv">1</span>, <span class="at">m =</span> <span class="dv">1</span>, <span class="at">y =</span> <span class="dv">1996</span><span class="sc">:</span><span class="dv">2024</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>Reyes <span class="ot">&lt;-</span> <span class="fu">timeCalendar</span>(<span class="at">d =</span> <span class="dv">6</span>, <span class="at">m =</span> <span class="dv">1</span>, <span class="at">y =</span> <span class="dv">1996</span><span class="sc">:</span><span class="dv">2024</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>ViernesSanto <span class="ot">&lt;-</span> <span class="fu">Easter</span>(<span class="dv">1996</span><span class="sc">:</span><span class="dv">2024</span>, <span class="at">shift =</span> <span class="sc">-</span><span class="dv">2</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>DiaTrabajo <span class="ot">&lt;-</span> <span class="fu">timeCalendar</span>(<span class="at">d =</span> <span class="dv">1</span>, <span class="at">m =</span> <span class="dv">5</span>, <span class="at">y =</span> <span class="dv">1996</span><span class="sc">:</span><span class="dv">2024</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>Asuncion <span class="ot">&lt;-</span> <span class="fu">timeCalendar</span>(<span class="at">d =</span> <span class="dv">15</span>, <span class="at">m =</span> <span class="dv">8</span>, <span class="at">y =</span> <span class="dv">1996</span><span class="sc">:</span><span class="dv">2024</span>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>Hispanidad <span class="ot">&lt;-</span> <span class="fu">timeCalendar</span>(<span class="at">d =</span> <span class="dv">12</span>, <span class="at">m =</span> <span class="dv">10</span>, <span class="at">y =</span> <span class="dv">1996</span><span class="sc">:</span><span class="dv">2024</span>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>TodoSantos <span class="ot">&lt;-</span> <span class="fu">timeCalendar</span>(<span class="at">d =</span> <span class="dv">1</span>, <span class="at">m =</span> <span class="dv">11</span>, <span class="at">y =</span> <span class="dv">1996</span><span class="sc">:</span><span class="dv">2024</span>)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>Constitucion <span class="ot">&lt;-</span> <span class="fu">timeCalendar</span>(<span class="at">d =</span> <span class="dv">6</span>, <span class="at">m =</span> <span class="dv">12</span>, <span class="at">y =</span> <span class="dv">1996</span><span class="sc">:</span><span class="dv">2024</span>)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>Inmaculada <span class="ot">&lt;-</span> <span class="fu">timeCalendar</span>(<span class="at">d =</span> <span class="dv">8</span>, <span class="at">m =</span> <span class="dv">12</span>, <span class="at">y =</span> <span class="dv">1996</span><span class="sc">:</span><span class="dv">2024</span>)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>Navidad <span class="ot">&lt;-</span> <span class="fu">timeCalendar</span>(<span class="at">d =</span> <span class="dv">25</span>, <span class="at">m =</span> <span class="dv">12</span>, <span class="at">y =</span> <span class="dv">1996</span><span class="sc">:</span><span class="dv">2024</span>)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>FestivosNacionales <span class="ot">&lt;-</span> <span class="fu">c</span>(AnoNuevo, Reyes, ViernesSanto,</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>                        DiaTrabajo, Asuncion,  Hispanidad, TodoSantos, </span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>                        Constitucion, Inmaculada, Navidad)</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>fechaDiaria <span class="ot">&lt;-</span> <span class="fu">timeSequence</span>(<span class="at">from =</span> <span class="st">"1996-01-01"</span>, <span class="at">to =</span> <span class="st">"2024-12-31"</span>)</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>biz <span class="ot">&lt;-</span> fechaDiaria[<span class="fu">isBizday</span>(fechaDiaria, <span class="at">holidays =</span> FestivosNacionales)]</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>bizdays <span class="ot">&lt;-</span> <span class="fu">format</span>(biz, <span class="at">format =</span> <span class="st">"%Y-%m"</span>)</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>DiasLaborables <span class="ot">&lt;-</span> <span class="fu">table</span>(bizdays)</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>DiasLaborables <span class="ot">&lt;-</span> <span class="fu">ts</span>(DiasLaborables, <span class="at">start =</span> <span class="dv">1996</span>, <span class="at">frequency =</span> <span class="dv">12</span>)</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="fu">subset</span>(DiasLaborables, <span class="at">start =</span> <span class="dv">289</span>) <span class="co">#Mostramos solo los 5 últimos años</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec
2020  21  20  22  21  20  22  23  21  22  21  21  21
2021  19  20  23  21  21  22  22  22  22  20  21  21
2022  20  20  23  20  22  22  21  22  22  20  21  20
2023  21  20  23  19  22  22  21  22  21  21  21  18
2024  22  21  20  22  22  20  23  21  21  23  20  20</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>pDiasLaborables <span class="ot">&lt;-</span> <span class="fu">subset</span>(DiasLaborables, <span class="at">start =</span> <span class="fu">length</span>(DiasLaborables) <span class="sc">-</span> <span class="dv">59</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>DiasLaborables <span class="ot">&lt;-</span> <span class="fu">subset</span>(DiasLaborables, <span class="at">end =</span> <span class="fu">length</span>(DiasLaborables) <span class="sc">-</span> <span class="dv">60</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Es conveniente indicar que la identificación de las festividades nacionales dista de ser perfecta por varios motivos:</p>
<ul>
<li>algunos festivos nacionales si caen en domingo, se pasan a lunes (por ejemplo Reyes y la Inmaculada de 2019), aspecto que no se ha tenido en cuenta.</li>
<li>algunos festivos nacionales pueden ser sustituidos por otros días por las Comunidades Autónomas, por ejemplo Reyes o Jueves Santo.</li>
</ul>
<p><br>
</p>
</section>
<section id="análisis-gráfico-de-la-estacionalidad" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="análisis-gráfico-de-la-estacionalidad">Análisis gráfico de la estacionalidad</h3>
<p>Veamos ahora una descriptiva detallada de la estacionalidad de la serie Pasajeros, haciendo especial hincapié en el efecto de las vacaciones (verano y Semana Santa) y el número de días laborables. Para ello, mostraremos gráficamente las subseries definidas por el mes tanto para Pasajeros como para <em>Pasajeros por día laborable</em>, esta segunda resultado de dividir Pasajeros por DiasLaborables.</p>
<div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>PasajerosDL <span class="ot">&lt;-</span> Pasajeros<span class="sc">/</span>DiasLaborables</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsubseriesplot</span>(Pasajeros) <span class="sc">+</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Millones de pasajeros"</span>) <span class="sc">+</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">""</span>)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsubseriesplot</span>(PasajerosDL) <span class="sc">+</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Millones de pasajeros"</span>) <span class="sc">+</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-PasajerosEstacionalidad" class="cell quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 100.0%;justify-content: center;">
<div id="fig-PasajerosEstacionalidad-1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="03-11-Ejemplo-Pasajeros_files/figure-html/fig-PasajerosEstacionalidad-1.png" class="img-fluid figure-img" data-ref-parent="fig-PasajerosEstacionalidad"></p>
<p></p><figcaption class="figure-caption">(a) Pasajeros</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 100.0%;justify-content: center;">
<div id="fig-PasajerosEstacionalidad-2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="03-11-Ejemplo-Pasajeros_files/figure-html/fig-PasajerosEstacionalidad-2.png" class="img-fluid figure-img" data-ref-parent="fig-PasajerosEstacionalidad"></p>
<p></p><figcaption class="figure-caption">(b) Pasajeros por día laborable</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p></p><figcaption class="figure-caption">Figura 3: Estacionalidad de la serie Pasajeros</figcaption><p></p>
</figure>
</div>
</div>
<p>La <a href="#fig-PasajerosEstacionalidad">Figura&nbsp;3</a> muestra para cada mes la serie de pasajeros (total o por día laborable) y el valor medio (línea azul horizontal). En ambos paneles se identifica perfectamente el efecto de los periodos vacacionales sobre el transporte urbano de pasajeros. En las vacaciones de verano se observa una fuerte caída en el número de pasajeros, especialmente en agosto y, en menor medida, en julio y septiembre. Por otro lado, las subseries de marzo y abril muestran mucha más irregularidad que las de otros meses debido a que el volumen de pasajeros depende de cómo ha caído la Semana Santa. Si un año esta cae en marzo, ese mes presentará un volumen de pasajeros inferior al de los meses de marzo sin Semana Santa, mientras que en abril se dará el efecto contrario. Diciembre, para ser un mes de 31 días, presenta también un reducido número de pasajeros debido a las vacaciones navideñas.</p>
<p>La <a href="#fig-PasajerosEstacionalidad">Figura&nbsp;3</a> a) muestra el efecto estacional total debido al número de días del mes y de días laborales. Por ejemplo, en febrero, el mes con menos días y por tanto con menos días laborales, en media se transportan menos pasajeros, comparado con enero o marzo. Octubre, un mes con 31 días, muestra un volumen medio de pasajeros mayor que noviembre de 30 días.</p>
<p>En la <a href="#fig-PasajerosEstacionalidad">Figura&nbsp;3</a> b) se ha eliminado el efecto de los días laborables al trabajar con la serie de pasajeros transportados por día laborable. Si la comparamos con la <a href="#fig-PasajerosEstacionalidad">Figura&nbsp;3</a> a), destaca que las diferencias entre las medias (lineas azules) se han reducido: prácticamente no hay diferencias entre los meses de enero a junio, o entre los meses de octubre a diciembre.</p>
<p>Cabría pensar que al excluir de la serie de días laborables la Semana Santa, en la <a href="#fig-PasajerosEstacionalidad">Figura&nbsp;3</a> b) las subseries de marzo y abril deberían ser tan suaves como las observadas para otro meses, pero no es así. Claramente la simple exclusión de los festivos nacionales de Semana Santa no es suficiente para recoger bien su efecto sobre el transporte urbano. La razón hay que buscarla en las vacaciones escolares de este periodo, que en algunas comunidades autónomas tiene lugar durante la propia semana de Semana Santa, mientras que en otras comunidades tiene lugar en la semana posterior. De esta forma, el efecto sobre el transporte urbano de Semana Santa no es homogéneo en el territorio nacional y resulta difícil incluirlo en el análisis de la serie Pasajeros.</p>
<p><br>
</p>
</section>
<section id="análisis-numérico-de-la-estacionalidad" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="análisis-numérico-de-la-estacionalidad">Análisis numérico de la estacionalidad</h3>
<p>Podemos obtener la componente estacional de forma sencilla para poder valorarla numéricamente y ver que efecto tiene el número de días laborables. Previamente, debemos determinar el esquema, aditivo o multiplicativo, de la serie.</p>
<p>La gráfica media-desviación típica (<a href="#fig-Esquema">Figura&nbsp;4</a>) refuerza la impresión que se obtenía de la gráfica de la serie (<a href="#fig-Pasajeros">Figura&nbsp;1</a>), que el esquema es aditivo.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>MediaAnual <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(Pasajeros, <span class="at">FUN =</span> mean)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>DesviacionAnual <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(Pasajeros, <span class="at">FUN =</span> sd)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> MediaAnual, <span class="at">y =</span> DesviacionAnual), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Media de pasajeros por año"</span>) <span class="sc">+</span> </span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Desviación típica de pasajeros por año"</span>) <span class="sc">+</span> </span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-Esquema" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="03-11-Ejemplo-Pasajeros_files/figure-html/fig-Esquema-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
<p></p><figcaption class="figure-caption">Figura 4: Identificación del tipo de esquema</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>PasajerosMedia <span class="ot">&lt;-</span> <span class="fu">tapply</span>(Pasajeros <span class="sc">-</span> <span class="fu">mean</span>(Pasajeros), </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">cycle</span>(Pasajeros), </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>                         mean)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>PasajerosDLMedia <span class="ot">&lt;-</span> <span class="fu">tapply</span>((PasajerosDL <span class="sc">-</span> <span class="fu">mean</span>(PasajerosDL)), </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">cycle</span>(PasajerosDL), </span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>                           mean)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>datos <span class="ot">&lt;-</span> <span class="fu">cbind</span>(PasajerosMedia, PasajerosDLMedia)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(datos) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Pasajeros"</span>, <span class="st">"Pasajeros por día laborable"</span>)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(datos) <span class="ot">&lt;-</span> meses</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(datos, </span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">digits =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="tbl-EfectoEstacional" class="anchored">
<table class="table table-sm table-striped">
<caption>Tabla 1: Efecto estacional</caption>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">Pasajeros</th>
<th style="text-align: right;">Pasajeros por día laborable</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Ene</td>
<td style="text-align: right;">3.19</td>
<td style="text-align: right;">0.32</td>
</tr>
<tr class="even">
<td style="text-align: left;">Feb</td>
<td style="text-align: right;">-0.36</td>
<td style="text-align: right;">0.46</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Mar</td>
<td style="text-align: right;">17.71</td>
<td style="text-align: right;">0.47</td>
</tr>
<tr class="even">
<td style="text-align: left;">Abr</td>
<td style="text-align: right;">3.36</td>
<td style="text-align: right;">0.35</td>
</tr>
<tr class="odd">
<td style="text-align: left;">May</td>
<td style="text-align: right;">19.11</td>
<td style="text-align: right;">0.70</td>
</tr>
<tr class="even">
<td style="text-align: left;">Jun</td>
<td style="text-align: right;">6.30</td>
<td style="text-align: right;">0.17</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Jul</td>
<td style="text-align: right;">-15.09</td>
<td style="text-align: right;">-1.22</td>
</tr>
<tr class="even">
<td style="text-align: left;">Ago</td>
<td style="text-align: right;">-71.64</td>
<td style="text-align: right;">-3.51</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Sep</td>
<td style="text-align: right;">-7.75</td>
<td style="text-align: right;">-0.50</td>
</tr>
<tr class="even">
<td style="text-align: left;">Oct</td>
<td style="text-align: right;">27.60</td>
<td style="text-align: right;">1.05</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Nov</td>
<td style="text-align: right;">15.36</td>
<td style="text-align: right;">0.97</td>
</tr>
<tr class="even">
<td style="text-align: left;">Dic</td>
<td style="text-align: right;">2.20</td>
<td style="text-align: right;">0.74</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>La <a href="#tbl-EfectoEstacional">Tabla&nbsp;1</a> pone en cifras el efecto estacional sobre los Pasajeros (primera columna): en agosto la caída en el número de pasajeros, respecto de la media anual, se cifra en 72 millones de pasajeros. En julio, septiembre y en menor medida febrero también el uso del transporte urbano es inferior a la media anual, en el caso de los dos primeros meses por las vacaciones de verano y en febrero debido a ser el mes con menos días del año. Por otro lado, destaca el elevado número de pasajeros en los meses de marzo, mayo y octubre, por tener 31 días, y noviembre, por razones desconocidas.</p>
<p>Tras la corrección por el número de días laborales, el efecto estacional es más suave (véase la segunda columna en la <a href="#tbl-EfectoEstacional">Tabla&nbsp;1</a>). Ahora, los meses de febrero y marzo tienen un efecto similar, al igual que octubre y noviembre. También se observa que las diferencias entre marzo y abril se han reducido.</p>
<p><br>
</p>
</section>
</section>
<section id="descomposición-de-la-serie" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="descomposición-de-la-serie"><span class="header-section-number">2.3</span> Descomposición de la serie</h2>
<p>Ya hemos realizado una descripción detallada de las principales componentes de la serie, tendencia y estacionalidad. Ahora vamos a proceder a descomponerla a fin de analizar, aunque sea de forma gráfica, el error y tener ya una primera impresión sobre la relevancia de la componente de intervención en Pasajeros.</p>
<p>Dado que la serie presenta un esquema aditivo, usaremos el método de descomposición por regresiones locales ponderadas, asumiendo una componente estacional constante y considerando la presencia de posibles valores extremos.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>PasajerosStl <span class="ot">&lt;-</span> <span class="fu">stl</span>(Pasajeros[,<span class="dv">1</span>], </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">s.window =</span> <span class="st">"periodic"</span>, </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">robust =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>error <span class="ot">&lt;-</span> <span class="fu">remainder</span>(PasajerosStl)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>sderror <span class="ot">&lt;-</span> <span class="fu">sd</span>(error)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(error,</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"Error"</span>,</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>,</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">colour =</span> <span class="st">"darkblue"</span>) <span class="sc">+</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">2</span>, <span class="sc">-</span><span class="dv">2</span>, <span class="sc">-</span><span class="dv">3</span>)<span class="sc">*</span>sderror, </span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"green"</span>, <span class="st">"green"</span>, <span class="st">"red"</span>),</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>             <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span> <span class="fu">seq</span>(<span class="dv">1996</span>, <span class="dv">2020</span>, <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-ErrorDescomposicion1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="03-11-Ejemplo-Pasajeros_files/figure-html/fig-ErrorDescomposicion1-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
<p></p><figcaption class="figure-caption">Figura 5: Error + Intervención. Descomposición de Pasajeros</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>La <a href="#fig-ErrorDescomposicion1">Figura&nbsp;5</a> muestra el error de la descomposición y los intervalos de confianza al 95% (líneas verdes) y el 99.7% (líneas rojas). Se aprecian claramente múltiples valores extremos (superan las tres desviaciones típicas) en forma de <em>compensación</em> (dos errores extremos consecutivos de signo opuesto) que corresponden a los meses de marzo y abril de 1997, 2002, 2008 y 2013, y otro valor extremo en abril de 2005. Además, en marzo y abril de 2016 hay dos valores atípicos. Nótese que todos los valores identificados corresponden a los meses de marzo y abril, y en todos los casos el error negativo tiene lugar en marzo y el positivo en abril. Si miramos un calendario veremos que tienen lugar en los años en que Semana Santa cayó en marzo.</p>
<p>Si repetimos este análisis para la serie de Pasajeros por día laborable, los resultados son bien diferentes (véase <a href="#fig-ErrorDescomposicion2">Figura&nbsp;6</a>). Ahora solo se detectan dos valores extremos en diciembre de 2000 y 2006. También destaca el error de diciembre de 2017. Los errores en diciembre se dan cuando Navidad cae en lunes, de forma que la caída en el transporte urbano debida a la nochebuena coincide con la de cualquier domingo. Así, estos meses de diciembre presentan más transporte urbano que los meses de diciembre donde la nochebuena cae entre semana.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>PasajerosStl <span class="ot">&lt;-</span> <span class="fu">stl</span>(PasajerosDL[,<span class="dv">1</span>], </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">s.window =</span> <span class="st">"periodic"</span>, </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">robust =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>error <span class="ot">&lt;-</span> <span class="fu">remainder</span>(PasajerosStl)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>sderror <span class="ot">&lt;-</span> <span class="fu">sd</span>(error)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(error,</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"Error"</span>,</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>,</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">colour =</span> <span class="st">"darkblue"</span>) <span class="sc">+</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">2</span>, <span class="sc">-</span><span class="dv">2</span>, <span class="sc">-</span><span class="dv">3</span>)<span class="sc">*</span>sderror, </span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"green"</span>, <span class="st">"green"</span>, <span class="st">"red"</span>),</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>             <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span> <span class="fu">seq</span>(<span class="dv">1996</span>, <span class="dv">2020</span>, <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-ErrorDescomposicion2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="03-11-Ejemplo-Pasajeros_files/figure-html/fig-ErrorDescomposicion2-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
<p></p><figcaption class="figure-caption">Figura 6: Error + Intervención. Descomposición de Pasajeros por día laborable</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Para la identificación de los valores extremos se ha hecho uso de las funciones <code>easter</code> del paquete <code>forecast</code> y <code>dayOfWeek</code> del paquete <code>timeDate</code>.</p>
<p><br>
</p>
</section>
<section id="conclusión" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="conclusión"><span class="header-section-number">2.4</span> Conclusión</h2>
<p>La serie de pasajeros en transporte urbano muestra una tendencia creciente solo interrumpida entre 2008 y 2013 debido a la Gran Recesión.</p>
<p>Los principales determinantes de la estacionalidad de la serie Pasajeros son los grandes periodos vacacionales en España (Semana Santa y verano) y el número de días laborales del mes. Así, en la serie Pasajeros corregida por días laborables la componente estacional se ha suavizado y prácticamente queda determinada por las vacaciones.</p>
<p>La intervención tiene lugar en los meses de marzo y abril debido al carácter móvil de la Semana Santa, y en diciembre cuando el día de Navidad cae en lunes de forma que la caída de pasajeros de nochebuena se solapa con la de cualquier domingo.</p>
<p><br>
<br>
</p>
</section>
</section>
<section id="un-predicción-rápida-y-sencilla" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Un predicción rápida y sencilla</h1>
<p>En los siguientes epígrafes aplicaremos técnicas de predicción crecientes en complejidad conceptual y computacional, y que requerirán de más hipótesis para su correcta aplicación. Aunque actualmente más complejidad no siempre implica más recursos (temporales, humanos, informáticos), cabe preguntarse si vale la pena. Así, más por una cuestión teórica que práctica, veamos cual sería la calidad de las predicciones si aplicamos una metodología sencilla, en este caso el método ingenuo con estacionalidad.</p>
<div class="cell" data-layout-align="center">

</div>
<p>Los indicadores de calidad de ajuste (predicción intramuestral a un periodo vista) indican que repetir la última observación del mismo mes puede ser suficiente para obtener una buena predicción a corto plazo. En media el error es de 11 millones de pasajeros (RMSE), o un 3.5%. A largo plazo, las predicciones pueden perder calidad rápidamente puesto que no capturan ningún tipo de tendencia. La <a href="#fig-Sencillo">Figura&nbsp;7</a> muestra como la predicción del número de pasajeros para los años 2020 a 2024 se mantiene estacionaria y no refleja la tendencia creciente observada desde 2014.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>PasajerosSnaive <span class="ot">&lt;-</span> <span class="fu">snaive</span>(Pasajeros, </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>                          <span class="at">h =</span> <span class="dv">60</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(PasajerosSnaive)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   ME     RMSE      MAE       MPE     MAPE MASE        ACF1
Training set 2.377978 10.96492 8.260812 0.9534372 3.509156    1 -0.01034773</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(PasajerosSnaive, </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">PI =</span> <span class="cn">FALSE</span>,</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"Millones de pasajeros"</span>,</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span> <span class="fu">seq</span>(<span class="dv">1996</span>, <span class="dv">2024</span>, <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-Sencillo" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="03-11-Ejemplo-Pasajeros_files/figure-html/fig-Sencillo-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
<p></p><figcaption class="figure-caption">Figura 7: Pasajeros (1996-2019) y predicción (2020-2024). Método ingenuo con estacionalidad</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Este será nuestro punto de referencia. Cabe esperar que en los siguientes epígrafes, donde aplicaremos técnicas de Alisado exponencial y modelos ARIMA, se observe un incremento significativo en la calidad del ajuste.</p>
<p><br>
<br>
</p>
</section>
<section id="alisado-exponencial" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Alisado Exponencial</h1>
<p>En primer lugar analizaremos la capacidad predictiva de los métodos de Alisado exponencial sobre la serie Pasajeros. Con este fin, ajustaremos el mejor modelo de alisado y estimaremos los criterios de calidad para el ajuste y las predicciones extramuestrales según el horizonte temporal. Posteriormente veremos si es posible mejorar las predicciones aplicando la transformación logarítmica a Pasajeros y analizando la serie Pasajeros por día laborable.</p>
<p><br>
</p>
<section id="análisis-de-la-serie-pasajeros" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="análisis-de-la-serie-pasajeros"><span class="header-section-number">4.1</span> Análisis de la serie Pasajeros</h2>
<p><br>
</p>
<section id="estimación-e-interpretación" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="estimación-e-interpretación">Estimación e interpretación</h3>
<p>El modelo óptimo, estimado con la función <code>ets</code> sin imponer ninguna restricción, es ETS(M,Ad,A): pendiente aditiva con amortiguamiento, estacionalidad aditiva y residuo multiplicativo. <span class="math display">\[y_{t+1} = (l_t + \phi b_t + s_{t+1-m}) \cdot (1 + \varepsilon_{t+1}).\]</span></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>PasajerosEts <span class="ot">&lt;-</span> <span class="fu">ets</span>(Pasajeros)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(PasajerosEts) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ETS(M,Ad,A) 

Call:
 ets(y = Pasajeros) 

  Smoothing parameters:
    alpha = 0.1374 
    beta  = 0.017 
    gamma = 1e-04 
    phi   = 0.9438 

  Initial states:
    l = 203.1964 
    b = -0.4508 
    s = 2.0753 14.0423 27.0229 -8.7953 -72.369 -15.0625
           6.6935 19.5129 4.2863 18.0168 0.373 4.2039

  sigma:  0.0333

     AIC     AICc      BIC 
2823.866 2826.408 2889.799 

Training set error measures:
                    ME     RMSE      MAE       MPE     MAPE      MASE
Training set 0.5929553 7.492818 5.654414 0.1765693 2.447442 0.6844865
                   ACF1
Training set -0.1434247</code></pre>
</div>
</div>
<p>El valor de <span class="math inline">\(\phi=\)</span> 0.94 indica que la inclusión de amortiguamiento en el modelo mejora sensiblemente su ajuste a los datos. Por otro lado, <span class="math inline">\(\gamma\)</span> es técnicamente cero, indicando que el efecto estacional se mantiene constante en el tiempo. Sin embargo, el valor de <span class="math inline">\(\beta\)</span>, reducido pero no nulo, indica que la pendiente cambia en el tiempo de forma muy lenta.</p>
<p>La calidad del ajuste es bastante buena, con un error porcentual del 2.4% o un error de 7.5 millones de pasajeros (RMSE). La aplicación del método de alisado supone una reducción de un punto en el error porcentual respecto del método ingenuo, o una reducción de 3.5 millones de pasajeros. Es decir, el modelo de alisado exponencial supone una mejora en la calidad del ajuste del 32% respecto del método ingenuo con estacionalidad visto en el epígrafe previo (MASE). El indicador ACF1 revela que las fórmulas usadas para el intervalo de confianza no son válidas.</p>
<p>El efecto estacional, que recordemos se mantiene constante en el tiempo, es prácticamente idéntico al estimado en la descriptiva y viene determinado por los periodos vacacionales y el número de días del mes (y por consiguiente el número de días laborables). Véase la <a href="#fig-AlisadoComponente">Figura&nbsp;8</a>.</p>
<p>En verano (julio a septiembre) el uso del transporte urbano es inferior a la media anual, destacando agosto con un descenso de 72 millones de pasajeros. Por el contrario, octubre destaca por ser el mes con mayor incremento en el volumen de pasajeros (27 millones) respecto de la media anual.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>PasajerosEtsEst <span class="ot">&lt;-</span> PasajerosEts<span class="sc">$</span>states[<span class="fu">nrow</span>(PasajerosEts<span class="sc">$</span>states), <span class="dv">14</span><span class="sc">:</span><span class="dv">3</span>]</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(PasajerosEtsEst) <span class="ot">&lt;-</span> meses</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(PasajerosEtsEst, <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Ene    Feb    Mar    Abr    May    Jun    Jul    Ago    Sep    Oct    Nov 
  4.21   0.37  18.02   4.29  19.51   6.69 -15.06 -72.37  -8.79  27.02  14.04 
   Dic 
  2.07 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">y =</span> PasajerosEtsEst), <span class="at">colour =</span> <span class="st">"darkblue"</span>) <span class="sc">+</span> </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Efecto estacional"</span>) <span class="sc">+</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, </span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> meses)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-AlisadoComponente" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="03-11-Ejemplo-Pasajeros_files/figure-html/fig-AlisadoComponente-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
<p></p><figcaption class="figure-caption">Figura 8: Componente estacional estimada con Alisado exponencial</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p><br>
</p>
</section>
<section id="predicción" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="predicción">Predicción</h3>
<p>Podemos ahora pedir los valores de predicción para los próximos cinco años. No mostramos los resultados numéricos, pero si gráficos (<a href="#fig-AlisadoPrediccion">Figura&nbsp;9</a>). Las predicciones muestran una tendencia creciente amortiguada y, por tanto, no tan acusada como la observada en los años precedentes.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>PasajerosEtsPre <span class="ot">&lt;-</span> <span class="fu">forecast</span>(PasajerosEts, </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>                            <span class="at">h =</span> <span class="dv">60</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(PasajerosEtsPre,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"Millones de pasajeros"</span>,</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">PI =</span> <span class="cn">FALSE</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-AlisadoPrediccion" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="03-11-Ejemplo-Pasajeros_files/figure-html/fig-AlisadoPrediccion-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
<p></p><figcaption class="figure-caption">Figura 9: Pasajeros (1996-2019) y predicción (2020-2024). Método de Alisado Exponencial</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>En el año 2020 se esperan 3153 millones de pasajeros, un 1.6% más que en 2019.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
<p><br>
</p>
</section>
<section id="análisis-del-error" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="análisis-del-error">Análisis del error</h3>
<p>El residuo del modelo (<a href="#fig-AlisadoError">Figura&nbsp;10</a>) muestra varios valores que pueden ser considerados como atípicos y que se dan siempre en los meses de marzo y abril para los años donde la Semana Santa recayó en marzo.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>error <span class="ot">&lt;-</span> <span class="fu">residuals</span>(PasajerosEts)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>sderror <span class="ot">&lt;-</span> <span class="fu">sd</span>(error)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(error,</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"Error"</span>,</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>,</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">colour =</span> <span class="st">"darkblue"</span>) <span class="sc">+</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span> ,<span class="dv">3</span>)<span class="sc">*</span>sderror, </span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"green"</span>, <span class="st">"green"</span>, <span class="st">"red"</span>), <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span> <span class="fu">seq</span>(<span class="dv">1996</span>, <span class="dv">2020</span>, <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-AlisadoError" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="03-11-Ejemplo-Pasajeros_files/figure-html/fig-AlisadoError-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
<p></p><figcaption class="figure-caption">Figura 10: Error + Intervención. Método de Alisado Exponencial</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p><br>
</p>
</section>
</section>
<section id="otras-alternativas-de-análisis" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="otras-alternativas-de-análisis"><span class="header-section-number">4.2</span> Otras alternativas de análisis</h2>
<p>En la descriptiva se ha visto que la serie de pasajeros por día laborable tiene un comportamiento más suave (la componente estacional era más plana) y presentaba un menor número de valores atípicos que la serie original Pasajeros. Cabe esperar, por tanto, que esta serie presente un mejor ajuste con los métodos de Alisado Exponencial y ofrezca mejores predicciones.</p>
<p>Por otro lado, siempre vale la pena analizar la transformación logarítmica de la serie y ver si ofrece mejores resultados que la serie original. La transformación logarítmica es especialmente eficaz para series no lineales, así que para Pasajeros posiblemente no suponga ningún mejora.</p>
<p>Las transformaciones indicadas en los dos párrafos precedentes son solo dos de las posibles. También se pude analizar la serie de pasajeros por día del mes o la transformación óptima de Box-Cox. La idea es no quedarse con lo inmediato –la serie tal cual nos la han ofrecido–, sino probar otras alternativas. Por ejemplo, la serie de Pasajeros es el agregado del número de pasajeros que viajan en transporte urbano según el tipo de transporte (autobús, metro, tranvía…). Se podría proceder a analizar cada serie por separado (pasajeros en autobús, pasajeros en metro, etc.), para luego agregar los resultados y ver si este enfoque da mejores resultados que el análisis directo de la serie agregada Pasajeros.</p>
<p>En este epígrafe se analizarán tres de las transformaciones indicadas: la transformación logarítmica, los pasajeros por día laborable y los pasajeros por día del mes. El objetivo es ver si es posible mejorar la calidad de las predicciones obtenidas para Pasajeros. Se usará como criterio de bondad el error de las predicciones extramuestrales según el horizonte temporal, obtenido con el procedimiento <em>origen de predicción móvil</em>. Asumiremos que son necesarios 12 años para obtener una buena estimación del modelo y el horizonte temporal se fijará en 12 meses (<span class="math inline">\(k = 144, h = 12\)</span>). Previamente, hay que crear la serie Pasajeros por día del mes, e identificar el mejor modelo para las series transformadas.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>PasajerosDM <span class="ot">&lt;-</span> Pasajeros<span class="sc">/</span><span class="fu">monthdays</span>(Pasajeros)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ets</span>(Pasajeros, <span class="at">lambda =</span> <span class="dv">0</span>)<span class="sc">$</span>method</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "ETS(A,Ad,A)"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ets</span>(PasajerosDL)<span class="sc">$</span>method</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "ETS(M,Ad,A)"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ets</span>(PasajerosDM)<span class="sc">$</span>method</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "ETS(A,Ad,A)"</code></pre>
</div>
</div>
<p><br>
</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">144</span>                 </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>h <span class="ot">&lt;-</span> <span class="dv">12</span>                  </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>TT <span class="ot">&lt;-</span> <span class="fu">length</span>(Pasajeros)  </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> TT <span class="sc">-</span> k <span class="sc">-</span> h          </span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>mapeAlisadoPas <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, s <span class="sc">+</span> <span class="dv">1</span>, h)</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>mapeAlisadolPas <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, s <span class="sc">+</span> <span class="dv">1</span>, h)</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>mapeAlisadoPasDL <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, s <span class="sc">+</span> <span class="dv">1</span>, h)</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>mapeAlisadoPasDM <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, s <span class="sc">+</span> <span class="dv">1</span>, h)</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">0</span><span class="sc">:</span>s) {</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>  train.set <span class="ot">&lt;-</span> <span class="fu">subset</span>(Pasajeros, <span class="at">start =</span> i <span class="sc">+</span> <span class="dv">1</span>, <span class="at">end =</span> i <span class="sc">+</span> k)</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>  test.set <span class="ot">&lt;-</span>  <span class="fu">subset</span>(Pasajeros, <span class="at">start =</span> i <span class="sc">+</span> k <span class="sc">+</span> <span class="dv">1</span>, <span class="at">end =</span> i <span class="sc">+</span> k <span class="sc">+</span> h)</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>  trainDL.set <span class="ot">&lt;-</span> <span class="fu">subset</span>(PasajerosDL, <span class="at">start =</span> i <span class="sc">+</span> <span class="dv">1</span>, <span class="at">end =</span> i <span class="sc">+</span> k)</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>  testDL.set <span class="ot">&lt;-</span>  <span class="fu">subset</span>(PasajerosDL, <span class="at">start =</span> i <span class="sc">+</span> k <span class="sc">+</span> <span class="dv">1</span>, <span class="at">end =</span> i <span class="sc">+</span> k <span class="sc">+</span> h)</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>  trainDM.set <span class="ot">&lt;-</span> <span class="fu">subset</span>(PasajerosDM, <span class="at">start =</span> i <span class="sc">+</span> <span class="dv">1</span>, <span class="at">end =</span> i <span class="sc">+</span> k)</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>  testDM.set <span class="ot">&lt;-</span>  <span class="fu">subset</span>(PasajerosDM, <span class="at">start =</span> i <span class="sc">+</span> k <span class="sc">+</span> <span class="dv">1</span>, <span class="at">end =</span> i <span class="sc">+</span> k <span class="sc">+</span> h)</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>  fit <span class="ot">&lt;-</span> <span class="fu">ets</span>(train.set, <span class="at">model =</span> <span class="st">"MAA"</span>, <span class="at">damped =</span> <span class="cn">TRUE</span>)</span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>  fcast <span class="ot">&lt;-</span> <span class="fu">forecast</span>(fit, <span class="at">h =</span> h)</span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>  mapeAlisadoPas[i <span class="sc">+</span> <span class="dv">1</span>,] <span class="ot">&lt;-</span> <span class="dv">100</span><span class="sc">*</span><span class="fu">abs</span>(test.set <span class="sc">-</span> fcast<span class="sc">$</span>mean)<span class="sc">/</span>test.set</span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>  fit <span class="ot">&lt;-</span> <span class="fu">ets</span>(train.set, <span class="at">model =</span> <span class="st">"AAA"</span>, <span class="at">damped =</span> <span class="cn">TRUE</span>, <span class="at">lambda =</span> <span class="dv">0</span>)</span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>  fcast <span class="ot">&lt;-</span> <span class="fu">forecast</span>(fit, <span class="at">h =</span> h)</span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a>  mapeAlisadolPas[i <span class="sc">+</span> <span class="dv">1</span>,] <span class="ot">&lt;-</span> <span class="dv">100</span><span class="sc">*</span><span class="fu">abs</span>(test.set <span class="sc">-</span> fcast<span class="sc">$</span>mean)<span class="sc">/</span>test.set</span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a>  fit <span class="ot">&lt;-</span> <span class="fu">ets</span>(trainDL.set, <span class="at">model =</span> <span class="st">"MAA"</span>, <span class="at">damped =</span> <span class="cn">TRUE</span>)</span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a>  fcast <span class="ot">&lt;-</span> <span class="fu">forecast</span>(fit, <span class="at">h =</span> h)</span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a>  mapeAlisadoPasDL[i <span class="sc">+</span> <span class="dv">1</span>,] <span class="ot">&lt;-</span> <span class="dv">100</span><span class="sc">*</span><span class="fu">abs</span>(testDL.set <span class="sc">-</span> fcast<span class="sc">$</span>mean)<span class="sc">/</span>testDL.set</span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a>  fit <span class="ot">&lt;-</span> <span class="fu">ets</span>(trainDM.set, <span class="at">model =</span> <span class="st">"AAA"</span>, <span class="at">damped =</span> <span class="cn">TRUE</span>)</span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a>  fcast <span class="ot">&lt;-</span> <span class="fu">forecast</span>(fit, <span class="at">h =</span> h)</span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a>  mapeAlisadoPasDM[i <span class="sc">+</span> <span class="dv">1</span>,] <span class="ot">&lt;-</span> <span class="dv">100</span><span class="sc">*</span><span class="fu">abs</span>(testDM.set <span class="sc">-</span> fcast<span class="sc">$</span>mean)<span class="sc">/</span>testDM.set</span>
<span id="cb30-36"><a href="#cb30-36" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-37"><a href="#cb30-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-38"><a href="#cb30-38" aria-hidden="true" tabindex="-1"></a>errorAlisadoPas <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(mapeAlisadoPas)</span>
<span id="cb30-39"><a href="#cb30-39" aria-hidden="true" tabindex="-1"></a>errorAlisadolPas <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(mapeAlisadolPas)</span>
<span id="cb30-40"><a href="#cb30-40" aria-hidden="true" tabindex="-1"></a>errorAlisadoPasDL <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(mapeAlisadoPasDL)</span>
<span id="cb30-41"><a href="#cb30-41" aria-hidden="true" tabindex="-1"></a>errorAlisadoPasDM <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(mapeAlisadoPasDM)</span>
<span id="cb30-42"><a href="#cb30-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-43"><a href="#cb30-43" aria-hidden="true" tabindex="-1"></a>datos <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb30-44"><a href="#cb30-44" aria-hidden="true" tabindex="-1"></a>  <span class="at">factor =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"Pasajeros"</span>, <span class="dv">12</span>), </span>
<span id="cb30-45"><a href="#cb30-45" aria-hidden="true" tabindex="-1"></a>             <span class="fu">rep</span>(<span class="st">"Pasajeros por día laborable"</span>, <span class="dv">12</span>), </span>
<span id="cb30-46"><a href="#cb30-46" aria-hidden="true" tabindex="-1"></a>             <span class="fu">rep</span>(<span class="st">"Pasajeros por día del mes"</span>, <span class="dv">12</span>), </span>
<span id="cb30-47"><a href="#cb30-47" aria-hidden="true" tabindex="-1"></a>             <span class="fu">rep</span>(<span class="st">"Pasajeros (log)"</span>, <span class="dv">12</span>)),</span>
<span id="cb30-48"><a href="#cb30-48" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>),</span>
<span id="cb30-49"><a href="#cb30-49" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">c</span>(errorAlisadoPas, errorAlisadoPasDL, errorAlisadoPasDM, errorAlisadolPas)</span>
<span id="cb30-50"><a href="#cb30-50" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(datos, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y,  <span class="at">colour=</span> factor)) <span class="sc">+</span> </span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Horizonte temporal de predicción"</span>) <span class="sc">+</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"%"</span>) <span class="sc">+</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks=</span> <span class="fu">seq</span>(<span class="fl">2.6</span>, <span class="dv">4</span>, .<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">colour =</span> <span class="st">"Métodos"</span>) <span class="sc">+</span> </span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="fu">c</span>(<span class="fl">0.15</span>,<span class="fl">0.7</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-AlisadoErrorOPM" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="03-11-Ejemplo-Pasajeros_files/figure-html/fig-AlisadoErrorOPM-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
<p></p><figcaption class="figure-caption">Figura 11: Error de predicción (MAPE) según horizonte temporal y enfoque. Método de Alisado Exponencial</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Antes de pasar al análisis de los resultados, indicar que en las predicciones sobre el logaritmo no se ha pedido corrección por sesgo, y que al trabajar con errores porcentuales no es necesario pasar la predicción de pasajeros por día (laborable o del mes) a predicción de pasajeros.</p>
<p>La <a href="#fig-AlisadoErrorOPM">Figura&nbsp;11</a> muestra los errores de predicción según el horizonte temporal para las tres aproximaciones. En todos los casos el error aumenta con el horizonte temporal de predicción, de forma que las predicciones a doce meses vista tienen un error un punto porcentual superior a las predicciones a un mes vista.</p>
<p>Por otro lado, para horizontes temporales de hasta 8 meses vista las predicciones realizadas sobre el logaritmo de la serie original Pasajeros son las más ajustadas. Para predicciones de 9 a 12 meses, las mejores predicciones se obtienen con Pasajeros por día del mes, seguidas de las predicciones realizadas sobre la serie sin transformar. En contra de lo esperado, la predicción a partir de la serie de pasajeros por día laborable es la que mayor error porcentual presenta.</p>
<p><br>
</p>
</section>
<section id="conclusión-1" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="conclusión-1"><span class="header-section-number">4.3</span> Conclusión</h2>
<p>Los modelos de Alisado Exponencial resultan excelentes para predecir la serie Pasajeros. El error de ajuste, del 2.4%, es un punto inferior al error obtenido con el método ingenuo con estacionalidad. Además, en las predicciones extramuestrales a 12 meses vista el error porcentual sigue manteniéndose bajo, no superando el 4%.</p>
<p>La transformación logarítmica de la serie pasajeros y la serie Pasajeros por día del mes han dado mejores predicciones por Alisado Exponencial que el análisis directo de la serie.</p>
<p><br>
<br>
</p>
</section>
</section>
<section id="modelos-arima" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Modelos Arima</h1>
<p>La aplicación de la metodología ARIMA a la serie Pasajeros implica un notable incremento en la complejidad de los modelos y en los requerimientos estadísticos, que solo está justificada si se reduce sustancialmente el error de predicción.</p>
<p>En los epígrafes previos hemos visto que la serie Pasajeros tiene una componente de intervención muy acusada, destacando el número de días del mes, el de días laborables, el fechado de la Semana Santa y que el día de Navidad caiga en lunes. Cabe espera, por tanto, que la incorporación de estos efectos calendario en el análisis de la serie incremente significativamente la calidad de ajuste y la capacidad predictiva. Veamos si es así.</p>
<p><br>
</p>
<section id="transformación-de-la-serie-pasajeros" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="transformación-de-la-serie-pasajeros"><span class="header-section-number">5.1</span> Transformación de la serie Pasajeros</h2>
<p>Por un lado, el análisis por Alisado Exponencial ha puesto de relieve el carácter lineal de Pasajeros y la efectividad que podría tener usar la transformación logarítmica para mejorar la calidad de las predicciones.</p>
<p>Por otro lado, tras un análisis preliminar por modelos ARIMA se puede ver que la transformación logarítmica mejora la identificación del modelo y facilitaba su interpretación.</p>
<p>Así, optamos por aplicar la transformación logarítmica a Pasajeros.</p>
<p>Las FAC del logaritmo de la serie y algunas de sus diferenciaciones (<a href="#fig-PasajerosFAC">Figura&nbsp;12</a>) indican que es necesaria la doble diferenciación regular y estacional para alcanzar las hipótesis de estacionariedad y ergodicidad: <span class="math inline">\(\log(Pasajeros) \sim I(1)I_{12}(1)\)</span>. Los resultados ofrecidos por las funciones <code>ndiffs</code> y <code>nsdiffs</code> apoyan esta conclusión.</p>
<div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggAcf</span>(<span class="fu">log</span>(Pasajeros), <span class="at">lag =</span> <span class="dv">48</span>, <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">ylab =</span> <span class="st">""</span>, <span class="at">main =</span> <span class="st">""</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggAcf</span>(<span class="fu">diff</span>(<span class="fu">log</span>(Pasajeros)), <span class="at">lag =</span> <span class="dv">48</span>, <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">ylab =</span> <span class="st">""</span>, <span class="at">main =</span> <span class="st">""</span>)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggAcf</span>(<span class="fu">diff</span>(<span class="fu">log</span>(Pasajeros), <span class="at">lag =</span> <span class="dv">12</span>), <span class="at">lag =</span> <span class="dv">48</span>, <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">ylab =</span> <span class="st">""</span>, <span class="at">main =</span> <span class="st">""</span>)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggAcf</span>(<span class="fu">diff</span>(<span class="fu">diff</span>(<span class="fu">log</span>(Pasajeros), <span class="at">lag=</span><span class="dv">12</span>)), <span class="at">lag =</span> <span class="dv">48</span>, <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">ylab =</span> <span class="st">""</span>, <span class="at">main =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-PasajerosFAC" class="cell quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-PasajerosFAC-1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="03-11-Ejemplo-Pasajeros_files/figure-html/fig-PasajerosFAC-1.png" class="img-fluid figure-img" data-ref-parent="fig-PasajerosFAC"></p>
<p></p><figcaption class="figure-caption">(a) Log serie</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-PasajerosFAC-2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="03-11-Ejemplo-Pasajeros_files/figure-html/fig-PasajerosFAC-2.png" class="img-fluid figure-img" data-ref-parent="fig-PasajerosFAC"></p>
<p></p><figcaption class="figure-caption">(b) Dif. regular log serie</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-PasajerosFAC-3" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="03-11-Ejemplo-Pasajeros_files/figure-html/fig-PasajerosFAC-3.png" class="img-fluid figure-img" data-ref-parent="fig-PasajerosFAC"></p>
<p></p><figcaption class="figure-caption">(c) Dif. estacional log serie</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-PasajerosFAC-4" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="03-11-Ejemplo-Pasajeros_files/figure-html/fig-PasajerosFAC-4.png" class="img-fluid figure-img" data-ref-parent="fig-PasajerosFAC"></p>
<p></p><figcaption class="figure-caption">(d) Dif. regular y estacional log serie</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p></p><figcaption class="figure-caption">Figura 12: FAC para Pasajeros</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ndiffs</span>(<span class="fu">log</span>(Pasajeros))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nsdiffs</span>(<span class="fu">log</span>(Pasajeros))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
</div>
<p>La <a href="#fig-PasajerosyTransformacion">Figura&nbsp;13</a> muestra la serie original <span class="math inline">\(y_t\)</span> y la serie transformada <span class="math inline">\(\nabla \nabla_{12} \log(y_t)\)</span>. En la serie transformada destacan las compensaciones asociadas a la intervención de Semana Santa.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>series <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="st">"Original"</span> <span class="ot">=</span> Pasajeros,</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Dif reg. y est. de log"</span> <span class="ot">=</span> <span class="fu">diff</span>(<span class="fu">diff</span>(<span class="fu">log</span>(Pasajeros), <span class="at">lag =</span> <span class="dv">12</span>)))</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(series, <span class="at">facets =</span> <span class="cn">TRUE</span>,</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">""</span>,</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-PasajerosyTransformacion" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="03-11-Ejemplo-Pasajeros_files/figure-html/fig-PasajerosyTransformacion-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
<p></p><figcaption class="figure-caption">Figura 13: Serie original de Pasajeros y su transformación</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p><br>
</p>
</section>
<section id="identificación-de-la-serie-pasajeros" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="identificación-de-la-serie-pasajeros"><span class="header-section-number">5.2</span> Identificación de la serie Pasajeros</h2>
<p>Vamos a identificar los valores de <span class="math inline">\(p\)</span>, <span class="math inline">\(q\)</span>, <span class="math inline">\(P\)</span> y <span class="math inline">\(Q\)</span> del proceso ARIMA. Para ello, solicitaremos con <code>auto.arima</code> y <code>seas</code> una identificación automática, en el primer caso incluyendo todos los efectos calendario ya identificados.</p>
<p><br>
</p>
<section id="identificación-automática-con-auto.arima" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="identificación-automática-con-auto.arima">Identificación automática con <code>auto.arima</code></h3>
<p>Para <em>ayudar</em> a la función <code>auto.arima</code> en el proceso de identificación vamos a definir previamente todas las variables de intervención que en el desarrollo del análisis de la serie hemos ido identificando: días del mes, días laborables del mes, meses de diciembre con el día de Navidad en lunes y Semana Santa:</p>
<ul>
<li>La variables <em>días laborables del mes</em> ya ha sido definida previamente como DiasLaborables.</li>
<li>La variable <em>Días del mes</em> se puede definir directamente con la función <code>monthdays</code> de la librería <code>forecast</code>. En lugar de días del mes, consideraremos la variable <em>días no laborables del mes</em>, resultante de restar a los días del mes los días laborables.</li>
<li>Los meses de diciembre en que el día de Navidad cae en lunes requiere un poco más de trabajo. La idea general es generar un rango de fechas diarias que cubra todo el periodo de análisis (variable <em>fechas</em>), identificar los lunes de Navidad (variable dicotómica <em>lunesNavidad</em>), eliminar el identificador del día del rango de fechas con la función <code>format</code> y, por último, con <code>tapply</code> sumar para cada mes-año los lunes de Navidad, que lógicamente solo tendrán lugar algunos meses de diciembre y una sola vez. En los objetos definidos con la función <code>as.POSIXlt</code> los meses van de 0 a 11 (enero a diciembre) y los días de la semana de 0 a 6 (domingo a sábado).</li>
<li>La creación de las variables de intervención que estiman el efecto de la Semana Santa es aún más complejo. El efecto del viernes de Semana Santa ya queda recogido en la variable DiasNoLaborables. Lo que vamos a hacer ahora es crear una variable que permita estimar el efecto de las vacaciones escolares (y de muchos padres y madres) de lunes a Jueves Santo en aquellas comunidades donde así es; y otra variable para estimar el efecto de las vacaciones escolares que tienen lugar la semana posterior al Domingo de Resurrección, de lunes a viernes tras Semana Santa. Estas nuevas variables (<em>DiasPreSanta</em> y <em>DiasPascua</em>) valdrán cero para los meses distintos de marzo y abril, pero para marzo y abril valdrán la proporción de días vacacionales que recaen en el correspondiente mes.</li>
</ul>
<p><strong>Días no laborables</strong></p>
<p>Generamos la variables para DiasNoLaborables y se muestra su valor para los últimos 5 años.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>DiasNoLaborables <span class="ot">&lt;-</span> <span class="fu">monthdays</span>(DiasLaborables) <span class="sc">-</span> DiasLaborables</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>pDiasNoLaborables <span class="ot">&lt;-</span> <span class="fu">monthdays</span>(pDiasLaborables) <span class="sc">-</span> pDiasLaborables</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(DiasNoLaborables, <span class="at">n =</span> <span class="dv">60</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec
2015  11   8   9   9  11   8   8  10   8  10   9  10
2016  12   8   9   9   9   8  10   9   8  11   9  11
2017  10   8   8  11   9   8  10   9   9  10   9  13
2018   9   8  10   9   9   9   9   9  10   9   9  12
2019   9   8  10   9   9  10   8  10   9   8  10  11</code></pre>
</div>
</div>
<p><strong>Navidad cae en lunes</strong></p>
<p>Generamos la variable que identifica los mes de diciembre en los que la Navidad cayó en lunes.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>fechas <span class="ot">&lt;-</span> <span class="fu">as.POSIXlt</span>(<span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">as.Date</span>(<span class="st">"1996-1-1"</span>), </span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">to =</span> <span class="fu">as.Date</span>(<span class="st">"2024-12-31"</span>), </span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">by =</span> <span class="dv">1</span>))</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>LunesNavidad <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">*</span>(fechas<span class="sc">$</span>wday <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> fechas<span class="sc">$</span>mon <span class="sc">==</span> <span class="dv">11</span> <span class="sc">&amp;</span> fechas<span class="sc">$</span>mday <span class="sc">==</span> <span class="dv">25</span>)</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>fechas <span class="ot">&lt;-</span> <span class="fu">format</span>(fechas, <span class="at">format =</span> <span class="st">"%Y-%m"</span>)</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>LunesNavidad <span class="ot">&lt;-</span> <span class="fu">tapply</span>(LunesNavidad, fechas, sum)</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>LunesNavidad <span class="ot">&lt;-</span> <span class="fu">ts</span>(LunesNavidad, <span class="at">start =</span> <span class="dv">1996</span>, <span class="at">frequency =</span> <span class="dv">12</span>)</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>pLunesNavidad <span class="ot">&lt;-</span> <span class="fu">subset</span>(LunesNavidad, <span class="at">start =</span> <span class="fu">length</span>(LunesNavidad) <span class="sc">-</span> <span class="dv">59</span>)</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>LunesNavidad <span class="ot">&lt;-</span> <span class="fu">subset</span>(LunesNavidad, <span class="at">end =</span> <span class="fu">length</span>(LunesNavidad) <span class="sc">-</span> <span class="dv">60</span>)</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>LunesNavidad[LunesNavidad <span class="sc">==</span> <span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2000-12 2006-12 2017-12 
      1       1       1 </code></pre>
</div>
</div>
<p><strong>Semana Santa</strong></p>
<p>Se generan las variables <em>DiasPreSanta</em> y <em>DiasPascua</em> y se muestra su valor para los últimos 5 años.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>LunSanto <span class="ot">&lt;-</span> <span class="fu">Easter</span>(<span class="dv">1996</span><span class="sc">:</span><span class="dv">2024</span>, <span class="at">shift =</span> <span class="sc">-</span><span class="dv">6</span>)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>MarSanto <span class="ot">&lt;-</span> <span class="fu">Easter</span>(<span class="dv">1996</span><span class="sc">:</span><span class="dv">2024</span>, <span class="at">shift =</span> <span class="sc">-</span><span class="dv">5</span>)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>MieSanto <span class="ot">&lt;-</span> <span class="fu">Easter</span>(<span class="dv">1996</span><span class="sc">:</span><span class="dv">2024</span>, <span class="at">shift =</span> <span class="sc">-</span><span class="dv">4</span>)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>JueSanto <span class="ot">&lt;-</span> <span class="fu">Easter</span>(<span class="dv">1996</span><span class="sc">:</span><span class="dv">2024</span>, <span class="at">shift =</span> <span class="sc">-</span><span class="dv">3</span>)</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>PreSanta <span class="ot">&lt;-</span> <span class="fu">c</span>(LunSanto, MarSanto, MieSanto, JueSanto)</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>biz <span class="ot">&lt;-</span> fechaDiaria[<span class="fu">isBizday</span>(fechaDiaria, <span class="at">holidays =</span> PreSanta, <span class="at">wday =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">6</span>)]</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>bizdays <span class="ot">&lt;-</span> <span class="fu">format</span>(biz, <span class="at">format =</span> <span class="st">"%Y-%m"</span>)</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>DiasPreSanta <span class="ot">&lt;-</span> <span class="fu">table</span>(bizdays)</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>DiasPreSanta <span class="ot">&lt;-</span> <span class="fu">ts</span>(DiasPreSanta, <span class="at">start =</span> <span class="dv">1996</span>, <span class="at">frequency =</span> <span class="dv">12</span>)</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>DiasPreSanta <span class="ot">&lt;-</span> (<span class="fu">monthdays</span>(DiasPreSanta) <span class="sc">-</span> DiasPreSanta)<span class="sc">/</span><span class="dv">4</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>pDiasPreSanta <span class="ot">&lt;-</span> <span class="fu">subset</span>(DiasPreSanta, <span class="at">start =</span> <span class="fu">length</span>(DiasPreSanta) <span class="sc">-</span> <span class="dv">59</span>)</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>DiasPreSanta <span class="ot">&lt;-</span> <span class="fu">subset</span>(DiasPreSanta, <span class="at">end =</span> <span class="fu">length</span>(DiasPreSanta) <span class="sc">-</span> <span class="dv">60</span>)</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>LunPascua <span class="ot">&lt;-</span> <span class="fu">Easter</span>(<span class="dv">1996</span><span class="sc">:</span><span class="dv">2024</span>, <span class="at">shift =</span> <span class="dv">1</span>)</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>MarPascua <span class="ot">&lt;-</span> <span class="fu">Easter</span>(<span class="dv">1996</span><span class="sc">:</span><span class="dv">2024</span>, <span class="at">shift =</span> <span class="dv">2</span>)</span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>MiePascua <span class="ot">&lt;-</span> <span class="fu">Easter</span>(<span class="dv">1996</span><span class="sc">:</span><span class="dv">2024</span>, <span class="at">shift =</span> <span class="dv">3</span>)</span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>JuePascua <span class="ot">&lt;-</span> <span class="fu">Easter</span>(<span class="dv">1996</span><span class="sc">:</span><span class="dv">2024</span>, <span class="at">shift =</span> <span class="dv">4</span>)</span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>ViePascua <span class="ot">&lt;-</span> <span class="fu">Easter</span>(<span class="dv">1996</span><span class="sc">:</span><span class="dv">2024</span>, <span class="at">shift =</span> <span class="dv">5</span>)</span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>Pascua <span class="ot">&lt;-</span> <span class="fu">c</span>(LunPascua, MarPascua, MiePascua, JuePascua, ViePascua)</span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>biz <span class="ot">&lt;-</span> fechaDiaria[<span class="fu">isBizday</span>(fechaDiaria, <span class="at">holidays =</span> Pascua, <span class="at">wday =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">6</span>)]</span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a>bizdays <span class="ot">&lt;-</span> <span class="fu">format</span>(biz, <span class="at">format =</span> <span class="st">"%Y-%m"</span>)</span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a>DiasPascua <span class="ot">&lt;-</span> <span class="fu">table</span>(bizdays)</span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a>DiasPascua <span class="ot">&lt;-</span> <span class="fu">ts</span>(DiasPascua, <span class="at">start =</span> <span class="dv">1996</span>, <span class="at">frequency =</span> <span class="dv">12</span>)</span>
<span id="cb42-29"><a href="#cb42-29" aria-hidden="true" tabindex="-1"></a>DiasPascua <span class="ot">&lt;-</span> (<span class="fu">monthdays</span>(DiasPascua) <span class="sc">-</span> DiasPascua)<span class="sc">/</span><span class="dv">5</span></span>
<span id="cb42-30"><a href="#cb42-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-31"><a href="#cb42-31" aria-hidden="true" tabindex="-1"></a>pDiasPascua <span class="ot">&lt;-</span> <span class="fu">subset</span>(DiasPascua, <span class="at">start =</span> <span class="fu">length</span>(DiasPascua) <span class="sc">-</span> <span class="dv">59</span>)</span>
<span id="cb42-32"><a href="#cb42-32" aria-hidden="true" tabindex="-1"></a>DiasPascua <span class="ot">&lt;-</span> <span class="fu">subset</span>(DiasPascua, <span class="at">end =</span> <span class="fu">length</span>(DiasPascua) <span class="sc">-</span> <span class="dv">60</span>)</span>
<span id="cb42-33"><a href="#cb42-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-34"><a href="#cb42-34" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(DiasPreSanta, <span class="at">n =</span> <span class="dv">60</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec
2015 0.0 0.0 0.5 0.5 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0
2016 0.0 0.0 1.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0
2017 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0
2018 0.0 0.0 1.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0
2019 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(DiasPascua, <span class="at">n =</span> <span class="dv">60</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec
2015 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0
2016 0.0 0.0 0.8 0.2 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0
2017 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0
2018 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0
2019 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0</code></pre>
</div>
</div>
<p>Ahora tenemos todos los elementos para pedir la identificación automática con <code>auto.arima</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">auto.arima</span>(Pasajeros, </span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">lambda =</span> <span class="dv">0</span>,</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">d =</span> <span class="dv">1</span>, </span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">D =</span> <span class="dv">1</span>,</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">xreg =</span> <span class="fu">cbind</span>(DiasLaborables, DiasNoLaborables, </span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>                        LunesNavidad, DiasPreSanta, DiasPascua))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: Pasajeros 
Regression with ARIMA(0,1,1)(0,1,1)[12] errors 
Box Cox transformation: lambda= 0 

Coefficients:
          ma1     sma1  DiasLaborables  DiasNoLaborables  LunesNavidad
      -0.5775  -0.4194          0.0352            0.0159         0.028
s.e.   0.0496   0.0531          0.0057            0.0057         0.008
      DiasPreSanta  DiasPascua
           -0.0577     -0.0248
s.e.        0.0042      0.0070

sigma^2 = 0.0003214:  log likelihood = 718.25
AIC=-1420.51   AICc=-1419.97   BIC=-1391.58</code></pre>
</div>
</div>
<p>La identificación automática muestra el proceso de las aerolíneas. Además, parece que todas las variables de intervención son significativas.</p>
<p><br>
</p>
</section>
<section id="identificación-automática-con-seas" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="identificación-automática-con-seas">Identificación automática con <code>seas</code></h3>
<p>La función <code>seas</code> de <code>seasonal</code> incluye automáticamente durante la identificación las variables de intervención necesarias.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">seas</span>(<span class="fu">log</span>(Pasajeros)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
seas(x = log(Pasajeros))

Coefficients:
                   Estimate Std. Error z value Pr(&gt;|z|)    
Leap Year          0.026067   0.005643   4.620 3.84e-06 ***
Weekday            0.005285   0.000265  19.946  &lt; 2e-16 ***
Easter[1]         -0.086964   0.003186 -27.296  &lt; 2e-16 ***
AO2005.Jul        -0.054099   0.013221  -4.092 4.28e-05 ***
AR-Nonseasonal-01 -0.980370   0.271938  -3.605 0.000312 ***
AR-Nonseasonal-02 -0.597933   0.121438  -4.924 8.49e-07 ***
AR-Nonseasonal-03 -0.305587   0.086942  -3.515 0.000440 ***
MA-Nonseasonal-01 -0.561895   0.281101  -1.999 0.045619 *  
MA-Seasonal-12     0.382738   0.055910   6.846 7.61e-12 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

SEATS adj.  ARIMA: (3 1 1)(0 1 1)  Obs.: 288  Transform: none
AICc: -1375, BIC: -1339  QS (no seasonality in final):    0  
Box-Ljung (no autocorr.): 54.28 *** Shapiro (normality): 0.9895 *</code></pre>
</div>
</div>
<p>En este caso el proceso identificado en la parte regular es más complejo que el obtenido con <code>auto.arima</code>, ARIMA(3,1,1). Además, se han incluido variables de intervención asociadas a los años bisiestos, la Semana Santa y días laborables. Conjuntamente estas variables de intervención recogen los mismos efectos considerados por nosotros.</p>
<p>Concluimos que el modelo de partida para Pasajeros será <span class="math inline">\(\log(Pasajeros) \sim ARIMA_{12}(0, 1, 1)(0, 1, 1) + AI\)</span>.</p>
<p><br>
</p>
</section>
</section>
<section id="estimación-del-modelo-e-identificación-de-otras-componentes-de-intervención" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="estimación-del-modelo-e-identificación-de-otras-componentes-de-intervención"><span class="header-section-number">5.3</span> Estimación del modelo e identificación de otras componentes de intervención</h2>
<p>Vamos a estimar el modelo identificado y a analizar la presencia de otros valores atípicos en el residuo.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>PasajerosAri <span class="ot">&lt;-</span> <span class="fu">Arima</span>(Pasajeros, </span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">lambda =</span> <span class="dv">0</span>,</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>),  </span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">seasonal =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">xreg =</span> <span class="fu">cbind</span>(DiasLaborables, DiasNoLaborables, </span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>                                   LunesNavidad, DiasPreSanta, DiasPascua))</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>PasajerosAri</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: Pasajeros 
Regression with ARIMA(0,1,1)(0,1,1)[12] errors 
Box Cox transformation: lambda= 0 

Coefficients:
          ma1     sma1  DiasLaborables  DiasNoLaborables  LunesNavidad
      -0.5775  -0.4194          0.0352            0.0159         0.028
s.e.   0.0496   0.0531          0.0057            0.0057         0.008
      DiasPreSanta  DiasPascua
           -0.0577     -0.0248
s.e.        0.0042      0.0070

sigma^2 = 0.0003214:  log likelihood = 718.25
AIC=-1420.51   AICc=-1419.97   BIC=-1391.58</code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>error <span class="ot">&lt;-</span> <span class="fu">residuals</span>(PasajerosAri)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>sderror <span class="ot">&lt;-</span> <span class="fu">sd</span>(error)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(error, <span class="at">series=</span><span class="st">"Error"</span>,</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"Error"</span>,</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="sc">-</span><span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">3</span>)<span class="sc">*</span>sderror, </span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"blue"</span>, <span class="st">"black"</span>, <span class="st">"blue"</span>, <span class="st">"red"</span>), </span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span> <span class="fu">seq</span>(<span class="dv">1996</span>, <span class="dv">2020</span>, <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-PasajerosError1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="03-11-Ejemplo-Pasajeros_files/figure-html/fig-PasajerosError1-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
<p></p><figcaption class="figure-caption">Figura 14: Error + Intervención. Modelo ARIMA</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>En la <a href="#fig-PasajerosError1">Figura&nbsp;14</a> identificamos tres meses en los que el error supera o casi alcanza las tres desviaciones típicas y son candidatos a valores atípicos: abril de 2002, agosto de 2005 y marzo de 2010. No es fácil conocer las causas para estos valores atípicos.</p>
<p>Tras incluir las correspondientes variables artificiales en el modelo y estimarlo, identificamos otro valor extremo en agosto de 2006 y procedemos a incluirlo en el modelo y repetir el análisis. En esta ocasión ya no identificamos más valores atípicos (véase <a href="#fig-PasajerosError2">Figura&nbsp;15</a>).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>d0402 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">*</span>(<span class="fu">trunc</span>(<span class="fu">time</span>(Pasajeros)) <span class="sc">==</span> <span class="dv">2002</span> <span class="sc">&amp;</span> <span class="fu">cycle</span>(Pasajeros) <span class="sc">==</span> <span class="dv">4</span>)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>d0805 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">*</span>(<span class="fu">trunc</span>(<span class="fu">time</span>(Pasajeros)) <span class="sc">==</span> <span class="dv">2005</span> <span class="sc">&amp;</span> <span class="fu">cycle</span>(Pasajeros) <span class="sc">==</span> <span class="dv">8</span>)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>d0806 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">*</span>(<span class="fu">trunc</span>(<span class="fu">time</span>(Pasajeros)) <span class="sc">==</span> <span class="dv">2006</span> <span class="sc">&amp;</span> <span class="fu">cycle</span>(Pasajeros) <span class="sc">==</span> <span class="dv">8</span>)</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>d0310 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">*</span>(<span class="fu">trunc</span>(<span class="fu">time</span>(Pasajeros)) <span class="sc">==</span> <span class="dv">2010</span> <span class="sc">&amp;</span> <span class="fu">cycle</span>(Pasajeros) <span class="sc">==</span> <span class="dv">3</span>)</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>PasajerosAri <span class="ot">&lt;-</span> <span class="fu">Arima</span>(Pasajeros,</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">lambda =</span> <span class="dv">0</span>,</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>                      <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>),  </span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>                      <span class="at">seasonal =</span>  <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>                      <span class="at">xreg =</span> <span class="fu">cbind</span>(DiasLaborables, DiasNoLaborables, </span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>                                   LunesNavidad, DiasPreSanta, DiasPascua,</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>                                   d0402, d0805, d0806, d0310))</span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>PasajerosAri</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: Pasajeros 
Regression with ARIMA(0,1,1)(0,1,1)[12] errors 
Box Cox transformation: lambda= 0 

Coefficients:
          ma1     sma1  DiasLaborables  DiasNoLaborables  LunesNavidad
      -0.5276  -0.3752          0.0343            0.0158        0.0259
s.e.   0.0539   0.0591          0.0051            0.0052        0.0072
      DiasPreSanta  DiasPascua   d0402   d0805   d0806   d0310
           -0.0579     -0.0253  0.0333  0.0644  0.0284  0.0377
s.e.        0.0042      0.0067  0.0130  0.0126  0.0126  0.0126

sigma^2 = 0.0002842:  log likelihood = 737.61
AIC=-1451.23   AICc=-1450.03   BIC=-1407.82</code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>error <span class="ot">&lt;-</span> <span class="fu">residuals</span>(PasajerosAri)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>sderror <span class="ot">&lt;-</span> <span class="fu">sd</span>(error)</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(error, <span class="at">series=</span><span class="st">"Error"</span>,</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"Error"</span>,</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="sc">-</span><span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">3</span>)<span class="sc">*</span>sderror, </span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"blue"</span>, <span class="st">"black"</span>, <span class="st">"blue"</span>, <span class="st">"red"</span>), </span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span> <span class="fu">seq</span>(<span class="dv">1996</span>, <span class="dv">2020</span>, <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-PasajerosError2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="03-11-Ejemplo-Pasajeros_files/figure-html/fig-PasajerosError2-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
<p></p><figcaption class="figure-caption">Figura 15: Error + Intervención. Modelo ARIMA</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Antes de finalizar el proceso de identificación vamos a confirmar la significatividad de todos los parámetros estimados haciendo uso del estadístico de Wald (véase <a href="#tbl-Significatividad">Tabla&nbsp;2</a>).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>datos <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(<span class="fu">coef</span>(PasajerosAri))) {</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  datos <span class="ot">&lt;-</span> <span class="fu">rbind</span>(datos,</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">data.frame</span>(</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Coeficiente"</span> <span class="ot">=</span> <span class="fu">names</span>(<span class="fu">coef</span>(PasajerosAri))[i],</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Valor de p"</span> <span class="ot">=</span> <span class="fu">wald.test</span>(<span class="at">b =</span> <span class="fu">coef</span>(PasajerosAri), </span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">Sigma =</span> <span class="fu">vcov</span>(PasajerosAri), </span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">Terms =</span> i)<span class="sc">$</span>result<span class="sc">$</span>chi2[<span class="dv">3</span>])</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>                 )</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(datos, <span class="at">digits =</span> <span class="dv">4</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="tbl-Significatividad" class="anchored">
<table class="table table-sm table-striped">
<caption>Tabla 2: Contrastes de significatividad</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Coeficiente</th>
<th style="text-align: right;">Valor.de.p</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">ma1</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="even">
<td style="text-align: left;">sma1</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">DiasLaborables</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="even">
<td style="text-align: left;">DiasNoLaborables</td>
<td style="text-align: right;">0.0023</td>
</tr>
<tr class="odd">
<td style="text-align: left;">LunesNavidad</td>
<td style="text-align: right;">0.0003</td>
</tr>
<tr class="even">
<td style="text-align: left;">DiasPreSanta</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">DiasPascua</td>
<td style="text-align: right;">0.0001</td>
</tr>
<tr class="even">
<td style="text-align: left;">d0402</td>
<td style="text-align: right;">0.0106</td>
</tr>
<tr class="odd">
<td style="text-align: left;">d0805</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="even">
<td style="text-align: left;">d0806</td>
<td style="text-align: right;">0.0246</td>
</tr>
<tr class="odd">
<td style="text-align: left;">d0310</td>
<td style="text-align: right;">0.0028</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p><br>
</p>
</section>
<section id="validación-del-modelo" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="validación-del-modelo"><span class="header-section-number">5.4</span> Validación del modelo</h2>
<p>En el proceso de validación verificaremos si se cumplen las hipótesis básicas sobre el vector de residuos y analizaremos la calidad de ajuste y predicción del modelo estimado.</p>
<p><br>
</p>
<section id="incorrelación-homocedasticidad-y-normalidad" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="incorrelación-homocedasticidad-y-normalidad">Incorrelación, Homocedasticidad y Normalidad</h3>
<p>Veamos si el residuo es ruido blanco.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Box.test</span>(error, <span class="at">lag =</span> <span class="dv">2</span>,<span class="at">type =</span> <span class="st">"Ljung-Box"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Box-Ljung test

data:  error
X-squared = 0.020802, df = 2, p-value = 0.9897</code></pre>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Box.test</span>(error, <span class="at">lag =</span> <span class="dv">24</span>,<span class="at">type =</span> <span class="st">"Ljung-Box"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Box-Ljung test

data:  error
X-squared = 25.067, df = 24, p-value = 0.4021</code></pre>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Box.test</span>(error<span class="sc">^</span><span class="dv">2</span>, <span class="at">lag =</span> <span class="dv">2</span>, <span class="at">type =</span> <span class="st">"Ljung-Box"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Box-Ljung test

data:  error^2
X-squared = 3.5249, df = 2, p-value = 0.1716</code></pre>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Box.test</span>(error<span class="sc">^</span><span class="dv">2</span>, <span class="at">lag =</span> <span class="dv">24</span>, <span class="at">type =</span> <span class="st">"Ljung-Box"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Box-Ljung test

data:  error^2
X-squared = 25.854, df = 24, p-value = 0.3606</code></pre>
</div>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">jarque.bera.test</span>(error) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Jarque Bera Test

data:  error
X-squared = 0.40002, df = 2, p-value = 0.8187</code></pre>
</div>
</div>
<p>El error muestra ser incorrelado, homocedástico y seguir una distribución normal.</p>
<p><br>
</p>
</section>
<section id="calidad-del-ajuste" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="calidad-del-ajuste">Calidad del ajuste</h3>
<p>Analizando los criterios de bondad de ajuste (sobre el error de predicción intramuestral a un periodo vista) se tiene un error medio (ME) de -0.05 millones de pasajeros, prácticamente cero por lo que no parece que haya sesgo en las predicciones; en media nos equivocamos 3.7 millones de pasajeros (RMSE) y el error porcentual medio (MAPE) es 1.3%, muy bajo. Para ambos indicadores de bondad de ajuste el error obtenido es la mitad que el visto con Alisado Exponencial.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>                ME RMSE  MAE  MPE MAPE MASE ACF1
Training set -0.05 3.72 2.92 0.01 1.26 0.35 0.02</code></pre>
</div>
</div>
<p><br>
</p>
</section>
<section id="calidad-de-las-predicciones" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="calidad-de-las-predicciones">Calidad de las predicciones</h3>
<p>Se completará el proceso de validación estimado el error de predicción extramuestral según el horizonte temporal. Se considerarán 12 años para el periodo de estimación y un año para el de predicción.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">144</span>                  </span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>h <span class="ot">&lt;-</span> <span class="dv">12</span>                   </span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>T <span class="ot">&lt;-</span> <span class="fu">length</span>(Pasajeros)    </span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>s<span class="ot">&lt;-</span>T <span class="sc">-</span> k <span class="sc">-</span> h            </span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>mapeArima <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, s <span class="sc">+</span> <span class="dv">1</span>, h)</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">cbind</span>(DiasLaborables, DiasNoLaborables, </span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>           LunesNavidad, DiasPreSanta, DiasPascua,</span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>           d0402, d0805, d0806, d0310)</span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">0</span><span class="sc">:</span>s) {</span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a>  train.set <span class="ot">&lt;-</span> <span class="fu">subset</span>(Pasajeros, <span class="at">start =</span> i <span class="sc">+</span> <span class="dv">1</span>, <span class="at">end =</span> i <span class="sc">+</span> k)</span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>  test.set <span class="ot">&lt;-</span>  <span class="fu">subset</span>(Pasajeros, <span class="at">start =</span> i <span class="sc">+</span> k <span class="sc">+</span> <span class="dv">1</span>, <span class="at">end =</span> i <span class="sc">+</span> k <span class="sc">+</span> h) </span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a>  X.train <span class="ot">&lt;-</span> X[(i <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>(i <span class="sc">+</span> k),]</span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a>  hay <span class="ot">&lt;-</span> <span class="fu">colSums</span>(X.train)</span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a>  X.train <span class="ot">&lt;-</span> X.train[, hay<span class="sc">&gt;</span><span class="dv">0</span>]</span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb69-20"><a href="#cb69-20" aria-hidden="true" tabindex="-1"></a>  X.test <span class="ot">&lt;-</span> X[(i <span class="sc">+</span> k <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>(i <span class="sc">+</span> k <span class="sc">+</span> h),]</span>
<span id="cb69-21"><a href="#cb69-21" aria-hidden="true" tabindex="-1"></a>  X.test <span class="ot">&lt;-</span> X.test[, hay<span class="sc">&gt;</span><span class="dv">0</span>]</span>
<span id="cb69-22"><a href="#cb69-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb69-23"><a href="#cb69-23" aria-hidden="true" tabindex="-1"></a>  fit <span class="ot">&lt;-</span> <span class="fu">try</span>(<span class="fu">Arima</span>(train.set, </span>
<span id="cb69-24"><a href="#cb69-24" aria-hidden="true" tabindex="-1"></a>                   <span class="at">lambda =</span> <span class="dv">0</span>,</span>
<span id="cb69-25"><a href="#cb69-25" aria-hidden="true" tabindex="-1"></a>                   <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb69-26"><a href="#cb69-26" aria-hidden="true" tabindex="-1"></a>                   <span class="at">seasonal =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb69-27"><a href="#cb69-27" aria-hidden="true" tabindex="-1"></a>                   <span class="at">xreg=</span>X.train), <span class="at">silent =</span> <span class="cn">TRUE</span>)</span>
<span id="cb69-28"><a href="#cb69-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb69-29"><a href="#cb69-29" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.element</span>(<span class="st">"try-error"</span>, <span class="fu">class</span>(fit))) {</span>
<span id="cb69-30"><a href="#cb69-30" aria-hidden="true" tabindex="-1"></a>    fcast <span class="ot">&lt;-</span> <span class="fu">forecast</span>(fit, <span class="at">h =</span> h, <span class="at">xreg =</span> X.test)</span>
<span id="cb69-31"><a href="#cb69-31" aria-hidden="true" tabindex="-1"></a>    mapeArima[i <span class="sc">+</span> <span class="dv">1</span>,] <span class="ot">&lt;-</span> <span class="dv">100</span><span class="sc">*</span><span class="fu">abs</span>(test.set <span class="sc">-</span> fcast<span class="sc">$</span>mean)<span class="sc">/</span>test.set</span>
<span id="cb69-32"><a href="#cb69-32" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb69-33"><a href="#cb69-33" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb69-34"><a href="#cb69-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-35"><a href="#cb69-35" aria-hidden="true" tabindex="-1"></a>errorArima <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(mapeArima, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb69-36"><a href="#cb69-36" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(errorArima, <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 1.39 1.53 1.61 1.72 1.87 1.96 2.08 2.22 2.35 2.48 2.62 2.79</code></pre>
</div>
</div>
<p>El error es creciente en el horizonte temporal de predicción. Para predicciones extramuestrales a un periodo vista vale 1.4%, algo superior al error de estimación, pero realmente bajo. Incluso para predicciones a doce meses vista, el error sigue siendo reducido, 2.8%. Recordemos que para Alisado Exponencial era de 3.6%.</p>
<p><br>
</p>
</section>
</section>
<section id="interpretación-del-modelo-estimado" class="level2" data-number="5.5">
<h2 data-number="5.5" class="anchored" data-anchor-id="interpretación-del-modelo-estimado"><span class="header-section-number">5.5</span> Interpretación del modelo estimado</h2>
<p>El modelo estimado y validado corresponde al modelo de las aerolíneas con intervención: <span class="math inline">\(ARIMA_{12}(0,1,1)(0,1,1) + AI\)</span>. La ecuación teórica completa del modelo es:</p>
<p><span class="math display">\[(1-L)(1-L^{12})\log(Pasajeros) = (1+\theta_1 L)(1 + \theta_{12} L^{12})\varepsilon_t+\]</span></p>
<p><span class="math display">\[\gamma_1 DiasLaborables +\gamma_2 DiasNoLaborables +\gamma_3 LunesNavidad+\]</span></p>
<p><span class="math display">\[\gamma_4 DiasPreSanta + \gamma_5 DiasPascua +\]</span></p>
<p><span class="math display">\[\gamma_6 d0402 +\gamma_7 d0805 +\gamma_8 d0806 +\gamma_9 d0310.\]</span></p>
<p>Si se desarrolla el modelo y se deja en función de la tasa de variación anual del número de pasajero, queda (la parte de intervención no cambia):</p>
<p><span class="math display">\[TVAPasajeros_t = TVAPasajeros_{t-1} + \theta_1 \varepsilon_{t-1} + \theta_{12} \varepsilon_{t-12}+ \theta_1 \theta_{12} \varepsilon_{t-13}+\varepsilon_t + AI.\]</span></p>
<p>Finalmente, el modelo estimado es:</p>
<p><span class="math display">\[\widehat{TVAPasajeros}_t = TVAPasajeros_{t-1} -0.53 \varepsilon_{t-1} -0.37 \varepsilon_{t-12}+ 0.20 \varepsilon_{t-13} +\]</span></p>
<p><span class="math display">\[0.034\cdot DiasLaborables +0.016\cdot DiasNoLaborables+ 0.026\cdot LunesNavidad\]</span></p>
<p><span class="math display">\[- 0.058\cdot DiasPreSanta - 0.025\cdot DiasPascua +\]</span></p>
<p><span class="math display">\[0.033\cdot d0402 +0.064\cdot d0805 +0.028\cdot d0806 +0.038\cdot d0310.\]</span> Interpretación:</p>
<ul>
<li>La tasa de variación anual del número de pasajeros en transporte urbano para un mes dado es la misma que la observada en el mes previo.</li>
<li>Si hace uno, doce o trece meses se observó un número atípico de pasajeros, se debe tener en cuenta para corregir la predicción.</li>
<li>Cada día laborable adicional en un mes supone un incremento en el número de pasajeros del 3.4% y cada día no laborable un incremento adicional del 1.6%.</li>
<li>Si la Navidad cae en lunes y por tanto Nochebuena en domingo, ese mes de diciembre el número de pasajeros será un 2.6% superior al de un mes de diciembre donde la Navidad no cae en lunes.</li>
<li>Si los días laborables (lunes a jueves) de la Semana Santa caen íntegramente en marzo, ese mes el número de pasajeros cae un 5.8% respecto de un marzo sin Semana Santa. Lo mismo pasaría con abril.</li>
<li>De la misma forma, si los días laborables (lunes a viernes) de la semana posterior a Domingo de Resurrección (semana de Pascua) caen en marzo, ese mes el número de pasajeros cae un 2.5% respecto de un marzo sin Pascua. Lo mismo para abril.</li>
<li>Ademas, para cuatro meses se observó una tasa de variación anual atípicamente superior a la esperada.</li>
</ul>
<p><br>
</p>
</section>
<section id="predicción-del-número-de-pasajeros-en-transporte-urbano" class="level2" data-number="5.6">
<h2 data-number="5.6" class="anchored" data-anchor-id="predicción-del-número-de-pasajeros-en-transporte-urbano"><span class="header-section-number">5.6</span> Predicción del número de pasajeros en transporte urbano</h2>
<p>Una vez dado por válido el modelo, podemos pasar a realizar predicciones para los próximos años. Para las variables de intervención sujetas a fecha de calendario ya hemos ido creando sus valores previstos, para las demás los fijaremos a cero.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>pPasajerosAri <span class="ot">&lt;-</span> <span class="fu">forecast</span>(PasajerosAri, </span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>                          <span class="at">h =</span> <span class="dv">60</span>,</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">xreg =</span> <span class="fu">cbind</span>(pDiasLaborables, pDiasNoLaborables, </span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>                                       pLunesNavidad, pDiasPreSanta, pDiasPascua,</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>                                       <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">60</span>), <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">60</span>), </span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>                                       <span class="fu">rep</span>(<span class="dv">0</span> ,<span class="dv">60</span>), <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">60</span>)), </span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">level =</span> <span class="dv">95</span>)</span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(pPasajerosAri, </span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">""</span>,</span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span> <span class="fu">seq</span>(<span class="dv">1996</span>, <span class="dv">2024</span>, <span class="dv">4</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-PasajerosPrediccion" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="03-11-Ejemplo-Pasajeros_files/figure-html/fig-PasajerosPrediccion-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
<p></p><figcaption class="figure-caption">Figura 16: Pasajeros (1996-2019) y predicción (2020-2024). Modelo ARIMA</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Así, en 2020 se esperan 3180 millones de pasajeros y para 2021 un total de 3247 millones de pasajeros.</p>
<p><br>
<br>
<br>
</p>
</section>
</section>
<section id="comparación-entre-modelos" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Comparación entre modelos</h1>
<p>Para finalizar este análisis, vamos a comparar la calidad de ajuste y de predicción de los tres modelos estimados en este ejemplo: el método ingenuo con estacionalidad, el método de Alisado exponencial y el modelo ARIMA.</p>
<p>Recordemos que el método ingenuo con estacionalidad tenía un error de ajuste (MAPE) del 3.5% o 11 millones de pasajeros (RMSE). Mientras que para el mejor modelo de Alisado Exponencial obtenido (ETS(M,Ad,A)) se tiene un error del 2.4% equivalente a 7.5 millones de pasajeros. Por último, el modelo ARIMA presenta un error del 1.3% o 3.7 millones de pasajeros.</p>
<p>Claramente, el modelo de alisado supone una mejora sustancial sobre el método ingenuo y el modelo ARIMA sobre el de alisado, con una reducción, en este último caso, cercana al 50% en los dos indicadores de calidad contemplados.</p>
<p>Respecto de la calidad de las predicciones extramuestrales, la <a href="#fig-PasajerosComparacion">Figura&nbsp;17</a> muestra los valores para el modelo de Alisado Exponencial y ARIMA.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>datos <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">factor =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"Alisado"</span>, <span class="dv">12</span>), </span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>             <span class="fu">rep</span>(<span class="st">"Arima"</span>, <span class="dv">12</span>)),</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>),</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">c</span>(errorAlisadoPas, errorArima)</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(datos, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y,  <span class="at">colour=</span> factor)) <span class="sc">+</span> </span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Horizonte temporal de predicción"</span>) <span class="sc">+</span></span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"%"</span>) <span class="sc">+</span></span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks=</span> <span class="fu">seq</span>(<span class="fl">1.5</span>, <span class="dv">4</span>, .<span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">colour =</span> <span class="st">"Métodos"</span>) <span class="sc">+</span> </span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="fu">c</span>(<span class="fl">0.1</span>,<span class="fl">0.8</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-PasajerosComparacion" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="03-11-Ejemplo-Pasajeros_files/figure-html/fig-PasajerosComparacion-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
<p></p><figcaption class="figure-caption">Figura 17: Error de predicción (MAPE) según horizonte temporal y enfoque</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Con independencia del horizonte temporal, el error de previsión extramuestral del modelo ARIMA es menor que el error del modelo de Alisado Exponencial, aunque la diferencia se reduce conforme aumenta el horizonte temporal de previsión. En concreto, para previsiones a un mes vista, ARIMA comete un error 1.2 puntos porcentuales menor que el alisado, mientras que para predicciones a seis meses vista la diferencia es solo de 0.9 p.p. y para un horizonte de doce meses de 0.8 p.p.</p>
<p>El método ARIMA nos permite obtener las predicciones más precisas y además entender un poco mejor cuales son los determinantes del número de pasajeros en transporte urbano y su efecto sobre la serie. El método de Alisado Exponencial permite obtener predicciones bastante buenas con una simple línea de código. La conveniencia de uno u otro método dependerá de la importancia que se dé a la calidad de las predicciones, la comprensión de los determinantes de la serie o la complejidad de la metodología, entre otros aspectos.</p>
<p><br>
<br>
</p>
</section>
<section id="lista-de-funciones-utilizadas" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Lista de funciones utilizadas</h1>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: left;">Paquete</th>
<th style="text-align: left;">Funciones</th>
<th style="text-align: left;">Paquete</th>
<th style="text-align: left;">Funciones</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">aod</td>
<td style="text-align: left;">wald.test</td>
<td style="text-align: left;">forecast</td>
<td style="text-align: left;">ggsubseriesplot</td>
</tr>
<tr class="even">
<td style="text-align: left;">base</td>
<td style="text-align: left;">abs</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">monthdays</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">as.Date</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">ndiffs</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">as.numeric</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">nsdiffs</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">as.POSIXlt</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">remainder</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">c</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">snaive</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">cbind</td>
<td style="text-align: left;">ggplot2</td>
<td style="text-align: left;">aes</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">class</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">geom_hline</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">colMeans</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">geom_line</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">colnames</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">geom_point</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">colSums</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">ggplot</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">data.frame</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">ggtitle</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">diff</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">guide_legend</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">expression</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">guides</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">is.element</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">scale_colour_manual</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">length</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">scale_x_continuous</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">library</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">scale_y_continuous</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">list</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">theme</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">log</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">theme_bw</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">matrix</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">theme_set</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">mean</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">xlab</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">names</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">ylab</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">nrow</td>
<td style="text-align: left;">knitr</td>
<td style="text-align: left;">kable</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">rbind</td>
<td style="text-align: left;">seasonal</td>
<td style="text-align: left;">seas</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">rep</td>
<td style="text-align: left;">stats</td>
<td style="text-align: left;">aggregate</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">round</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">coef</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">rownames</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">cycle</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">seq</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">residuals</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">subset</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">sd</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">summary</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">stl</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">table</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">time</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">tapply</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">ts</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">trunc</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">vcov</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">try</td>
<td style="text-align: left;">timeDate</td>
<td style="text-align: left;">dayOfWeek</td>
</tr>
<tr class="odd">
<td style="text-align: left;">forecast</td>
<td style="text-align: left;">accuracy</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">Easter</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">Arima</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">format</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">auto.arima</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">isBizday</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">autoplot</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">timeCalendar</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">autolayer</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">timeSequence</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">easter</td>
<td style="text-align: left;">utils</td>
<td style="text-align: left;">read.csv2</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">ets</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">forecast</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">ggAcf</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
<p><br>
<br>
<br>
<br>
</p>


</section>


<div id="quarto-appendix" class="default"><section class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1" role="doc-endnote"><p>Recordemos que hemos recortado la serie hasta 2019 y <em>vivimos en un mundo donde nada sabemos de la Covid-19</em>.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2" role="doc-endnote"><p>Realmente en 2020 el número de Pasajeros fue de 1682 millones, un 45% menos que en 2019.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">© Copyright 2022, Iván Arribas. If you find any bugs please report them to <a href="mailto:ivan.arribas@uv.es">ivan.arribas@uv.e</a></div>   
    <div class="nav-footer-right">This page is built with <a href="https://quarto.org/">Quarto</a></div>
  </div>
</footer>



</body></html>