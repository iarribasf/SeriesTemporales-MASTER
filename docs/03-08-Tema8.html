<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Iván Arribas (Depto. Análisis Económico. Universitat de València)">

<title>Predicción con Datos Temporales - Series con estacionalidad. Procesos ARIMA con estacionalidad</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Predicción con Datos Temporales</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Inicio</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="./01-Guia-curso.html"> 
<span class="menu-text">Guía del curso</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./02-Logistica.html"> 
<span class="menu-text">Logística</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-diapos" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Diapos</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-diapos">    
        <li class="dropdown-header">Teoría</li>
        <li>
    <a class="dropdown-item" href="./03-01-Tema1.html">
 <span class="dropdown-text">Tema 1: Introducción</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-02-Tema2.html">
 <span class="dropdown-text">Tema 2: Definición</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-03-Tema3.html">
 <span class="dropdown-text">Tema 3: Métodos de predicción</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-04-Tema4.html">
 <span class="dropdown-text">Tema 4: Series sin tendencia ni estacionalidad</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-05-Tema5.html">
 <span class="dropdown-text">Tema 5: Evaluación de las predicciones</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-06-Tema6.html">
 <span class="dropdown-text">Tema 6: Series sin tendencia y sin estacionalidad</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-07-Tema7.html">
 <span class="dropdown-text">Tema 7: Series con tendencia y estacionalidad (Alisado)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-08-Tema8.html">
 <span class="dropdown-text">Tema 8: Series con tendencia y estacionalidad (Arima)</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Ejemplo de aplicación</li>
        <li>
    <a class="dropdown-item" href="./03-10-Ejemplo1.html">
 <span class="dropdown-text">Ejemplo: Descriptiva</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-11-Ejemplo2.html">
 <span class="dropdown-text">Ejemplo: Métodos sencillos</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-13-Ejemplo3.html">
 <span class="dropdown-text">Ejemplo: Alisado exponencial</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-14-Ejemplo4.html">
 <span class="dropdown-text">Ejemplo: Arima sin estacionalidad</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-15-Ejemplo5.html">
 <span class="dropdown-text">Ejemplo: Arima con estacionalidad</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Otro ejemplo</li>
        <li>
    <a class="dropdown-item" href="./03-20-Ejemplo-Pasajeros.html">
 <span class="dropdown-text">Ejemplo de Pasajeros</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-píldoras" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Píldoras</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-píldoras">    
        <li>
    <a class="dropdown-item" href="./04-01-Bootstrapping.html">
 <span class="dropdown-text">Bootstrapping para IC</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./04-02-Multiples_CS.html">
 <span class="dropdown-text">Múltiples componentes estacionales</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./04-03-Redes_neuronales.html">
 <span class="dropdown-text">Predicción con Redes Neuronales</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./04-04-Series_acotadas.html">
 <span class="dropdown-text">Series acotadas</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./04-05-Valores_perdidos_Outliers.html">
 <span class="dropdown-text">Valores perdidos y outliers</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./04-06-Covid_Nacimientos.html">
 <span class="dropdown-text">Efecto de la Covid-19 en Nacimientos</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./04-07-Combinando_predicciones.html">
 <span class="dropdown-text">Combinación de predicciones</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./04-08-Series_interrumpidas.html">
 <span class="dropdown-text">Series interrumpidas</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="./05-Recursos-R.html"> 
<span class="menu-text">Recursos de la asignatura</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./06-Evaluacion_Continua.html"> 
<span class="menu-text">Evaluacion Continua</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-más" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Más</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-más">    
        <li class="dropdown-header">R</li>
        <li>
    <a class="dropdown-item" href="https://cran.r-project.org">
 <span class="dropdown-text">Dónde está R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://rstudio.com">
 <span class="dropdown-text">Donde está RStudio</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Markdown</li>
        <li>
    <a class="dropdown-item" href="https://bookdown.org/yihui/rmarkdown/">
 <span class="dropdown-text">Markdown</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://rmarkdown.rstudio.com/lesson-1.html">
 <span class="dropdown-text">R Markdown</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://www.rstudio.com/wp-content/uploads/2015/03/rmarkdown-reference.pdf">
 <span class="dropdown-text">R Markdown (pdf)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://quarto.org/docs/tools/rstudio.html">
 <span class="dropdown-text">Quatro</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Otros</li>
        <li>
    <a class="dropdown-item" href="https://www.r-bloggers.com">
 <span class="dropdown-text">Blog sobre R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://bookdown.org">
 <span class="dropdown-text">Libros online que debes conocer</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Índice</h2>
   
  <ul>
  <li><a href="#introducción" id="toc-introducción" class="nav-link active" data-scroll-target="#introducción"><span class="header-section-number">1</span> Introducción</a></li>
  <li><a href="#transformaciones-de-una-serie-con-estacionalidad" id="toc-transformaciones-de-una-serie-con-estacionalidad" class="nav-link" data-scroll-target="#transformaciones-de-una-serie-con-estacionalidad"><span class="header-section-number">2</span> Transformaciones de una serie con estacionalidad</a>
  <ul class="collapse">
  <li><a href="#diferenciación-estacional" id="toc-diferenciación-estacional" class="nav-link" data-scroll-target="#diferenciación-estacional"><span class="header-section-number">2.1</span> Diferenciación estacional</a>
  <ul class="collapse">
  <li><a href="#diferenciación-con-r" id="toc-diferenciación-con-r" class="nav-link" data-scroll-target="#diferenciación-con-r">Diferenciación con <code>R</code></a></li>
  </ul></li>
  <li><a href="#diferencia-logaritmo-y-tasa-de-variación" id="toc-diferencia-logaritmo-y-tasa-de-variación" class="nav-link" data-scroll-target="#diferencia-logaritmo-y-tasa-de-variación"><span class="header-section-number">2.2</span> Diferencia, Logaritmo y Tasa de variación</a></li>
  </ul></li>
  <li><a href="#función-de-autocorrelación-y-ergodicidad." id="toc-función-de-autocorrelación-y-ergodicidad." class="nav-link" data-scroll-target="#función-de-autocorrelación-y-ergodicidad."><span class="header-section-number">3</span> Función de autocorrelación y ergodicidad.</a>
  <ul class="collapse">
  <li><a href="#estacionariedad" id="toc-estacionariedad" class="nav-link" data-scroll-target="#estacionariedad">Estacionariedad</a></li>
  <li><a href="#ergodicidad" id="toc-ergodicidad" class="nav-link" data-scroll-target="#ergodicidad">Ergodicidad</a></li>
  </ul></li>
  <li><a href="#procesos-arima-con-estacionalidad" id="toc-procesos-arima-con-estacionalidad" class="nav-link" data-scroll-target="#procesos-arima-con-estacionalidad"><span class="header-section-number">4</span> Procesos ARIMA con estacionalidad</a>
  <ul class="collapse">
  <li><a href="#procesos-autorregresivos-ar_mp" id="toc-procesos-autorregresivos-ar_mp" class="nav-link" data-scroll-target="#procesos-autorregresivos-ar_mp"><span class="header-section-number">4.1</span> Procesos autorregresivos <span class="math inline">\(AR_m(P)\)</span></a>
  <ul class="collapse">
  <li><a href="#definición" id="toc-definición" class="nav-link" data-scroll-target="#definición">Definición</a></li>
  <li><a href="#ejemplos" id="toc-ejemplos" class="nav-link" data-scroll-target="#ejemplos">Ejemplos</a></li>
  </ul></li>
  <li><a href="#procesos-en-medias-móviles-ma_mq" id="toc-procesos-en-medias-móviles-ma_mq" class="nav-link" data-scroll-target="#procesos-en-medias-móviles-ma_mq"><span class="header-section-number">4.2</span> Procesos en medias móviles <span class="math inline">\(MA_m(Q)\)</span></a>
  <ul class="collapse">
  <li><a href="#definición-1" id="toc-definición-1" class="nav-link" data-scroll-target="#definición-1">Definición</a></li>
  <li><a href="#ejemplos-1" id="toc-ejemplos-1" class="nav-link" data-scroll-target="#ejemplos-1">Ejemplos</a></li>
  </ul></li>
  <li><a href="#procesos-arma_mpq" id="toc-procesos-arma_mpq" class="nav-link" data-scroll-target="#procesos-arma_mpq"><span class="header-section-number">4.3</span> Procesos <span class="math inline">\(ARMA_m(P,Q)\)</span></a>
  <ul class="collapse">
  <li><a href="#definición-2" id="toc-definición-2" class="nav-link" data-scroll-target="#definición-2">Definición</a></li>
  <li><a href="#ejemplos-2" id="toc-ejemplos-2" class="nav-link" data-scroll-target="#ejemplos-2">Ejemplos</a></li>
  </ul></li>
  <li><a href="#procesos-arima_mpdq" id="toc-procesos-arima_mpdq" class="nav-link" data-scroll-target="#procesos-arima_mpdq"><span class="header-section-number">4.4</span> Procesos <span class="math inline">\(ARIMA_m(P,D,Q)\)</span></a>
  <ul class="collapse">
  <li><a href="#ejemplo" id="toc-ejemplo" class="nav-link" data-scroll-target="#ejemplo">Ejemplo</a></li>
  </ul></li>
  <li><a href="#proceso-arima_mpdqpdq" id="toc-proceso-arima_mpdqpdq" class="nav-link" data-scroll-target="#proceso-arima_mpdqpdq"><span class="header-section-number">4.5</span> Proceso <span class="math inline">\(ARIMA_m(p,d,q)(P,D,Q)\)</span></a></li>
  </ul></li>
  <li><a href="#ejemplos-3" id="toc-ejemplos-3" class="nav-link" data-scroll-target="#ejemplos-3"><span class="header-section-number">5</span> Ejemplos</a>
  <ul class="collapse">
  <li><a href="#nacimientos" id="toc-nacimientos" class="nav-link" data-scroll-target="#nacimientos"><span class="header-section-number">5.1</span> Nacimientos</a>
  <ul class="collapse">
  <li><a href="#transformación-de-la-serie" id="toc-transformación-de-la-serie" class="nav-link" data-scroll-target="#transformación-de-la-serie">Transformación de la serie</a></li>
  <li><a href="#identificación" id="toc-identificación" class="nav-link" data-scroll-target="#identificación">Identificación</a></li>
  <li><a href="#estimación-y-valores-extremos" id="toc-estimación-y-valores-extremos" class="nav-link" data-scroll-target="#estimación-y-valores-extremos">Estimación (y valores extremos)</a></li>
  <li><a href="#compensación" id="toc-compensación" class="nav-link" data-scroll-target="#compensación">Compensación</a></li>
  <li><a href="#validación" id="toc-validación" class="nav-link" data-scroll-target="#validación">Validación</a></li>
  <li><a href="#error-de-estimación" id="toc-error-de-estimación" class="nav-link" data-scroll-target="#error-de-estimación">Error de estimación</a></li>
  <li><a href="#error-de-predicción-estramuestral-según-horizonte-temporal" id="toc-error-de-predicción-estramuestral-según-horizonte-temporal" class="nav-link" data-scroll-target="#error-de-predicción-estramuestral-según-horizonte-temporal">Error de predicción estramuestral según horizonte temporal</a></li>
  <li><a href="#interpretación" id="toc-interpretación" class="nav-link" data-scroll-target="#interpretación">Interpretación</a></li>
  <li><a href="#predicción-de-la-serie" id="toc-predicción-de-la-serie" class="nav-link" data-scroll-target="#predicción-de-la-serie">Predicción de la serie</a></li>
  </ul></li>
  <li><a href="#exportaciones" id="toc-exportaciones" class="nav-link" data-scroll-target="#exportaciones"><span class="header-section-number">5.2</span> Exportaciones</a>
  <ul class="collapse">
  <li><a href="#transformación-de-la-serie-1" id="toc-transformación-de-la-serie-1" class="nav-link" data-scroll-target="#transformación-de-la-serie-1">Transformación de la serie</a></li>
  <li><a href="#identificación-1" id="toc-identificación-1" class="nav-link" data-scroll-target="#identificación-1">Identificación</a></li>
  <li><a href="#estimación-y-valores-extremos-1" id="toc-estimación-y-valores-extremos-1" class="nav-link" data-scroll-target="#estimación-y-valores-extremos-1">Estimación (y valores extremos)</a></li>
  <li><a href="#validación-1" id="toc-validación-1" class="nav-link" data-scroll-target="#validación-1">Validación</a></li>
  <li><a href="#error-de-estimación-1" id="toc-error-de-estimación-1" class="nav-link" data-scroll-target="#error-de-estimación-1">Error de estimación</a></li>
  <li><a href="#error-de-predicción-estramuestral-según-horizonte-temporal-1" id="toc-error-de-predicción-estramuestral-según-horizonte-temporal-1" class="nav-link" data-scroll-target="#error-de-predicción-estramuestral-según-horizonte-temporal-1">Error de predicción estramuestral según horizonte temporal</a></li>
  <li><a href="#interpretación-1" id="toc-interpretación-1" class="nav-link" data-scroll-target="#interpretación-1">Interpretación</a></li>
  <li><a href="#predicción-de-la-serie-1" id="toc-predicción-de-la-serie-1" class="nav-link" data-scroll-target="#predicción-de-la-serie-1">Predicción de la serie</a></li>
  </ul></li>
  <li><a href="#demanda-eléctrica" id="toc-demanda-eléctrica" class="nav-link" data-scroll-target="#demanda-eléctrica"><span class="header-section-number">5.3</span> Demanda eléctrica</a>
  <ul class="collapse">
  <li><a href="#transformación-de-la-serie-2" id="toc-transformación-de-la-serie-2" class="nav-link" data-scroll-target="#transformación-de-la-serie-2">Transformación de la serie</a></li>
  <li><a href="#identificación-2" id="toc-identificación-2" class="nav-link" data-scroll-target="#identificación-2">Identificación</a></li>
  <li><a href="#estimación-y-valores-extremos-2" id="toc-estimación-y-valores-extremos-2" class="nav-link" data-scroll-target="#estimación-y-valores-extremos-2">Estimación (y valores extremos)</a></li>
  <li><a href="#validación-2" id="toc-validación-2" class="nav-link" data-scroll-target="#validación-2">Validación</a></li>
  <li><a href="#error-de-estimación-2" id="toc-error-de-estimación-2" class="nav-link" data-scroll-target="#error-de-estimación-2">Error de estimación</a></li>
  <li><a href="#error-de-predicción-estramuestral-según-horizonte-temporal-2" id="toc-error-de-predicción-estramuestral-según-horizonte-temporal-2" class="nav-link" data-scroll-target="#error-de-predicción-estramuestral-según-horizonte-temporal-2">Error de predicción estramuestral según horizonte temporal</a></li>
  <li><a href="#interpretación-2" id="toc-interpretación-2" class="nav-link" data-scroll-target="#interpretación-2">Interpretación</a></li>
  <li><a href="#predicción-de-la-serie-2" id="toc-predicción-de-la-serie-2" class="nav-link" data-scroll-target="#predicción-de-la-serie-2">Predicción de la serie</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#comparación-con-el-método-de-alisado-exponencial" id="toc-comparación-con-el-método-de-alisado-exponencial" class="nav-link" data-scroll-target="#comparación-con-el-método-de-alisado-exponencial"><span class="header-section-number">6</span> Comparación con el método de Alisado exponencial</a>
  <ul class="collapse">
  <li><a href="#nacimientos-log" id="toc-nacimientos-log" class="nav-link" data-scroll-target="#nacimientos-log">Nacimientos (log)</a></li>
  <li><a href="#exportaciones-log" id="toc-exportaciones-log" class="nav-link" data-scroll-target="#exportaciones-log">Exportaciones (log)</a></li>
  <li><a href="#electricidad" id="toc-electricidad" class="nav-link" data-scroll-target="#electricidad">Electricidad</a></li>
  </ul></li>
  <li><a href="#resumen-de-los-comandos-utilizados" id="toc-resumen-de-los-comandos-utilizados" class="nav-link" data-scroll-target="#resumen-de-los-comandos-utilizados"><span class="header-section-number">7</span> Resumen de los comandos utilizados</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Series con estacionalidad. Procesos ARIMA con estacionalidad</h1>
<p class="subtitle lead">Previsión con Datos Temporales (GBIA)</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Iván Arribas (Depto. Análisis Económico. Universitat de València) </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<p><br>
<br>
</p>
<section id="introducción" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introducción</h1>
<p>En este tema revisitaremos las series con estacionalidad y aprenderemos a realizar predicciones con los modelo Arima.</p>
<p>Se mantienen las hipótesis sobre el proceso generador de datos que vimos en el <a href="https://iarribasf.github.io/PrediccionSeriesTemporales-GBIA/03-04-Tema4.html">Tema 4</a>: <em>estacionario en media y varianza</em> y <em>ergódico</em>. Sin embargo, ahora la estacionaridad en media no implicará necesariamente ni estacionaridad en varianza ni ergocidad.</p>
<p>Recuerda que <span class="math inline">\(m\)</span> es el orden estacional.</p>
<p><br>
<br>
</p>
</section>
<section id="transformaciones-de-una-serie-con-estacionalidad" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Transformaciones de una serie con estacionalidad</h1>
<p>En el el <a href="https://iarribasf.github.io/PrediccionSeriesTemporales-GBIA/03-06-Tema6.html">Tema 6</a> vimos como usar la diferenciación regular (<span class="math inline">\(\nabla y_t = y_t - y_{t-1}\)</span>) para conseguir que una serie no estacionaria pase a serlo. También vimos la transformación logarítmica que puede ayudar a interpretar mejor el modelo estimado cuando la serie ha sido diferenciada.</p>
<p>Veamos estas mismas transformaciones en el contexto de una serie con estacionalidad.</p>
<section id="diferenciación-estacional" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="diferenciación-estacional"><span class="header-section-number">2.1</span> Diferenciación estacional</h2>
<p>La <strong>diferencia estacional</strong> consiste en restar a la observación de un periodo la observación precedente de la misma estación. Si el orden estacional es <span class="math inline">\(m\)</span>, entonces la diferencia estacional de <span class="math inline">\(y_t\)</span> es <span class="math display">\[\nabla_m y_t = y_t - y_{t-m}.\]</span> Una serie no estacionaria en media puede pasar a serlo tras diferenciarla estacionalmente. En general, cualquiera de las dos diferenciaciones vistas (regular o estacional) o ambas a la vez son alternativas para obtener la estacionariedad.</p>
<p>La <a href="#fig-NacimientosDif" class="quarto-xref">Figura&nbsp;1</a> muestra un ejemplo de diferenciación regular y/o estacional. En el primer panel aparece la serie original Nacimientos <span class="math inline">\(y_t\)</span>; el segundo panel muestra la serie diferenciada regularmente <span class="math inline">\(\nabla y_t\)</span>; en el tercer panel la serie diferenciada estacionalmente <span class="math inline">\(\nabla_{12} y_t\)</span>; y en el cuarto panel muestra la serie diferenciada regular y estacionalmente <span class="math inline">\(\nabla\nabla_{12} y_t\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-NacimientosDif" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-NacimientosDif-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-08-Tema8_files/figure-html/fig-NacimientosDif-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-NacimientosDif-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;1: Nacimientos mensuales y diferenciaciones
</figcaption>
</figure>
</div>
</div>
</div>
<p><em>¿Qué transformación para nacimientos consideras que genera una serie estacionaria, tanto en media como en varianza?</em> Siempre hay un cierto grado de subjetividad en la elección de las diferencias que hay que aplicar a una serie. En la <a href="#fig-NacimientosDif" class="quarto-xref">Figura&nbsp;1</a> podemos considerar que la diferenciación regular (panel 2) es suficiente para lograr la estacionariedad en media, pero no parece que la serie generada sea estacionaria en varianza. La diferenciación estacional (panel 3) ni siquiera es suficiente para que la serie sea estacionaria en media. Finalmente, si optamos por la doble diferenciación, regular y estacional (panel 4), tenemos el proceso que más claramente verifica las hipótesis de estacionariedad en media y en varianza.</p>
<p>Por último, indicar que <strong>la diferenciación (regular, estacional o ambas) también permite alcanzar la ergodicidad</strong>.</p>
<section id="diferenciación-con-r" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="diferenciación-con-r">Diferenciación con <code>R</code></h3>
<p>En el <a href="https://iarribasf.github.io/PrediccionSeriesTemporales-GBIA/03-06-Tema6.html">Tema 6</a> vimos la función <code>diff(x, lag = k)</code> que calculaba la diferencia de orden <code>k</code> y la usamos para obtener la diferencia regular <span class="math inline">\(\nabla y_t = y_t - y_{t-1}\)</span> como <code>diff(</code><span class="math inline">\(y_t\)</span><code>)</code>.</p>
<p>Por tanto, si <span class="math inline">\(m\)</span> es el orden estacional, <code>diff(x, lag = m)</code> calcula la diferencia estacional. Si necesitas calcular una diferencia regular y otra estacional, <span class="math inline">\(\nabla\nabla_m y_t\)</span>, debes usar <code>diff(diff(x, lag = m))</code>. El orden de las diferenciaciones no cambia el resultado.</p>
<p>Además, en <code>forecast</code> está disponible la función <code>nsdiffs</code> que estima el número de diferencias estacionales necesarias usando un criterio <em>ad-hoc</em>. Esta función complementa a <code>ndiffs</code>, usada ya para determinar el número de diferencias regulares. Veamos que indican para la serie Nacimientos</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ndiffs</span>(nacimientos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nsdiffs</span>(nacimientos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
</div>
<p><br>
</p>
</section>
</section>
<section id="diferencia-logaritmo-y-tasa-de-variación" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="diferencia-logaritmo-y-tasa-de-variación"><span class="header-section-number">2.2</span> Diferencia, Logaritmo y Tasa de variación</h2>
<p>Ya vimos que la diferencia regular del logaritmo es una tasa de variación, <span class="math inline">\(\nabla \log(y_t) =TV y_t\)</span>. Por ejemplo, para una serie mensual, la diferencia regular del logaritmo es la Tasa de Variación Mensual de la serie: <span class="math inline">\(\nabla \log(y_t)=TVM y_t\)</span>. Para una serie diaria, la diferencia regular del logaritmo sería la tasa de variación diaria.</p>
<p>Si se opta por la diferencia estacional, entonces <span class="math inline">\(\nabla_m \log(y_t) \approx \frac{y_t - y_{t-m}}{y_{t-m}}\)</span>. Es decir, para una serie mensual la diferencia estacional del logaritmo es la Tasa de Variación Anual de la serie: <span class="math inline">\(\nabla_{12} \log(y_t)=TVA y_t\)</span>. Igualmente, para una serie diaria, la diferencia estacional de su logaritmo sería la tasa de variación semanal.</p>
<p>Cuando una serie tiene que ser diferenciada tanto regular como estacionalmente para conseguir su estacionariedad, podemos escribir</p>
<p><span class="math display">\[\nabla_m \nabla \log(y_t) = \nabla_m TV y_t = TV y_t - TV y_{t-m},\]</span> que para una serie mensual se puede interpretar como una diferencia estacional de tasas mensuales <span class="math inline">\(TVM y_t - TVM y_{t-12}\)</span>. Es decir, como cambia de año en año la tasa de variación mensual.</p>
<p>También podemos escribir</p>
<p><span class="math display">\[\nabla \nabla_m \log(y_t) = \nabla TV_m y_t = TV_m y_t - TV_m y_{t-1},\]</span></p>
<p>que para una serie mensual se puede interpretar como una diferencia regular de tasas anuales <span class="math inline">\(TVA y_t - TVA y_{t-1}\)</span>. Es decir, Es decir, como cambia de mes en mes la tasa de variación anual.</p>
<p><br>
</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
La diferenciacion y el logaritmo en series con estacionalidad
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><p>Si se tiene una serie con estacionalidad y no estacionaria, lo usual es tener que diferenciarla una vez (regular o estacionalmente) o aplicar ambas diferenciaciones para que sea estacionaria en media, en varianza y ergódica.</p></li>
<li><p>Si hay una doble diferenciación, la transformación logarítmica se puede usar para ganar en interpretabilidad o para intentar mejorar las predicciones.</p></li>
<li><p>La transformación logarítmica no es necesaria para alcanzar la estacionariedad de la serie.</p></li>
</ul>
</div>
</div>
<p><br>
<br>
</p>
</section>
</section>
<section id="función-de-autocorrelación-y-ergodicidad." class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Función de autocorrelación y ergodicidad.</h1>
<p>Si la serie es estacionaria, el valor medio de la serie es constante y, por tanto, no informativo. <strong>Son las covarianzas los que caracterizan el proceso estocástico</strong>.</p>
<p>Recordemos que <span class="math inline">\(\gamma_k=Cov(y_t,y_{t-k})\)</span> es la autocovarianza de orden <span class="math inline">\(k\)</span>. Por tanto <span class="math inline">\(\gamma_0\)</span> es la varianza de la serie <span class="math inline">\(y_t\)</span>. Sea <span class="math inline">\(\rho_k\)</span> la autocorrelación se orden <span class="math inline">\(k\)</span>. Se puede verificar que <span class="math display">\[\rho_k = cor(y_t, y_{t-k}) =\frac{\gamma_k}{\gamma_0}.\]</span></p>
<ul>
<li><span class="math inline">\(\rho_1\)</span> mide la información que se transmite de un periodo al siguiente periodo.</li>
<li><span class="math inline">\(\rho_k\)</span> mide la información que se transmite k periodos hacia adelante.</li>
</ul>
<p>Las autocorrelaciones caracterizan el proceso estocástico, y <strong>la función de autocorrelación o correlograma (FAC, o ACF en inglés) es el gráfico de</strong> <span class="math inline">\(r_k\)</span> contra <span class="math inline">\(k\)</span>, donde <span class="math inline">\(r_k\)</span> es la estimación de <span class="math inline">\(\rho_k\)</span> obtenida con las observaciones.</p>
<section id="estacionariedad" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="estacionariedad">Estacionariedad</h3>
<p>Ya hemos visto que una forma sencilla de determinar si una serie es estacionaria es mirando su gráfica (recuerda los ejemplos del <a href="https://iarribasf.github.io/PrediccionSeriesTemporales-GBIA/03-06-Tema6.html">Tema 6</a>). Una alternativa es ver la FAC de la serie: <strong>la serie es estacionaria solo si los primeros valores de la función de autocorrelación decrecen rápidamente</strong>.</p>
</section>
<section id="ergodicidad" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="ergodicidad">Ergodicidad</h3>
<p>Recordemos que un proceso es ergódico si cuanto más distancia hay entre dos periodos, menos información se transmite. Es decir, que el pasado cada vez ayuda menos a entender el presente.</p>
<p>Una condición necesaria, pero no suficiente, para que un proceso estacionario sea ergódico es:</p>
<p><span class="math display">\[\lim_{k\rightarrow \infty} \rho_k = 0.\]</span></p>
<p>La FAC nos permite ver fácilmente si un proceso es ergodíco.</p>
<p><br>
<br>
</p>
<p>La función <code>ggAcf</code>, del paquete <code>forecast</code> obtiene la FAC de una serie, aunque también puedes usar la función <code>acf</code> del paquete <code>stats</code>. La <a href="#fig-NacimientosFAC" class="quarto-xref">Figura&nbsp;2</a> muestra la FAC para la serie Nacimientos y algunas de sus transformaciones. La primera columna muestra la FAC para Nacimientos y varias diferenciaciones, mientras que la segunda columna muestra la FAC para el logaritmo de los nacimientos y sus diferenciaciones.</p>
<p>Observa el diferente uso que hacemos del argumento <code>lag</code>. Como argumento de la función <code>diff</code> indica el orden estacional de la diferenciación y vale 12 (<code>lag = 12</code>). Como argumento de la función <code>ggAcf</code> indica el número de autocorrelaciones que queremos mostrar gráficamente y lo hemos fijado en 48 (<code>lag = 48</code>) para ver al menos lo que ocurre en 4 años.</p>
<p>Se puede concluir que:</p>
<ul>
<li>La FAC de una serie y de su transformación logarítmica son muy similares.</li>
<li>En los paneles de la primera y tercera fila las primeras autocorrelaciones decrecen lentamente. Este es un claro indicativo de que la serie analizada no es estacionaria ni ergódica.</li>
<li>En los paneles de la segunda fila las primeras autocorrelaciones decrecen rápidamente, indicando que la serie diferenciada es estacionaria. Sin embargo, las autocorrelaciones en las posiciones múltiplo de 12 (el orden estacional) no decrecen, indicando que la serie no es ergódica.</li>
<li>Solo la diferenciación regular y estacional de la serie (paneles de la última fila) muestran un rápido descenso en los primeros coeficientes de autocorrelación, indicando que la serie así transformada es estacionaria; y también un rápido descenso en los coeficientes múltiplos de 12, indicando que la serie diferenciada es ergódica.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># nacimientos es la serie de Nacimientos</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggAcf</span>(nacimientos, <span class="at">lag =</span> <span class="dv">48</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggAcf</span>(<span class="fu">log</span>(nacimientos), <span class="at">lag =</span> <span class="dv">48</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggAcf</span>(<span class="fu">diff</span>(nacimientos), <span class="at">lag =</span> <span class="dv">48</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggAcf</span>(<span class="fu">diff</span>(<span class="fu">log</span>(nacimientos)), <span class="at">lag =</span> <span class="dv">48</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggAcf</span>(<span class="fu">diff</span>(nacimientos, <span class="at">lag =</span> <span class="dv">12</span>), <span class="at">lag =</span> <span class="dv">48</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggAcf</span>(<span class="fu">diff</span>(<span class="fu">log</span>(nacimientos), <span class="at">lag =</span> <span class="dv">12</span>), <span class="at">lag =</span> <span class="dv">48</span>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggAcf</span>(<span class="fu">diff</span>(<span class="fu">diff</span>(nacimientos, <span class="at">lag =</span> <span class="dv">12</span>)), <span class="at">lag =</span> <span class="dv">48</span>)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggAcf</span>(<span class="fu">diff</span>(<span class="fu">diff</span>(<span class="fu">log</span>(nacimientos), <span class="at">lag =</span> <span class="dv">12</span>)), <span class="at">lag =</span> <span class="dv">48</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout="[[45,-10,45],[45,-10,45],[45,-10,45],[45,-10,45]]" data-layout-align="center">
<div id="fig-NacimientosFAC" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-NacimientosFAC-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-NacimientosFAC" style="flex-basis: 45.0%;justify-content: center;">
<div id="fig-NacimientosFAC-1" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-NacimientosFAC-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-08-Tema8_files/figure-html/fig-NacimientosFAC-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%" data-ref-parent="fig-NacimientosFAC">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-NacimientosFAC-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Serie original
</figcaption>
</figure>
</div>
</div>
<div class="quarto-figure-spacer quarto-layout-cell" style="flex-basis: 10.0%;justify-content: center;">
<p>&nbsp;</p>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-NacimientosFAC" style="flex-basis: 45.0%;justify-content: center;">
<div id="fig-NacimientosFAC-2" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-NacimientosFAC-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-08-Tema8_files/figure-html/fig-NacimientosFAC-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%" data-ref-parent="fig-NacimientosFAC">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-NacimientosFAC-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Logaritmo de la serie
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-NacimientosFAC" style="flex-basis: 45.0%;justify-content: center;">
<div id="fig-NacimientosFAC-3" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-NacimientosFAC-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-08-Tema8_files/figure-html/fig-NacimientosFAC-3.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%" data-ref-parent="fig-NacimientosFAC">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-NacimientosFAC-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(c) Dif. regular de la serie
</figcaption>
</figure>
</div>
</div>
<div class="quarto-figure-spacer quarto-layout-cell" style="flex-basis: 10.0%;justify-content: center;">
<p>&nbsp;</p>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-NacimientosFAC" style="flex-basis: 45.0%;justify-content: center;">
<div id="fig-NacimientosFAC-4" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-NacimientosFAC-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-08-Tema8_files/figure-html/fig-NacimientosFAC-4.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%" data-ref-parent="fig-NacimientosFAC">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-NacimientosFAC-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(d) Dif. regular del logaritmo la serie
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-NacimientosFAC" style="flex-basis: 45.0%;justify-content: center;">
<div id="fig-NacimientosFAC-5" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-NacimientosFAC-5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-08-Tema8_files/figure-html/fig-NacimientosFAC-5.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%" data-ref-parent="fig-NacimientosFAC">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-NacimientosFAC-5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(e) Dif. estacional de la serie
</figcaption>
</figure>
</div>
</div>
<div class="quarto-figure-spacer quarto-layout-cell" style="flex-basis: 10.0%;justify-content: center;">
<p>&nbsp;</p>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-NacimientosFAC" style="flex-basis: 45.0%;justify-content: center;">
<div id="fig-NacimientosFAC-6" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-NacimientosFAC-6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-08-Tema8_files/figure-html/fig-NacimientosFAC-6.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%" data-ref-parent="fig-NacimientosFAC">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-NacimientosFAC-6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(f) Dif. estacional del logaritmo la serie
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-NacimientosFAC" style="flex-basis: 45.0%;justify-content: center;">
<div id="fig-NacimientosFAC-7" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-NacimientosFAC-7-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-08-Tema8_files/figure-html/fig-NacimientosFAC-7.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%" data-ref-parent="fig-NacimientosFAC">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-NacimientosFAC-7-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(g) Dif. reg. y est. de la serie
</figcaption>
</figure>
</div>
</div>
<div class="quarto-figure-spacer quarto-layout-cell" style="flex-basis: 10.0%;justify-content: center;">
<p>&nbsp;</p>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-NacimientosFAC" style="flex-basis: 45.0%;justify-content: center;">
<div id="fig-NacimientosFAC-8" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-NacimientosFAC-8-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-08-Tema8_files/figure-html/fig-NacimientosFAC-8.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%" data-ref-parent="fig-NacimientosFAC">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-NacimientosFAC-8-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(h) Dif. reg. y est. del logaritmo la serie
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-NacimientosFAC-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;2: FAC para Nacimientos
</figcaption>
</figure>
</div>
</div>
<p>Las bandas azules de la FAC muestran el intervalo de confianza al 95% (IC95). Si <span class="math inline">\(\rho_k = 0\)</span>, el estimador <span class="math inline">\(r_k\)</span> se distribuye aproximadamente como una normal de media <span class="math inline">\(-1/T\)</span> y varianza <span class="math inline">\(1/T\)</span>. Las líneas punteadas de la FAC están dibujadas en las posiciones <span class="math inline">\(\frac{-1}{T} \pm \frac{1.96}{\sqrt{T}}\)</span>.</p>
<ul>
<li><p>Si <span class="math inline">\(r_k\)</span> cae fuera del IC95, hay evidencia para rechazar la hipótesis nula de que <span class="math inline">\(\rho_k = 0\)</span> a un nivel del 5%. Recordemos que incluso si todos los <span class="math inline">\(\rho_k\)</span> son cero, cabe esperar que un 5% de sus estimaciones <span class="math inline">\(r_k\)</span> caigan fuera del IC95.</p></li>
<li><p>Los <span class="math inline">\(\rho_k\)</span> no son independientes. Si uno toma un valor fuera del IC95, es más probable que los valores vecinos caigan también fuera.</p></li>
</ul>
<p>Si queremos ver los valores numéricos de las autocorrelaciones debemos añadir a la función <code>ggAfc</code> el argumento <code>plot = FALSE</code>. Para la serie doblemente diferenciada vemos que la relación más elevada se da para el primer retardo (<span class="math inline">\(r_{1}=-0.338\)</span>).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggAcf</span>(<span class="fu">diff</span>(<span class="fu">diff</span>(nacimientos, <span class="at">lag =</span> <span class="dv">12</span>)), </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">lag =</span> <span class="dv">24</span>, </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Autocorrelations of series 'diff(diff(nacimientos, lag = 12))', by lag

     0      1      2      3      4      5      6      7      8      9     10 
 1.000 -0.338 -0.038 -0.005 -0.118 -0.016  0.069 -0.056  0.058  0.102 -0.060 
    11     12     13     14     15     16     17     18     19     20     21 
 0.081 -0.311  0.060  0.052  0.053 -0.060  0.114 -0.040 -0.076  0.066 -0.061 
    22     23     24 
 0.008  0.157 -0.151 </code></pre>
</div>
</div>
<p><br>
<br>
</p>
</section>
</section>
<section id="procesos-arima-con-estacionalidad" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Procesos ARIMA con estacionalidad</h1>
<p><br>
</p>
<section id="procesos-autorregresivos-ar_mp" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="procesos-autorregresivos-ar_mp"><span class="header-section-number">4.1</span> Procesos autorregresivos <span class="math inline">\(AR_m(P)\)</span></h2>
<section id="definición" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="definición">Definición</h3>
<p>El modelo general <strong>autorregresivo estacional de orden P</strong>, <span class="math inline">\(y_t \sim AR_m(P)\)</span> viene definido por <span class="math display">\[y_t=c + \phi_m y_{t-m} + \phi_{2m} y_{t-2m} + \ldots + \phi_{Pm} y_{t-Pm} + \varepsilon_t,\]</span> que usando el operador retardo queda <span class="math display">\[(1 - \phi_m L^m - \phi_{2m} L^{2m} - \ldots - \phi_{Pm} L^{Pm})y_t = c + \varepsilon_t.\]</span></p>
</section>
<section id="ejemplos" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="ejemplos">Ejemplos</h3>
<ul>
<li><p><span class="math inline">\(y_t \sim AR_{12}(1):\;\;y_t = c + \phi_{12} y_{t-12} + \varepsilon_t\)</span> o <span class="math inline">\((1 - \phi_{12} L^{12})y_t = c + \varepsilon_t\)</span></p></li>
<li><p><span class="math inline">\(y_t \sim AR_7(2):\;\;y_t = c + \phi_7 y_{t-7} + \phi_{14} y_{t-14} + \varepsilon_t\)</span> o <span class="math inline">\((1 - \phi_7 L^7 - \phi_{14} L^{14})y_t = c + \varepsilon_t\)</span></p></li>
</ul>
<p><br>
</p>
</section>
</section>
<section id="procesos-en-medias-móviles-ma_mq" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="procesos-en-medias-móviles-ma_mq"><span class="header-section-number">4.2</span> Procesos en medias móviles <span class="math inline">\(MA_m(Q)\)</span></h2>
<section id="definición-1" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="definición-1">Definición</h3>
<p>El modelo general <strong>en medias móviles estacional de orden Q</strong>, <span class="math inline">\(y_t \sim MA_m(Q)\)</span> viene definido por <span class="math display">\[y_t=c + \varepsilon_t + \theta_m \varepsilon_{t-m} + \theta_{2m} \varepsilon_{t-2m} + \ldots +
  \theta_{Qm} \varepsilon_{t-Qm},\]</span> que usando el operador retardo queda <span class="math display">\[y_t = c + (1 + \theta_m L^m + \theta_{2m} L^{2m} + \ldots + \theta_{Qm} L^{Qm}) \varepsilon_t.\]</span></p>
</section>
<section id="ejemplos-1" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="ejemplos-1">Ejemplos</h3>
<ul>
<li><p><span class="math inline">\(y_t \sim MA_7(1):\;\;y_t = c + \varepsilon_t + \theta_7 \varepsilon_{t-7}\)</span> o <span class="math inline">\(y_t = c + (1 + \theta_7 L^7)\varepsilon_t\)</span></p></li>
<li><p><span class="math inline">\(y_t \sim MA_{12}(2):\;\;y_t=c + \varepsilon_t + \theta_{12} \varepsilon_{t-12} + \theta_{24} \varepsilon_{t-24}\)</span> o <span class="math inline">\(y_t = c + (1 + \theta_{12} L^{12} + \theta_{24} L^{24})\varepsilon_t\)</span></p></li>
</ul>
<p><br>
</p>
</section>
</section>
<section id="procesos-arma_mpq" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="procesos-arma_mpq"><span class="header-section-number">4.3</span> Procesos <span class="math inline">\(ARMA_m(P,Q)\)</span></h2>
<section id="definición-2" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="definición-2">Definición</h3>
<p>El modelo general <span class="math inline">\(y_t \sim ARMA_m(P,Q)\)</span> viene definido por</p>
<p><span class="math display">\[ y_t = c + \phi_m y_{t-m} + \phi_{2m} y_{t-2m} + \ldots + \phi_{Pm} y_{t-Pm}  +
  \varepsilon_t + \theta_m \varepsilon_{t-m} + \theta_{2m} \varepsilon_{t-2m} + \ldots +
  \theta_{Qm} \varepsilon_{t-Qm},
\]</span> que usando el operador retardo queda</p>
<p><span class="math display">\[(1 - \phi_m L^m - \ldots - \phi_{Pm} L^{Pm})y_t = c + (1 + \theta_m L^m + \ldots + \theta_{Qm} L^{Qm}) \varepsilon_t.\]</span></p>
</section>
<section id="ejemplos-2" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="ejemplos-2">Ejemplos</h3>
<ul>
<li><p><span class="math inline">\(y_t \sim ARMA_7(1, 1):\;\;y_t = c + \phi_7 y_{t-7} + \theta_7 \varepsilon_{t-7} + \varepsilon_{t}\)</span> o <span class="math inline">\((1 - \phi_7 L^7)y_t = c + (1 + \theta_7 L^7)\varepsilon_t\)</span>.</p></li>
<li><p><span class="math inline">\(y_t \sim ARMA_{12}(1, 1):\;\;y_t = c + \phi_{12} y_{t-12} + \theta_{12} \varepsilon_{t-12} + \varepsilon_{t}\)</span> o <span class="math inline">\((1 - \phi_{12} L^{12})y_t = c + (1 + \theta_{12} L^{12})\varepsilon_t\)</span>.</p></li>
</ul>
<p><br>
</p>
</section>
</section>
<section id="procesos-arima_mpdq" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="procesos-arima_mpdq"><span class="header-section-number">4.4</span> Procesos <span class="math inline">\(ARIMA_m(P,D,Q)\)</span></h2>
<p>Si la serie <span class="math inline">\(y_t\)</span> no es estacionaria en su parte estacional, pero tras diferenciarla <span class="math inline">\(D\)</span> veces se hace estacionaria, diremos que la serie es integrada estacionalmente de orden <span class="math inline">\(D\)</span>: <span class="math inline">\(y_t \sim I_m(D)\)</span>. Por tanto,</p>
<ul>
<li>una serie estacionaria estacionalmente se indicará como <span class="math inline">\(y_t \sim I_m(0)\)</span>.</li>
<li><span class="math inline">\(y_t \sim I_m(1)\)</span> es equivalente a <span class="math inline">\(\nabla_m y_t = (1 - L^m)y_t \sim I_m(0)\)</span></li>
</ul>
<p>Una serie <span class="math inline">\(y_t\)</span> sigue un proceso <span class="math inline">\(ARIMA_m(P,D,Q)\)</span> si:</p>
<ol type="1">
<li>hay que diferenciarla estacionalmente <span class="math inline">\(D\)</span> veces para hacerla estacionaria, <span class="math inline">\(y_t \sim I_m(D)\)</span>; y</li>
<li>la serie diferenciada sigue un proceso ARMA(P, Q), <span class="math inline">\(\nabla_m^D y_t \sim ARMA_m(P,Q)\)</span>.</li>
</ol>
<p>Entonces, podemos escribir <span class="math inline">\(y_t \sim ARIMA_m(P,D,Q)\)</span> como <span class="math display">\[\begin{equation*}
\begin{array}{c@{\quad}ccc}
  (1 - \phi_m L^m - \ldots - \phi_{Pm} L^{Pm}) &amp; (1- L^m)^D y_t &amp; = &amp; c + (1 + \theta_m L^m + \ldots + \theta_{Qm} L^{Qm}) \varepsilon_t \\
  \uparrow                                     &amp; \uparrow       &amp;   &amp; \uparrow \\
   AR_m(P)                                     &amp; I_m(D)         &amp;   &amp; MA_m(Q)
\end{array}
\end{equation*}\]</span></p>
<section id="ejemplo" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="ejemplo">Ejemplo</h3>
<ul>
<li><span class="math inline">\(y_t \sim ARIMA_{12}(1, 1, 1):\;\;(1 - \phi_{12} L^{12})(1- L^{12}) y_t = c + (1 + \theta_{12} L^{12}) \varepsilon_t\)</span> o <span class="math inline">\(y_t = c + y_{t-12} + \phi_{12}(y_{t-12} - y_{t-24}) + \theta_{12} \varepsilon_{t-12} + \varepsilon_t\)</span>.</li>
<li><span class="math inline">\(log(y_t) \sim ARIMA_{12}(1, 1, 1):\;\;(1 - \phi_{12} L^{12})(1- L^{12}) log(y_t) = (1 - \phi_{12} L^{12})TVAy_t  = c + (1 + \theta_{12} L^{12}) \varepsilon_t\)</span> o <span class="math inline">\(TVAy_t = c + \phi_{12}TVAy_{t-12} + \theta_{12} \varepsilon_{t-12} + \varepsilon_t\)</span>.</li>
</ul>
<p><br>
</p>
</section>
</section>
<section id="proceso-arima_mpdqpdq" class="level2" data-number="4.5">
<h2 data-number="4.5" class="anchored" data-anchor-id="proceso-arima_mpdqpdq"><span class="header-section-number">4.5</span> Proceso <span class="math inline">\(ARIMA_m(p,d,q)(P,D,Q)\)</span></h2>
<p>La realidad nos muestra que la mayoría de las series con estacionalidad se ajustan a una combinación de <em>procesos regulares y estacionales</em>.</p>
<p>El proceso <span class="math inline">\(ARIMA_m(p, d, q)(P, D, Q)\)</span> puede ser expresado como <span class="math display">\[\begin{equation*}
\begin{array}{ccccc}
  AR(p) &amp; AR_m(P) &amp; I(d) &amp; I_m(D) &amp;  \\
  \downarrow &amp; \downarrow &amp; \downarrow &amp; \downarrow  &amp;  \\
  (1 - \phi_1 L - \ldots - \phi_p L^p) &amp; (1 - \phi_m L^m - \ldots - \phi_{Pm} L^{Pm}) &amp; (1 - L)^d &amp; (1- L^m)^Dy_t &amp; = \\
  c + (1 + \theta_1 L + \ldots + \theta_q L^q) &amp; (1 + \theta_m L^m + \ldots + \theta_{Qm} L^{Qm}) \varepsilon_t &amp; &amp; &amp; \\
  \uparrow &amp; \uparrow &amp; &amp; &amp; \\
  MA(q) &amp; MA_m(Q)  &amp; &amp; &amp;
\end{array}
\end{equation*}\]</span></p>
<p>Por ejemplo, entre las series mensuales uno de los procesos más comunes es <span class="math inline">\(ARIMA_{12}(0, 1, 1)(0, 1, 1)\)</span>, denominado <em>modelo de las aerolíneas</em> por ser el proceso generador de datos de muchas series mensuales de transporte de pasajeros, en concreto la serie mensual de pasajeros de avión. La ecuación de este modelo es</p>
<p><span class="math display">\[(1-L)(1-L^{12})y_t = (1+ \theta_1L)(1 + \theta_{12}L^{12})\varepsilon_t\]</span> que si desarrollamos queda <span class="math display">\[y_t = y_{t-1} + (y_{t-12} - y_{t-13}) + \theta_1 \varepsilon_{t-1} + \theta_{12} \varepsilon_{t-12} + \theta_{1}\theta_{12} \varepsilon_{t-13} + \varepsilon_t \]</span></p>
<ul>
<li>El número de pasajeros del mes <span class="math inline">\(t\)</span> es el mismo que el del mes previo <span class="math inline">\(t-1\)</span>, más la diferencia entre estos meses observada el año pasado.</li>
<li>Si en los meses usados para la predicción (<span class="math inline">\(t-1\)</span>, <span class="math inline">\(t-12\)</span> y <span class="math inline">\(t-13\)</span>) ha ocurrido algo extraordinario, hay que tenerlo en cuenta a la hora de afinar la predicción.</li>
</ul>
<p>Si usamos la <strong>transformación logarítmica</strong>, tendríamos <span class="math display">\[(1-L)(1-L^{12})\log(y_t) = (1+ \theta_1L)(1 + \theta_{12}L^{12})\varepsilon_t\]</span> o <span class="math display">\[(1-L)TVAy_t = (1+ \theta_1L)(1 + \theta_{12}L^{12})\varepsilon_t\]</span> que desarrollando queda <span class="math display">\[TVAy_t = TVAy_{t-1} + \theta_1 \varepsilon_{t-1} + \theta_{12} \varepsilon_{t-12} + \theta_{1}\theta_{12} \varepsilon_{t-13} + \varepsilon_t \]</span></p>
<ul>
<li>La tasa de variación anual en el número de pasajeros del mes <span class="math inline">\(t\)</span> es la misma que la del mes previo <span class="math inline">\(t-1\)</span>.</li>
<li>Si en los meses usados para la predicción (<span class="math inline">\(t-1\)</span>, <span class="math inline">\(t-12\)</span> y <span class="math inline">\(t-13\)</span>) ha ocurrido algo extraordinario, hay que tenerlo en cuenta a la hora de afinar la predicción.</li>
</ul>
<p><br>
<br>
</p>
</section>
</section>
<section id="ejemplos-3" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Ejemplos</h1>
<p><br>
</p>
<section id="nacimientos" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="nacimientos"><span class="header-section-number">5.1</span> Nacimientos</h2>
<p>Vamos a aplicar la metodología de Box-Jenkins a la serie de <strong>nacimientos en España</strong> desde el año 2000 (véase <a href="#fig-Nacimientos" class="quarto-xref">Figura&nbsp;3</a>).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>nacimientos <span class="ot">&lt;-</span> <span class="fu">read.csv2</span>(<span class="st">"./series/Nacimientos.csv"</span>, </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>nacimientos <span class="ot">&lt;-</span> <span class="fu">ts</span>(nacimientos[, <span class="dv">2</span>],</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1975</span>, <span class="dv">1</span>),</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">freq =</span> <span class="dv">12</span>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>nacimientos <span class="ot">&lt;-</span> <span class="fu">window</span>(nacimientos, <span class="at">start =</span> <span class="dv">2000</span>)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(nacimientos,</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"Nacimientos"</span>,</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-Nacimientos" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-Nacimientos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-08-Tema8_files/figure-html/fig-Nacimientos-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-Nacimientos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;3: Nacimientos mensuales
</figcaption>
</figure>
</div>
</div>
</div>
<section id="transformación-de-la-serie" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="transformación-de-la-serie">Transformación de la serie</h3>
<p>Para nacimientos las funciones <code>ndiffs</code> y <code>nsdiffs</code> sugieren la doble diferenciación regular y estacional para alcanzar la estacionariedad.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ndiffs</span>(nacimientos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nsdiffs</span>(nacimientos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
</div>
<p>Veamos ahora que transformación es necesaria para que sea ergódica. Además, trabajaremos con el logaritmo de la serie para ganar en interpretabilidad.</p>
<p>Excepcionalmente se ha fijado la escala del eje OY desde -1 a 1 (argumento <code>ylim</code>) en las cuatro FAC para mejorar su comparación e interpretación. A la hora de comparar gráficas, fíjate si la escala es la misma.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggAcf</span>(<span class="fu">log</span>(nacimientos), <span class="at">lag =</span> <span class="dv">48</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">ylab =</span> <span class="st">""</span>, <span class="at">main =</span> <span class="st">""</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggAcf</span>(<span class="fu">diff</span>(<span class="fu">log</span>(nacimientos)), <span class="at">lag =</span> <span class="dv">48</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>), </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">ylab =</span> <span class="st">""</span>, <span class="at">main =</span> <span class="st">""</span>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggAcf</span>(<span class="fu">diff</span>(<span class="fu">log</span>(nacimientos), <span class="at">lag =</span> <span class="dv">12</span>), <span class="at">lag =</span> <span class="dv">48</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">ylab =</span> <span class="st">""</span>, <span class="at">main =</span> <span class="st">""</span>)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggAcf</span>(<span class="fu">diff</span>(<span class="fu">diff</span>(<span class="fu">log</span>(nacimientos), <span class="at">lag =</span> <span class="dv">12</span>)), <span class="at">lag =</span> <span class="dv">48</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">ylab =</span> <span class="st">""</span>, <span class="at">main =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout="[[50,50],[50,50]]" data-layout-align="center">
<div id="fig-NacFAC" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-NacFAC-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-NacFAC" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-NacFAC-1" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-NacFAC-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-08-Tema8_files/figure-html/fig-NacFAC-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%" data-ref-parent="fig-NacFAC">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-NacFAC-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Serie
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-NacFAC" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-NacFAC-2" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-NacFAC-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-08-Tema8_files/figure-html/fig-NacFAC-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%" data-ref-parent="fig-NacFAC">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-NacFAC-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Diferencia regular
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-NacFAC" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-NacFAC-3" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-NacFAC-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-08-Tema8_files/figure-html/fig-NacFAC-3.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%" data-ref-parent="fig-NacFAC">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-NacFAC-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(c) Diferencia estacional
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-NacFAC" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-NacFAC-4" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-NacFAC-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-08-Tema8_files/figure-html/fig-NacFAC-4.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%" data-ref-parent="fig-NacFAC">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-NacFAC-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(d) Diferencia regular y estacional
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-NacFAC-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;4: FAC para Nacimientos (log)
</figcaption>
</figure>
</div>
</div>
<p>Para que la serie sea estacionaria y ergódica es necesaria la doble diferenciación regular y estacional. Es decir, trabajaremos con la siguiente serie transformada <span class="math display">\[\nabla\nabla_{12}\log(nacimientos_t) \sim I(0)I_{12}(0).\]</span></p>
</section>
<section id="identificación" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="identificación">Identificación</h3>
<p>¿Qué nos indica <code>auto.arima</code>? Primero vamos a generar e incluir en el proceso de autoidentificación las variables asociadas a los efectos de intervención que hemos detectado en los temas previos. En concreto, hemos visto que el número de días del mes explica el número de nacimientos. Este efecto era muy claro para los meses de febrero bisiestos. Para el calculo de la variable que recoge el número de días del mes usaremos la función <code>monthdays</code> de la librería <code>forecast</code> que devuelve el número de días de cada mes o trimestre de una serie.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">monthdays</span>(nacimientos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>     Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec
2000  31  29  31  30  31  30  31  31  30  31  30  31
2001  31  28  31  30  31  30  31  31  30  31  30  31
2002  31  28  31  30  31  30  31  31  30  31  30  31
2003  31  28  31  30  31  30  31  31  30  31  30  31
2004  31  29  31  30  31  30  31  31  30  31  30  31</code></pre>
</div>
</div>
<p>Por otro lado, los periodos vacacionales pueden afectar la programación de las cesáreas e influir en el número de nacimientos. Como la Semana Santa es un periodo festivo que puede caer en marzo o abril, dependiendo del año, los nacimientos en estos dos meses pueden variar según como cae la Semana Santa. Para capturar este efecto, usaremos la función <code>easter</code> de la librería <code>forecast</code> que devuelve para cada mes la proporción de días de la Semana Santa que contiene (considerando solo del Viernes Santo al Domingo de Resurrección, tres días).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">easter</span>(nacimientos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>      Jan  Feb  Mar  Apr  May  Jun  Jul  Aug  Sep  Oct  Nov  Dec
2015 0.00 0.00 0.00 1.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00
2016 0.00 0.00 1.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00
2017 0.00 0.00 0.00 1.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00
2018 0.00 0.00 0.67 0.33 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00
2019 0.00 0.00 0.00 1.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00</code></pre>
</div>
</div>
<p>Además, vimos en el tema de Alisado que en enero de 2011, diciembre de 2020 y febrero y marzo de 2021 el número de nacimientos era atípico.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>DiasMes <span class="ot">&lt;-</span> <span class="fu">monthdays</span>(nacimientos)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>SemanaSanta <span class="ot">&lt;-</span> <span class="fu">easter</span>(nacimientos)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>d0111 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">*</span>(<span class="fu">cycle</span>(nacimientos) <span class="sc">==</span> <span class="dv">1</span>  <span class="sc">&amp;</span> <span class="fu">trunc</span>(<span class="fu">time</span>(nacimientos)) <span class="sc">==</span> <span class="dv">2011</span>)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>d1220 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">*</span>(<span class="fu">cycle</span>(nacimientos) <span class="sc">==</span> <span class="dv">12</span> <span class="sc">&amp;</span> <span class="fu">trunc</span>(<span class="fu">time</span>(nacimientos)) <span class="sc">==</span> <span class="dv">2020</span>)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>d0221 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">*</span>(<span class="fu">cycle</span>(nacimientos) <span class="sc">==</span> <span class="dv">2</span>  <span class="sc">&amp;</span> <span class="fu">trunc</span>(<span class="fu">time</span>(nacimientos)) <span class="sc">==</span> <span class="dv">2021</span>)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>d0321 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">*</span>(<span class="fu">cycle</span>(nacimientos) <span class="sc">==</span> <span class="dv">3</span>  <span class="sc">&amp;</span> <span class="fu">trunc</span>(<span class="fu">time</span>(nacimientos)) <span class="sc">==</span> <span class="dv">2021</span>)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="fu">auto.arima</span>(nacimientos, </span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">d =</span> <span class="dv">1</span>, </span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">D =</span> <span class="dv">1</span>, </span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">lambda =</span> <span class="dv">0</span>,</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">xreg =</span> <span class="fu">cbind</span>(DiasMes, SemanaSanta, </span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>                        d0111, d1220, d0221, d0321))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: nacimientos 
Regression with ARIMA(0,1,2)(0,1,2)[12] errors 
Box Cox transformation: lambda= 0 

Coefficients:
          ma1      ma2     sma1     sma2  DiasMes  SemanaSanta    d0111
      -0.3127  -0.1613  -0.7015  -0.1249   0.0266      -0.0173  -0.0772
s.e.   0.0864   0.1012   0.0635   0.0627   0.0083       0.0050   0.0187
        d1220   d0221   d0321
      -0.0936  0.0468  0.0570
s.e.   0.0221  0.0223  0.0226

sigma^2 = 0.0005765:  log likelihood = 635.04
AIC=-1248.07   AICc=-1247.07   BIC=-1208.29</code></pre>
</div>
</div>
<p>Indica el modelo, <span class="math inline">\(ARIMA_{12}(0,1,2)(0,1,2)\)</span>, donde los coeficiente <code>ma2</code> y <code>sma2</code> no parecen ser significativos. Si esto es así, estaríamos ante el modelo de la aerolíneas. Por otro lado, parece que los coeficientes del modelo asociados a las variables de intervención son significativas.</p>
<p><br>
</p>
<p>Una alternativa a <code>auto.arima</code> es la función <code>seas</code> de la librería <code>seasonal</code>. La función <code>seas</code> tiene como ventajas que también analiza automáticamente la conveniencia de usar la transformación logarítmica, que identifica posibles efectos calendario y valores extremos, y que suele ser más parsimoniosa que <code>auto.arima</code>. Su desventaja es que sólo se puede aplicar para series mensuales o trimestrales.</p>
<p>La aplicación de <code>seas</code> sobre la serie indica que no es necesaria la transformación logarítmica así que solicitamos la identificación automática forzando la transformación. Veamos que identificación ofrece <code>seas</code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">#summary(seas(nacimientos))</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">seas</span>(nacimientos, <span class="at">transform.function =</span> <span class="st">"log"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
seas(x = nacimientos, transform.function = "log")

Coefficients:
                    Estimate Std. Error z value Pr(&gt;|z|)    
Weekday            0.0028341  0.0002676  10.589  &lt; 2e-16 ***
Easter[1]         -0.0132747  0.0039909  -3.326  0.00088 ***
AO2010.Dec         0.0655881  0.0141737   4.627 3.70e-06 ***
AO2020.Nov        -0.0656768  0.0153456  -4.280 1.87e-05 ***
AO2020.Dec        -0.2016273  0.0159295 -12.657  &lt; 2e-16 ***
AO2021.Jan        -0.1568422  0.0154818 -10.131  &lt; 2e-16 ***
MA-Nonseasonal-01  0.4250414  0.0541258   7.853 4.07e-15 ***
MA-Seasonal-12     0.7584950  0.0413099  18.361  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

SEATS adj.  ARIMA: (0 1 1)(0 1 1)  Obs.: 288  Transform: log
AICc:  4348, BIC:  4380  QS (no seasonality in final):    0  
Box-Ljung (no autocorr.): 25.18   Shapiro (normality): 0.9913 .</code></pre>
</div>
</div>
<p>En primer lugar, la función identifica el modelo de las aerolíneas con la transformación logarítmica de Nacimientos. Además, un efecto calendario Semana Santa, un efecto calendario días laborables del mes (que podemos entender similar a nuestro efecto días del mes) y cuatro meses atípicos en diciembre de 2010, noviembre y diciembre de 2020 y enero de 2021.</p>
<p>Tras las dos autoidentificaciones complementarias, decidimos que la identificación de partida es <span class="math inline">\(ARIMA_{12}(0,1,1)(0,1,1) + AI\)</span>, <span class="math display">\[(1 - L)(1 - L^{12})\log(nacimientos_t) = (1 + \theta_1 L)(1 + \theta_{12} L^{12})\varepsilon_t + AI.\]</span> donde <em>AI</em> recoge las variables de intervención incluidas en <code>auto.arima</code> y <code>seas</code>.</p>
</section>
<section id="estimación-y-valores-extremos" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="estimación-y-valores-extremos">Estimación (y valores extremos)</h3>
<p>Vamos a estimar el modelo identificado, incluidas las nuevas variables de intervención identificadas con la función <code>seas</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>d1210 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">*</span>(<span class="fu">cycle</span>(nacimientos) <span class="sc">==</span> <span class="dv">12</span> <span class="sc">&amp;</span> <span class="fu">trunc</span>(<span class="fu">time</span>(nacimientos)) <span class="sc">==</span> <span class="dv">2010</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>d1120 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">*</span>(<span class="fu">cycle</span>(nacimientos) <span class="sc">==</span> <span class="dv">11</span> <span class="sc">&amp;</span> <span class="fu">trunc</span>(<span class="fu">time</span>(nacimientos)) <span class="sc">==</span> <span class="dv">2020</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>d0121 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">*</span>(<span class="fu">cycle</span>(nacimientos) <span class="sc">==</span>  <span class="dv">1</span> <span class="sc">&amp;</span> <span class="fu">trunc</span>(<span class="fu">time</span>(nacimientos)) <span class="sc">==</span> <span class="dv">2021</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>nac.ar1 <span class="ot">&lt;-</span> <span class="fu">Arima</span>(nacimientos, </span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">seasonal =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>                 <span class="at">lambda =</span> <span class="dv">0</span>,</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>                 <span class="at">xreg =</span> <span class="fu">cbind</span>(DiasMes, SemanaSanta, </span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>                              d1210,  d0111, d1120, d1220, d0121, d0221, d0321)) </span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>nac.ar1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: nacimientos 
Regression with ARIMA(0,1,1)(0,1,1)[12] errors 
Box Cox transformation: lambda= 0 

Coefficients:
          ma1     sma1  DiasMes  SemanaSanta   d1210    d0111    d1120    d1220
      -0.5569  -0.7506   0.0293      -0.0167  0.0664  -0.0533  -0.0831  -0.2060
s.e.   0.0513   0.0408   0.0075       0.0050  0.0171   0.0171   0.0178   0.0185
        d0121    d0221   d0321
      -0.1880  -0.0542  0.0229
s.e.   0.0188   0.0187  0.0180

sigma^2 = 0.0004212:  log likelihood = 680.41
AIC=-1336.83   AICc=-1335.63   BIC=-1293.42</code></pre>
</div>
</div>
<p>Ya tenemos un modelo de partida, aunque parece que el coeficiente de la intervención en marzo de 2021 no es significativo. Veamos si es necesaria más intervención.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>error <span class="ot">&lt;-</span> <span class="fu">residuals</span>(nac.ar1)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>sderror <span class="ot">&lt;-</span> <span class="fu">sd</span>(error)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(error, <span class="at">series=</span><span class="st">"Error"</span>,</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"Error"</span>,</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="sc">-</span><span class="dv">2</span>,<span class="dv">2</span>, <span class="dv">3</span>)<span class="sc">*</span>sderror, </span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"green"</span>, <span class="st">"green"</span>, <span class="st">"red"</span>), </span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span> <span class="fu">seq</span>(<span class="dv">2000</span>, <span class="dv">2024</span>, <span class="dv">2</span>)) </span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>fechas <span class="ot">&lt;-</span> <span class="fu">format</span>(<span class="fu">seq</span>(<span class="fu">as.Date</span>(<span class="st">"2000-1-1"</span>), <span class="fu">as.Date</span>(<span class="st">"2023-12-1"</span>), <span class="st">"month"</span>), <span class="st">"%Y-%m"</span>)</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>fechas[<span class="fu">abs</span>(error) <span class="sc">&gt;</span> <span class="fl">2.5</span> <span class="sc">*</span> sderror]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2006-12" "2016-04" "2016-06" "2022-11"</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-NacError" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-NacError-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-08-Tema8_files/figure-html/fig-NacError-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-NacError-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;5: Error + Intervención
</figcaption>
</figure>
</div>
</div>
</div>
<p>Se observa que hay cuatro candidatos a valores atípicos en diciembre de 2006, abril y junio de 2016 y noviembre de 2022, dado que los errores asociados se acercan o superan las 3 desviaciones típicas. En junio de 2016 no hay evidencia de que ocurriera nada atípico en los nacimientos y el coeficiente de esta variable resulta no ser significativo si lo incluimos en el modelo. Por tanto, no crearemos una variable asociada a este mes. Para los otros tres meses:</p>
<ul>
<li>Se crea una variable de intervención para cada caso</li>
<li>Se estima de nuevo el modelo incluyendo estas variables (<code>auto.arima</code> identifica el mismo modelo).</li>
<li>Se vuelve a analizar si quedan valores atípicos</li>
</ul>
<p>Además, aprovechamos para excluir la variable de intervención de marzo de 2021 que no era significativa</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>d1206 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">*</span>(<span class="fu">cycle</span>(nacimientos) <span class="sc">==</span> <span class="dv">12</span> <span class="sc">&amp;</span> <span class="fu">trunc</span>(<span class="fu">time</span>(nacimientos)) <span class="sc">==</span> <span class="dv">2006</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>d0416 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">*</span>(<span class="fu">cycle</span>(nacimientos) <span class="sc">==</span>  <span class="dv">4</span> <span class="sc">&amp;</span> <span class="fu">trunc</span>(<span class="fu">time</span>(nacimientos)) <span class="sc">==</span> <span class="dv">2016</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>d1122 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">*</span>(<span class="fu">cycle</span>(nacimientos) <span class="sc">==</span> <span class="dv">11</span> <span class="sc">&amp;</span> <span class="fu">trunc</span>(<span class="fu">time</span>(nacimientos)) <span class="sc">==</span> <span class="dv">2022</span>)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>nac.ar2 <span class="ot">&lt;-</span> <span class="fu">Arima</span>(nacimientos, </span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">seasonal =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>                 <span class="at">lambda =</span> <span class="dv">0</span>,</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>                 <span class="at">xreg =</span> <span class="fu">cbind</span>(DiasMes, SemanaSanta, </span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>                              d1206, d1210, d0111, d0416,</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>                              d1120, d1220, d0121, d0221, d1122))</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>nac.ar2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: nacimientos 
Regression with ARIMA(0,1,1)(0,1,1)[12] errors 
Box Cox transformation: lambda= 0 

Coefficients:
          ma1     sma1  DiasMes  SemanaSanta    d1206   d1210    d0111    d0416
      -0.5125  -0.7599   0.0279      -0.0222  -0.0460  0.0621  -0.0547  -0.0542
s.e.   0.0550   0.0398   0.0071       0.0050   0.0158  0.0164   0.0163   0.0165
        d1120    d1220    d0121    d0221   d1122
      -0.0799  -0.2101  -0.1939  -0.0620  0.0404
s.e.   0.0171   0.0176   0.0177   0.0172  0.0165

sigma^2 = 0.0003917:  log likelihood = 691.41
AIC=-1354.83   AICc=-1353.21   BIC=-1304.19</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>error <span class="ot">&lt;-</span> <span class="fu">residuals</span>(nac.ar2)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>sderror <span class="ot">&lt;-</span> <span class="fu">sd</span>(error)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(error, <span class="at">series=</span><span class="st">"Error"</span>,</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"Error"</span>,</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>)<span class="sc">*</span>sderror, </span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"green"</span>, <span class="st">"green"</span>, <span class="st">"red"</span>), </span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span> <span class="fu">seq</span>(<span class="dv">2000</span>, <span class="dv">2022</span>, <span class="dv">2</span>)) </span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a><span class="co"># fechas[abs(error) &gt; 2.5 * sderror]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-NacError2" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-NacError2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-08-Tema8_files/figure-html/fig-NacError2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-NacError2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;6: Error + Intervención
</figcaption>
</figure>
</div>
</div>
</div>
<p>No se observan errores elevados, así que vamos a asumir que ya no hay valores extremos.</p>
</section>
<section id="compensación" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="compensación">Compensación</h3>
<p>Podemos observar que en todos los modelos estimados los coeficientes de las variables de intervención de los <strong>meses consecutivos</strong> diciembre de 2010 y enero de 2011 son similares pero de signo opuesto. A este tipo de intervención se le denomina compensación: el efecto extraordinario en un periodo se compensa con un efecto de similar magnitud pero signo opuesto en el periodo siguiente. La causa detrás de esta compensación puede ser tan prosaica como que por error muchos nacimientos ocurridos en enero de 2011 se asignaron informaticamente a diciembre de 2010. O quizás algo pasó en esos meses que adelantó un número considerable de nacimientos.</p>
<p>Vamos a crear una variable de intervención asociada a esta compensación. Es tan sencillo como definir una variable ficticia que valga cero siempre excepto para los meses de diciembre de 2010 y enero de 2011 que valdrá 1 y - 1 respectivamente.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Creacion del la compensacion</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>d12100111 <span class="ot">&lt;-</span> d1210 <span class="sc">-</span> d0111</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Respecto del efecto de la pandemia en la serie, las dos intervenciones asociadas al inicio y final del efecto (noviembre de 2020 y febrero de 2021) tienen un valor similar, y las dos intervenciones asociadas al corazón del efecto (diciembre de 2020 y enero de 2021) también tienen un valor parecido. En este caso las dos variables ficticias que vamos a crear deben valer cero siempre excepto para dos meses que valdrán 1. La primera variable valdrá 1 en noviembre de 2020 y febrero de 2021, y la segunda variable valdrá 1 en diciembre de 2020 y enero de 2021.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Variables de intervencion asociadas a la Covid-19</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>d11200221 <span class="ot">&lt;-</span> d1120 <span class="sc">+</span> d0221</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>d12200121 <span class="ot">&lt;-</span> d1220 <span class="sc">+</span> d0121</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ahora vamos a sustituir las seis variables ficticias <code>d1210</code>, <code>d0111</code>, <code>d1120</code>, <code>d1220</code>, <code>d0121</code> y <code>d0221</code> del modelo por las nuevas variables <code>d12100111</code>, <code>d11200221</code> y <code>d12200121</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>nac.ar3 <span class="ot">&lt;-</span> <span class="fu">Arima</span>(nacimientos, </span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">seasonal =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">lambda =</span> <span class="dv">0</span>,</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">xreg =</span> <span class="fu">cbind</span>(DiasMes, SemanaSanta, </span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>                              d1206, d12100111, d0416,</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>                              d11200221, d12200121, d1122))</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>nac.ar3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: nacimientos 
Regression with ARIMA(0,1,1)(0,1,1)[12] errors 
Box Cox transformation: lambda= 0 

Coefficients:
          ma1     sma1  DiasMes  SemanaSanta    d1206  d12100111    d0416
      -0.5063  -0.7607   0.0276      -0.0221  -0.0462     0.0584  -0.0541
s.e.   0.0546   0.0399   0.0071       0.0050   0.0158     0.0099   0.0165
      d11200221  d12200121   d1122
        -0.0710    -0.2022  0.0418
s.e.     0.0131     0.0145  0.0164

sigma^2 = 0.000389:  log likelihood = 690.79
AIC=-1359.59   AICc=-1358.58   BIC=-1319.8</code></pre>
</div>
</div>
<p>Los coeficientes estimados en este modelo son prácticamente iguales a los obtenidos en el modelo previo.</p>
</section>
<section id="validación" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="validación">Validación</h3>
<p>Vamos si todos los coeficientes del modelo son significativos.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(nac.ar3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
z test of coefficients:

              Estimate Std. Error  z value  Pr(&gt;|z|)    
ma1         -0.5062827  0.0545897  -9.2743 &lt; 2.2e-16 ***
sma1        -0.7606907  0.0398969 -19.0664 &lt; 2.2e-16 ***
DiasMes      0.0275858  0.0071012   3.8847 0.0001025 ***
SemanaSanta -0.0221422  0.0049579  -4.4661 7.967e-06 ***
d1206       -0.0462432  0.0157747  -2.9315 0.0033735 ** 
d12100111    0.0584458  0.0099443   5.8773 4.170e-09 ***
d0416       -0.0541083  0.0165482  -3.2697 0.0010765 ** 
d11200221   -0.0710234  0.0130601  -5.4382 5.383e-08 ***
d12200121   -0.2021734  0.0144820 -13.9604 &lt; 2.2e-16 ***
d1122        0.0418207  0.0163895   2.5517 0.0107204 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Todos los coeficientes son significativos al 5%.</p>
</section>
<section id="error-de-estimación" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="error-de-estimación">Error de estimación</h3>
<p>El error medio de -61, muy bajo en comparación con el valor medio de la serie, y el MPE de -0.17 indican que no hay sesgo. Además, el valor tan reducido de ACF1 indica que las previsiones por intervalo estarán correctamente calculadas.</p>
<p>En media nos equivocamos en 683 bebés (RMSE) y el error porcentual medio es del 1.5%.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(nac.ar3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>                 ME   RMSE    MAE   MPE MAPE MASE ACF1
Training set -60.62 682.74 547.63 -0.17 1.54  0.4 0.03</code></pre>
</div>
</div>
</section>
<section id="error-de-predicción-estramuestral-según-horizonte-temporal" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="error-de-predicción-estramuestral-según-horizonte-temporal">Error de predicción estramuestral según horizonte temporal</h3>
<p>Asumimos que se precisan quince años para hacer una buena estimación, <span class="math inline">\(k = 180\)</span>, y fijaremos el horizonte temporal en un año, <span class="math inline">\(h = 12\)</span> meses.</p>
<p>El código es aun más complejo que el visto en el tema previo. Por un lado, hemos de tener en cuenta que hay variables de intervención y por otro lado que la función <code>Arima</code> podría fallar en el proceso de estimación.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">180</span>                   </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>h <span class="ot">&lt;-</span> <span class="dv">12</span>                    </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>T <span class="ot">&lt;-</span> <span class="fu">length</span>(nacimientos)   </span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>s<span class="ot">&lt;-</span>T <span class="sc">-</span> k <span class="sc">-</span> h               </span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>mapeArima <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, s <span class="sc">+</span> <span class="dv">1</span>, h)</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">cbind</span>(DiasMes, SemanaSanta))</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">0</span><span class="sc">:</span>s) {</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>  train.set <span class="ot">&lt;-</span> <span class="fu">subset</span>(nacimientos, <span class="at">start =</span> i <span class="sc">+</span> <span class="dv">1</span>, <span class="at">end =</span> i <span class="sc">+</span> k)</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>  test.set <span class="ot">&lt;-</span>  <span class="fu">subset</span>(nacimientos, <span class="at">start =</span> i <span class="sc">+</span> k <span class="sc">+</span> <span class="dv">1</span>, <span class="at">end =</span> i <span class="sc">+</span> k <span class="sc">+</span> h) </span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>  X.train <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(X[(i <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>(i <span class="sc">+</span> k),])</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>  X.test <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(X[(i <span class="sc">+</span> k <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>(i <span class="sc">+</span> k <span class="sc">+</span> h),])</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>  fit <span class="ot">&lt;-</span> <span class="fu">try</span>(<span class="fu">Arima</span>(train.set, </span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>                   <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>                   <span class="at">seasonal =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>                   <span class="at">lambda =</span> <span class="dv">0</span>,</span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>                   <span class="at">xreg =</span> X.train))</span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.element</span>(<span class="st">"try-error"</span>, <span class="fu">class</span>(fit))) {</span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>    fcast <span class="ot">&lt;-</span> <span class="fu">forecast</span>(fit, <span class="at">h =</span> h, <span class="at">xreg =</span> X.test) </span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>    mapeArima[i <span class="sc">+</span> <span class="dv">1</span>,] <span class="ot">&lt;-</span> <span class="dv">100</span><span class="sc">*</span><span class="fu">abs</span>(test.set <span class="sc">-</span> fcast<span class="sc">$</span>mean)<span class="sc">/</span>test.set</span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Como para el cálculo de los errores de predicción no se ha tenido en cuenta la intervención no sujeta a afectos calendario (la compensación a finales de 2010, la Covid-19…), vamos a obtener el error mediano como medida de precisión.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>errorArima <span class="ot">&lt;-</span> <span class="fu">apply</span>(mapeArima, <span class="at">MARGIN =</span> <span class="dv">2</span>, <span class="at">FUN =</span> median, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>errorArima</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 1.407992 1.400730 1.686976 1.778348 1.750788 1.571241 1.977455 1.962138
 [9] 2.122341 2.116743 1.740723 2.068629</code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">y =</span> errorArima), <span class="at">colour =</span> <span class="st">"Blue"</span>) <span class="sc">+</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Horizonte temporal de predicción"</span>) <span class="sc">+</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"%"</span>) <span class="sc">+</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-NacMAPE" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-NacMAPE-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-08-Tema8_files/figure-html/fig-NacMAPE-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-NacMAPE-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;7: Error de predicción (MedAPE) según horizonte temporal
</figcaption>
</figure>
</div>
</div>
</div>
<p>La <a href="#fig-NacMAPE" class="quarto-xref">Figura&nbsp;7</a> revela que el error de predicción aumenta según aumenta el horizonte de predicción, pero incluso a un año vista, se mantiene cercano al 2%.</p>
</section>
<section id="interpretación" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="interpretación">Interpretación</h3>
<p>El <em>modelo teórico</em> es <span class="math inline">\(log(nacimientos) \sim ARIMA_{12}(0, 1, 1)(0, 1, 1) + AI\)</span>,</p>
<p><span class="math display">\[(1 - L^{12})(1 - L)\log(nacimientos_t) = (1 + \theta_1 L)(1 + \theta_{12} L^{12})\varepsilon_t + AI.\]</span></p>
<p>Si sustituimos <span class="math inline">\((1 - L^{12})\log(nacimientos_t)\)</span> por <span class="math inline">\(TVA_{nacimientos_t}\)</span>, la tasa de variación anual de los nacimientos, y desarrollamos queda <span class="math display">\[
\begin{aligned}
TVA\_nac_t  = &amp; TVA\_nac_{t - 1} + \theta_1 \varepsilon_{t-1} + \theta_{12} \varepsilon_{t-12} + \theta_1\theta_{12} \varepsilon_{t-13} +  \varepsilon_{t}+ \\
&amp; \gamma_1 \cdot DiasMes_t + \gamma_2 \cdot SemanaSanta +\gamma_3 \cdot d1206_t + \gamma_4 \cdot d12100111_t + \\
&amp; \gamma_5 \cdot d0416_t + \gamma_6 \cdot d11200221_t + \gamma_7 \cdot d12200121_t + \gamma_8 \cdot d1122_t.
\end{aligned}
\]</span></p>
<p>Finalmente, el <em>modelo estimado</em> es, <span class="math display">\[
\begin{aligned}
\widehat{TVA}\_nac_t = &amp; TVA\_nac_{t-1}  - 0.51\varepsilon_{t-1} - 0.76\varepsilon_{t-12} + 0.39\varepsilon_{t-13} + \\
&amp; 0.028 \cdot DiasMes_t - 0.022 \cdot SemanaSanta - 0.046 \cdot d1206_t + 0.058 \cdot d12100111_t \\
&amp; - 0.054 \cdot d0416_t - 0.071 \cdot d11200221_t - 0.20  \cdot d12200121_t + 0.042 \cdot d1122.
\end{aligned}
\]</span></p>
<ul>
<li><p>En cada mes, <strong>la tasa de variación anual de los nacimientos es la misma que la del mes pasado</strong> (<span class="math inline">\(\widehat{TVA}_{nacimientos_t} = TVA_{nacimientos_{t-1}}\)</span>).</p></li>
<li><p>Además, si algunos de los meses necesarios para predecir fue anómalo, el error hay que tenerlo en cuenta para afinar la previsión.</p></li>
<li><p>Respecto de los efectos calendario, cada día adicional de un mes nacen un 2.8% más de bebés. El mes en que cae la Semana Santa los nacimientos caen un 2.2%.</p></li>
<li><p>Por alguna razón, en diciembre de 2006 hubo un 4.6% menos de nacimientos de lo esperado; en diciembre de 2010 hubo un 5.8% más de nacimientos de lo esperado que fue compensado en enero de 2011; en abril de 2016 hubo un 5.4% menos de nacimientos de lo esperado; y en noviembre de 2022 hubo un 4.1% más de nacimientos.</p></li>
<li><p>Respecto de la pandemia, nueve meses después del confinamiento hubo una reducción transitoria en el número de nacimientos. En concreto, en noviembre de 2020 se redujeron un 7.1% y en los dos meses siguientes la caída fue de un 20%. En febrero de 2021 los nacimientos se recuperaron parcialmente y la caída fue del 7.1%. A partir de marzo de 2021 los nacimientos recuperaron los valores prepandemia.</p></li>
</ul>
</section>
<section id="predicción-de-la-serie" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="predicción-de-la-serie">Predicción de la serie</h3>
<p>Una vez dado por válido el modelo podemos pasar a realizar predicciones. Hay que tener en cuenta que hay siete variables de intervención, dos de ellas son efectos calendario (DiasMes y SemanaSanta), para las que debemos indicar qué valores tomarán en el periodo de predicción. Vamos a fijar el horizonte de predicción en cuatro años y mostrar los resultados numéricamente (solo para el primer año) y gráficamente (<a href="#fig-NacPre" class="quarto-xref">Figura&nbsp;8</a>).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> <span class="fu">ts</span>(<span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">48</span>), <span class="at">start =</span> <span class="dv">2024</span>, <span class="at">freq =</span> <span class="dv">12</span>)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>pdm <span class="ot">&lt;-</span> <span class="fu">monthdays</span>(tmp)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>pss <span class="ot">&lt;-</span> <span class="fu">easter</span>(tmp)</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>pnac.ar3 <span class="ot">&lt;-</span> <span class="fu">forecast</span>(nac.ar3, </span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">h =</span> <span class="dv">48</span>,</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">xreg =</span> <span class="fu">cbind</span>(pdm, pss, </span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">48</span>), <span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">48</span>), <span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">48</span>),</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">48</span>), <span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">48</span>), <span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">48</span>)), </span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">level =</span> <span class="dv">95</span>)</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>pnac.ar3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>         Point Forecast    Lo 95    Hi 95
Jan 2024       27053.45 26027.68 28119.66
Feb 2024       24871.69 23822.29 25967.32
Mar 2024       25954.92 24759.70 27207.85
Apr 2024       25592.81 24323.70 26928.14
May 2024       26130.96 24749.32 27589.73
Jun 2024       25986.39 24532.41 27526.53
Jul 2024       27707.00 26076.31 29439.67
Aug 2024       27722.56 26014.58 29542.67
Sep 2024       27547.83 25778.28 29438.85
Oct 2024       28022.05 26151.64 30026.24
Nov 2024       26577.70 24739.60 28552.38
Dec 2024       26502.57 24608.13 28542.85</code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(pnac.ar3, </span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Nacimientos"</span>,</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span> <span class="fu">seq</span>(<span class="dv">2000</span>, <span class="dv">2028</span>, <span class="dv">2</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-NacPre" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-NacPre-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-08-Tema8_files/figure-html/fig-NacPre-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-NacPre-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;8: Nacimientos (2000-2023) y predicción (2024-2027)
</figcaption>
</figure>
</div>
</div>
</div>
<p><br>
</p>
</section>
</section>
<section id="exportaciones" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="exportaciones"><span class="header-section-number">5.2</span> Exportaciones</h2>
<p>Consideremos la serie de <strong>exportaciones de bienes desde España hacía la UE27</strong> (conjunto de 27 países de la Unión Europea, con Reino Unido ya ha excluido). La serie va de enero de 1999 hasta diciembre de 2023 y está en millones de euros.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>exportaciones <span class="ot">&lt;-</span> <span class="fu">read.csv2</span>(<span class="st">"./series/Exportaciones.csv"</span>, </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>                           <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>exportaciones <span class="ot">&lt;-</span> <span class="fu">ts</span>(exportaciones,</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1999</span>, <span class="dv">1</span>),</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">freq =</span> <span class="dv">12</span>)</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(exportaciones,</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"Millones de €"</span>,</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-Exportaciones" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-Exportaciones-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-08-Tema8_files/figure-html/fig-Exportaciones-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-Exportaciones-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;9: Exportaciones de España a la EU27
</figcaption>
</figure>
</div>
</div>
</div>
<section id="transformación-de-la-serie-1" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="transformación-de-la-serie-1">Transformación de la serie</h3>
<p>La <a href="#fig-Exportaciones" class="quarto-xref">Figura&nbsp;9</a> deja claro que la serie debe ser diferenciada para ser estacionaria. También muestra dos periodos con una marcada intervención: al inicio de la Gran Recesión (2008-2014) y durante el periodo más duro de la Covid-19 en el año 2020. Además, por la naturaleza de la serie es previsible que exista un efecto días del mes o días laborables y un efecto Semana Santa.</p>
<p>Por otro lado, la <a href="#fig-Exportaciones" class="quarto-xref">Figura&nbsp;9</a> muestra que la serie tiene un esquema multiplicativa, así que trabajaremos con la transformación logarítmica.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggAcf</span>(<span class="fu">log</span>(exportaciones), <span class="at">lag =</span> <span class="dv">48</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">ylab =</span> <span class="st">""</span>, <span class="at">main =</span> <span class="st">""</span>)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggAcf</span>(<span class="fu">diff</span>(<span class="fu">log</span>(exportaciones)), <span class="at">lag =</span> <span class="dv">48</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">ylab =</span> <span class="st">""</span>, <span class="at">main =</span> <span class="st">""</span>)</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggAcf</span>(<span class="fu">diff</span>(<span class="fu">log</span>(exportaciones), <span class="at">lag =</span> <span class="dv">12</span>), <span class="at">lag =</span> <span class="dv">48</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">ylab =</span> <span class="st">""</span>, <span class="at">main =</span> <span class="st">""</span>)</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggAcf</span>(<span class="fu">diff</span>(<span class="fu">diff</span>(<span class="fu">log</span>(exportaciones), <span class="at">lag =</span> <span class="dv">12</span>)), <span class="at">lag =</span> <span class="dv">48</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">ylab =</span> <span class="st">""</span>, <span class="at">main =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout="[[50,50],[50,50]]" data-layout-align="center">
<div id="fig-ExpFAC" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ExpFAC-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-ExpFAC" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-ExpFAC-1" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-ExpFAC-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-08-Tema8_files/figure-html/fig-ExpFAC-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%" data-ref-parent="fig-ExpFAC">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-ExpFAC-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Serie
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-ExpFAC" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-ExpFAC-2" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-ExpFAC-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-08-Tema8_files/figure-html/fig-ExpFAC-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%" data-ref-parent="fig-ExpFAC">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-ExpFAC-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Diferencia regular
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-ExpFAC" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-ExpFAC-3" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-ExpFAC-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-08-Tema8_files/figure-html/fig-ExpFAC-3.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%" data-ref-parent="fig-ExpFAC">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-ExpFAC-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(c) Diferencia estacional
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-ExpFAC" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-ExpFAC-4" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-ExpFAC-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-08-Tema8_files/figure-html/fig-ExpFAC-4.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%" data-ref-parent="fig-ExpFAC">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-ExpFAC-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(d) Diferencia regular y estacional
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ExpFAC-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;10: FAC para Exportaciones (log)
</figcaption>
</figure>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ndiffs</span>(<span class="fu">log</span>(exportaciones))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nsdiffs</span>(<span class="fu">log</span>(exportaciones))       </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
</div>
<p>El análisis de la <a href="#fig-ExpFAC" class="quarto-xref">Figura&nbsp;10</a> revela la necesidad de la doble diferenciación, que es confirmada por las funciones <code>ndiffs</code> y <code>nsdiffs</code>. Concluimos que para que la serie sea estacionaria y ergódica es necesaria la doble diferenciación regular y estacional. Es decir, trabajaremos con la siguiente serie transformada <span class="math display">\[\nabla\nabla_{12}\log(exportaciones_t) \sim I(0)I_{12}(0).\]</span></p>
</section>
<section id="identificación-1" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="identificación-1">Identificación</h3>
<p>Si probamos con la función <code>auto.arima</code>, indicando la doble diferenciación y añadiendo el efecto de los días del mes y la Semana Santa, nos sugiere <span class="math inline">\(ARIMA_{12}(2,1,2)(2,1,2)\)</span>. Demasiado complejo.</p>
<p>Veamos qué nos indica <code>seas</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">seas</span>(exportaciones))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
seas(x = exportaciones)

Coefficients:
                    Estimate Std. Error z value Pr(&gt;|z|)    
Mon               -0.0002753  0.0036983  -0.074 0.940664    
Tue                0.0140569  0.0036324   3.870 0.000109 ***
Wed                0.0091676  0.0036440   2.516 0.011876 *  
Thu                0.0094801  0.0036551   2.594 0.009495 ** 
Fri                0.0131957  0.0036349   3.630 0.000283 ***
Sat               -0.0187370  0.0036035  -5.200 2.00e-07 ***
Easter[1]         -0.0678310  0.0075546  -8.979  &lt; 2e-16 ***
LS2008.Dec        -0.1891898  0.0292510  -6.468 9.94e-11 ***
AO2020.Mar        -0.1694793  0.0292773  -5.789 7.09e-09 ***
AO2020.Apr        -0.5021644  0.0304350 -16.500  &lt; 2e-16 ***
AO2020.May        -0.2740737  0.0292955  -9.356  &lt; 2e-16 ***
LS2023.Apr        -0.1323508  0.0325300  -4.069 4.73e-05 ***
MA-Nonseasonal-01  0.4091021  0.0531795   7.693 1.44e-14 ***
MA-Seasonal-12     0.6302998  0.0456916  13.795  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

SEATS adj.  ARIMA: (0 1 1)(0 1 1)  Obs.: 300  Transform: log
AICc:  4270, BIC:  4324  QS (no seasonality in final):    0  
Box-Ljung (no autocorr.): 40.16 * Shapiro (normality): 0.996  
Messages generated by X-13:
Warnings:
- At least one visually significant trading day peak has been
  found in one or more of the estimated spectra.</code></pre>
</div>
</div>
<p>El modelo identificado es el de las aerolíneas para la transformación logarítmica de Exportaciones. Respecto de la intervención, identifica dos efectos calendario: uno por cada día laboral y Semana Santa. También se identifican cinco intervenciones no asociadas a efectos calendario: tres pulsos –intervenciones que afectan un solo mes (AO)– y dos cambios permanentes –intervenciones que afectan un rango elevado de meses (LS):</p>
<ul>
<li>Un cambio permanente (<em>level shift</em> o LS) empieza en diciembre de 2008 y el coeficiente estimado es negativo. Es decir, la Gran Recesión generó una caída permanente de las exportaciones españolas a la UE27.</li>
<li>El otro cambio permanente, también de signo negativo, empieza en abril de 2023 y corrige a la baja el elevado nivel de las exportaciones observado tras la pandemia.</li>
<li>También asociado a la Covid-19 están los pulsos de marzo, abril y mayo de 2020.</li>
</ul>
</section>
<section id="estimación-y-valores-extremos-1" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="estimación-y-valores-extremos-1">Estimación (y valores extremos)</h3>
<p>Vamos a estimar el modelo identificado con <code>seas</code>, incluidas las variables de intervención. A este respecto unas palabras sobre como obtener los días laborables de un mes.</p>
<p>Entenderemos por días laborables los lunes a viernes de cada mes, menos los días festivos. Un inconveniente de este efecto es que los festivos que afectan a una serie dependen de su naturaleza y ámbito geográfico. Por ejemplo, en Estados Unidos el día del trabajador se celebra el primer lunes de septiembre, en Reino Unido el primer lunes de mayo y en España el 1 de mayo. Además, para la serie de transporte de pasajeros urbanos de Valencia los festivos relevantes serán diferentes que para la misma serie para Madrid.</p>
<p>Para el ámbito geográfico nacional, los días laborables se puede obtener con la función <code>bizdays</code>. Esta función devuelve el número de días laborables de cada mes para determinados centros financieros (equivalentes a países). Por proximidad <em>geográfica</em>, usaremos el calendario de Londres para España.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>DiasLaborables <span class="ot">&lt;-</span> <span class="fu">bizdays</span>(exportaciones, <span class="at">FinCenter =</span> <span class="st">"London"</span>)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>SemanaSanta <span class="ot">&lt;-</span> <span class="fu">easter</span>(exportaciones)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Para los pulsos, que solo afectan un mes, se crea una variable que vale cero excepto para el mes a intervenir que vale 1.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>d0320 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">*</span>(<span class="fu">cycle</span>(exportaciones) <span class="sc">==</span>  <span class="dv">3</span> <span class="sc">&amp;</span> <span class="fu">trunc</span>(<span class="fu">time</span>(exportaciones)) <span class="sc">==</span> <span class="dv">2020</span>)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>d0420 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">*</span>(<span class="fu">cycle</span>(exportaciones) <span class="sc">==</span>  <span class="dv">4</span> <span class="sc">&amp;</span> <span class="fu">trunc</span>(<span class="fu">time</span>(exportaciones)) <span class="sc">==</span> <span class="dv">2020</span>)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>d0520 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">*</span>(<span class="fu">cycle</span>(exportaciones) <span class="sc">==</span>  <span class="dv">5</span> <span class="sc">&amp;</span> <span class="fu">trunc</span>(<span class="fu">time</span>(exportaciones)) <span class="sc">==</span> <span class="dv">2020</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Para los cambios permanentes que afectan desde un mes en adelante, se crea una variable que vale cero antes del mes de inicio de la intervención y 1 desde ese mes en adelante.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>l1208 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">*</span>(<span class="fu">trunc</span>(<span class="fu">time</span>(exportaciones)) <span class="sc">&gt;</span> <span class="dv">2008</span>) <span class="sc">+</span> </span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span><span class="sc">*</span>(<span class="fu">cycle</span>(exportaciones) <span class="sc">&gt;=</span> <span class="dv">12</span> <span class="sc">&amp;</span> <span class="fu">trunc</span>(<span class="fu">time</span>(exportaciones)) <span class="sc">==</span> <span class="dv">2008</span>)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>l0423 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">*</span>(<span class="fu">trunc</span>(<span class="fu">time</span>(exportaciones)) <span class="sc">&gt;</span> <span class="dv">2023</span>) <span class="sc">+</span> </span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span><span class="sc">*</span>(<span class="fu">cycle</span>(exportaciones) <span class="sc">&gt;=</span> <span class="dv">4</span> <span class="sc">&amp;</span> <span class="fu">trunc</span>(<span class="fu">time</span>(exportaciones)) <span class="sc">==</span> <span class="dv">2023</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Estimamos el modelo de partida, en el que parece que todos los coeficientes son significativos.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>exp.ar1 <span class="ot">&lt;-</span> <span class="fu">Arima</span>(exportaciones, </span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">seasonal =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">lambda =</span> <span class="dv">0</span>,</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">xreg =</span> <span class="fu">cbind</span>(DiasLaborables, SemanaSanta, </span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>                              l1208, d0320, d0420, d0520, l0423))</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>exp.ar1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: exportaciones 
Regression with ARIMA(0,1,1)(0,1,1)[12] errors 
Box Cox transformation: lambda= 0 

Coefficients:
          ma1     sma1  DiasLaborables  SemanaSanta    l1208    d0320    d0420
      -0.4580  -0.6519          0.0315      -0.0206  -0.1956  -0.1822  -0.5051
s.e.   0.0491   0.0516          0.0018       0.0093   0.0307   0.0314   0.0325
        d0520    l0423
      -0.2672  -0.1277
s.e.   0.0318   0.0341

sigma^2 = 0.001465:  log likelihood = 530.59
AIC=-1041.19   AICc=-1040.39   BIC=-1004.59</code></pre>
</div>
</div>
<p>Veamos si es necesaria más intervención.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>error <span class="ot">&lt;-</span> <span class="fu">residuals</span>(exp.ar1)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>sderror <span class="ot">&lt;-</span> <span class="fu">sd</span>(error)</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(error, <span class="at">series=</span><span class="st">"Error"</span>,</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"Error"</span>,</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="sc">-</span><span class="dv">2</span>,<span class="dv">2</span>, <span class="dv">3</span>)<span class="sc">*</span>sderror, </span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"green"</span>, <span class="st">"green"</span>, <span class="st">"red"</span>), </span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span> <span class="fu">seq</span>(<span class="dv">1998</span>, <span class="dv">2022</span>, <span class="dv">2</span>)) </span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>fechas <span class="ot">&lt;-</span> <span class="fu">format</span>(<span class="fu">seq</span>(<span class="fu">as.Date</span>(<span class="st">"1999-1-1"</span>), <span class="fu">as.Date</span>(<span class="st">"2023-12-1"</span>), <span class="st">"month"</span>), <span class="st">"%Y-%m"</span>)</span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>fechas[<span class="fu">abs</span>(error) <span class="sc">&gt;</span> <span class="fl">2.5</span> <span class="sc">*</span> sderror]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2008-10" "2010-06" "2012-06" "2013-08" "2020-06"</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-ExpError" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ExpError-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-08-Tema8_files/figure-html/fig-ExpError-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ExpError-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;11: Error + Intervención
</figcaption>
</figure>
</div>
</div>
</div>
<p>Se observan algunos candidatos a valores atípicos por superar el error las 2.5 desviaciones típicas, pero ninguna alcanza las 3 desviaciones típicas. A fin de aligerar este ejemplo no se van a incluir más variables de intervención.</p>
</section>
<section id="validación-1" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="validación-1">Validación</h3>
<p>Veamos si los coeficientes del modelo son significativos. Para ello, aplicamos la prueba z.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(exp.ar1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
z test of coefficients:

                 Estimate Std. Error  z value  Pr(&gt;|z|)    
ma1            -0.4580059  0.0490920  -9.3295 &lt; 2.2e-16 ***
sma1           -0.6518852  0.0515779 -12.6389 &lt; 2.2e-16 ***
DiasLaborables  0.0314654  0.0018045  17.4371 &lt; 2.2e-16 ***
SemanaSanta    -0.0206082  0.0092680  -2.2236 0.0261758 *  
l1208          -0.1956032  0.0306802  -6.3755 1.823e-10 ***
d0320          -0.1822087  0.0313723  -5.8080 6.324e-09 ***
d0420          -0.5050739  0.0324815 -15.5496 &lt; 2.2e-16 ***
d0520          -0.2672099  0.0317877  -8.4061 &lt; 2.2e-16 ***
l0423          -0.1276646  0.0341494  -3.7384 0.0001852 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Todos los coeficientes son significativos.</p>
</section>
<section id="error-de-estimación-1" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="error-de-estimación-1">Error de estimación</h3>
<p>En media nos equivocamos en 456 millones de euros (RMSE) y el error porcentual medio es del 2.8%, muy reducido.</p>
<p>La serie no presenta sesgo y el intervalo de confianza para las predicciones es válido.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(exp.ar1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>                 ME   RMSE    MAE   MPE MAPE MASE  ACF1
Training set -10.34 456.31 327.43 -0.25 2.82  0.3 -0.04</code></pre>
</div>
</div>
</section>
<section id="error-de-predicción-estramuestral-según-horizonte-temporal-1" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="error-de-predicción-estramuestral-según-horizonte-temporal-1">Error de predicción estramuestral según horizonte temporal</h3>
<p>Asumimos que se precisan diez años para hacer una buena estimación, <span class="math inline">\(k = 120\)</span>, y fijaremos el horizonte temporal en un año, <span class="math inline">\(h = 12\)</span> meses. Usaremos como criterio de calidad el MedAPE</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">120</span>                   </span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>h <span class="ot">&lt;-</span> <span class="dv">12</span>                    </span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>T <span class="ot">&lt;-</span> <span class="fu">length</span>(exportaciones)   </span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> T <span class="sc">-</span> k <span class="sc">-</span> h               </span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>mapeArima <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, s <span class="sc">+</span> <span class="dv">1</span>, h)</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">cbind</span>(DiasLaborables, SemanaSanta))</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">0</span><span class="sc">:</span>s) {</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>  train.set <span class="ot">&lt;-</span> <span class="fu">subset</span>(exportaciones, <span class="at">start =</span> i <span class="sc">+</span> <span class="dv">1</span>, <span class="at">end =</span> i <span class="sc">+</span> k)</span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>  test.set <span class="ot">&lt;-</span>  <span class="fu">subset</span>(exportaciones, <span class="at">start =</span> i <span class="sc">+</span> k <span class="sc">+</span> <span class="dv">1</span>, <span class="at">end =</span> i <span class="sc">+</span> k <span class="sc">+</span> h) </span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>  X.train <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(X[(i <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>(i <span class="sc">+</span> k),])</span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>  X.test <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(X[(i <span class="sc">+</span> k <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>(i <span class="sc">+</span> k <span class="sc">+</span> h),])</span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a>  fit <span class="ot">&lt;-</span> <span class="fu">try</span>(<span class="fu">Arima</span>(train.set, </span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a>                   <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true" tabindex="-1"></a>                   <span class="at">seasonal =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb63-20"><a href="#cb63-20" aria-hidden="true" tabindex="-1"></a>                   <span class="at">lambda =</span> <span class="dv">0</span>,</span>
<span id="cb63-21"><a href="#cb63-21" aria-hidden="true" tabindex="-1"></a>                   <span class="at">xreg =</span> X.train))</span>
<span id="cb63-22"><a href="#cb63-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb63-23"><a href="#cb63-23" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.element</span>(<span class="st">"try-error"</span>, <span class="fu">class</span>(fit))) {</span>
<span id="cb63-24"><a href="#cb63-24" aria-hidden="true" tabindex="-1"></a>    fcast <span class="ot">&lt;-</span> <span class="fu">forecast</span>(fit, <span class="at">h =</span> h, <span class="at">xreg =</span> X.test) </span>
<span id="cb63-25"><a href="#cb63-25" aria-hidden="true" tabindex="-1"></a>    mapeArima[i <span class="sc">+</span> <span class="dv">1</span>,] <span class="ot">&lt;-</span> <span class="dv">100</span><span class="sc">*</span><span class="fu">abs</span>(test.set <span class="sc">-</span> fcast<span class="sc">$</span>mean)<span class="sc">/</span>test.set</span>
<span id="cb63-26"><a href="#cb63-26" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb63-27"><a href="#cb63-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb63-28"><a href="#cb63-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-29"><a href="#cb63-29" aria-hidden="true" tabindex="-1"></a>errorArima <span class="ot">&lt;-</span> <span class="fu">apply</span>(mapeArima, <span class="at">MARGIN =</span> <span class="dv">2</span>, <span class="at">FUN =</span> median, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb63-30"><a href="#cb63-30" aria-hidden="true" tabindex="-1"></a>errorArima</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 2.528064 2.604219 2.972136 3.220444 3.666207 4.098874 4.505794 4.770593
 [9] 4.935492 4.797301 4.768106 5.412510</code></pre>
</div>
</div>
<p>Para evitar el efecto sobre los errores de predicción de la no inclusión de las variables ficticias se ha calculado el error mediano. La <a href="#fig-ExpMAPE" class="quarto-xref">Figura&nbsp;12</a> revela que el error de predicción aumenta lentamente según aumenta el horizonte de predicción, pasando del 2.5% a un mes vista hasta el 5.4% a 12 meses vista.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">y =</span> errorArima), <span class="at">colour =</span> <span class="st">"Blue"</span>) <span class="sc">+</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Horizonte temporal de predicción"</span>) <span class="sc">+</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"%"</span>) <span class="sc">+</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-ExpMAPE" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ExpMAPE-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-08-Tema8_files/figure-html/fig-ExpMAPE-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ExpMAPE-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;12: Error de predicción (MedAPE) según horizonte temporal
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="interpretación-1" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="interpretación-1">Interpretación</h3>
<p>La parte regular del modelo estimado es la misma que la obtenida para la serie Nacimientos y su interpretación es, por tanto, idéntica: en cada mes, <strong>la tasa de variación anual de las exportaciones es la misma que la del mes pasado</strong>. Además, si algunos de los meses necesarios para predecir fue anómalo, el error hay que tenerlo en cuenta para afinar la previsión.</p>
<p>Vamos por tanto a centrarnos en la interpretación de la intervención:</p>
<ul>
<li>Cada día laborable adicional en un mes aumenta las exportaciones en un 3.1% (coeficiente <span class="math inline">\(0.0315\)</span> de <code>DiasLAborables</code>)</li>
<li>El mes en que cae la Semana Santa las exportaciones caen un 2.1%. (coeficiente <span class="math inline">\(-0.0206\)</span> de <code>SemanaSanta</code>)</li>
<li>A raíz de la Gran Recesión, las exportaciones se redujeron de forma permanente un 19.6% desde diciembre de 2008. Es decir, sin la Gran Recesión, las exportaciones ahora serían un 19.6% superiores (coeficiente <span class="math inline">\(-0.1956\)</span> de <code>l1208</code>)</li>
<li>A raíz de la Covid-19, las exportaciones se redujeron de forma temporal en los meses de marzo, abril y mayo de 2020 un 18%, 51% y 27%, respectivamente.</li>
<li>Además, el nivel de las exportaciones se ha corregido a la baja desde abril de 2023 un 12.8% (coeficiente <span class="math inline">\(-0.1277\)</span> de <code>l0423</code>).</li>
</ul>
</section>
<section id="predicción-de-la-serie-1" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="predicción-de-la-serie-1">Predicción de la serie</h3>
<p>Una vez dado por válido el modelo, podemos pasar a realizar predicciones teniendo en cuenta las siete variables de intervención:</p>
<ul>
<li>Dos de ellas son efectos calendario (DiasLaborables y SemanaSanta), para las que debemos indicar qué valores tomarán en el periodo de predicción</li>
<li>Otras dos son cambios permanentes y su valor debe ser 1 en el futuro.</li>
<li>Solo para los pulsos, se fijará un valor futuro de 0.</li>
</ul>
<p>Vamos a fijar el horizonte de predicción en cuatro años y mostrar los resultados numérica (solo para el primer año) y gráficamente (<a href="#fig-ExpPre" class="quarto-xref">Figura&nbsp;13</a>).</p>
<p>Recuerda siempre incluir las variables ficticias en la función <code>forecast</code> en el mismo orden que aparecen en la estimación con <code>Arima</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> <span class="fu">ts</span>(<span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">48</span>), <span class="at">start =</span> <span class="dv">2024</span>, <span class="at">freq =</span> <span class="dv">12</span>)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>pdl <span class="ot">&lt;-</span> <span class="fu">bizdays</span>(tmp, <span class="at">FinCenter =</span> <span class="st">"London"</span>)</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>pss <span class="ot">&lt;-</span> <span class="fu">easter</span>(tmp)</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>pexp.ar1 <span class="ot">&lt;-</span> <span class="fu">forecast</span>(exp.ar1, </span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">h =</span> <span class="dv">48</span>,</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">xreg =</span> <span class="fu">cbind</span>(pdl, pss, </span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">rep</span>(<span class="dv">1</span>,<span class="dv">48</span>), </span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">48</span>), <span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">48</span>), <span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">48</span>),</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">rep</span>(<span class="dv">1</span>,<span class="dv">48</span>)), </span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>                     <span class="at">level =</span> <span class="dv">95</span>)</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>pexp.ar1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>         Point Forecast    Lo 95    Hi 95
Jan 2024       20398.15 18923.71 21987.48
Feb 2024       20935.60 19223.06 22800.71
Mar 2024       21820.13 19851.88 23983.51
Apr 2024       22452.95 20257.25 24886.64
May 2024       23319.37 20876.66 26047.89
Jun 2024       22484.03 19983.70 25297.19
Jul 2024       21850.14 19288.37 24752.14
Aug 2024       16463.85 14439.96 18771.40
Sep 2024       22737.88 19820.28 26084.96
Oct 2024       23111.43 20027.50 26670.24
Nov 2024       23491.95 20242.32 27263.27
Dec 2024       21372.59 18315.97 24939.31</code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(pexp.ar1, </span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"Millones de euros"</span>,</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>,</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">PI =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span> <span class="fu">seq</span>(<span class="dv">1998</span>, <span class="dv">2028</span>, <span class="dv">2</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-ExpPre" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ExpPre-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-08-Tema8_files/figure-html/fig-ExpPre-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ExpPre-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;13: Exportaciones (1999-2023) y predicción (2024-2027)
</figcaption>
</figure>
</div>
</div>
</div>
<p><br>
</p>
</section>
</section>
<section id="demanda-eléctrica" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="demanda-eléctrica"><span class="header-section-number">5.3</span> Demanda eléctrica</h2>
<p>Consideremos las serie diaria de <strong>demanda eléctrica</strong> (GWh) en España durante 2023.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>electricidad <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"./series/Consumo electrico.csv"</span>, </span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>electricidad <span class="ot">&lt;-</span> <span class="fu">ts</span>(electricidad[, <span class="dv">1</span>],</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">7</span>),</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">frequency =</span> <span class="dv">7</span>)</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(electricidad,</span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"GWh"</span>,</span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-Electricidad" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-Electricidad-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-08-Tema8_files/figure-html/fig-Electricidad-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-Electricidad-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;14: Demanda eléctrica en España en 2023
</figcaption>
</figure>
</div>
</div>
</div>
<section id="transformación-de-la-serie-2" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="transformación-de-la-serie-2">Transformación de la serie</h3>
<p>Estrictamente hablando la serie no muestra tendencia, porque solo podemos observar un año. Sin embargo, se observan cambios de nivel en la demanda eléctrica que se pueden confundir con la presencia de tendencia, pero que realmente están asociados a los cambios de temperatura y el uso de los sistemas de climatización. Estos cambios de nivel se repiten cada año y se deberían incorporar en la estructura de la serie como una segunda componente estacional. Ahora bien, dado que solo se está analizando un año de la serie, vamos a asimilar los cambios de nivel a la presencia de tendencia y a considerar, por tanto, la serie como no estacionaria.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggAcf</span>(electricidad, <span class="at">lag =</span> <span class="dv">42</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">ylab =</span> <span class="st">""</span>, <span class="at">main =</span> <span class="st">""</span>)</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggAcf</span>(<span class="fu">diff</span>(electricidad), <span class="at">lag =</span> <span class="dv">42</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">ylab =</span> <span class="st">""</span>, <span class="at">main =</span> <span class="st">""</span>)</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggAcf</span>(<span class="fu">diff</span>(electricidad, <span class="at">lag =</span> <span class="dv">7</span>), <span class="at">lag =</span> <span class="dv">42</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">ylab =</span> <span class="st">""</span>, <span class="at">main =</span> <span class="st">""</span>)</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggAcf</span>(<span class="fu">diff</span>(<span class="fu">diff</span>(electricidad, <span class="at">lag =</span> <span class="dv">7</span>)), <span class="at">lag =</span> <span class="dv">42</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">ylab =</span> <span class="st">""</span>, <span class="at">main =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout="[[50,50],[50,50]]" data-layout-align="center">
<div id="fig-EleFAC" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-EleFAC-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-EleFAC" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-EleFAC-1" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-EleFAC-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-08-Tema8_files/figure-html/fig-EleFAC-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%" data-ref-parent="fig-EleFAC">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-EleFAC-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Serie
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-EleFAC" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-EleFAC-2" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-EleFAC-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-08-Tema8_files/figure-html/fig-EleFAC-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%" data-ref-parent="fig-EleFAC">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-EleFAC-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Diferencia regular
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-EleFAC" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-EleFAC-3" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-EleFAC-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-08-Tema8_files/figure-html/fig-EleFAC-3.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%" data-ref-parent="fig-EleFAC">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-EleFAC-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(c) Diferencia estacional
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-EleFAC" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-EleFAC-4" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-EleFAC-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-08-Tema8_files/figure-html/fig-EleFAC-4.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%" data-ref-parent="fig-EleFAC">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-EleFAC-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(d) Diferencia regular y estacional
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-EleFAC-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;15: FAC para Electricidad
</figcaption>
</figure>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ndiffs</span>(electricidad)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nsdiffs</span>(electricidad)       </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
</div>
<p>La FAC muestra que para que la serie sea estacionaria y ergódica es necesaria la doble diferenciación regular y estacional, aunque la función <code>ndiffs</code> no indica que la diferenciación regular sea necesaria. Trabajaremos con la siguiente serie transformada <span class="math display">\[\nabla\nabla_{12}electricidad_t \sim I(0)I_{12}(0).\]</span></p>
</section>
<section id="identificación-2" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="identificación-2">Identificación</h3>
<p>Antes de proceder con la primera autoidentifación, vamos a analizar que intervención puede ser necesaria para estimar y predecir adecuadamente la serie.</p>
<p><strong>Efectos calendario</strong></p>
<p>La <a href="#fig-Electricidad" class="quarto-xref">Figura&nbsp;14</a> muestra días con una marcada intervención asociada a la caída de la demanda de electricidad los días festivo (véase el análisis de esta serie realizada en el <a href="https://iarribasf.github.io/PrediccionSeriesTemporales-GBIA/03-07-Tema7.html">Tema 7</a>). Por ejemplo, destaca el bajo consumo el 1 de enero (primer dato de la serie), en Navidades o en Semana Santa (semana 14 del año).</p>
<p>La caída en el consumo dependerá del día de la semana. Es decir, cabe esperar que en un martes festivo la caída del consumo sea mayor que la de un domingo festivo porque en el segundo caso el consumo ya es de por si muy bajo.</p>
<p>Por tanto, para realizar un análisis detallado de la serie vamos crear variables ficticias que identifiquen los días festivos del calendario. Además, vamos a distinguir si el festivo ha sido entre semana (de lunes a viernes), en sábado o en domingo.</p>
<p>Un repaso por el calendario para el año 2023 nos indica que ningún festivo nacional<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> ha caído en sábado así que solo podremos estimar el efecto de los festivos entre semana y en domingo sobre el consumo de electricidad.</p>
<p>El siguiente código hace todo el trabajo.</p>
<ul>
<li><p>La primera línea crea una serie que identifica cada fecha del año 2023. La función <code>seq</code> devuelve un objeto <code>date</code> donde cada fecha no se guarda como un texto (aunque se muestre así) sino de una forma mas compleja.</p></li>
<li><p>En la segunda línea en el objeto <code>fiestas</code> identificamos los 13 días festivos del año: 12 fiestas nacionales y el lunes 10 de abril, festivo un muchas comunidades.</p></li>
<li><p>En estas dos primeras líneas, la función <code>as.Date</code> se usa para que R identifique una secuencia de caracteres como una fecha tipo “aaaa-mm-dd”.</p></li>
<li><p>La línea 3 genera una serie ficticia para identificar los festivos entre semana. Primero se identifican que fechas del año aparecen incluidas entre las fiestas (<code>fechas %in% fiestas</code>), generándose un vector booleano (TRUE/FALSE) de longitud 365. Luego se identifican que días del año han caído entre semana (<code>cycle(electricidad) &lt; 6</code>), generandose otro vector booleano de longitud 365. El producto de estos dos vectores solo valdrá 1 (TRUE) si simultáneamente una fecha es festiva y ha caído entre semana.</p></li>
<li><p>La linea 4 usa las mismas ideas para generar una serie ficticia que identifica los festivos en domingo.</p></li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>fechas <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">as.Date</span>(<span class="st">"2023-1-1"</span>), <span class="fu">as.Date</span>(<span class="st">"2023-12-31"</span>), <span class="st">"day"</span>)</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>fiestas <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">c</span>(<span class="st">"2023-01-01"</span>, <span class="st">"2023-01-02"</span>, <span class="st">"2023-01-06"</span>, </span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"2023-04-06"</span>, <span class="st">"2023-04-07"</span>, <span class="st">"2023-04-10"</span>, </span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"2023-05-01"</span>, <span class="st">"2023-08-15"</span>, <span class="st">"2023-10-12"</span>, <span class="st">"2023-11-01"</span>, </span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"2023-12-06"</span>, <span class="st">"2023-12-08"</span>, <span class="st">"2023-12-25"</span>))</span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>festivosEntreSemana <span class="ot">&lt;-</span> (fechas <span class="sc">%in%</span> fiestas) <span class="sc">*</span> (<span class="fu">cycle</span>(electricidad) <span class="sc">&lt;</span> <span class="dv">6</span>)</span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>festivosDomingo <span class="ot">&lt;-</span> (fechas <span class="sc">%in%</span> fiestas) <span class="sc">*</span> (<span class="fu">cycle</span>(electricidad) <span class="sc">==</span> <span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Al final el código nos devuelve dos variables ficticias: <code>festivosEntreSemana</code> valdrá 1 en la posición del año correspondiente a un día festivo entre semana y 0 en otro caso; <code>festivosDomingo</code> valdrá 1 en la posición del año correspondiente a un domingo festivo y 0 en otro caso.</p>
<p>Como ningún festivo en 2023 cayó en sábado, no es posible estimar su efecto sobre el consumo eléctrico y no se ha creado la variable ficticia correspondiente.</p>
<p><strong>Efecto temperatura</strong></p>
<p>El consumo de electricidad está fuertemente relacionado con la temperatura. En concreto, cuanto más se aleja la temperatura de un día de la media anual (por exceso de frío o de calor) mayor es el consumo eléctrico (véase la <a href="#fig-ElectricidadTempreratura" class="quarto-xref">Figura&nbsp;16</a>).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>temperatura <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"./series/Temperatura.csv"</span>)</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>temperatura <span class="ot">&lt;-</span> temperatura[, <span class="dv">1</span>]</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>excesotemperatura <span class="ot">&lt;-</span> <span class="fu">abs</span>(temperatura <span class="sc">-</span> <span class="fu">mean</span>(temperatura))</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> excesotemperatura, <span class="at">y =</span> electricidad), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Exceso de temperatura (ºC)"</span>) <span class="sc">+</span> </span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Demanda eléctrica (GWh)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-ElectricidadTempreratura" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ElectricidadTempreratura-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-08-Tema8_files/figure-html/fig-ElectricidadTempreratura-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ElectricidadTempreratura-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;16: Relación entre exceso de temperatura y consumo eléctrico
</figcaption>
</figure>
</div>
</div>
</div>
<p>Usaremos la variable <code>excesotemperatura</code> como otra variable de intervencion.</p>
<p><strong>Identificación</strong></p>
<p>Si probamos con la función <code>auto.arima</code>, indicando la doble diferenciación, los días festivos entre semana, los festivos en domingo y el exceso de temperatura.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">auto.arima</span>(electricidad,</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">d =</span> <span class="dv">1</span>,</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">D =</span> <span class="dv">1</span>,</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">xreg =</span> <span class="fu">cbind</span>(festivosEntreSemana, festivosDomingo, </span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>                        excesotemperatura))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: electricidad 
Regression with ARIMA(1,1,0)(1,1,0)[7] errors 

Coefficients:
         ar1     sar1  festivosEntreSemana  festivosDomingo  excesotemperatura
      0.0815  -0.5435             -72.7484         -80.0718             2.6936
s.e.  0.0568   0.0492               3.1198          17.3091             0.4057

sigma^2 = 283.7:  log likelihood = -1513.43
AIC=3038.86   AICc=3039.1   BIC=3062.13</code></pre>
</div>
</div>
<p>El modelo identificado es ARIMA(1, 1, 0)(1, 1, 0), pero el coeficiente del proceso AR(1) claramente no es significativo.</p>
<p>Respecto de la intervención, las tres variables de intervención parece ser significativas. Además, el efecto estimado para los días festivos por las dos variables ficticias es muy similar. Parece que la caída del consumo eléctrico en un festivo no depende del día de la semana. Ojo, no estamos diciendo que un lunes festivo, por ejemplo, se consume lo mismo que un domingo festivo. Dado que un lunes no festivo se consume más que un domingo no festivo, si la caída asociada a festividad es la misma, el lunes festivo se seguirá consumiendo más que un domingo festivo. Por tanto, vamos a crear una única variable ficticia que identifique los festivos independientemente del día de la semana en que caen.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>festivos <span class="ot">&lt;-</span> festivosEntreSemana <span class="sc">+</span> festivosDomingo</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="estimación-y-valores-extremos-2" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="estimación-y-valores-extremos-2">Estimación (y valores extremos)</h3>
<p>Estimamos el modelo de partida, excluyendo el proceso AR(1).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>ele.ar1 <span class="ot">&lt;-</span> <span class="fu">Arima</span>(electricidad, </span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">seasonal =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">xreg =</span> <span class="fu">cbind</span>(festivos, excesotemperatura))</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>ele.ar1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: electricidad 
Regression with ARIMA(0,1,0)(1,1,0)[7] errors 

Coefficients:
         sar1  festivos  excesotemperatura
      -0.5473  -74.2090             2.8101
s.e.   0.0484    3.1115             0.3990

sigma^2 = 283.7:  log likelihood = -1514.48
AIC=3036.96   AICc=3037.07   BIC=3052.47</code></pre>
</div>
</div>
<p>Veamos si es necesaria más intervención.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>error <span class="ot">&lt;-</span> <span class="fu">residuals</span>(ele.ar1)</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>sderror <span class="ot">&lt;-</span> <span class="fu">sd</span>(error)</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(error, <span class="at">series=</span><span class="st">"Error"</span>,</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"Error"</span>,</span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="sc">-</span><span class="dv">2</span>,<span class="dv">2</span>, <span class="dv">3</span>)<span class="sc">*</span>sderror, </span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"green"</span>, <span class="st">"green"</span>, <span class="st">"red"</span>), </span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span> <span class="fu">seq</span>(<span class="dv">1998</span>, <span class="dv">2022</span>, <span class="dv">2</span>)) </span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a>fechas[<span class="fu">abs</span>(error) <span class="sc">&gt;</span> <span class="dv">3</span> <span class="sc">*</span> sderror]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2023-07-25" "2023-08-27" "2023-12-25"</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-ExpError2" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ExpError2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-08-Tema8_files/figure-html/fig-ExpError2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ExpError2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;17: Error + Intervención
</figcaption>
</figure>
</div>
</div>
</div>
<p>Se observan tres candidatos a valores atípicos por superar el error las 3 desviaciones típicas.</p>
<ul>
<li>27 de julio: día de Santiago (patrón de España) y festivo en Galicia, Castilla y León, Navarra y País Vasco.</li>
<li>27 de agosto: no se ha identificado nada especial este día</li>
<li>25 de diciembre, Navidad: este día ya está incluido como festivo en la variable <code>festivos</code>, pero es tan festivo que el consumo cayó mucho más que en otro día festivo cualquiera.</li>
</ul>
<p>Deberíamos incluir el 27 de julio en nuestra lista de festivos y crear una variable ficticia especial para Navidad, pero a fin de aligerar este ejemplo no vamos a modificar el modelo actual.</p>
</section>
<section id="validación-2" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="validación-2">Validación</h3>
<p>Veamos si los coeficientes del modelo son significativos. Para ello, aplicamos la prueba z.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(ele.ar1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
z test of coefficients:

                    Estimate Std. Error  z value  Pr(&gt;|z|)    
sar1               -0.547285   0.048413 -11.3045 &lt; 2.2e-16 ***
festivos          -74.208962   3.111550 -23.8495 &lt; 2.2e-16 ***
excesotemperatura   2.810094   0.399026   7.0424  1.89e-12 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Todos los coeficientes son significativos.</p>
</section>
<section id="error-de-estimación-2" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="error-de-estimación-2">Error de estimación</h3>
<p>En media nos equivocamos en 17 GWh (RMSE) y el error porcentual medio es del 1.8%, muy reducido.</p>
<p>La serie no presenta sesgo y el intervalo de confianza para las predicciones es válido.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(ele.ar1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>                ME  RMSE   MAE   MPE MAPE MASE ACF1
Training set -0.15 16.59 11.96 -0.05 1.81 0.38 0.07</code></pre>
</div>
</div>
</section>
<section id="error-de-predicción-estramuestral-según-horizonte-temporal-2" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="error-de-predicción-estramuestral-según-horizonte-temporal-2">Error de predicción estramuestral según horizonte temporal</h3>
<p>Asumimos que se precisan veinte semanas para hacer una buena estimación, <span class="math inline">\(k = 140\)</span>, y fijaremos el horizonte temporal en una semana, <span class="math inline">\(h = 7\)</span> días. Como el modelo apenas presenta valores atípicos, podemos calcular como medida de precisión el valor medio en lugar del mediano.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">140</span>               </span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>h <span class="ot">&lt;-</span> <span class="dv">7</span>                   </span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>T <span class="ot">&lt;-</span> <span class="fu">length</span>(electricidad)   </span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> T <span class="sc">-</span> k <span class="sc">-</span> h               </span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>mapeArima <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, s <span class="sc">+</span> <span class="dv">1</span>, h)</span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">cbind</span>(festivos, excesotemperatura))</span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">0</span><span class="sc">:</span>s) {</span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a>  train.set <span class="ot">&lt;-</span> <span class="fu">subset</span>(electricidad, <span class="at">start =</span> i <span class="sc">+</span> <span class="dv">1</span>, <span class="at">end =</span> i <span class="sc">+</span> k)</span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a>  test.set <span class="ot">&lt;-</span>  <span class="fu">subset</span>(electricidad, <span class="at">start =</span> i <span class="sc">+</span> k <span class="sc">+</span> <span class="dv">1</span>, <span class="at">end =</span> i <span class="sc">+</span> k <span class="sc">+</span> h) </span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a>  X.train <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(X[(i <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>(i <span class="sc">+</span> k),])</span>
<span id="cb88-15"><a href="#cb88-15" aria-hidden="true" tabindex="-1"></a>  X.test <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(X[(i <span class="sc">+</span> k <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>(i <span class="sc">+</span> k <span class="sc">+</span> h),])</span>
<span id="cb88-16"><a href="#cb88-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb88-17"><a href="#cb88-17" aria-hidden="true" tabindex="-1"></a>  fit <span class="ot">&lt;-</span> <span class="fu">try</span>(<span class="fu">Arima</span>(train.set, </span>
<span id="cb88-18"><a href="#cb88-18" aria-hidden="true" tabindex="-1"></a>                   <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb88-19"><a href="#cb88-19" aria-hidden="true" tabindex="-1"></a>                   <span class="at">seasonal =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb88-20"><a href="#cb88-20" aria-hidden="true" tabindex="-1"></a>                   <span class="at">xreg =</span> X.train))</span>
<span id="cb88-21"><a href="#cb88-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb88-22"><a href="#cb88-22" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.element</span>(<span class="st">"try-error"</span>, <span class="fu">class</span>(fit))) {</span>
<span id="cb88-23"><a href="#cb88-23" aria-hidden="true" tabindex="-1"></a>    fcast <span class="ot">&lt;-</span> <span class="fu">forecast</span>(fit, <span class="at">h =</span> h, <span class="at">xreg =</span> X.test) </span>
<span id="cb88-24"><a href="#cb88-24" aria-hidden="true" tabindex="-1"></a>    mapeArima[i <span class="sc">+</span> <span class="dv">1</span>,] <span class="ot">&lt;-</span> <span class="dv">100</span><span class="sc">*</span><span class="fu">abs</span>(test.set <span class="sc">-</span> fcast<span class="sc">$</span>mean)<span class="sc">/</span>test.set</span>
<span id="cb88-25"><a href="#cb88-25" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb88-26"><a href="#cb88-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb88-27"><a href="#cb88-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-28"><a href="#cb88-28" aria-hidden="true" tabindex="-1"></a>errorArima <span class="ot">&lt;-</span> <span class="fu">apply</span>(mapeArima, <span class="at">MARGIN =</span> <span class="dv">2</span>, <span class="at">FUN =</span> median, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb88-29"><a href="#cb88-29" aria-hidden="true" tabindex="-1"></a>errorArima</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.349262 2.111647 2.435318 2.716222 3.116016 3.311760 3.234447</code></pre>
</div>
</div>
<p>El error de predicción parte del 1.3% para previsiones a un día vista (algo inferior al error de ajuste) y aumenta progresivamente según aumenta el horizonte de predicción, pasando al 3.2% a 7 días vista.</p>
</section>
<section id="interpretación-2" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="interpretación-2">Interpretación</h3>
<p>El <em>modelo teórico</em> es <span class="math inline">\(electricidad_t \sim ARIMA_{7}(0, 1, 0)(1, 1, 0) + AI\)</span>,</p>
<p><span class="math display">\[(1 - L^{7})(1 - L)electricidad_t = (1 + \theta_{7} L^{7})\varepsilon_t + AI.\]</span></p>
<p>Si desarrollamos queda <span class="math display">\[
\begin{aligned}
electricidad_t &amp; = electricidad_{t-1} + (electricidad_{t-7} - electricidad_{t-8})  + \theta_{7} \varepsilon_{t-7} + \varepsilon_{t}+ \\
&amp; \gamma_1 \cdot festivos +\gamma_2 \cdot excesotemperatura_t
\end{aligned}
\]</span> Finalmente, el <em>modelo estimado</em> es, <span class="math display">\[
\begin{aligned}
\widehat{electricidad_t} &amp; = electricidad_{t-1} + (electricidad_{t-7} - electricidad_{t-8}) - 0.55 \varepsilon_{t-7}  \\
&amp; -74.2 \cdot festivos_t + 2.8 \cdot excesotemperatura_t
\end{aligned}
\]</span></p>
<ul>
<li>El consumo de electricidad de un día es el mismo que el del día anterior más la variación observada entre estos dos días la semana pasada. Por ejemplo, el consumo un miércoles es el del martes pasado más la variación observada entre el martes y el miércoles de la semana previa.</li>
<li>Los días festivos el consumo cae en 74.2 GWh respecto de la demanda en un día no festivo.</li>
<li>Por cada grado centígrado de desviación de la temperatura sobre la media anual, el consumo aumenta en 2.8 GWh.</li>
</ul>
</section>
<section id="predicción-de-la-serie-2" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="predicción-de-la-serie-2">Predicción de la serie</h3>
<p>Una vez dado por válido el modelo, podemos pasar a realizar predicciones para los próximos siete días y mostrar los resultados numérica y gráficamente (<a href="#fig-ElePre" class="quarto-xref">Figura&nbsp;18</a>).</p>
<p>Teniendo en cuenta las dos variables de intervención:</p>
<ul>
<li>Para el efecto calendario debemos indicar qué valores tomará en el periodo de predicción, es decir, que días son festivos. Como el rango de predicción abarca del 1 al 7 de enero de 2024, se marcarán como festivos el lunes día 1 (Año nuevo) y el sábado 6 (Reyes).</li>
<li>Para el efecto de la temperatura deberíamos, primero obtener la temperatura prevista para el periodo de predicción y después calcular el exceso de temperatura. La previsión de la temperatura se puede obtener de AEMET o de cualquier otro servicio de metereología.</li>
</ul>
<p>Recuerda siempre incluir las variables ficticias en la función <code>forecast</code> en el mismo orden que aparecen en la estimación con <code>Arima</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>pfestivos <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>ptemperatura <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">6.6</span>, <span class="fl">4.0</span>, <span class="fl">10.0</span>, <span class="fl">9.2</span>, <span class="fl">7.6</span>, <span class="fl">5.4</span>, <span class="fl">4.8</span>)</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>pexcesotemperatura <span class="ot">&lt;-</span> ptemperatura <span class="sc">-</span> <span class="fu">mean</span>(temperatura)</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>pele.ar1 <span class="ot">&lt;-</span> <span class="fu">forecast</span>(ele.ar1, </span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">h =</span> <span class="dv">7</span>,</span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">xreg =</span> <span class="fu">cbind</span>(pfestivos, pexcesotemperatura), </span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">level =</span> <span class="dv">95</span>)</span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a>pele.ar1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         Point Forecast    Lo 95    Hi 95
54.00000       553.6264 520.6113 586.6415
54.14286       639.1189 592.4285 685.8093
54.28571       682.8552 625.6713 740.0390
54.42857       672.0053 605.9751 738.0355
54.57143       643.9064 570.0824 717.7304
54.71429       488.0978 407.2276 568.9680
54.85714       526.9900 439.6402 614.3397</code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(pele.ar1, </span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"GWh"</span>,</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span> <span class="fu">seq</span>(<span class="dv">46</span>, <span class="dv">56</span>, <span class="dv">1</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-ElePre" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ElePre-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-08-Tema8_files/figure-html/fig-ElePre-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ElePre-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;18: Demanda eléctrica y predicción
</figcaption>
</figure>
</div>
</div>
</div>
<p>La <a href="#fig-ElePre" class="quarto-xref">Figura&nbsp;18</a> muestra la serie Electricidad y su predicción para la primera semana de 2024, junto con el intervalo de confianza. La calidad de ajuste es tan buena que el intervalo de confianza de las predicciones es muy estrecho.</p>
<p><br>
</p>
</section>
</section>
</section>
<section id="comparación-con-el-método-de-alisado-exponencial" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Comparación con el método de Alisado exponencial</h1>
<p>Veamos una comparativa, para los dos ejemplos vistos, entre los resultados obtenidos con ARIMA y con Alisado exponencial</p>
<section id="nacimientos-log" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="nacimientos-log">Nacimientos (log)</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Método</th>
<th style="text-align: left;">Modelo</th>
<th style="text-align: center;">MAPE</th>
<th style="text-align: center;"></th>
<th style="text-align: center;"></th>
<th style="text-align: center;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: center;">Ajuste</td>
<td style="text-align: center;">Extra h = 1</td>
<td style="text-align: center;">Extra h = 6</td>
<td style="text-align: center;">Extra h =12</td>
</tr>
<tr class="even">
<td style="text-align: left;">ARIMA</td>
<td style="text-align: left;">(0,1,1)(0,1,1)+AI</td>
<td style="text-align: center;">1.54</td>
<td style="text-align: center;">2.25</td>
<td style="text-align: center;">2.80</td>
<td style="text-align: center;">3.08</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Alisado</td>
<td style="text-align: left;">(A,N,A)</td>
<td style="text-align: center;">2.06</td>
<td style="text-align: center;">2.44</td>
<td style="text-align: center;">3.51</td>
<td style="text-align: center;">4.54</td>
</tr>
</tbody>
</table>
<p>Para Nacimientos, la mejora en los indicadores de calidad con ARIMA respecto de Alisado es muy reducida para predicciones a unos pocos meses vista, pero supera el punto porcentual para predicciones a 12 meses vista. El uso de un método u otro dependerá del horizonte temporal y la presencia de AI.</p>
</section>
<section id="exportaciones-log" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="exportaciones-log">Exportaciones (log)</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Método</th>
<th style="text-align: left;">Modelo</th>
<th style="text-align: center;">MAPE</th>
<th style="text-align: center;"></th>
<th style="text-align: center;"></th>
<th style="text-align: center;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: center;">Ajuste</td>
<td style="text-align: center;">Extra h = 1</td>
<td style="text-align: center;">Extra h = 6</td>
<td style="text-align: center;">Extra h =12</td>
</tr>
<tr class="even">
<td style="text-align: left;">ARIMA</td>
<td style="text-align: left;">(0,1,1)(0,1,1)+AI</td>
<td style="text-align: center;">2.86</td>
<td style="text-align: center;">2.53</td>
<td style="text-align: center;">4.10</td>
<td style="text-align: center;">5.41</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Alisado</td>
<td style="text-align: left;">(A,A,A)</td>
<td style="text-align: center;">5.00</td>
<td style="text-align: center;">5.30</td>
<td style="text-align: center;">7.02</td>
<td style="text-align: center;">9.57</td>
</tr>
</tbody>
</table>
<p>En el caso de Exportaciones, la mejora en la calidad del ajuste con ARIMA respecto de Alisado oscila entre 2 y 4 puntos porcentuales según el horizonte temporal. En este caso, ARIMA ofrece mejores resultados que Alisado.</p>
</section>
<section id="electricidad" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="electricidad">Electricidad</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Método</th>
<th style="text-align: left;">Modelo</th>
<th style="text-align: center;">MAPE</th>
<th style="text-align: center;"></th>
<th style="text-align: center;"></th>
<th style="text-align: center;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: center;">Ajuste</td>
<td style="text-align: center;">Extra h = 1</td>
<td style="text-align: center;">Extra h = 4</td>
<td style="text-align: center;">Extra h =7</td>
</tr>
<tr class="even">
<td style="text-align: left;">ARIMA</td>
<td style="text-align: left;">(0,1,0)(1,1,0)+AI</td>
<td style="text-align: center;">1.81</td>
<td style="text-align: center;">1.92</td>
<td style="text-align: center;">3.95</td>
<td style="text-align: center;">4.44</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Alisado</td>
<td style="text-align: left;">(A,N,A)</td>
<td style="text-align: center;">2.50</td>
<td style="text-align: center;">2.14</td>
<td style="text-align: center;">4.33</td>
<td style="text-align: center;">4.76</td>
</tr>
</tbody>
</table>
<p>En el caso de Electricidad, la mejora en la calidad del ajuste con ARIMA respecto de Alisado es inferior a medio punto porcentual. El uso de los modelos Arima no parece muy justificado, más allá de poder corregir las predicciones en los días festivos.</p>
<p><br>
<br>
</p>
</section>
</section>
<section id="resumen-de-los-comandos-utilizados" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Resumen de los comandos utilizados</h1>
<table class="caption-top table">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 48%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Función</th>
<th style="text-align: left;">Paquete</th>
<th style="text-align: left;">Descripción</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>nsdiffs</code></td>
<td style="text-align: left;">forecast</td>
<td style="text-align: left;">estima el número de diferencias estacionales necesarias para que una serie sea estacionaria</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>mothdays</code></td>
<td style="text-align: left;">forecast</td>
<td style="text-align: left;">da el número de días de cada mes</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>bizdays</code></td>
<td style="text-align: left;">forecast</td>
<td style="text-align: left;">da el número de días laborables de cada mes</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>easter</code></td>
<td style="text-align: left;">forecast</td>
<td style="text-align: left;">da la proporción de días de Semana Santa que caen en Marzo y Abril</td>
</tr>
</tbody>
</table>
<p><br>
<br>
<br>
<br>
</p>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p><code>R</code> permite crear tu propio calendario de festivos y existen otras librerías que extienden las opciones de <code>bizdays</code>. En el ejemplo de Pasajeros puedes ver como construir la serie de días laborables del mes para España paso a paso.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Para este análisis solo se van a considerar los festivos nacionales en 2023 al que añadiremos el lunes de Semana Santa. Es posible que algunos festivos autonómicos en comunidades muy pobladas tengan un efecto sobre el consumo eléctrico, pero esto es un ejercicio y hay que limitar el alcance del análisis.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>© Copyright 2024, Iván Arribas. If you find any bugs please report them to <a href="mailto:ivan.arribas@uv.es">ivan.arribas@uv.es</a></p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>This page is built with <a href="https://quarto.org/">Quarto</a></p>
</div>
  </div>
</footer>




</body></html>