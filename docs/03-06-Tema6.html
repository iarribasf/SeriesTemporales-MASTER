<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Iván Arribas (Depto. Análisis Económico. Universitat de València)">

<title>Predicción con Datos Temporales - Series con tendencia y sin estacionalidad</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Predicción con Datos Temporales</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Inicio</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="./01-Guia-curso.html"> 
<span class="menu-text">Guía del curso</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./02-Logistica.html"> 
<span class="menu-text">Logística</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-diapos" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Diapos</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-diapos">    
        <li class="dropdown-header">Teoría</li>
        <li>
    <a class="dropdown-item" href="./03-01-Tema1.html">
 <span class="dropdown-text">Tema 1: Introducción</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-02-Tema2.html">
 <span class="dropdown-text">Tema 2: Definición</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-03-Tema3.html">
 <span class="dropdown-text">Tema 3: Métodos de predicción</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-04-Tema4.html">
 <span class="dropdown-text">Tema 4: Series sin tendencia ni estacionalidad</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-05-Tema5.html">
 <span class="dropdown-text">Tema 5: Evaluación de las predicciones</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-06-Tema6.html">
 <span class="dropdown-text">Tema 6: Series sin tendencia y sin estacionalidad</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-07-Tema7.html">
 <span class="dropdown-text">Tema 7: Series con tendencia y estacionalidad (Alisado)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-08-Tema8.html">
 <span class="dropdown-text">Tema 8: Series con tendencia y estacionalidad (Arima)</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Ejemplo de aplicación</li>
        <li>
    <a class="dropdown-item" href="./03-10-Ejemplo1.html">
 <span class="dropdown-text">Ejemplo: Descriptiva</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-11-Ejemplo2.html">
 <span class="dropdown-text">Ejemplo: Métodos sencillos</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-13-Ejemplo3.html">
 <span class="dropdown-text">Ejemplo: Alisado exponencial</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-14-Ejemplo4.html">
 <span class="dropdown-text">Ejemplo: Arima sin estacionalidad</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-15-Ejemplo5.html">
 <span class="dropdown-text">Ejemplo: Arima con estacionalidad</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Otro ejemplo</li>
        <li>
    <a class="dropdown-item" href="./03-20-Ejemplo-Pasajeros.html">
 <span class="dropdown-text">Ejemplo de Pasajeros</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-píldoras" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Píldoras</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-píldoras">    
        <li>
    <a class="dropdown-item" href="./04-01-Bootstrapping.html">
 <span class="dropdown-text">Bootstrapping para IC</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./04-02-Multiples_CS.html">
 <span class="dropdown-text">Múltiples componentes estacionales</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./04-03-Redes_neuronales.html">
 <span class="dropdown-text">Predicción con Redes Neuronales</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./04-04-Series_acotadas.html">
 <span class="dropdown-text">Series acotadas</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./04-05-Valores_perdidos_Outliers.html">
 <span class="dropdown-text">Valores perdidos y outliers</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./04-06-Covid_Nacimientos.html">
 <span class="dropdown-text">Efecto de la Covid-19 en Nacimientos</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./04-07-Combinando_predicciones.html">
 <span class="dropdown-text">Combinación de predicciones</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./04-08-Series_interrumpidas.html">
 <span class="dropdown-text">Series interrumpidas</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="./05-Recursos-R.html"> 
<span class="menu-text">Recursos de la asignatura</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./06-Evaluacion_Continua.html"> 
<span class="menu-text">Evaluacion Continua</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-más" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Más</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-más">    
        <li class="dropdown-header">R</li>
        <li>
    <a class="dropdown-item" href="https://cran.r-project.org">
 <span class="dropdown-text">Dónde está R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://rstudio.com">
 <span class="dropdown-text">Donde está RStudio</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Markdown</li>
        <li>
    <a class="dropdown-item" href="https://bookdown.org/yihui/rmarkdown/">
 <span class="dropdown-text">Markdown</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://rmarkdown.rstudio.com/lesson-1.html">
 <span class="dropdown-text">R Markdown</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://www.rstudio.com/wp-content/uploads/2015/03/rmarkdown-reference.pdf">
 <span class="dropdown-text">R Markdown (pdf)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://quarto.org/docs/tools/rstudio.html">
 <span class="dropdown-text">Quatro</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Otros</li>
        <li>
    <a class="dropdown-item" href="https://www.r-bloggers.com">
 <span class="dropdown-text">Blog sobre R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://bookdown.org">
 <span class="dropdown-text">Libros online que debes conocer</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Índice</h2>
   
  <ul>
  <li><a href="#introducción" id="toc-introducción" class="nav-link active" data-scroll-target="#introducción"><span class="header-section-number">1</span> Introducción</a></li>
  <li><a href="#métodos-sencillos-de-predicción" id="toc-métodos-sencillos-de-predicción" class="nav-link" data-scroll-target="#métodos-sencillos-de-predicción"><span class="header-section-number">2</span> Métodos sencillos de predicción</a>
  <ul class="collapse">
  <li><a href="#métodos-sencillos-de-predicción-1" id="toc-métodos-sencillos-de-predicción-1" class="nav-link" data-scroll-target="#métodos-sencillos-de-predicción-1"><span class="header-section-number">2.1</span> Métodos sencillos de predicción</a></li>
  <li><a href="#ejemplo-de-aplicación-a-la-serie-residuos" id="toc-ejemplo-de-aplicación-a-la-serie-residuos" class="nav-link" data-scroll-target="#ejemplo-de-aplicación-a-la-serie-residuos"><span class="header-section-number">2.2</span> Ejemplo de aplicación a la serie Residuos</a></li>
  </ul></li>
  <li><a href="#alisado-exponencial" id="toc-alisado-exponencial" class="nav-link" data-scroll-target="#alisado-exponencial"><span class="header-section-number">3</span> Alisado exponencial</a>
  <ul class="collapse">
  <li><a href="#definición" id="toc-definición" class="nav-link" data-scroll-target="#definición"><span class="header-section-number">3.1</span> Definición</a></li>
  <li><a href="#casos-posibles" id="toc-casos-posibles" class="nav-link" data-scroll-target="#casos-posibles"><span class="header-section-number">3.2</span> Casos posibles</a></li>
  <li><a href="#alisado-exponencial-de-holt-a-a-n" id="toc-alisado-exponencial-de-holt-a-a-n" class="nav-link" data-scroll-target="#alisado-exponencial-de-holt-a-a-n"><span class="header-section-number">3.3</span> Alisado exponencial de Holt (A, A, N)</a>
  <ul class="collapse">
  <li><a href="#formulas-interactivas-de-sus-componentes" id="toc-formulas-interactivas-de-sus-componentes" class="nav-link" data-scroll-target="#formulas-interactivas-de-sus-componentes">Formulas interactivas de sus componentes</a></li>
  <li><a href="#estimación-de-los-parámetros-del-modelo" id="toc-estimación-de-los-parámetros-del-modelo" class="nav-link" data-scroll-target="#estimación-de-los-parámetros-del-modelo">Estimación de los parámetros del modelo</a></li>
  <li><a href="#ejemplo-de-aplicación-a-la-serie-residuos-1" id="toc-ejemplo-de-aplicación-a-la-serie-residuos-1" class="nav-link" data-scroll-target="#ejemplo-de-aplicación-a-la-serie-residuos-1">Ejemplo de aplicación a la serie Residuos</a></li>
  </ul></li>
  <li><a href="#alisado-exponencial-con-pendiente-amortiguada-a-ad-n" id="toc-alisado-exponencial-con-pendiente-amortiguada-a-ad-n" class="nav-link" data-scroll-target="#alisado-exponencial-con-pendiente-amortiguada-a-ad-n"><span class="header-section-number">3.4</span> Alisado exponencial con pendiente amortiguada (A, Ad, N)</a>
  <ul class="collapse">
  <li><a href="#formulas-interactivas-de-sus-componentes-1" id="toc-formulas-interactivas-de-sus-componentes-1" class="nav-link" data-scroll-target="#formulas-interactivas-de-sus-componentes-1">Formulas interactivas de sus componentes</a></li>
  <li><a href="#ejemplo-de-aplicación-a-la-serie-residuos-2" id="toc-ejemplo-de-aplicación-a-la-serie-residuos-2" class="nav-link" data-scroll-target="#ejemplo-de-aplicación-a-la-serie-residuos-2">Ejemplo de aplicación a la serie Residuos</a></li>
  </ul></li>
  <li><a href="#casos-generales-de-alisado-exponencial" id="toc-casos-generales-de-alisado-exponencial" class="nav-link" data-scroll-target="#casos-generales-de-alisado-exponencial"><span class="header-section-number">3.5</span> Casos generales de alisado exponencial</a></li>
  </ul></li>
  <li><a href="#modelos-arima" id="toc-modelos-arima" class="nav-link" data-scroll-target="#modelos-arima"><span class="header-section-number">4</span> Modelos ARIMA</a>
  <ul class="collapse">
  <li><a href="#diferenciación-de-una-serie" id="toc-diferenciación-de-una-serie" class="nav-link" data-scroll-target="#diferenciación-de-una-serie"><span class="header-section-number">4.1</span> Diferenciación de una serie</a>
  <ul class="collapse">
  <li><a href="#diferenciación-con-r" id="toc-diferenciación-con-r" class="nav-link" data-scroll-target="#diferenciación-con-r">Diferenciación con <code>R</code></a></li>
  <li><a href="#operador-retardo-de-nuevo" id="toc-operador-retardo-de-nuevo" class="nav-link" data-scroll-target="#operador-retardo-de-nuevo">Operador Retardo (de nuevo)</a></li>
  </ul></li>
  <li><a href="#procesos-arimap-d-p" id="toc-procesos-arimap-d-p" class="nav-link" data-scroll-target="#procesos-arimap-d-p"><span class="header-section-number">4.2</span> Procesos ARIMA(p, d, p)</a></li>
  <li><a href="#ejemplo-de-aplicación-a-la-serie-residuos-3" id="toc-ejemplo-de-aplicación-a-la-serie-residuos-3" class="nav-link" data-scroll-target="#ejemplo-de-aplicación-a-la-serie-residuos-3"><span class="header-section-number">4.3</span> Ejemplo de aplicación a la serie Residuos</a>
  <ul class="collapse">
  <li><a href="#diferencación-de-la-serie" id="toc-diferencación-de-la-serie" class="nav-link" data-scroll-target="#diferencación-de-la-serie">Diferencación de la serie</a></li>
  <li><a href="#identificación" id="toc-identificación" class="nav-link" data-scroll-target="#identificación">Identificación</a></li>
  <li><a href="#estimación" id="toc-estimación" class="nav-link" data-scroll-target="#estimación">Estimación</a></li>
  <li><a href="#intervención" id="toc-intervención" class="nav-link" data-scroll-target="#intervención">Intervención</a></li>
  <li><a href="#validación" id="toc-validación" class="nav-link" data-scroll-target="#validación">Validación</a></li>
  <li><a href="#medidas-de-error" id="toc-medidas-de-error" class="nav-link" data-scroll-target="#medidas-de-error">Medidas de error</a></li>
  <li><a href="#interpretación-del-modelo" id="toc-interpretación-del-modelo" class="nav-link" data-scroll-target="#interpretación-del-modelo">Interpretación del modelo</a></li>
  <li><a href="#predicción" id="toc-predicción" class="nav-link" data-scroll-target="#predicción">Predicción</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#ejemplo-con-transformación-logarítmica" id="toc-ejemplo-con-transformación-logarítmica" class="nav-link" data-scroll-target="#ejemplo-con-transformación-logarítmica"><span class="header-section-number">5</span> Ejemplo con transformación logarítmica</a></li>
  <li><a href="#ejemplo-de-aplicacion-para-la-serie-aforo" id="toc-ejemplo-de-aplicacion-para-la-serie-aforo" class="nav-link" data-scroll-target="#ejemplo-de-aplicacion-para-la-serie-aforo"><span class="header-section-number">6</span> Ejemplo de aplicacion para la serie Aforo</a>
  <ul class="collapse">
  <li><a href="#métodos-sencillos" id="toc-métodos-sencillos" class="nav-link" data-scroll-target="#métodos-sencillos"><span class="header-section-number">6.1</span> Métodos sencillos</a></li>
  <li><a href="#asilado-exponencial" id="toc-asilado-exponencial" class="nav-link" data-scroll-target="#asilado-exponencial"><span class="header-section-number">6.2</span> Asilado exponencial</a>
  <ul class="collapse">
  <li><a href="#estimacion-del-modelo" id="toc-estimacion-del-modelo" class="nav-link" data-scroll-target="#estimacion-del-modelo">Estimacion del modelo</a></li>
  <li><a href="#predicción-1" id="toc-predicción-1" class="nav-link" data-scroll-target="#predicción-1">Predicción</a></li>
  <li><a href="#análisis-del-residuo" id="toc-análisis-del-residuo" class="nav-link" data-scroll-target="#análisis-del-residuo">Análisis del residuo</a></li>
  </ul></li>
  <li><a href="#modelo-arima" id="toc-modelo-arima" class="nav-link" data-scroll-target="#modelo-arima"><span class="header-section-number">6.3</span> Modelo Arima</a>
  <ul class="collapse">
  <li><a href="#transformación-de-la-serie" id="toc-transformación-de-la-serie" class="nav-link" data-scroll-target="#transformación-de-la-serie">Transformación de la serie</a></li>
  <li><a href="#identificación-y-estimación" id="toc-identificación-y-estimación" class="nav-link" data-scroll-target="#identificación-y-estimación">Identificación y Estimación</a></li>
  <li><a href="#validación-1" id="toc-validación-1" class="nav-link" data-scroll-target="#validación-1">Validación</a></li>
  <li><a href="#medidas-de-error-1" id="toc-medidas-de-error-1" class="nav-link" data-scroll-target="#medidas-de-error-1">Medidas de error</a></li>
  <li><a href="#interpretación-del-modelo-1" id="toc-interpretación-del-modelo-1" class="nav-link" data-scroll-target="#interpretación-del-modelo-1">Interpretación del modelo</a></li>
  <li><a href="#predicción-2" id="toc-predicción-2" class="nav-link" data-scroll-target="#predicción-2">Predicción</a></li>
  </ul></li>
  <li><a href="#comparación-entre-modelos" id="toc-comparación-entre-modelos" class="nav-link" data-scroll-target="#comparación-entre-modelos"><span class="header-section-number">6.4</span> Comparación entre modelos</a></li>
  </ul></li>
  <li><a href="#ejemplo-de-aplicacion-para-la-serie-nacimientos" id="toc-ejemplo-de-aplicacion-para-la-serie-nacimientos" class="nav-link" data-scroll-target="#ejemplo-de-aplicacion-para-la-serie-nacimientos"><span class="header-section-number">7</span> Ejemplo de aplicacion para la serie Nacimientos</a>
  <ul class="collapse">
  <li><a href="#métodos-sencillo-de-la-deriva" id="toc-métodos-sencillo-de-la-deriva" class="nav-link" data-scroll-target="#métodos-sencillo-de-la-deriva"><span class="header-section-number">7.1</span> Métodos sencillo de la deriva</a></li>
  <li><a href="#asilado-exponencial-1" id="toc-asilado-exponencial-1" class="nav-link" data-scroll-target="#asilado-exponencial-1"><span class="header-section-number">7.2</span> Asilado exponencial</a>
  <ul class="collapse">
  <li><a href="#estimacion-del-modelo-1" id="toc-estimacion-del-modelo-1" class="nav-link" data-scroll-target="#estimacion-del-modelo-1">Estimacion del modelo</a></li>
  <li><a href="#predicción-3" id="toc-predicción-3" class="nav-link" data-scroll-target="#predicción-3">Predicción</a></li>
  </ul></li>
  <li><a href="#modelo-arima-1" id="toc-modelo-arima-1" class="nav-link" data-scroll-target="#modelo-arima-1"><span class="header-section-number">7.3</span> Modelo Arima</a>
  <ul class="collapse">
  <li><a href="#transformación-de-la-serie-1" id="toc-transformación-de-la-serie-1" class="nav-link" data-scroll-target="#transformación-de-la-serie-1">Transformación de la serie</a></li>
  <li><a href="#identificación-y-estimación-1" id="toc-identificación-y-estimación-1" class="nav-link" data-scroll-target="#identificación-y-estimación-1">Identificación y Estimación</a></li>
  <li><a href="#validación-2" id="toc-validación-2" class="nav-link" data-scroll-target="#validación-2">Validación</a></li>
  <li><a href="#medidas-de-error-2" id="toc-medidas-de-error-2" class="nav-link" data-scroll-target="#medidas-de-error-2">Medidas de error</a></li>
  <li><a href="#interpretación-del-modelo-2" id="toc-interpretación-del-modelo-2" class="nav-link" data-scroll-target="#interpretación-del-modelo-2">Interpretación del modelo</a></li>
  <li><a href="#predicción-4" id="toc-predicción-4" class="nav-link" data-scroll-target="#predicción-4">Predicción</a></li>
  </ul></li>
  <li><a href="#comparación-entre-modelos-1" id="toc-comparación-entre-modelos-1" class="nav-link" data-scroll-target="#comparación-entre-modelos-1"><span class="header-section-number">7.4</span> Comparación entre modelos</a></li>
  </ul></li>
  <li><a href="#resumen-de-los-comandos-utilizados" id="toc-resumen-de-los-comandos-utilizados" class="nav-link" data-scroll-target="#resumen-de-los-comandos-utilizados"><span class="header-section-number">8</span> Resumen de los comandos utilizados</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Series con tendencia y sin estacionalidad</h1>
<p class="subtitle lead">Previsión con Datos Temporales (GBIA)</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Iván Arribas (Depto. Análisis Económico. Universitat de València) </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<p><br>
<br>
</p>
<section id="introducción" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introducción</h1>
<p>Vamos a dar un pequeño paso en la complejidad de las series a analizar. En el <a href="https://iarribasf.github.io/PrediccionSeriesTemporales-GBIA/03-04-Tema4.html">Tema 4</a> aprendimos a predecir series que no tenían tendencia ni estacionalidad. En este tema estudiaremos series que presentan tendencia, sea creciente o decreciente, pero que siguen sin tener componente estacional, <span class="math inline">\(y_t = T_t + \varepsilon_t\)</span>.</p>
<p>La <a href="#fig-ejemplos_si_tendencia" class="quarto-xref">Figura&nbsp;1</a> muestra ejemplos de este tipo de series. El panel superior muestra la serie Residuos, el volumen de residuos recogidos por las autoridades municipales y eliminados a través del sistema de gestión de residuos desde 1995 hasta 2022 en kg per cápita (fuente Instituto Nacional de Estadística). Se observa claramente que los últimos años del pasado siglo el volumen de residuos recogidos presentaba una tendencia creciente, que se invirtió al inicio del siglo. Luego, a principios de la década pasada, la serie paso de tendencia decreciente a estacionaria. El panel medio muestra la serie Aforo, el número medio de de vehículos diarios que pasan por Oropesa, carretera N-340, km. 996.48, desde 1960 a 2022 (fuente Ministerio de Transportes y Movilidad Sostenible). La tendencia de esta serie está muy relacionado con el ciclo económico, la inauguración de la AP-7 en 1978 y el fin de su peaje en 2020, y la pandemia. El panel inferior muestra el número de nacimientos anuales desde 1975 hasta 2023 (fuente Instituto Nacional de Estadística), serie que ya hemos comentado en el <a href="https://iarribasf.github.io/PrediccionSeriesTemporales-GBIA/03-02-Tema2.html">Tema 2</a>.</p>
<div id="fig-ejemplos_si_tendencia" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ejemplos_si_tendencia-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-ejemplos_si_tendencia" style="flex-basis: 100.0%;justify-content: center;">
<div id="fig-ejemplos_si_tendencia-1" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-ejemplos_si_tendencia-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-06-Tema6_files/figure-html/fig-ejemplos_si_tendencia-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%" data-ref-parent="fig-ejemplos_si_tendencia">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-ejemplos_si_tendencia-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Residuos (kg per cápita)
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-ejemplos_si_tendencia" style="flex-basis: 100.0%;justify-content: center;">
<div id="fig-ejemplos_si_tendencia-2" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-ejemplos_si_tendencia-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-06-Tema6_files/figure-html/fig-ejemplos_si_tendencia-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%" data-ref-parent="fig-ejemplos_si_tendencia">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-ejemplos_si_tendencia-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Aforo (número de vehículos)
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-ejemplos_si_tendencia" style="flex-basis: 100.0%;justify-content: center;">
<div id="fig-ejemplos_si_tendencia-3" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-ejemplos_si_tendencia-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-06-Tema6_files/figure-html/fig-ejemplos_si_tendencia-3.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%" data-ref-parent="fig-ejemplos_si_tendencia">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-ejemplos_si_tendencia-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(c) Nacimientos (en miles)
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ejemplos_si_tendencia-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;1: Ejemplos de series con tendencia y sin estacionalidad
</figcaption>
</figure>
</div>
<p>En este tema revisitaremos los tres métodos vistos en el <a href="https://iarribasf.github.io/PrediccionSeriesTemporales-GBIA/03-04-Tema4.html">Tema 4</a>, métodos sencillos, métodos de Alisado exponencial y modelos Arima, y veremos como se deben adaptar y ampliar para capturar la componente de la tendencia.</p>
<p>Dentro del contexto de la series con tendencia, al estudiar los métodos de Alisado introduciremos el concepto de <em>amortiguamiento</em> que mejora la calidad de las predicciones a medio plazo; y en los modelos Arima el concepto de <em>diferenciación</em> para posibilitar el cumplimiento de la hipótesis de estacionariedad.</p>
<p>Además, veremos como aplicar la <em>transformación logarítmica</em> en el análisis y predicción de series temporales. Esta transformación tiene la propiedad de generar siempre predicciones positivas y ocasionalmente mejora la precisión de las predicciones.</p>
<p><br>
<br>
</p>
</section>
<section id="métodos-sencillos-de-predicción" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Métodos sencillos de predicción</h1>
<p>Veamos algunos métodos sencillos para series con tendencia y sin estacionalidad, sus funciones en el paquete <code>forecast</code> y un ejemplo de aplicación.</p>
<p><br>
</p>
<section id="métodos-sencillos-de-predicción-1" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="métodos-sencillos-de-predicción-1"><span class="header-section-number">2.1</span> Métodos sencillos de predicción</h2>
<p><strong>Método ingenuo II</strong>: <span class="math inline">\(\hat{y}_{T+h}=y_T + h(y_T-y_{T-1})\)</span>.</p>
<ul>
<li>La predicción <span class="math inline">\(h\)</span> periodos adelante es la <strong>última observación</strong> disponible más <span class="math inline">\(h\)</span> veces el <strong>último incremento</strong> observado.</li>
<li>No tiene función en <code>R</code>, pero se podría emular mediante la función <code>ets</code> (véase epígrafe de 3 de este tema, Alisado de Holt).</li>
</ul>
<p><strong>Método de la deriva</strong>: <span class="math inline">\(\hat{y}_{T+h}=y_T+h\frac{y_T - y_1}{T-1}\)</span>.</p>
<ul>
<li>La predicción <span class="math inline">\(h\)</span> periodos adelante es la <strong>última observación</strong> disponible más <span class="math inline">\(h\)</span> veces el <strong>incremento medio</strong> observado.</li>
<li>Función de <code>R</code>: <code>rwf(y, h, drift = TRUE)</code></li>
</ul>
<p>Observa que ambos métodos realmente solo hacen uso de dos observaciones de toda la serie y en ambos casos para obtener una pendiente con la que predecir.</p>
<p><br>
</p>
</section>
<section id="ejemplo-de-aplicación-a-la-serie-residuos" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="ejemplo-de-aplicación-a-la-serie-residuos"><span class="header-section-number">2.2</span> Ejemplo de aplicación a la serie Residuos</h2>
<p>Analizaremos Residuos, una serie anual de 1995 a 2022 (fuente <a href="https://www.ine.es">Instituto Nacional de Estadística</a>) que muestra los residuos recogidos por o en nombre de las autoridades municipales y eliminados a través del sistema de gestión de residuos. Los datos están disponibles en el fichero <code>Residuos.csv</code>. La primera columna tiene el año de la serie y la segunda contiene los residuos recogidos en kg per cápita. El panel a) de la <a href="#fig-ejemplos_si_tendencia" class="quarto-xref">Figura&nbsp;1</a> muestra que es una serie con tendencia que ha cambiado con el tiempo.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>residuos <span class="ot">&lt;-</span> <span class="fu">read.csv2</span>(<span class="st">"./series/Residuos.csv"</span>, </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>residuos <span class="ot">&lt;-</span> <span class="fu">ts</span>(residuos[, <span class="dv">2</span>],</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">start =</span> <span class="dv">1995</span>, </span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">frequency  =</span> <span class="dv">1</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>derivaResiduos <span class="ot">&lt;-</span> <span class="fu">rwf</span>(residuos, <span class="at">h =</span> <span class="dv">5</span>, </span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>                      <span class="at">drift =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(derivaResiduos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Forecast method: Random walk with drift

Model Information:
Call: rwf(y = residuos, h = 5, drift = TRUE) 

Drift: -1.4074  (se 4.2266)
Residual sd: 21.962 

Error measures:
                        ME     RMSE      MAE        MPE     MAPE      MASE
Training set -1.684166e-14 21.55142 16.49657 -0.0954967 3.044183 0.9986713
                  ACF1
Training set 0.4069491

Forecasts:
     Point Forecast    Lo 80    Hi 80    Lo 95    Hi 95
2023       465.5926 436.9307 494.2544 421.7581 509.4271
2024       464.1852 422.9337 505.4366 401.0965 527.2738
2025       462.7778 411.3916 514.1640 384.1894 541.3662
2026       461.3704 401.0539 521.6869 369.1242 553.6165
2027       459.9630 391.4480 528.4779 355.1784 564.7475</code></pre>
</div>
</div>
<p>La salida obtenida con <code>summary</code> muestra el resultado de la aplicación del método de la deriva, donde se ha fijado un horizonte de previsión de cinco años (<code>h = 5</code>). Primero el método calcula la pendiente media de toda la serie a partir del primer y último dato <span class="math inline">\(\frac{y_T - y_1}{T-1}\)</span> que vale <span class="math inline">\(-1.4074\)</span> (<code>Drift</code> en la salida). Después, la previsión para 2023 se obtiene sumando al último dato de la serie (467) la pendiente, que por ser negativa ofrece un volumen de residuos inferior al de 2023. Si sumamos sucesivamente la pendiente, vamos obteniendo el resto de predicciones.</p>
<p>La calidad de ajuste muestra un RMSE de 21.6 kg per cápita (16.5 kg per cápita si usamos el MAE) o del 3%. El método no ofrece sesgo (MPE inferior al 1%), pero las predicciones por intervalo no son fiables (ACF1 superior a 0.1).</p>
<p>En la <a href="#fig-residuossencillos" class="quarto-xref">Figura&nbsp;2</a> muestra el resultado gráfico de la aplicación de este método. Observa que la predicción seria la continuación de una línea imaginaria que pasa por el primer y último dato de la serie.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(derivaResiduos, </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">series =</span> <span class="st">""</span>,</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"Kg per cápita"</span>,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-residuossencillos" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-residuossencillos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-06-Tema6_files/figure-html/fig-residuossencillos-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-residuossencillos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;2: Recogida de residuos y predicción por el método de la Deriva
</figcaption>
</figure>
</div>
</div>
</div>
<p><br>
<br>
</p>
</section>
</section>
<section id="alisado-exponencial" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Alisado exponencial</h1>
<p><br>
</p>
<section id="definición" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="definición"><span class="header-section-number">3.1</span> Definición</h2>
<p>Dentro de las series con tendencia y sin estacionalidad, para obtener una predicción en el periodo <span class="math inline">\(t+1\)</span> con datos hasta el periodo <span class="math inline">\(t\)</span> necesitamos dos componentes:</p>
<ul>
<li>La estimación del nivel de la serie en el periodo <span class="math inline">\(t\)</span>: <span class="math inline">\(l_t\)</span></li>
<li>La estimación de la pendiente de la serie en el periodo <span class="math inline">\(t\)</span>: <span class="math inline">\(b_t\)</span></li>
</ul>
<p>A partir de estas componentes obtenidas en el periodo <span class="math inline">\(t\)</span> y para un esquema aditivo, se tendría que la predicción en el periodo <span class="math inline">\(t+1\)</span> es:</p>
<p><span class="math display">\[\widehat{y}_{t+1} = l_t+b_t.\]</span> Si el objetivo es estimar una previsión <span class="math inline">\(h\)</span> periodos hacia delante desde el periodo <span class="math inline">\(t\)</span>, <span class="math inline">\(\widehat{y}_{t+h}\)</span>, hay que modificar la ecuación de predicción adecuadamente. Por ejemplo, para el caso aditivo se tendría que</p>
<p><span class="math display">\[\widehat{y}_{t+h} = l_t+hb_t.\]</span></p>
<p><br>
</p>
</section>
<section id="casos-posibles" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="casos-posibles"><span class="header-section-number">3.2</span> Casos posibles</h2>
<p>En las expresiones previas hemos supuesto que el nivel y la pendiente tienen esquema aditivo, pero puede ser multiplicativo (<span class="math inline">\(\widehat{y}_{t+h} = l_t \cdot b_t^h\)</span>), donde la pendiente incremente porcentualmente el nivel de la serie. Además, la pendiente puede ser amortiguada, concepto que definiremos en breve.</p>
<p>Por otro lado, recordemos que el término de error de los modelos de alisado puede ser aditivo o multiplicativo. Si el residuo es aditivo, entonces el modelo es <span class="math inline">\(y_t = \widehat{y}_t + \widehat{\varepsilon}_t\)</span>. Ahora bien, si el residuo es multiplicativo, entonces el modelo es <span class="math inline">\(y_t = \widehat{y}_t \cdot (1 + \widehat{\varepsilon}_t)\)</span>.</p>
<p>Por tanto, dentro de las series con tendencia y sin estacionalidad hay 8 posibles casos: dos según el tipo de error por 4 según el tipo de tendencia. Si, por completitud, añadimos a estos casos los dos ya vistos para series estacionarias en el <a href="https://iarribasf.github.io/PrediccionSeriesTemporales-GBIA/03-04-Tema4.html">Tema 4</a>, tememos la <a href="#tbl-taxonomia" class="quarto-xref">Tabla&nbsp;1</a> de posibilidades. En la tabla, la primera letra hace referencia al tipo de error y la segunda al tipo de pendiente.</p>
<div id="tbl-taxonomia" class="quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-taxonomia-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabla&nbsp;1: Casos de alisado según el tipo de error y tendencia
</figcaption>
<div aria-describedby="tbl-taxonomia-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">Tendencia</th>
<th style="text-align: center;"></th>
<th style="text-align: center;">Error</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: center;">Aditivo (A)</td>
<td style="text-align: center;">Multiplicativo (M)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Ninguna (N)</td>
<td style="text-align: center;">A, N</td>
<td style="text-align: center;">M, N</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Aditiva (A)</td>
<td style="text-align: center;"><strong>A, A</strong></td>
<td style="text-align: center;">M, A</td>
</tr>
<tr class="even">
<td style="text-align: left;">Aditiva Amortiguada (Ad)</td>
<td style="text-align: center;"><strong>A, Ad</strong></td>
<td style="text-align: center;">M, Ad</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Multiplicativa (M)</td>
<td style="text-align: center;">A, M</td>
<td style="text-align: center;">M, M</td>
</tr>
<tr class="even">
<td style="text-align: left;">Multiplicativa Amortiguada (Md)</td>
<td style="text-align: center;">A, Md</td>
<td style="text-align: center;">M, Md</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>Cada caso difiere en las componentes que se observan y su esquema, dando lugar a un conjunto diferente de ecuaciones recursivas de actualización:</p>
<p><span class="math display">\[
\begin{aligned}
l_t&amp; = f_l(y_t,y_{t-1}\ldots, l_{t-1},l_{t-2}\ldots,b_{t-1},b_{t-2}\ldots) \\
b_t&amp; = f_b(y_t,y_{t-1}\ldots, l_{t},l_{t-1}\ldots,b_{t-1},b_{t-2}\ldots)
\end{aligned}
\]</span></p>
<p>Recordemos que el tipo de error (aditivo o multiplicativo) es sobre todo relevante en el cálculo del intervalo de confianza de las predicciones.</p>
<p>Los modelos más usuales para series con tendencia y sin estacionalidad son (recordemos que las letras indican: error, tendencia y estacionalidad):</p>
<ul>
<li>(A, A, N): Alisado de Holt</li>
<li>(A, Ad, N): Alisado con tendencia amortiguada (d de <em>damped</em>, amortiguamiento)</li>
</ul>
<p>Ahora bien, podemos estimar cualquiera de los 10 modelos usando la función <code>ets</code> del paquete <code>forecast</code>.</p>
<p>Acude al artículo de <span class="citation" data-cites="Hyndman08">Hyndman and Khandakar (<a href="#ref-Hyndman08" role="doc-biblioref">2008</a>)</span> para saber más de cada modelo, o al libro de <span class="citation" data-cites="Hyndman08b">Hyndman et al. (<a href="#ref-Hyndman08b" role="doc-biblioref">2008</a>)</span>.</p>
<p><br>
</p>
</section>
<section id="alisado-exponencial-de-holt-a-a-n" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="alisado-exponencial-de-holt-a-a-n"><span class="header-section-number">3.3</span> Alisado exponencial de Holt (A, A, N)</h2>
<section id="formulas-interactivas-de-sus-componentes" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="formulas-interactivas-de-sus-componentes">Formulas interactivas de sus componentes</h3>
<p>Las <strong>ecuaciones recursivas</strong> son</p>
<p><span class="math display">\[
\begin{aligned}
l_t &amp; =\alpha y_t + (1-\alpha)(l_{t-1}+b_{t-1}) \\
b_t &amp; =\beta (l_t - l_{t-1}) + (1-\beta)b_{t-1}
\end{aligned}
\]</span></p>
<p>La ecuación de la <strong>predicción intramuestral</strong> a un periodo vista es</p>
<p><span class="math display">\[\widehat{y}_{t+1} = l_t + b_t,\]</span> de forma que la ecuación de <strong>predicción extramuestral</strong> es <span class="math display">\[\widehat{y}_{T+h}=l_T + h b_T.\]</span></p>
<p>Dos estimaciones razonables del nivel de la serie en el periodo <span class="math inline">\(t\)</span> son el valor observado para la serie en ese periodo <span class="math inline">\(y_t\)</span>, y una estimación del nivel del periodo <span class="math inline">\(t\)</span> realizada desde el periodo <span class="math inline">\(t-1\)</span>: <span class="math inline">\(l_{t-1} + b_{t-1}\)</span>. Por otro lado, dos estimaciones razonables de la pendiente de la serie en el periodo <span class="math inline">\(t\)</span> son el cambio de nivel de <span class="math inline">\(t-1\)</span> a <span class="math inline">\(t\)</span> (el último observado) <span class="math inline">\(l_t-l_{t-1}\)</span>, y el valor de la pendiente en el periodo previo, <span class="math inline">\(b_{t-1}\)</span>. En ambos casos, nivel y pendiente, la estimación final es una media ponderada, parametrizada por <span class="math inline">\(0 &lt; \alpha, \beta &lt; 1\)</span>.</p>
<p>Observa que el <em>método ingenuo II</em> es un caso concreto de Alisado de Holt. Si hacemos <span class="math inline">\(\alpha=\beta = 1,\)</span> queda <span class="math inline">\(l_t=y_t\)</span> y <span class="math inline">\(b_t=y_t-y_{t-1}\)</span>, por tanto <span class="math display">\[\widehat{y}_{t+1}=l_t + b_t = y_t + (y_t - y_{t-1})\]</span> y <span class="math display">\[\widehat{y}_{T+h}=l_T + h \cdot b_T = y_T + h(y_T - y_{T-1}).\]</span></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
¿Sabrías responder a estas preguntas?
</div>
</div>
<div class="callout-body-container callout-body">
<p>Hemos visto que en modelo de Alisado con tendencia, si <span class="math inline">\(\alpha = \beta = 1\)</span>, la ecuación de predicción que queda es la del método Ingenuo II.</p>
<p>¿Cómo quedaría la ecuación de predicción si <span class="math inline">\(\alpha = \beta = 0\)</span>?</p>
<p>¿Y si <span class="math inline">\(\alpha = 1\)</span> y <span class="math inline">\(\beta = 0\)</span>? ¿Y si <span class="math inline">\(\alpha = 0\)</span> y <span class="math inline">\(\beta = 1\)</span>?</p>
</div>
</div>
</section>
<section id="estimación-de-los-parámetros-del-modelo" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="estimación-de-los-parámetros-del-modelo">Estimación de los parámetros del modelo</h3>
<p>Para aplicar este método es necesario estimar unos valores iniciales <span class="math inline">\(l_0\)</span> y <span class="math inline">\(b_0\)</span> de las ecuaciones recursivas e identificar los valores más adecuados de los parámetros <span class="math inline">\(\alpha\)</span> y <span class="math inline">\(\beta\)</span>.</p>
<p>La función <code>ets</code> por defecto estima los parámetros <span class="math inline">\(\alpha\)</span>, <span class="math inline">\(\beta\)</span>, <span class="math inline">\(l_0\)</span> y <span class="math inline">\(b_0\)</span> maximizando la función de verosimilitud. En este caso la búsqueda está restringida a <span class="math inline">\(0 &lt; \beta &lt; \alpha &lt; 1\)</span>. Por tanto, <span class="math inline">\(\alpha\)</span> y <span class="math inline">\(\beta\)</span> nunca pueden ser 0 o 1 y en la práctica sus valores limite son 0.0001 y 0.9999.</p>
<p>La interpretación del parámetro <span class="math inline">\(\alpha\)</span> es similar al caso del alisado exponencial simple.</p>
<p><strong>Interpretación del parámetro</strong> <span class="math inline">\(\beta\)</span>:</p>
<ul>
<li>Si <span class="math inline">\(\beta = 1\)</span>, <span class="math inline">\(b_t = l_t - l_{t-1}\)</span>, la pendiente se actualiza constantemente porque varía periodo a periodo Puede ser un indicador de mal ajuste (tendencia no lineal o pendiente no aditiva).</li>
<li>Si <span class="math inline">\(\beta = 0\)</span>, <span class="math inline">\(b_t = b_{t-1}= \ldots = b_0\)</span>, la pendiente se mantiene constante en el tiempo.</li>
</ul>
</section>
<section id="ejemplo-de-aplicación-a-la-serie-residuos-1" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="ejemplo-de-aplicación-a-la-serie-residuos-1">Ejemplo de aplicación a la serie Residuos</h3>
<p>Vamos a usar el método de alisado de Holt para predecir la serie Residuos. Usaremos para ello la función <code>ets</code> con el argumento <code>model = "AAN"</code> (error y tendencia aditivas sin estacionalidad). Además, es necesario añadir el argumento <code>damped = FALSE</code> para prevenir el uso de tendencia amortiguada, que veremos en el siguiente epígrafe.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>etsResiduos <span class="ot">&lt;-</span> <span class="fu">ets</span>(residuos, </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">model =</span> <span class="st">"AAN"</span>,</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">damped =</span> <span class="cn">FALSE</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(etsResiduos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ETS(A,A,N) 

Call:
ets(y = residuos, model = "AAN", damped = FALSE)

  Smoothing parameters:
    alpha = 0.9917 
    beta  = 1e-04 

  Initial states:
    l = 568.957 
    b = -2.8916 

  sigma:  26.1313

     AIC     AICc      BIC 
281.7210 284.4483 288.3820 

Training set error measures:
                     ME     RMSE      MAE        MPE     MAPE     MASE
Training set -0.7573797 24.19288 18.21516 -0.2531821 3.386255 1.102711
                  ACF1
Training set 0.2192994</code></pre>
</div>
</div>
<p>Los valores óptimos de los cuatro parámetros estimados son <span class="math inline">\(\alpha=\)</span> 0.99, <span class="math inline">\(\beta=\)</span> 0, <span class="math inline">\(l_0 =\)</span> 568.96 y <span class="math inline">\(b_0 =\)</span> -2.89.</p>
<p>Observa que <span class="math inline">\(\alpha\)</span> es prácticamente 1 y que <span class="math inline">\(\beta\)</span> es cero. Si aplicamos estos valores de los parámetros a las ecuaciones recursivas y la predicción extramuestral, obtenemos <span class="math inline">\(y_{T+h}=y_T + h\cdot b_0\)</span>: la predicción es el último valor observado más <span class="math inline">\(h\)</span> veces la primera pendiente estimada. La calidad de las predicciones es razonable, con un error porcentual medio del 3.4%.</p>
<p>Por otro lado, el valor de <span class="math inline">\(l_0\)</span> indica que el nivel estimado para el volumen de residuos de 1994 es de 568.96. Además, el incremento entre 1994 y 1995 se estima en <span class="math inline">\(b_0 =\)</span> -2.89.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Parámetros estimados
</div>
</div>
<div class="callout-body-container callout-body">
<p>¿Cuántos parámetros se han estimado (y la respuesta no es 4)? ¿Cuál es el denominador en el cálculo de RMSE y de <em>sigma</em>?</p>
</div>
</div>
<p>En el objeto <code>etsResiduos</code> la matriz <code>etsResiduos$states</code> guarda todos los valores obtenidos con las ecuaciones recursivas, en este caso el nivel y la pendiente, incluidos los valores de arranque. Puedes ver los valores de <span class="math inline">\(l_{2022}\)</span> y <span class="math inline">\(b_{2022}\)</span> en su última fila, que valen respectivamente</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(etsResiduos<span class="sc">$</span>states, <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Time Series:
Start = 2022 
End = 2022 
Frequency = 1 
            l         b
2022 466.9747 -2.893718</code></pre>
</div>
</div>
<p>Así, la predicción para <span class="math inline">\(2023\)</span> es <span class="math inline">\(\widehat{y}_{2023}=l_{2022} + b_{2022}=\)</span> 466.97 <span class="math inline">\(+\)</span> -2.89 <span class="math inline">\(=\)</span> 464.08. Igualmente <span class="math inline">\(\widehat{y}_{2024}=l_{2022} + 2\cdot b_{2022}=\)</span> 461.19. Es decir, el incremento entre previsiones es constante e igual a <span class="math inline">\(b_{2022}\)</span> que, por ser <span class="math inline">\(\beta\)</span> prácticamente nulo, casi coincide con <span class="math inline">\(b_0\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>etsResiduosf <span class="ot">&lt;-</span> <span class="fu">forecast</span>(etsResiduos,</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">h =</span> <span class="dv">5</span>, </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">level =</span> <span class="dv">95</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>etsResiduosf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Point Forecast    Lo 95    Hi 95
2023       464.0810 412.8646 515.2974
2024       461.1873 389.0510 533.3236
2025       458.2936 370.0626 546.5245
2026       455.3998 353.5850 557.2147
2027       452.5061 338.7153 566.2970</code></pre>
</div>
</div>
<p>La <a href="#fig-residuosAAN" class="quarto-xref">Figura&nbsp;3</a> muestra la serie Residuos y las previsiones extramuestrales, que muestran una ligera tendencia decreciente.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(etsResiduosf,</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"Kg. per cápita"</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-residuosAAN" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-residuosAAN-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-06-Tema6_files/figure-html/fig-residuosAAN-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-residuosAAN-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;3: Residuos y predicción con alisado de Holt
</figcaption>
</figure>
</div>
</div>
</div>
<p><br>
</p>
</section>
</section>
<section id="alisado-exponencial-con-pendiente-amortiguada-a-ad-n" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="alisado-exponencial-con-pendiente-amortiguada-a-ad-n"><span class="header-section-number">3.4</span> Alisado exponencial con pendiente amortiguada (A, Ad, N)</h2>
<p>Las previsiones con el método de Holt presentan siempre una pendiente constante. En previsiones a corto plazo esto no es un problema, pero para previsiones a largo plazo la experiencia indica que suele aparecer un sesgo de previsión. El alisado exponencial con pendiente amortiguada trata de corregir esta limitación. El mecanismo, propuesto por <span class="citation" data-cites="Gardner85">Gardner and Mckenzie (<a href="#ref-Gardner85" role="doc-biblioref">1985</a>)</span>, es introducir un nuevo parámetro <span class="math inline">\(0 \leq \phi \leq 1\)</span> que <em>amortigua</em> la tendencia hasta hacerla plana en el largo plazo.</p>
<section id="formulas-interactivas-de-sus-componentes-1" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="formulas-interactivas-de-sus-componentes-1">Formulas interactivas de sus componentes</h3>
<p>Las <strong>ecuaciones recursivas</strong> son</p>
<p><span class="math display">\[
\begin{aligned}
l_t &amp; =\alpha y_t + (1-\alpha)(l_{t-1}+\phi b_{t-1}) \\
b_t &amp; =\beta (l_t - l_{t-1}) + (1-\beta)\phi b_{t-1}
\end{aligned}
\]</span></p>
<p>La ecuación de la <strong>predicción intramuestral</strong> a un periodo vista es <span class="math display">\[\widehat{y}_{t+1} = l_t + \phi b_t,\]</span> de forma que la ecuación de <strong>predicción extramuestral</strong> es <span class="math display">\[\widehat{y}_{T+h}=l_T + (\phi + \phi^2 + \ldots + \phi^h) b_T.\]</span></p>
<p>Se ha añadido un nuevo parámetro <span class="math inline">\(\phi\in [0, 1]\)</span> que acompaña siempre a la pendiente <span class="math inline">\(b_t\)</span>. Si <span class="math inline">\(\phi = 1\)</span>, se tiene el alisado de Holt y si <span class="math inline">\(\phi = 0\)</span>, se tiene el alisado simple. Se puede comprobar que en el largo plazo las predicciones se hacen constantes e iguales a <span class="math inline">\(l_T + \phi b_T/(1 - \phi)\)</span>.</p>
<p>Por razones prácticas el rango de búsqueda de <span class="math inline">\(\phi\)</span> queda en el intervalo <span class="math inline">\([0.8, 0.98]\)</span>. Si el valor óptimo de <span class="math inline">\(\phi\)</span> fuera su valor máximo de <span class="math inline">\(0.98\)</span> o muy cercano a este, cabría plantearse si no sería más adecuado un modelo sin amortiguamiento.</p>
</section>
<section id="ejemplo-de-aplicación-a-la-serie-residuos-2" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="ejemplo-de-aplicación-a-la-serie-residuos-2">Ejemplo de aplicación a la serie Residuos</h3>
<p>Vamos a usar el método de Alisado con amortiguamiento para predecir, una vez más, la serie Residuos añadiendo a la función <code>ets</code> el argumento <code>damped = TRUE</code>. En este caso, para ver el efecto del <em>amortiguamiento</em> vamos a pedir un horizonte temporal de previsión más largo.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>etsDResiduos <span class="ot">&lt;-</span> <span class="fu">ets</span>(residuos, </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">model =</span> <span class="st">"AAN"</span>, </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">damped =</span> <span class="cn">TRUE</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(etsDResiduos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ETS(A,Ad,N) 

Call:
ets(y = residuos, model = "AAN", damped = TRUE)

  Smoothing parameters:
    alpha = 0.9999 
    beta  = 0.1808 
    phi   = 0.8 

  Initial states:
    l = 564.3968 
    b = 14.5779 

  sigma:  26.4267

     AIC     AICc      BIC 
283.1587 287.1587 291.1520 

Training set error measures:
                    ME    RMSE      MAE        MPE     MAPE     MASE       ACF1
Training set -3.193352 23.9512 17.42662 -0.6361345 3.226137 1.054975 0.04099902</code></pre>
</div>
</div>
<p>El valor óptimo del parámetro <span class="math inline">\(\phi\)</span> es <span class="math inline">\(0.8\)</span> y el error porcentual 3.2%, algo inferior al obtenido con el alisado de Holt sin amortiguamiento. Además, el modelo de Alisado con amortiguamiento genera intervalos de predicción correctos, cosa que no ocurría con el modelo de Alisado de Holt.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Parámetros estimados
</div>
</div>
<div class="callout-body-container callout-body">
<p>¿Cuántos parámetros se han estimado en este caso? ¿Cuáles?</p>
</div>
</div>
<p>La <a href="#fig-residuosAAdN" class="quarto-xref">Figura&nbsp;4</a> muestra la serie Residuos, su estimación intramuestral y las predicciones a 15 años vista. Observa que la pendiente de las previsiones se <em>amortigua</em> en el tiempo, de forma que al principio las previsiones crecen más rápidamente que en los últimos años.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>etsDResiduosf <span class="ot">&lt;-</span> <span class="fu">forecast</span>(etsDResiduos, </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>                          <span class="at">h =</span> <span class="dv">15</span>,</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">level =</span> <span class="dv">95</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>etsDResiduosf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Point Forecast    Lo 95    Hi 95
2023       467.3276 415.5323 519.1229
2024       467.5896 388.8679 546.3113
2025       467.7992 365.5349 570.0635
2026       467.9669 343.9999 591.9340
2027       468.1011 323.7753 612.4269
2028       468.2084 304.6386 631.7782
2029       468.2943 286.4588 650.1298
2030       468.3630 269.1417 667.5842
2031       468.4179 252.6118 684.2240
2032       468.4619 236.8035 700.1202
2033       468.4971 221.6584 715.3357
2034       468.5252 207.1236 729.9268
2035       468.5477 193.1509 743.9445
2036       468.5657 179.6963 757.4351
2037       468.5801 166.7198 770.4405</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(etsDResiduosf,</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"kg per cápita"</span>,</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>,</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">PI =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-residuosAAdN" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-residuosAAdN-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-06-Tema6_files/figure-html/fig-residuosAAdN-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-residuosAAdN-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;4: Residuos y predicción con alisado exponencial con amortiguamiento
</figcaption>
</figure>
</div>
</div>
</div>
<p><br>
</p>
</section>
</section>
<section id="casos-generales-de-alisado-exponencial" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="casos-generales-de-alisado-exponencial"><span class="header-section-number">3.5</span> Casos generales de alisado exponencial</h2>
<p>En los epígrafes previos hemos visto dos de los diez casos expuestos en la taxonomía de la <a href="#tbl-taxonomia" class="quarto-xref">Tabla&nbsp;1</a>, fijados a partir de los argumentos <code>model</code> y <code>damped</code> de la función <code>ets</code>. ¿Pero cómo sabemos nosotros cuál es realmente el modelo que mejor se ajusta a nuestros datos? Veamos ahora como estimar cualquiera de los modelos que surgen según las diferentes posibilidades de la tendencia (N, A, Ad, M y Md) y el error (A, M).</p>
<p>Recordemos que el tipo de modelo en <code>ets</code> se especifica con el argumento <code>model</code> y que <code>damped</code> indica si hay amortiguamiento. Por ejemplo, <code>model = "AAN", damped = FALSE</code> indica alisado de Holt y <code>model = "MMN", damped = TRUE</code> indica un modelo con error y pendiente multiplicativas y con amortiguamiento.</p>
<p>Si en una de las tres letras del código del modelo se indica “Z”, la función <code>ets</code> selecciona de entre los modelos posibles el que mejor se ajusta. Si ademas se indica <code>damped = NULL</code> (o no se indica nada) se dejaría a la función total libertad para buscar entre modelos con y sin amortiguamiento.</p>
<p>Por ejemplo, <code>model = "ZAN"</code> indica un modelo con pendiente aditiva, sin estacionalidad y dejaría a <code>ets</code> la búsqueda de la mejor opción para el error (aditivo o multiplicativo) y para el amortiguamiento. <strong>Si se especifica <code>model = "ZZZ"</code> junto con <code>damped = NULL</code> (opciones por defecto) se dejaría a la función total libertad para buscar entre todos los modelos</strong>. Si se desea restringir la búsqueda a modelos sin amortiguamiento basta indicar <code>damped = FALSE</code> y si se desea restringir la búsqueda solo a modelos aditivos se puede usar el argumento <code>additive.only = TRUE</code>.</p>
<p>En realidad, por defecto <code>ets</code> no considera modelos con tendencia multiplicativa (últimas dos líneas de la <a href="#tbl-taxonomia" class="quarto-xref">Tabla&nbsp;1</a>). Debes fijar el parámetro <code>allow.multiplicative.trend = TRUE</code> para incluir en la búsqueda estos modelos.</p>
<p>Cuando se pide a función <code>ets</code> elegir entre varias modelos, por defecto elige aquel con menor AICc, pero recuerda que el argumento <code>ic</code> permite cambiar de criterio.</p>
<p>Por ejemplo, para Residuos si no restringimos la búsqueda, la función <code>ets</code> muestra que el modelo con mejor ajuste es “MNN” con <span class="math inline">\(\alpha = 1\)</span>. Es decir, el Ingenuo I con error multiplicativo.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">ets</span>(residuos))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ETS(M,N,N) 

Call:
ets(y = residuos)

  Smoothing parameters:
    alpha = 0.9999 

  Initial states:
    l = 504.2743 

  sigma:  0.0395

     AIC     AICc      BIC 
267.4168 268.4168 271.4134 

Training set error measures:
                    ME     RMSE      MAE        MPE     MAPE      MASE
Training set -1.331356 21.20947 15.95526 -0.3461958 2.946509 0.9659013
                  ACF1
Training set 0.4113965</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Una reflexión sobre los métodos automáticos de selección de modelos
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Con el comando <code>forecast(ets(nacimientos),h=24)</code> obtenemos una predicción mensual a dos años vista del número de nacimientos en España. Así de simple, solo 31 caracteres. Todo esto gracias a que un algoritmo interno ha estimado los parámetros de múltiples modelos, elegido el mejor modelo de todos y lo ha usado para obtener las predicciones. Podemos afirmar que tenemos las mejores predicciones. Un momento, ¿podemos?</p>
<p>Parémonos a reflexionar sobre lo que hemos hecho o, más bien, lo que el algoritmo ha hecho y a contrastarlo con lo que nosotros queríamos. Por un lado, el algoritmo estima los parámetros de un menú fijo de modelos y para ello usa un criterio de optimización, que por defecto es maximizar la función de verosimilitud; cuando ya tiene estimados todos los modelos, elije el mejor usando el criterio de información de Akaike corregido para muestras pequeñas; y finalmente, nosotros medimos la capacidad predictiva del modelo seleccionado usando el error absoluto porcentual medio. Vaya, resulta que en los procesos de identificación y estimación del mejor modelo se usan dos criterios diferentes, que además no coinciden con nuestro criterio de calidad de las predicciones.</p>
<p>Si consideramos que la calidad de un modelo viene dada por el error absoluto porcentual medio en las predicciones intramuestrales a un periodo vista (lo que hemos decidido llamar MAPE), ¿no deberíamos estimar los parámetros del modelo usando como criterio la minimización del MAPE?, ¿no deberíamos elegir entre varios modelos aquel que presenta un MAPE menor? De esta forma, en todos los pasos del proceso se usa el mismo criterio, que es, además, el criterio que hemos considerado adecuado para valorar la calidad de las predicciones.</p>
<p>Pero no es esto lo que hacemos.</p>
<p>Nada nos garantiza que el modelo estimado y seleccionado por el algoritmo estime las mejores predicciones posibles. Y por <em>mejores</em> quiero decir que de entre todos los posibles modelos del menú y todos los posibles valores de sus parámetros, el seleccionado sea el que minimiza nuestro criterio de calidad de las predicciones.</p>
<p>Ahora ya podemos dar respuesta a la pregunta del primer párrafo: no, no podemos afirmar que nuestras predicciones sean las mejores.</p>
<p>Alguien dirá que casi seguro entre las predicciones subóptimas obtenidas por el algoritmo con su extraña mezcla de criterios y las predicciones óptimas de verdad no habrá mucha diferencia. Total, que más da una función de verosimilitud que un criterio de información que una medida del error medio. Pero lo cierto es que no lo sabemos, no tenemos ni idea de la distancia que hay entre lo óptimo y lo subóptimo, y si el coste de equivocarme en las predicciones es alto, puede que incluso una pequeña diferencia sea relevante.</p>
<p>Esta reflexión realizada en el contexto de series temporales y para la función <code>ets</code> es aplicable a todos los casos donde dejamos que un algoritmo ya programado elija el mejor modelo, y se basa en el hecho de que rara vez los criterios de estimación y elección que usan los algoritmos coinciden con el concepto de calidad de ajuste que estamos interesados.</p>
<p>A pesar de lo aquí expuesto, como es más cómodo (y rápido) tirar de rutinas ya programadas que escribir nuestro propio código, seguiremos trabajando con modelos subóptimos y obteniendo estimaciones subóptimas, pero diciendo que son las mejores.</p>
</div>
</div>
</div>
<p><br>
<br>
</p>
</section>
</section>
<section id="modelos-arima" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Modelos ARIMA</h1>
<p><br>
</p>
<section id="diferenciación-de-una-serie" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="diferenciación-de-una-serie"><span class="header-section-number">4.1</span> Diferenciación de una serie</h2>
<p>Recuerda que para poder aplicar estos modelos, la serie tiene que ser estacionaria en media, en varianza y ergódica. Además, por el tipo de series que estamos analizando, estas son siempre estacionarias en varianza y la estacionariedad en media implica ergodicidad. Es decir, <strong>para series sin estacionalidad solo necesitamos para aplicar modelos Arima que la serie sea estacionaria en media</strong>.</p>
<p>Por tanto, ¿qué pasa si una serie temporal <span class="math inline">\(\{y_t\}_{t=1}^T\)</span> no es estacionaria en media?. A continuación veremos una transformación muy sencilla que convierten una serie no estacionaria en estacionaria, la diferenciación.</p>
<p>En el panel superior de la <a href="#fig-aforo2" class="quarto-xref">Figura&nbsp;5</a> vuelves a tener la serie de aforo vista al inicio del tema, que denominaremos <span class="math inline">\(y_t\)</span>. En el panel inferior la diferencia de la serie, <span class="math inline">\(y_t - y_{t-1}\)</span>. La serie Aforo no es estacionaria en media, pero su diferencia si es estacionaria en media.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-aforo2" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-aforo2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-06-Tema6_files/figure-html/fig-aforo2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-aforo2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;5: Aforo y su diferencia
</figcaption>
</figure>
</div>
</div>
</div>
<p><strong>La diferenciación permite transformar una serie no estacionaria en media en estacionaria en media</strong>. Diferenciar de orden <span class="math inline">\(k\)</span> consiste en restar a la observación de un periodo la de <span class="math inline">\(k\)</span> periodos antes: <span class="math display">\[\nabla_k y_t = y_t - y_{t-k}.\]</span></p>
<p>Un caso concreto es la <strong>diferenciación regular o diferenciación de orden uno</strong>, que consiste en restar a la observación de un periodo la del periodo precedente: <span class="math display">\[\nabla y_t = y_t - y_{t-1}.\]</span></p>
<p>Si <span class="math inline">\(\nabla y_t\)</span> no fuera estacionaria, se diferenciaría una segunda vez para obtener una doble diferenciación de primer orden: <span class="math display">\[\nabla^{2} y_t = \nabla(\nabla y_t) = \nabla y_t - \nabla y_{t-1} = (y_t - y_{t-1}) - (y_{t-1} - y_{t-2}) = y_t - 2y_{t-1} + y_{t-2}\]</span></p>
<p>En la práctica una sola diferenciación suele ser suficiente para obtener la estacionariedad en media; diferenciar dos veces es excepcional; y diferenciar tres o más veces no se da.</p>
<section id="diferenciación-con-r" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="diferenciación-con-r">Diferenciación con <code>R</code></h3>
<p><code>R</code> dispone de la función <code>diff</code> para diferenciar una serie:</p>
<ul>
<li><code>diff(x, lag = k)</code> calcula la diferencia de orden <span class="math inline">\(k\)</span>, <span class="math inline">\(\nabla_k y_t\)</span></li>
<li><code>diff(x)</code> calcula la diferencia regular o de orden <span class="math inline">\(1\)</span>, <span class="math inline">\(\nabla y_t\)</span> (el valor por defecto de <code>lag</code> es 1)</li>
<li><code>diff(x, difference = d)</code> calcula <span class="math inline">\(d\)</span> diferencias regulares, <span class="math inline">\(\nabla^d y_t\)</span></li>
</ul>
<p>Además, en <code>forecast</code> está disponible la función <code>ndiffs</code> que estima el número de diferencias regulares necesarias para que una serie sea estacionaria. Para ello usa un contraste de raíces unitarias (que no veremos en este curso). Para la serie Aforo la función sugiere una diferenciación. Lo mismo ocurre para la serie Residuos.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ndiffs</span>(aforo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ndiffs</span>(residuos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
</div>
<p>Sin embargo, para la serie Nacimientos, el número de diferenciaciones sugerida es 2.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ndiffs</span>(nacimientos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2</code></pre>
</div>
</div>
</section>
<section id="operador-retardo-de-nuevo" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="operador-retardo-de-nuevo">Operador Retardo (de nuevo)</h3>
<p>Podemos usar el operador retardo para escribir la diferenciación de una forma más operativa. Así,</p>
<p><span class="math display">\[
\begin{aligned}
  \nabla y_t &amp; =  y_t - y_{t-1} = y_t - Ly_t = (1-L)y_t \\
  \nabla^d y_t &amp; =  (1-L)^d y_t
\end{aligned}
\]</span></p>
</section>
</section>
<section id="procesos-arimap-d-p" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="procesos-arimap-d-p"><span class="header-section-number">4.2</span> Procesos ARIMA(p, d, p)</h2>
<p>Ya vimos que ARIMA surge de combinar las siglas de tres procesos diferentes: <strong>AR</strong> de AutoRegresive, <strong>I</strong> de Integrated y <strong>MA</strong> de Moving Average. De ellos vimos en el <a href="https://iarribasf.github.io/PrediccionSeriesTemporales-GBIA/03-04-Tema4.html">Tema 4</a> los procesos AR y MA.</p>
<p>Veamos ahora la <strong>I</strong>.</p>
<p><strong>Integración, I</strong></p>
<p>Si la serie <span class="math inline">\(y_t\)</span> no es estacionaria, pero tras diferenciarla <span class="math inline">\(d\)</span> veces se hace estacionaria, diremos que la serie es integrada de orden <span class="math inline">\(d\)</span>: <span class="math inline">\(y_t \sim I(d)\)</span>. Por tanto,</p>
<ul>
<li>una serie estacionaria se indicará como <span class="math inline">\(y_t \sim I(0)\)</span></li>
<li><span class="math inline">\(y_t \sim I(d)\)</span> es equivalente a <span class="math inline">\(\nabla^d y_t = (1 - L)^d y_t \sim I(0)\)</span></li>
</ul>
<p>Una serie <span class="math inline">\(y_t\)</span> sigue un proceso <span class="math inline">\(ARIMA(p,d,q)\)</span> si:</p>
<ol type="1">
<li>hay que diferenciar la serie <span class="math inline">\(d\)</span> veces para hacerla estacionaria, <span class="math inline">\(y_t \sim I(d)\)</span>; y</li>
<li>la serie diferenciada sigue un proceso ARMA(p,q), <span class="math inline">\(\nabla^d y_t \sim ARMA(p,q)\)</span>.</li>
</ol>
<p>Entonces, podemos escribir <span class="math inline">\(y_t \sim ARIMA(p,d,q)\)</span>:</p>
<span class="math display">\[\begin{equation*}
  \begin{array}{c@{\qquad}c@{\quad}ccc}
   (1 - \phi_1 L - \ldots - \phi_p L^p) &amp; (1- L)^d y_t &amp; = &amp; c + (1 + \theta_1 L + ... + \theta_q L^q) \varepsilon_t \\
                           \uparrow                            &amp; \uparrow      &amp;   &amp; \uparrow \\
                           AR(p)                               &amp; I(d)          &amp;   &amp; MA(q)
  \end{array}
\end{equation*}\]</span>
<p>Algunos ejemplos son:</p>
<ul>
<li><p><span class="math inline">\(y_t \sim ARIMA(0, 1, 0): \;\;(1- L) y_t = c + \varepsilon_t\)</span> o <span class="math inline">\(y_t = c + y_{t-1} + \varepsilon_t\)</span>. Si <span class="math inline">\(c=0\)</span>, tenemos un <strong>paseo aleatorio</strong>; si <span class="math inline">\(c \neq 0\)</span>, tenemos un <strong>paseo aleatorio con deriva</strong>.</p></li>
<li><p><span class="math inline">\(y_t \sim ARIMA(1, 1, 1): \;\;(1 - \phi_1 L)(1- L) y_t = c + (1 + \theta_1 L) \varepsilon_t\)</span> o <span class="math inline">\(y_t = c + y_{t-1} + \phi_1(y_{t-1} - y_{t-2}) + \theta_1 \varepsilon_{t-1} + \varepsilon_t\)</span>. Observa que a pesar de ser un proceso AR(1), la prediccion de la serie en el periodo <span class="math inline">\(t\)</span> depende no solo del valor de la serie en el periodo <span class="math inline">\(t-1\)</span>, sino también de su valor en el periodo <span class="math inline">\(t-2\)</span>. Solo el uso del operador retardo permite escribir adecuadamente la ecuación de predicción.</p></li>
</ul>
<p><br>
</p>
</section>
<section id="ejemplo-de-aplicación-a-la-serie-residuos-3" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="ejemplo-de-aplicación-a-la-serie-residuos-3"><span class="header-section-number">4.3</span> Ejemplo de aplicación a la serie Residuos</h2>
<p>Vamos a aplicar la metodología de Box-Jenkins a la serie Residuos.</p>
<section id="diferencación-de-la-serie" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="diferencación-de-la-serie">Diferencación de la serie</h3>
<p>El primer paso es transformar la serie original para que sea estacionaria. La <a href="#fig-Residuos" class="quarto-xref">Figura&nbsp;6</a> muestra la gráfica de la serie y de su primera diferencia. Se aprecia que la serie original no es estacionaria en media, pero si lo es la serie diferenciada.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(<span class="st">"Residuos"</span> <span class="ot">=</span> residuos,</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Dif. Residuos"</span> <span class="ot">=</span> <span class="fu">diff</span>(residuos)) <span class="sc">%&gt;%</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">facets =</span> <span class="cn">TRUE</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">ylab =</span> <span class="st">"kg. per cápita"</span>,</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">main =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-Residuos" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-Residuos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-06-Tema6_files/figure-html/fig-Residuos-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-Residuos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;6: Residuos recogidos
</figcaption>
</figure>
</div>
</div>
</div>
<p>Además,</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ndiffs</span>(residuos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
</div>
<p>Podemos concluir que la primera diferencia de la serie Residuos es estacionaria y, por tanto, ergódica. Es decir, <span class="math inline">\(d=1\)</span> o <span class="math inline">\(residuos_t \sim I(1)\)</span>.</p>
</section>
<section id="identificación" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="identificación">Identificación</h3>
<p>Tras diferenciar la serie, vamos a identificar los valores de <span class="math inline">\(p\)</span> y <span class="math inline">\(q\)</span>, el paso más difícil, ayudándonos de la función <code>auto.arima</code>. Como ya hemos decidido el número de diferenciaciones, fijamos este parámetro con <code>d = 1</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">auto.arima</span>(residuos, </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">d =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: residuos 
ARIMA(1,1,0) 

Coefficients:
         ar1
      0.4178
s.e.  0.1741

sigma^2 = 397.8:  log likelihood = -118.71
AIC=241.42   AICc=241.92   BIC=244.01</code></pre>
</div>
</div>
<p>Observa como la identificación automática da como mejor modelo <span class="math inline">\(p=1\)</span> y <span class="math inline">\(q=0\)</span>, donde el parámetro estimado parece siginficativo (supera los dos errores estándar). Es decir <span class="math inline">\(residuos_t \sim ARIMA(1,1,0)\)</span> sin deriva (sin constante).</p>
</section>
<section id="estimación" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="estimación">Estimación</h3>
<p>Procedemos a estimar el modelo identificado con la función <code>Arima</code>, donde el proceso a estimar se indica en el argumento <code>order</code> y si hay constante en el argumento con <code>include.constant</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>arima110 <span class="ot">&lt;-</span> <span class="fu">Arima</span>(residuos, </span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>), </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">include.constant =</span> <span class="cn">FALSE</span>)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>arima110</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: residuos 
ARIMA(1,1,0) 

Coefficients:
         ar1
      0.4178
s.e.  0.1741

sigma^2 = 397.8:  log likelihood = -118.71
AIC=241.42   AICc=241.92   BIC=244.01</code></pre>
</div>
</div>
</section>
<section id="intervención" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="intervención">Intervención</h3>
<p>Se analiza si para algún año se observa un error atípico (por ejemplo 3 veces superior al error estándar). La <a href="#fig-ResiduosError" class="quarto-xref">Figura&nbsp;7</a> muestra que en los años 1999 y 2004, el residuo sobrepasa los dos errores estándar pero queda lejos de los tres errores estándar así que asumiremos que no hay valores atípicos.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>error <span class="ot">&lt;-</span> <span class="fu">residuals</span>(arima110)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>sderror <span class="ot">&lt;-</span> <span class="fu">sd</span>(error)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(error, <span class="at">series=</span><span class="st">"Error"</span>,</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"Error"</span>,</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>)<span class="sc">*</span>sderror, </span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"green"</span>, <span class="st">"green"</span>, <span class="st">"red"</span>), </span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span> <span class="fu">seq</span>(<span class="dv">1995</span>, <span class="dv">2023</span>, <span class="dv">2</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-ResiduosError" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ResiduosError-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-06-Tema6_files/figure-html/fig-ResiduosError-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ResiduosError-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;7: Error + Intervención
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="validación" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="validación">Validación</h3>
<p>El parámetro estimado <span class="math inline">\(\phi_1\)</span> es significativo.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(arima110)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
z test of coefficients:

    Estimate Std. Error z value Pr(&gt;|z|)  
ar1  0.41776    0.17414   2.399  0.01644 *
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
</section>
<section id="medidas-de-error" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="medidas-de-error">Medidas de error</h3>
<p>El error medio es 19 kg per cápita (RMSE) y el error porcentual medio (MAPE) es 2.65%.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(arima110)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>                ME  RMSE   MAE   MPE MAPE MASE  ACF1
Training set -0.85 19.22 14.54 -0.19 2.65 0.88 -0.05</code></pre>
</div>
</div>
<p>Además, hay no hay sesgo y la fórmula usada para la previsión por intervalo es correcta.</p>
</section>
<section id="interpretación-del-modelo" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="interpretación-del-modelo">Interpretación del modelo</h3>
<p>La serie Residuos sigue un proceso ARIMA(1, 1, 0). Es decir ls ecuación del modelo es <span class="math display">\[(1 - \phi_1 L)(1 - L)y_t = \varepsilon_t\]</span> y la de predicción es <span class="math display">\[y_t = y_{t-1} + \phi_1(y_{t-1}- y_{t-2}) + \varepsilon_t\]</span></p>
<p>Si sustituimos los parámetros estimados se tiene que la ecuación de predicción estimada <span class="math display">\[\hat y_t =y_{t-1} + 0.42(y_{t-1}- y_{t-2})\]</span> Cada año, los residuos recogidos y tratados son iguales a los del año pasado más un 42% de la última variación observada.</p>
</section>
<section id="predicción" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="predicción">Predicción</h3>
<p>Una vez validado el modelo podemos pasar a realizar predicciones, en este caso a 5 años vista.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>parima110 <span class="ot">&lt;-</span> <span class="fu">forecast</span>(arima110, </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">h =</span> <span class="dv">5</span>, </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">level =</span> <span class="dv">95</span>)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>parima110</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Point Forecast    Lo 95    Hi 95
2023            467 427.9075 506.0925
2024            467 399.1766 534.8234
2025            467 374.9424 559.0576
2026            467 354.2518 579.7482
2027            467 336.2096 597.7904</code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(parima110, </span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>, </span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"Kg. per cápita"</span>,</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span> <span class="fu">seq</span>(<span class="dv">1995</span>, <span class="dv">2028</span>, <span class="dv">2</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-ResiduosPre" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ResiduosPre-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-06-Tema6_files/figure-html/fig-ResiduosPre-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ResiduosPre-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;8: Residuos (1995-2022) y predicción (2023-2027)
</figcaption>
</figure>
</div>
</div>
</div>
<p>La <a href="#fig-ResiduosPre" class="quarto-xref">Figura&nbsp;8</a> muestra la serie, la previsión y el intervalo de confianza al 95%. La predicción es constante porque anecdoticamente el volumen de residuos de los dos últimos años ha sido el mismo (<span class="math inline">\(y_{T-1}=y_T\)</span>). Es decir, la última variación es cero y la ecuación de predicción queda <span class="math inline">\(\hat y_{T+1} =y_T\)</span>. En las series diferenciadas el intervalo de confianza de las predicciones crece muy rápidamente porque los errores se van acumulando sin ningún tipo de amortiguamiento.</p>
<p><br>
<br>
</p>
</section>
</section>
</section>
<section id="ejemplo-con-transformación-logarítmica" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Ejemplo con transformación logarítmica</h1>
<p>Una alternativa para predecir cualquier serie es predecir su transformación logarítmica. Después, se aplica la transformación inversa y se obtienen las predicciones de la serie original. No siempre, pero este procedimiento puede mejorar la calidad de las predicciones. Además, este proceso asegura que las predicciones y sus intervalos sean siempre positivas (ve a la píldora <em>Series acotadas</em> para aprender más sobre cómo garantizar que las predicciones sean positivas o que permanezcan dentro de cierto intervalo).</p>
<p>El uso de la transformación logarítmica en la estimación de modelos y predicción se puede realizar de forma sencilla y transparente con cualquiera de las funciones de que hemos visto a partir de los argumentos <code>lambda</code> y <code>biasadj</code>.</p>
<ul>
<li><p><code>lambda = 0</code> indica que se ha de realizar la transformación logarítmica de la serie previamente a su modelización. Es un parámetro de la transformación Box-Cox que no veremos en detalle en este curso.</p></li>
<li><p><code>biasadj = TRUE</code> es necesario si tras una transformación de la serie original queremos que las predicciones sean insesgadas. Es decir, queremos obtener la predicción <em>media</em>.</p>
<p>Sea <span class="math inline">\(y_t\)</span> la serie original y <span class="math inline">\(z_t=log(y_t)\)</span> su transformación logarítmica. Si obtenemos una predicción <span class="math inline">\(\widehat{y}_t\)</span> de la serie original, esta será insesgada <span class="math inline">\(E[\widehat{y}_t]=y_t\)</span>. Ahora bien, si obtenemos una predicción <span class="math inline">\(\widehat{z}_t\)</span> de la serie transformada, podemos pensar que <span class="math inline">\(e^{\widehat{z}_t}\)</span> es una predicción insesgada de la serie original, pero resulta que <span class="math inline">\(E[e^{\widehat{z}_t}] \neq y_t\)</span>. Es decir, la exponencial de la predicción de la serie con transformada logarítmica no es insesgada.</p>
<p>Si el argumento <code>biasadj</code> es fijado a FALSE, las predicciones se calcularán de forma directa deshaciendo la transformación y serán sesgadas. En concreto, lo que se obtiene es una predicción <em>mediana</em>. Si, por el contrario, es fijado a TRUE, las predicciones se calcularán por medio de una fórmula alternativa y serán insesgadas.</p>
<p>En ambos casos, para series largas no debería observarse mucha diferencia entre las dos alternativas.</p></li>
</ul>
<p>Vamos a practicar el uso de estos argumentos con la serie Residuos y el método de Alisado. Veamos cuál es el modelo de Alisado que mejor ajusta a la transformación logarítmica de la serie. Además, vamos a pedir que las predicciones sean insesgadas, <code>biasadj = TRUE</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>etsLResiduos <span class="ot">&lt;-</span> <span class="fu">ets</span>(residuos, </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">lambda =</span> <span class="dv">0</span>,</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">biasadj =</span> <span class="cn">TRUE</span>)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(etsLResiduos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ETS(A,Ad,N) 

Call:
ets(y = residuos, lambda = 0, biasadj = TRUE)

  Box-Cox transformation: lambda= 0 

  Smoothing parameters:
    alpha = 0.9934 
    beta  = 0.3151 
    phi   = 0.8 

  Initial states:
    l = 6.1586 
    b = 0.0822 

  sigma:  0.0355

      AIC      AICc       BIC 
-87.15854 -83.15854 -79.16531 

Training set error measures:
                    ME     RMSE      MAE        MPE     MAPE      MASE
Training set -3.598389 18.38632 13.45029 -0.6414499 2.451673 0.8142555
                   ACF1
Training set 0.01152461</code></pre>
</div>
</div>
<p>Al identificar el mejor modelo para la serie transformada obtenemos el modelo “AAdN”, es decir Holt con amortiguamiento. El error medio de ajuste es 2.5 % (MAPE), 0.7 p.p. inferior al obtenido con Alisado de Holt con amortiguamiento para la serie sin transformar.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>etsLResiduosf <span class="ot">&lt;-</span> <span class="fu">forecast</span>(etsLResiduos,</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>                          <span class="at">h =</span> <span class="dv">5</span>,</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">level =</span> <span class="dv">95</span>,</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">biasadj =</span> <span class="cn">TRUE</span>)</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>etsLResiduosf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Point Forecast    Lo 95    Hi 95
2023       468.1629 436.4277 501.5737
2024       469.3098 419.2841 523.6200
2025       470.4810 403.7946 544.9870
2026       471.6892 389.4368 566.1444
2027       472.9379 376.0825 587.1313</code></pre>
</div>
</div>
<p>Respecto de las predicciones, la <a href="#fig-Residuoslog" class="quarto-xref">Figura&nbsp;9</a> muestra la serie Residuos y las previsiones extramuestrales obtenidas con y sin la transformación logarítmica. Podemos observar que para la serie transformada el volumen de residuos predicho crece más rápidamente que para la serie sin transformar.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-Residuoslog" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-Residuoslog-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-06-Tema6_files/figure-html/fig-Residuoslog-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-Residuoslog-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;9: Residuos y dos predicciones con Alisado de Holt con amortiguamiento
</figcaption>
</figure>
</div>
</div>
</div>
<p>La <a href="#tbl-residuoslog" class="quarto-xref">Tabla&nbsp;2</a> muestra las predicciones de Residuos obtenidas sin transformar la serie, con transformación logarítmica y predicciones insesgadas (<code>biasadj = TRUE</code>), y con transformación logarítmica y predicciones sesgadas (<code>biasadj = FALSE</code>).</p>
<div class="cell" data-layout-align="center">
<div id="tbl-residuoslog" class="cell quarto-float anchored" data-layout-align="center">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-residuoslog-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabla&nbsp;2: Diferencias en la predicción según transformación logarítmica y corrección por sesgo
</figcaption>
<div aria-describedby="tbl-residuoslog-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">Sin transformar</th>
<th style="text-align: right;">log(Nac) insesgadas</th>
<th style="text-align: right;">log(Nac) sesgadas</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">467.3276</td>
<td style="text-align: right;">468.1629</td>
<td style="text-align: right;">467.8682</td>
</tr>
<tr class="even">
<td style="text-align: right;">467.5896</td>
<td style="text-align: right;">469.3098</td>
<td style="text-align: right;">468.5569</td>
</tr>
<tr class="odd">
<td style="text-align: right;">467.7992</td>
<td style="text-align: right;">470.4810</td>
<td style="text-align: right;">469.1085</td>
</tr>
<tr class="even">
<td style="text-align: right;">467.9669</td>
<td style="text-align: right;">471.6892</td>
<td style="text-align: right;">469.5503</td>
</tr>
<tr class="odd">
<td style="text-align: right;">468.1011</td>
<td style="text-align: right;">472.9379</td>
<td style="text-align: right;">469.9040</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>Para un mismo modelo, las predicciones sesgadas siempre son menores que las insesgadas. La diferencia depende fundamentalmente de la desviación típica del error, <em>sigma</em> en la salida de los métodos de alisado exponencial. Cuanto mayor es <em>sigma</em>, mayores son las diferencias.</p>
<p>Por otro lado, las predicciones obtenidas sin y con la transformación logarítmica no guardan ninguna relación.</p>
<p><strong>Ni la transformación logarítmica ni el uso de predicciones insesgadas aseguran mejores predicciones respecto de otras opciones</strong>, como puede ser trabajar con predicciones sesgadas o no realizar la transformación logarítmica. Hay que usar Origen de predicción móvil para determinar que transformación es la mejor.</p>
<p><br>
<br>
</p>
</section>
<section id="ejemplo-de-aplicacion-para-la-serie-aforo" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Ejemplo de aplicacion para la serie Aforo</h1>
<p>Vamos a aplicar las diferentes metodologías vistas en este tema a la serie <strong>aforo de vehículos</strong> por Oropesa, carretera N-340, km. 996,48 (fuente Ministerio de Fomento). La serie es anual de 1960 a 2022 (63 datos). La serie ofrece el número medio diario de vehículos que pasan por esta carretera.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>aforo <span class="ot">&lt;-</span> <span class="fu">read.csv2</span>(<span class="st">"./series/Aforo_oropesa.csv"</span>, </span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>aforo <span class="ot">&lt;-</span> <span class="fu">ts</span>(aforo, </span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">start =</span> <span class="dv">1960</span>, </span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">freq =</span> <span class="dv">1</span>)</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(aforo, </span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>, </span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"Vehículos diarios"</span>,</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-Aforo" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-Aforo-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-06-Tema6_files/figure-html/fig-Aforo-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-Aforo-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;10: Aforo de vehículos en N-340, Oropesa
</figcaption>
</figure>
</div>
</div>
</div>
<p>Los puntos de cambio en la tendencia de la serie Aforo están muy relacionados con la autopista AP-7 y las crisis ocurridas en España: la caída del aforo en 1979 se debe a la inauguración en 1978 del tramo de la AP-7 Torreblanca - Castellón; el incremento del Aforo al inicio de la década de los 80 se debe al periodo de expansión económica en España; y la caída en el aforo al partir de 2009 a la crisis financiera que llevó a la Gran Recesión. Además, se observa un clara intervención, la caída puntual en 2020 originada por el confinamiento durante la pandemia de la Covid-19.</p>
<p><br>
</p>
<section id="métodos-sencillos" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="métodos-sencillos"><span class="header-section-number">6.1</span> Métodos sencillos</h2>
<p>Vamos a empezar aplicando el método de la deriva a la serie. Podemos observar que el incremento promedio de la serie es de 114.6 vehículos diarios. Este será el incremento que se aplicará al dato de 2023 para obtener las predicciones. En concreto, para 2025 se espera un paso de 9071 vehículos diarios por la N-340 a su paso por Oropesa.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>derivaAforo <span class="ot">&lt;-</span> <span class="fu">rwf</span>(aforo, <span class="at">h =</span> <span class="dv">4</span>, <span class="at">drift =</span> <span class="cn">TRUE</span>)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(derivaAforo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Forecast method: Random walk with drift

Model Information:
Call: rwf(y = aforo, h = 4, drift = TRUE) 

Drift: 114.6349  (se 127.5966)
Residual sd: 1012.7662 

Error measures:
                       ME     RMSE      MAE       MPE     MAPE      MASE
Training set 5.775913e-14 1004.696 688.7579 0.6342941 7.716355 0.9515316
                  ACF1
Training set 0.1926475

Forecasts:
     Point Forecast    Lo 80    Hi 80    Lo 95    Hi 95
2024       8956.635 7648.462 10264.81 6955.958 10957.31
2025       9071.270 7206.837 10935.70 6219.866 11922.67
2026       9185.905 6884.952 11486.86 5666.902 12704.91
2027       9300.540 6623.576 11977.50 5206.478 13394.60</code></pre>
</div>
</div>
<p>El modelo ofrece un error de ajuste medio del 7.7% (unos 1000 vehículos según RMSE), no presenta sesgo y la predicción por intervalo no es fiable.</p>
<p>Como la pendiente media estimada es de <code>114.6</code> vehículos al día (<code>drift</code>), la predicción crece anualmente en esta cantidad.</p>
<p><br>
</p>
</section>
<section id="asilado-exponencial" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="asilado-exponencial"><span class="header-section-number">6.2</span> Asilado exponencial</h2>
<section id="estimacion-del-modelo" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="estimacion-del-modelo">Estimacion del modelo</h3>
<p>Si estimamos el mejor modelo de alisado exponencial para la serie Aforo sin ningún tipo de restricción, nos encontramos:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>etsAforo <span class="ot">&lt;-</span> <span class="fu">ets</span>(aforo)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(etsAforo) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ETS(M,A,N) 

Call:
ets(y = aforo)

  Smoothing parameters:
    alpha = 0.9432 
    beta  = 0.0516 

  Initial states:
    l = 754.8422 
    b = 748.8161 

  sigma:  0.1

     AIC     AICc      BIC 
1150.507 1151.541 1161.301 

Training set error measures:
                    ME     RMSE     MAE       MPE     MAPE      MASE      ACF1
Training set -253.4493 1020.318 675.912 -3.048656 7.427081 0.9337848 0.1775309</code></pre>
</div>
</div>
<p>El modelo estimado es ETS(M,A,N) o “MAN”, un modelo con pendiente aditiva, sin estacionalidad y con error multiplicativo. Es decir, <span class="math inline">\(y_{t+1} = (l_t + b_t) \cdot (1 + \varepsilon_{t+1})\)</span>.</p>
<p>El valor de <span class="math inline">\(\alpha\)</span> prácticamente es 1, indicando que el nivel de la serie varía en el tiempo. Por otro lado, el valor de <span class="math inline">\(\beta\)</span> prácticamente es 0, es decir, la pendiente se mantiene contante en el tiempo.</p>
<p>Respecto de la calidad ajuste del modelo, el valor de MAPE = <span class="math inline">\(7.4\)</span>% es solo ligeramente inferior al obtenido con el método sencillo. Por otro lado, el modelo estimado presenta un marcado sesgo negativo (las predicciones en promedio son mayores que los valores reales) y las predicciones por intervalos no están correctamente calculadas.</p>
</section>
<section id="predicción-1" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="predicción-1">Predicción</h3>
<p>Mediante la función <code>forecast</code> podemos predecir el aforo para los proximos años. Como el último valor calculado para la pendiente <span class="math inline">\(b_T\)</span> es negativo, se espera una progresiva reducción en el paso de vehículos por Oropesa. Con este método la predicción para 2025 es de 8638 vehículos diarios.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(etsAforo<span class="sc">$</span>states, <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Time Series:
Start = 2023 
End = 2023 
Frequency = 1 
            l         b
2023 8814.216 -88.05432</code></pre>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>etsResiduosPre <span class="ot">&lt;-</span> <span class="fu">forecast</span>(etsAforo, </span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">h =</span> <span class="dv">4</span>,</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">level =</span> <span class="dv">95</span>)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>etsResiduosPre</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Point Forecast    Lo 95    Hi 95
2024       8726.162 7016.524 10435.80
2025       8638.108 6232.767 11043.45
2026       8550.053 5561.714 11538.39
2027       8461.999 4944.569 11979.43</code></pre>
</div>
</div>
</section>
<section id="análisis-del-residuo" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="análisis-del-residuo">Análisis del residuo</h3>
<p>Veamos si hay años atípicos.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>error <span class="ot">&lt;-</span> <span class="fu">residuals</span>(etsAforo)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>sderror <span class="ot">&lt;-</span> <span class="fu">sd</span>(error)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(error, <span class="at">series=</span><span class="st">"Error"</span>,</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">"Periodo"</span>,</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"Error"</span>,</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span> ,<span class="dv">3</span>)<span class="sc">*</span>sderror, </span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"blue"</span>, <span class="st">"blue"</span>, <span class="st">"red"</span>), <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span> <span class="fu">seq</span>(<span class="dv">1960</span>, <span class="dv">2022</span>, <span class="dv">4</span>)) </span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Creamos un variable con todos las años de la serie</span></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>fechas <span class="ot">&lt;-</span> <span class="fu">format</span>(<span class="fu">seq</span>(<span class="fu">as.Date</span>(<span class="st">"1960-01-01"</span>), <span class="fu">as.Date</span>(<span class="st">"2022-01-01"</span>), <span class="st">"year"</span>), <span class="st">"%Y"</span>)</span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Identificamos los años atípicos</span></span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>fechas[<span class="fu">abs</span>(error) <span class="sc">&gt;</span> <span class="fl">2.5</span> <span class="sc">*</span> sderror]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "1979" "2020"</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-ResiduosError2" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ResiduosError2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-06-Tema6_files/figure-html/fig-ResiduosError2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ResiduosError2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;11: Error + Intervención
</figcaption>
</figure>
</div>
</div>
</div>
<p>La <a href="#fig-ResiduosError2" class="quarto-xref">Figura&nbsp;11</a> muestra como intervención el año de la pandemia, con una caída en el aforo que superó las tres desviaciones típicas. También destaca en 1979 la caída en el aforo debida a la inauguración de la AP-7 en este tramo de carretera.</p>
<p>La prueba de Tukey solo identifica como atípico el año 2020.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>atipicos <span class="ot">&lt;-</span> <span class="fu">tsoutliers</span>(error)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>fechas[atipicos<span class="sc">$</span>index]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2020"</code></pre>
</div>
</div>
<p><br>
</p>
</section>
</section>
<section id="modelo-arima" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="modelo-arima"><span class="header-section-number">6.3</span> Modelo Arima</h2>
<section id="transformación-de-la-serie" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="transformación-de-la-serie">Transformación de la serie</h3>
<p>La <a href="#fig-AforoFAC" class="quarto-xref">Figura&nbsp;12</a> muestra que la serie Aforo no es estacionaria. Así, el primer paso es transformar la serie original para que lo sea. La serie no es estacionaria, pero sí lo es su primera diferencia. Ten siempre presente que diferenciar más veces de las necesarias puede dificultar la identificación y la interpretación. Por otro lado, la función <code>ndiffs</code> aconseja una diferenciación. Así, optamos por fijar <span class="math inline">\(d = 1\)</span>.</p>
<div class="cell" data-layout="[[50,50]]" data-layout-align="center">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(aforo, <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">ylab =</span> <span class="st">""</span>, <span class="at">main =</span> <span class="st">""</span>)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(<span class="fu">diff</span>(aforo), <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">ylab =</span> <span class="st">""</span>, <span class="at">main =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-AforoFAC" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-AforoFAC-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-AforoFAC" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-AforoFAC-1" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-AforoFAC-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-06-Tema6_files/figure-html/fig-AforoFAC-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%" data-ref-parent="fig-AforoFAC">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-AforoFAC-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Serie original
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-AforoFAC" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-AforoFAC-2" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-AforoFAC-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-06-Tema6_files/figure-html/fig-AforoFAC-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%" data-ref-parent="fig-AforoFAC">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-AforoFAC-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Dif. de la serie
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-AforoFAC-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;12: Gráfica para Aforo y su primera diferencia
</figcaption>
</figure>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ndiffs</span>(aforo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
</div>
</section>
<section id="identificación-y-estimación" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="identificación-y-estimación">Identificación y Estimación</h3>
<p>Veamos a identificar los valores de <span class="math inline">\(p\)</span> y <span class="math inline">\(q\)</span> a partir de <code>auto.arima</code>, indicándole que <code>d = 1</code>. La función sugiere un proceso ARIMA(0,1,0) sin constante.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">auto.arima</span>(aforo, </span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">d =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: aforo 
ARIMA(0,1,0) 

sigma^2 = 1022556:  log likelihood = -525.28
AIC=1052.57   AICc=1052.63   BIC=1054.71</code></pre>
</div>
</div>
<p>Vamos a ver la gráfica de los residuos del modelo ARIMA(0,1,0) para identificar los valores extremos (intervención).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>arima010 <span class="ot">&lt;-</span> <span class="fu">Arima</span>(aforo, </span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">include.constant =</span> <span class="cn">FALSE</span>)</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>error <span class="ot">&lt;-</span> <span class="fu">residuals</span>(arima010)</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>sderror <span class="ot">&lt;-</span> <span class="fu">sd</span>(error)</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(error, <span class="at">series=</span><span class="st">"Error"</span>,</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"Error"</span>,</span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>)<span class="sc">*</span>sderror, </span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"green"</span>, <span class="st">"green"</span>, <span class="st">"red"</span>), </span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>             <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span> <span class="fu">seq</span>(<span class="dv">1960</span>, <span class="dv">2020</span>, <span class="dv">4</span>)) </span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a>fechas[<span class="fu">abs</span>(error) <span class="sc">&gt;</span> <span class="fl">2.5</span> <span class="sc">*</span> sderror]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "1979" "2011" "2020"</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-AforoError" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-AforoError-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-06-Tema6_files/figure-html/fig-AforoError-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-AforoError-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;13: Error + Intervención
</figcaption>
</figure>
</div>
</div>
</div>
<p>Se identifican tres posibles valores extremos, tres intervenciones, en los años 1979, 2011 (relacionado con la Gran Recesión) y 2020, donde el error supera las 2.5 desviaciones típicas. Cada una de las intervenciones es del tipo <em>pulso</em> porque solo afecta un periodo de la serie y tienen una causa identificada.</p>
<p>Ahora, creamos una variable ficticia asociada a cada intervención, que denominaremos d1979, d2011 y d2020, y las incluiremos en la autoidentificación.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>d1979 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">*</span>(<span class="fu">time</span>(error) <span class="sc">==</span> <span class="dv">1979</span>)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>d2011 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">*</span>(<span class="fu">time</span>(error) <span class="sc">==</span> <span class="dv">2011</span>)</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>d2020 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">*</span>(<span class="fu">time</span>(error) <span class="sc">==</span> <span class="dv">2020</span>)</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="fu">auto.arima</span>(aforo,</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">d =</span> <span class="dv">1</span>,</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">xreg =</span> <span class="fu">cbind</span>(d1979, d2011, d2020))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: aforo 
Regression with ARIMA(2,1,0) errors 

Coefficients:
         ar1     ar2       d1979       d2011       d2020
      0.2008  0.4051  -1664.2472  -1187.5328  -2368.0686
s.e.  0.1176  0.1209    497.3584    460.7665    461.7576

sigma^2 = 608880:  log likelihood = -506.59
AIC=1025.18   AICc=1026.68   BIC=1038.04</code></pre>
</div>
</div>
<p>Observa como la inclusión de intervención modifica la autoidentificación, que ahora es un proceso ARIMA(2,1,0).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>arima210 <span class="ot">&lt;-</span> <span class="fu">Arima</span>(aforo, </span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">include.constant =</span> <span class="cn">FALSE</span>,</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">xreg =</span> <span class="fu">cbind</span>(d1979, d2011, d2020))</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>arima210</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: aforo 
Regression with ARIMA(2,1,0) errors 

Coefficients:
         ar1     ar2       d1979       d2011       d2020
      0.2008  0.4051  -1664.2472  -1187.5328  -2368.0686
s.e.  0.1176  0.1209    497.3584    460.7665    461.7576

sigma^2 = 608880:  log likelihood = -506.59
AIC=1025.18   AICc=1026.68   BIC=1038.04</code></pre>
</div>
</div>
<p>Todos los coeficientes estimados, excepto el <code>ar1</code> (<span class="math inline">\(\phi_1\)</span>), superan las dos desviaciones estándar y parece que son significativos.</p>
<p>La <a href="#fig-AforoError2" class="quarto-xref">Figura&nbsp;14</a> muestra que para ningún año se observa un error atípico. Es decir, no es necesaria más intervención.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>error <span class="ot">&lt;-</span> <span class="fu">residuals</span>(arima210)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>sderror <span class="ot">&lt;-</span> <span class="fu">sd</span>(error)</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(error, <span class="at">series=</span><span class="st">"Error"</span>,</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"Error"</span>,</span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>)<span class="sc">*</span>sderror, </span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"green"</span>, <span class="st">"green"</span>, <span class="st">"red"</span>), </span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span> <span class="fu">seq</span>(<span class="dv">1960</span>, <span class="dv">2020</span>, <span class="dv">4</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-AforoError2" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-AforoError2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-06-Tema6_files/figure-html/fig-AforoError2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-AforoError2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;14: Error + Intervención
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="validación-1" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="validación-1">Validación</h3>
<p>Veamos qué coeficientes estimados son significativos.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(arima210)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
z test of coefficients:

         Estimate  Std. Error z value  Pr(&gt;|z|)    
ar1       0.20083     0.11757  1.7082 0.0876036 .  
ar2       0.40512     0.12089  3.3510 0.0008052 ***
d1979 -1664.24718   497.35837 -3.3462 0.0008194 ***
d2011 -1187.53277   460.76649 -2.5773 0.0099576 ** 
d2020 -2368.06859   461.75755 -5.1284 2.922e-07 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Las tres variables de intervención son significativas y el coeficiente <span class="math inline">\(\phi_2\)</span> (<code>ar2</code>) también. No es significativo el coeficiente <span class="math inline">\(\phi_1\)</span> (<code>ar1</code>) al 5% pero si al 10%.</p>
<p>Confirmamos que <span class="math inline">\(aforo_t \sim ARIMA(2,1,0)\)</span> con intervención.</p>
</section>
<section id="medidas-de-error-1" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="medidas-de-error-1">Medidas de error</h3>
<p>El error de ajuste medio, medido con el RMSE, es 743 vehículos por día y el error porcentual medio (MAPE) es 5.99%, ambos muy inferiores a los obtenidos con el método sencillo y el Alisado exponencial. Además, hay sesgo de predicción (aunque menor que el observado con Alisado) y la fórmula empleada para el cálculo del intervalo de confianza de las predicciones es válida.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(arima210)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>                ME   RMSE    MAE  MPE MAPE MASE ACF1
Training set 49.26 742.83 551.43 1.23 5.99 0.76 0.04</code></pre>
</div>
</div>
</section>
<section id="interpretación-del-modelo-1" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="interpretación-del-modelo-1">Interpretación del modelo</h3>
<p>El <strong>modelo teórico</strong> es <span class="math inline">\(aforo_t \sim ARIMA(2,1,0) + d1979 + d2011 + d2020\)</span>:</p>
<p><span class="math display">\[(1 - \phi_1 L - \phi_2 L^2)(1 - L)aforo_t =  \varepsilon_t + \gamma_1 \cdot d1979 + \gamma_2 \cdot d2011 + \gamma_3 \cdot d2020.\]</span></p>
<p>Si desarrollamos, queda:</p>
<p><span class="math display">\[aforo_t = aforo_{t-1} + \phi_1(aforo_{t-1}-aforo_{t-2}) + \phi_2(aforo_{t-2}-aforo_{t-3}) +\]</span> <span class="math display">\[\gamma_1 \cdot d1979 +  \gamma_2 \cdot d2011 + \gamma_3 \cdot d2020 + \varepsilon_t.\]</span></p>
<p>Finalmente, el <strong>modelo estimado</strong> es: <span class="math display">\[\widehat{aforo}_t = aforo_{t-1} + 0.20(aforo_{t-1}-aforo_{t-2}) + 0.41(aforo_{t-2}-aforo_{t-3})\]</span> <span class="math display">\[-1664 \cdot d1979 - 1188 \cdot d2011 - 2368 \cdot d2020\]</span> Cada año el aforo es el mismo que el aforo del año pasado más un 20% del último incremento observado y un 41% del incremento anterior.</p>
<p>Respecto de la intervención, en 1979 hubo cerca de 1700 de vehículos por día menos de lo esperado debido a la apertura de la autopista AP-7; en 2011 hubo unos 1200 vehículos menos debido a la Gran Recesión; y en 2020 las restricciones de movilidad debidas a la pandemia redujeron el aforo en 2400 vehículos al día.</p>
</section>
<section id="predicción-2" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="predicción-2">Predicción</h3>
<p>Como hemos incluido tres variables ficticias en el ajuste, de cara a predecir el aforo hemos de indicar cuales serán los valores futuros para estas variables. En este caso serán cero puesto que son intervenciones que no responden a un efecto calendario. Las causas detrás de estas intervenciones no se espera que se repitan en el futuro.</p>
<p>Ya sabemos que en <code>R</code> esto se hace incluyendo en el comando <code>forecast</code> el argumento <code>xreg = cbind(rep(0, 4), rep(0, 4), rep(0, 4))</code> que añade cinco ceros por cada variable de intervención porque la predicción va a ser a cinco años vista.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>parima210 <span class="ot">&lt;-</span> <span class="fu">forecast</span>(arima210, </span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">h =</span> <span class="dv">4</span>, </span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">level =</span> <span class="dv">95</span>,</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">xreg =</span> <span class="fu">cbind</span>(<span class="at">d1979=</span><span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">4</span>), <span class="at">d2011=</span><span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">4</span>), </span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">d2020=</span><span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">4</span>)))</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>parima210</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Point Forecast    Lo 95    Hi 95
2024       9131.695 7602.320 10661.07
2025       9323.968 6934.030 11713.91
2026       9479.943 6008.483 12951.40
2027       9589.161 5142.358 14035.96</code></pre>
</div>
</div>
<p>Para 2025 se espera un paso de 9324 vehículos al día por la N-340 a la altura de Oropesa.</p>
<p><br>
</p>
</section>
</section>
<section id="comparación-entre-modelos" class="level2" data-number="6.4">
<h2 data-number="6.4" class="anchored" data-anchor-id="comparación-entre-modelos"><span class="header-section-number">6.4</span> Comparación entre modelos</h2>
<p>Hemos visto que en calidad de ajuste, el modelo Arima supera en 1.5 p.p. al modelo de Alisado o en 280 vehículos, según atendamos al MAPE o al RMSE. Además, es el único método que ofrece predicciones por intervalo fiables.</p>
<p>Sin embargo seguimos sin saber cuál de los tres métodos ofrece la mejor calidad en las predicciones. La <a href="#fig-comparaAforo" class="quarto-xref">Figura&nbsp;15</a> muestra la serie aforo y las predicciones obtenidas con cada método. Tanto Arima como el método simple preveen un incremento en el aforo, continuando con la tendencia reciente observada tras la pandemia. Por el contrario, según el método de Alisado el aforo irá disminuyendo, resultado que concuerda con el la tendencia general observada tras la Gran Recesión. ¿Que previsión resultará acertada?</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-comparaAforo" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-comparaAforo-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-06-Tema6_files/figure-html/fig-comparaAforo-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-comparaAforo-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;15: Aforo y predicicones con tres métodos
</figcaption>
</figure>
</div>
</div>
</div>
<p>Vamos a aplicar origen de previsión móvil a los tres métodos para elegir la mejor predicción. Consideraremos que son necesarios 30 años para ajustar bien los modelos y haremos previsiones a 4 años vista.</p>
<p>Como criterio de calidad de las predicciones vamos a usar el RMSE. Se ha elegido calcular el error medio con lo que el cálculo las medidas de precisión estará algo afectado por los elevados errores observados en los tres año atípicos.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">30</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>h <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>TT <span class="ot">&lt;-</span> <span class="fu">length</span>(aforo)</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> TT <span class="sc">-</span> k <span class="sc">-</span> h</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>rmseDer <span class="ot">&lt;-</span> rmseAli <span class="ot">&lt;-</span> rmseAri <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, s <span class="sc">+</span> <span class="dv">1</span>, h)</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">0</span><span class="sc">:</span>s) {</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>  train.set <span class="ot">&lt;-</span> <span class="fu">subset</span>(aforo, <span class="at">start =</span> i <span class="sc">+</span> <span class="dv">1</span>, <span class="at">end =</span> i <span class="sc">+</span> k)</span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>  test.set <span class="ot">&lt;-</span>  <span class="fu">subset</span>(aforo, <span class="at">start =</span> i <span class="sc">+</span> k <span class="sc">+</span> <span class="dv">1</span>, <span class="at">end =</span> i <span class="sc">+</span> k <span class="sc">+</span> h)</span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>  fcast <span class="ot">&lt;-</span> <span class="fu">rwf</span>(train.set, <span class="at">h =</span> h, <span class="at">drift =</span> <span class="cn">TRUE</span>)</span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a>  rmseDer[i <span class="sc">+</span> <span class="dv">1</span>,] <span class="ot">&lt;-</span> (test.set <span class="sc">-</span> fcast<span class="sc">$</span>mean)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a>  fit <span class="ot">&lt;-</span> <span class="fu">ets</span>(train.set, <span class="at">model =</span> <span class="st">"MAN"</span>, <span class="at">damped =</span> <span class="cn">FALSE</span>)</span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a>  fcast <span class="ot">&lt;-</span> <span class="fu">forecast</span>(fit, <span class="at">h =</span> h)</span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true" tabindex="-1"></a>  rmseAli[i <span class="sc">+</span> <span class="dv">1</span>,] <span class="ot">&lt;-</span> (test.set <span class="sc">-</span> fcast<span class="sc">$</span>mean)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb74-18"><a href="#cb74-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-19"><a href="#cb74-19" aria-hidden="true" tabindex="-1"></a>  fit <span class="ot">&lt;-</span> <span class="fu">Arima</span>(train.set, <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">0</span>), <span class="at">include.constant =</span> <span class="cn">FALSE</span>)</span>
<span id="cb74-20"><a href="#cb74-20" aria-hidden="true" tabindex="-1"></a>  fcast <span class="ot">&lt;-</span> <span class="fu">forecast</span>(fit, <span class="at">h =</span> h)</span>
<span id="cb74-21"><a href="#cb74-21" aria-hidden="true" tabindex="-1"></a>  rmseAri[i <span class="sc">+</span> <span class="dv">1</span>,] <span class="ot">&lt;-</span> (test.set <span class="sc">-</span> fcast<span class="sc">$</span>mean)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb74-22"><a href="#cb74-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb74-23"><a href="#cb74-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-24"><a href="#cb74-24" aria-hidden="true" tabindex="-1"></a>rmseDerMedia <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">colMeans</span>(rmseDer))</span>
<span id="cb74-25"><a href="#cb74-25" aria-hidden="true" tabindex="-1"></a>rmseAliMedia <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">colMeans</span>(rmseAli))</span>
<span id="cb74-26"><a href="#cb74-26" aria-hidden="true" tabindex="-1"></a>rmseAriMedia <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">colMeans</span>(rmseAri))</span>
<span id="cb74-27"><a href="#cb74-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-28"><a href="#cb74-28" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(rmseDerMedia, <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1045.48 1652.23 2207.89 2742.52</code></pre>
</div>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(rmseAliMedia, <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1108.34 1767.07 2399.95 3129.44</code></pre>
</div>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(rmseAriMedia, <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  985.41 1487.23 1957.45 2484.06</code></pre>
</div>
</div>
<p>El método Arima ofrece mejores predicciones para todos los horizontes temporales y el método de Alisado muestra la peor calidad en las previsiones, especialmente a largo plazo.</p>
</section>
</section>
<section id="ejemplo-de-aplicacion-para-la-serie-nacimientos" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Ejemplo de aplicacion para la serie Nacimientos</h1>
<p>En el siguiente ejemplo usaremos la serie Nacimientos anualizada desde el año 2000. Además, aplicaremos la transformación logarítmica para practicar este procedimiento.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>nacimientos <span class="ot">&lt;-</span> <span class="fu">read.csv2</span>(<span class="st">"./series/Nacimientos.csv"</span>, </span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>nacimientos <span class="ot">&lt;-</span> <span class="fu">ts</span>(nacimientos[, <span class="dv">2</span>], </span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1975</span>, <span class="dv">1</span>), </span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">freq =</span> <span class="dv">12</span>)</span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>nacimientos <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(nacimientos, <span class="at">FUN =</span> sum)</span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>nacimientos <span class="ot">&lt;-</span> <span class="fu">window</span>(nacimientos, <span class="at">start =</span> <span class="dv">2000</span>)</span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(nacimientos, </span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>, </span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"Bebés"</span>,</span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-Nacimientos" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-Nacimientos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-06-Tema6_files/figure-html/fig-Nacimientos-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-Nacimientos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;16: Nacimientos
</figcaption>
</figure>
</div>
</div>
</div>
<p>El aumento de los nacimientos en España de madres inmigrantes —que en media tienen más hijos que las madres españolas— se vio interrumpido con la Gran Recesión. La crisis provocó que muchas familias de inmigrantes retornaran a su país de origen y generó una caída en la natalidad, que se ha mantenido hasta la fecha.</p>
<p><br>
</p>
<section id="métodos-sencillo-de-la-deriva" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="métodos-sencillo-de-la-deriva"><span class="header-section-number">7.1</span> Métodos sencillo de la deriva</h2>
<p>Vamos a empezar aplicando el método de la deriva a la transformación logarítmica de la serie. Ni para este método ni para los siguientes usaremos predicciones insesgadas.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>derivaNacimientos <span class="ot">&lt;-</span> <span class="fu">rwf</span>(nacimientos, </span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">h =</span> <span class="dv">4</span>, </span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">lambda =</span> <span class="dv">0</span>, </span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">drift =</span> <span class="cn">TRUE</span>)</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(derivaNacimientos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Forecast method: Random walk with drift

Model Information:
Call: rwf(y = nacimientos, h = 4, drift = TRUE, lambda = 0) 

Drift: -0.0091  (se 0.0075)
Residual sd: 0.0359 

Error measures:
                   ME     RMSE      MAE         MPE     MAPE      MASE
Training set 599.0297 15473.06 13338.83 -0.06127007 3.075667 0.9486111
                  ACF1
Training set 0.5195922

Forecasts:
     Point Forecast    Lo 80    Hi 80    Lo 95    Hi 95
2024       319342.1 304700.7 334687.1 297223.7 343106.5
2025       316437.9 295711.7 338616.8 285295.2 350980.2
2026       313560.1 288121.2 341245.1 275501.0 356876.8
2027       310708.5 281264.3 343235.0 266824.4 361810.0</code></pre>
</div>
</div>
<p>Como el número de nacimientos en 2023 es solo algo inferior al de 2000, el valor medio de la pendiente estimado por el método de la deriva es -0.0091. Por este motivo las predicciones para los próximos 4 años muestran una lenta caída de la natalidad del 0.91% anual.</p>
<p>Por otro lado, el modelo ofrece un error de ajuste medio del 3.1% (unos 15500 bebés según RMSE), no presenta sesgo y la predicción por intervalo no es fiable.</p>
<p><br>
</p>
</section>
<section id="asilado-exponencial-1" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="asilado-exponencial-1"><span class="header-section-number">7.2</span> Asilado exponencial</h2>
<section id="estimacion-del-modelo-1" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="estimacion-del-modelo-1">Estimacion del modelo</h3>
<p>Si estimamos el mejor modelo de alisado exponencial para la transformación logarítmica de la serie Nacimientos sin ningún tipo de restricción, nos encontramos:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ets(nacimientos)</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>etsNacimientos <span class="ot">&lt;-</span> <span class="fu">ets</span>(nacimientos, </span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">lambda =</span> <span class="dv">0</span>)</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(etsNacimientos) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ETS(A,A,N) 

Call:
ets(y = nacimientos, lambda = 0)

  Box-Cox transformation: lambda= 0 

  Smoothing parameters:
    alpha = 0.8677 
    beta  = 0.5162 

  Initial states:
    l = 12.8623 
    b = 0.0288 

  sigma:  0.0287

      AIC      AICc       BIC 
-88.47180 -85.13847 -82.58153 

Training set error measures:
                    ME     RMSE      MAE        MPE     MAPE      MASE
Training set -2281.097 12257.41 8412.686 -0.4502361 1.919209 0.5982808
                    ACF1
Training set -0.06026791</code></pre>
</div>
</div>
<p>El modelo estimado es ETS(A,A,N) o “AAN”, un modelo con pendiente y error aditivos y sin estacionalidad. Es decir, <span class="math inline">\(\log(y_{t+1}) = l_t + b_t + \varepsilon_{t+1}\)</span>. Cuando se usa la transformación logarítmica, nunca aparecerán componentes multiplicativas.</p>
<p>El valor de <span class="math inline">\(\alpha\)</span> es cercano a 1, indicando que el nivel de la serie varía en el tiempo. El valor de <span class="math inline">\(\beta\)</span> es 0.5. Es decir, la pendiente ha cambiado gradualmente con en el tiempo, pasando, en este caso, de positiva a negativa (véase <a href="#fig-etsNacimientos" class="quarto-xref">Figura&nbsp;17</a>).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(etsNacimientos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-etsNacimientos" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center" width="80%">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-etsNacimientos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-06-Tema6_files/figure-html/fig-etsNacimientos-1.png" id="fig-etsNacimientos" class="img-fluid quarto-figure quarto-figure-center anchored figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-etsNacimientos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;17
</figcaption>
</figure>
</div>
</div>
</div>
<p>Respecto de la calidad ajuste del modelo, el valor de MAPE= <span class="math inline">\(1.9\)</span>% es 1.2 p.p. inferior al obtenido con el método de la deriva. Otra ventaja del método de Alisado frente al de la deriva es que las predicciones por intervalos están correctamente calculadas.</p>
</section>
<section id="predicción-3" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="predicción-3">Predicción</h3>
<p>El último valor calculado para la pendiente <span class="math inline">\(b_T\)</span> es igual al -0.0227. Es decir, cada año se espera una caída en los nacimientos del 2.3%.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(etsNacimientos<span class="sc">$</span>states, <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Time Series:
Start = 2023 
End = 2023 
Frequency = 1 
            l           b
2023 12.68321 -0.02272149</code></pre>
</div>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>etsNacimientosPre <span class="ot">&lt;-</span> <span class="fu">forecast</span>(etsNacimientos, </span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">h =</span> <span class="dv">4</span>,</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">level =</span> <span class="dv">95</span>)</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>etsNacimientosPre</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Point Forecast    Lo 95    Hi 95
2024       315051.3 297793.5 333309.2
2025       307973.6 279730.8 339067.9
2026       301054.9 260703.0 347652.4
2027       294291.6 241405.6 358763.6</code></pre>
</div>
</div>
<p><br>
</p>
</section>
</section>
<section id="modelo-arima-1" class="level2" data-number="7.3">
<h2 data-number="7.3" class="anchored" data-anchor-id="modelo-arima-1"><span class="header-section-number">7.3</span> Modelo Arima</h2>
<section id="transformación-de-la-serie-1" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="transformación-de-la-serie-1">Transformación de la serie</h3>
<p>La <a href="#fig-NacimientosFAC" class="quarto-xref">Figura&nbsp;18</a> muestra que la serie Nacimientos, transformada logarítmicamente, no es estacionaria, pero si los es su primera diferencia. Sin embargo, la función <code>ndiffs</code> aconseja dos diferenciaciones al interpretar el escalón que se observa en la serie diferenciada (panel izquierdo de la <a href="#fig-NacimientosFAC" class="quarto-xref">Figura&nbsp;18</a>) como tendencia. Así, optamos por fijar <span class="math inline">\(d = 1\)</span>.</p>
<div class="cell" data-layout="[[50,50]]" data-layout-align="center">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(<span class="fu">log</span>(nacimientos), <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">ylab =</span> <span class="st">""</span>, <span class="at">main =</span> <span class="st">""</span>)</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(<span class="fu">diff</span>(<span class="fu">log</span>(nacimientos)), <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">ylab =</span> <span class="st">""</span>, <span class="at">main =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-NacimientosFAC" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-NacimientosFAC-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-NacimientosFAC" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-NacimientosFAC-1" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-NacimientosFAC-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-06-Tema6_files/figure-html/fig-NacimientosFAC-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%" data-ref-parent="fig-NacimientosFAC">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-NacimientosFAC-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Serie original (log)
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-NacimientosFAC" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-NacimientosFAC-2" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-NacimientosFAC-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-06-Tema6_files/figure-html/fig-NacimientosFAC-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%" data-ref-parent="fig-NacimientosFAC">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-NacimientosFAC-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Dif. de la serie (log)
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-NacimientosFAC-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;18: Gráfica para Nacimientos y su primera diferencia
</figcaption>
</figure>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ndiffs</span>(<span class="fu">log</span>(nacimientos))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2</code></pre>
</div>
</div>
</section>
<section id="identificación-y-estimación-1" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="identificación-y-estimación-1">Identificación y Estimación</h3>
<p>Veamos a identificar los valores de <span class="math inline">\(p\)</span> y <span class="math inline">\(q\)</span> a partir de <code>auto.arima</code>, indicándole que <code>d = 1</code>. La función sugiere un proceso ARIMA(2,1,0) sin constante.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">auto.arima</span>(nacimientos, </span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">d =</span> <span class="dv">1</span>,</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">lambda =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: nacimientos 
ARIMA(2,1,0) 
Box Cox transformation: lambda= 0 

Coefficients:
         ar1     ar2
      0.3590  0.3863
s.e.  0.1824  0.1853

sigma^2 = 0.0007691:  log likelihood = 50.62
AIC=-95.23   AICc=-93.97   BIC=-91.83</code></pre>
</div>
</div>
<p>Vamos a ver la gráfica de los residuos del modelo ARIMA(2,1,0) para identificar los valores extremos (intervención).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>arima210 <span class="ot">&lt;-</span> <span class="fu">Arima</span>(nacimientos, </span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">include.constant =</span> <span class="cn">FALSE</span>)</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>error <span class="ot">&lt;-</span> <span class="fu">residuals</span>(arima210)</span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>sderror <span class="ot">&lt;-</span> <span class="fu">sd</span>(error)</span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(error, <span class="at">series=</span><span class="st">"Error"</span>,</span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"Error"</span>,</span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb95-13"><a href="#cb95-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>)<span class="sc">*</span>sderror, </span>
<span id="cb95-14"><a href="#cb95-14" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"green"</span>, <span class="st">"green"</span>, <span class="st">"red"</span>), </span>
<span id="cb95-15"><a href="#cb95-15" aria-hidden="true" tabindex="-1"></a>             <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb95-16"><a href="#cb95-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb95-17"><a href="#cb95-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span> <span class="fu">seq</span>(<span class="dv">2000</span>, <span class="dv">2024</span>, <span class="dv">4</span>)) </span>
<span id="cb95-18"><a href="#cb95-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-19"><a href="#cb95-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Creamos un variable con todos las años de la serie</span></span>
<span id="cb95-20"><a href="#cb95-20" aria-hidden="true" tabindex="-1"></a>fechas <span class="ot">&lt;-</span> <span class="fu">format</span>(<span class="fu">seq</span>(<span class="fu">as.Date</span>(<span class="st">"2000-01-01"</span>), <span class="fu">as.Date</span>(<span class="st">"2023-01-01"</span>), <span class="st">"year"</span>), <span class="st">"%Y"</span>)</span>
<span id="cb95-21"><a href="#cb95-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Identificamos los años atípicos</span></span>
<span id="cb95-22"><a href="#cb95-22" aria-hidden="true" tabindex="-1"></a>fechas[<span class="fu">abs</span>(error) <span class="sc">&gt;</span> <span class="fl">2.5</span> <span class="sc">*</span> sderror]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2009"</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-NacimientosError" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-NacimientosError-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-06-Tema6_files/figure-html/fig-NacimientosError-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-NacimientosError-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;19: Error + Intervención
</figcaption>
</figure>
</div>
</div>
</div>
<p>Se identifica un valor extremo en el año 2009, cuando se prodice el cambio en la tendencia y el número de nacimientos cae bruscamente.</p>
<p>Creamos una variable ficticia asociada a la intervención, que denominaremos d2009, y la incluimos en la autoidentificación.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>d2009 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">*</span>(<span class="fu">time</span>(error) <span class="sc">==</span> <span class="dv">2009</span>)</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a><span class="fu">auto.arima</span>(nacimientos,</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">d =</span> <span class="dv">1</span>,</span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">lambda =</span> <span class="dv">0</span>,</span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">xreg =</span> <span class="fu">cbind</span>(d2009))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: nacimientos 
Regression with ARIMA(1,1,0) errors 
Box Cox transformation: lambda= 0 

Coefficients:
         ar1     xreg
      0.6770  -0.0292
s.e.  0.1452   0.0126

sigma^2 = 0.0007516:  log likelihood = 50.95
AIC=-95.9   AICc=-94.64   BIC=-92.49</code></pre>
</div>
</div>
<p>Observa como la inclusión de intervención modifica la autoidentificación, que ahora es un proceso ARIMA(1,1,0).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>arima110 <span class="ot">&lt;-</span> <span class="fu">Arima</span>(nacimientos, </span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">include.constant =</span> <span class="cn">FALSE</span>,</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">lambda =</span> <span class="dv">0</span>,</span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">xreg =</span> <span class="fu">cbind</span>(d2009))</span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>arima110</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: nacimientos 
Regression with ARIMA(1,1,0) errors 
Box Cox transformation: lambda= 0 

Coefficients:
         ar1     xreg
      0.6770  -0.0292
s.e.  0.1452   0.0126

sigma^2 = 0.0007516:  log likelihood = 50.95
AIC=-95.9   AICc=-94.64   BIC=-92.49</code></pre>
</div>
</div>
<p>Todos los coeficientes estimados superan las dos desviaciones estándar y parecen ser significativos.</p>
<p>La <a href="#fig-NacimientosError2" class="quarto-xref">Figura&nbsp;20</a> muestra que para ningún año se observa un error atípico. Es decir, no es necesaria más intervención.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>error <span class="ot">&lt;-</span> <span class="fu">residuals</span>(arima110)</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>sderror <span class="ot">&lt;-</span> <span class="fu">sd</span>(error)</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(error, <span class="at">series=</span><span class="st">"Error"</span>,</span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"Error"</span>,</span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>)<span class="sc">*</span>sderror, </span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"green"</span>, <span class="st">"green"</span>, <span class="st">"red"</span>), </span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb101-12"><a href="#cb101-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb101-13"><a href="#cb101-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span> <span class="fu">seq</span>(<span class="dv">2000</span>, <span class="dv">2024</span>, <span class="dv">4</span>)) </span>
<span id="cb101-14"><a href="#cb101-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-15"><a href="#cb101-15" aria-hidden="true" tabindex="-1"></a><span class="co">#fechas[abs(error) &gt; 2.5 * sderror]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-NacimientosError2" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-NacimientosError2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-06-Tema6_files/figure-html/fig-NacimientosError2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-NacimientosError2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;20: Error + Intervención
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="validación-2" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="validación-2">Validación</h3>
<p>Veamos qué coeficientes estimados son significativos.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(arima110)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
z test of coefficients:

      Estimate Std. Error z value  Pr(&gt;|z|)    
ar1   0.677044   0.145205  4.6627 3.121e-06 ***
xreg -0.029205   0.012631 -2.3120   0.02078 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Confirmamos que <span class="math inline">\(Nacimientos_t \sim ARIMA(1,1,0)\)</span> sin constante y con intervención.</p>
</section>
<section id="medidas-de-error-2" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="medidas-de-error-2">Medidas de error</h3>
<p>El error de ajuste medio, medido con el RMSE, es 11887 bebés, inferior al obtenido con el método de Alisado. Sin embargo, el error porcentual medio (MAPE) es 1.97%, algo superior al del método de Alisado. Un ejemplo perfecto de que el método con mejor ajuste puede depender del criterio de calidad seleccionado. Además, no hay sesgo de predicción y la fórmula empleada para el cálculo del intervalo de confianza de las predicciones es válida.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(arima110)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>                   ME     RMSE     MAE   MPE MAPE MASE  ACF1
Training set -1442.23 11886.86 8577.24 -0.34 1.97 0.61 -0.02</code></pre>
</div>
</div>
</section>
<section id="interpretación-del-modelo-2" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="interpretación-del-modelo-2">Interpretación del modelo</h3>
<p>El <strong>modelo teórico</strong> es <span class="math inline">\(\log(Nacimientos_t) \sim ARIMA(1,1,0) + d2009\)</span>:</p>
<p><span class="math display">\[(1 - \phi_1 L)(1 - L)\log(Nacimientos_t) =  \varepsilon_t + \gamma_1 \cdot d2009.\]</span> Equivalentemente, <span class="math display">\[(1 - \phi_1 L)TVA\_Nacimientos_t =  \varepsilon_t + \gamma_1 \cdot d2009\]</span></p>
<p>Si desarrollamos, queda:</p>
<p><span class="math display">\[TVA\_Nacimientos_t = \phi_1TVA\_Nacimientos_{t-1} + \gamma_1 \cdot d2009+ \varepsilon_t.\]</span> Finalmente, el <strong>modelo estimado</strong> es: <span class="math display">\[\widehat{TVA\_Nacimientos_t} = 0.69 \cdot TVA\_Nacimientos_t -0.029 \cdot d2009\]</span></p>
<p>Cada año la tasa de variación anual de los nacimientos es un 70% de la tasa del año previo. Respecto de la intervención, en 2009 la tasa de variación anual fue 2.9 p.p inferior a lo esperado. Alternativamente, el 2009 el número de nacimientos fue un 2.9% inferior a lo esperado.</p>
</section>
<section id="predicción-4" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="predicción-4">Predicción</h3>
<p>Incluimos el argumento <code>xreg = cbind(rep(0, 4))</code> para recoger el efecto nulo en el futuro de la intervención.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>parima110 <span class="ot">&lt;-</span> <span class="fu">forecast</span>(arima110, </span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">h =</span> <span class="dv">4</span>, </span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">level =</span> <span class="dv">95</span>,</span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">xreg =</span> <span class="fu">cbind</span>(<span class="at">d1979=</span><span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">4</span>)))</span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>parima110</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Point Forecast    Lo 95    Hi 95
2024       316994.9 300411.8 334493.4
2025       313470.5 282249.5 348145.1
2026       311106.7 266310.2 363438.5
2027       309516.4 252506.6 379397.6</code></pre>
</div>
</div>
<p><br>
</p>
</section>
</section>
<section id="comparación-entre-modelos-1" class="level2" data-number="7.4">
<h2 data-number="7.4" class="anchored" data-anchor-id="comparación-entre-modelos-1"><span class="header-section-number">7.4</span> Comparación entre modelos</h2>
<p>Hemos visto que en calidad de ajuste, los modelos de Alisado y Arima superan al modelo simple. También hemos visto que el mejor entre Alisado y Arima depende del criterio de calidad de ajuste empleado.</p>
<p>La <a href="#fig-comparaNacimiento" class="quarto-xref">Figura&nbsp;21</a> muestra la serie Nacimientos y las predicciones obtenidas con cada método. Todas ellas muestran un descenso continuado en la natalidad, especialmente marcado para el método de Alisado.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-comparaNacimiento" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-comparaNacimiento-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-06-Tema6_files/figure-html/fig-comparaNacimiento-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-comparaNacimiento-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;21: Nacimiento y predicicones con tres métodos
</figcaption>
</figure>
</div>
</div>
</div>
<p>Veamos ahora qué metodo ofrece las predicciones con menor error con origen de previsión móvil. Consideraremos que son necesarios 20 años para ajustar bien los modelos y haremos previsiones a 4 años vista. Como criterio de calidad de las predicciones vamos a usar el MAPE.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>h <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>TT <span class="ot">&lt;-</span> <span class="fu">length</span>(nacimientos)</span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> TT <span class="sc">-</span> k <span class="sc">-</span> h</span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a>mapeDer <span class="ot">&lt;-</span> mapeAli <span class="ot">&lt;-</span> mapeAri <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, s <span class="sc">+</span> <span class="dv">1</span>, h)</span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">0</span><span class="sc">:</span>s) {</span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a>  train.set <span class="ot">&lt;-</span> <span class="fu">subset</span>(nacimientos, <span class="at">start =</span> i <span class="sc">+</span> <span class="dv">1</span>, <span class="at">end =</span> i <span class="sc">+</span> k)</span>
<span id="cb108-10"><a href="#cb108-10" aria-hidden="true" tabindex="-1"></a>  test.set <span class="ot">&lt;-</span>  <span class="fu">subset</span>(nacimientos, <span class="at">start =</span> i <span class="sc">+</span> k <span class="sc">+</span> <span class="dv">1</span>, <span class="at">end =</span> i <span class="sc">+</span> k <span class="sc">+</span> h)</span>
<span id="cb108-11"><a href="#cb108-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb108-12"><a href="#cb108-12" aria-hidden="true" tabindex="-1"></a>  fcast <span class="ot">&lt;-</span> <span class="fu">rwf</span>(train.set, <span class="at">h =</span> h, <span class="at">drift =</span> <span class="cn">TRUE</span>, <span class="at">lambda =</span> <span class="dv">0</span>)</span>
<span id="cb108-13"><a href="#cb108-13" aria-hidden="true" tabindex="-1"></a>  mapeDer[i <span class="sc">+</span> <span class="dv">1</span>,] <span class="ot">&lt;-</span> <span class="dv">100</span><span class="sc">*</span><span class="fu">abs</span>(test.set <span class="sc">-</span> fcast<span class="sc">$</span>mean)<span class="sc">/</span>test.set</span>
<span id="cb108-14"><a href="#cb108-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-15"><a href="#cb108-15" aria-hidden="true" tabindex="-1"></a>  fit <span class="ot">&lt;-</span> <span class="fu">ets</span>(train.set, <span class="at">model =</span> <span class="st">"AAN"</span>, <span class="at">damped =</span> <span class="cn">FALSE</span>, <span class="at">lambda =</span> <span class="dv">0</span>)</span>
<span id="cb108-16"><a href="#cb108-16" aria-hidden="true" tabindex="-1"></a>  fcast <span class="ot">&lt;-</span> <span class="fu">forecast</span>(fit, <span class="at">h =</span> h)</span>
<span id="cb108-17"><a href="#cb108-17" aria-hidden="true" tabindex="-1"></a>  mapeAli[i <span class="sc">+</span> <span class="dv">1</span>,] <span class="ot">&lt;-</span> <span class="dv">100</span><span class="sc">*</span><span class="fu">abs</span>(test.set <span class="sc">-</span> fcast<span class="sc">$</span>mean)<span class="sc">/</span>test.set</span>
<span id="cb108-18"><a href="#cb108-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-19"><a href="#cb108-19" aria-hidden="true" tabindex="-1"></a>  fit <span class="ot">&lt;-</span> <span class="fu">Arima</span>(train.set, <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>), <span class="at">include.constant =</span> <span class="cn">FALSE</span>, <span class="at">lambda =</span> <span class="dv">0</span>)</span>
<span id="cb108-20"><a href="#cb108-20" aria-hidden="true" tabindex="-1"></a>  fcast <span class="ot">&lt;-</span> <span class="fu">forecast</span>(fit, <span class="at">h =</span> h)</span>
<span id="cb108-21"><a href="#cb108-21" aria-hidden="true" tabindex="-1"></a>  mapeAri[i <span class="sc">+</span> <span class="dv">1</span>,] <span class="ot">&lt;-</span> <span class="dv">100</span><span class="sc">*</span><span class="fu">abs</span>(test.set <span class="sc">-</span> fcast<span class="sc">$</span>mean)<span class="sc">/</span>test.set</span>
<span id="cb108-22"><a href="#cb108-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb108-23"><a href="#cb108-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-24"><a href="#cb108-24" aria-hidden="true" tabindex="-1"></a>mapeDerMedia <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(mapeDer)</span>
<span id="cb108-25"><a href="#cb108-25" aria-hidden="true" tabindex="-1"></a>mapeAliMedia <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(mapeAli)</span>
<span id="cb108-26"><a href="#cb108-26" aria-hidden="true" tabindex="-1"></a>mapeAriMedia <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(mapeAri)</span>
<span id="cb108-27"><a href="#cb108-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-28"><a href="#cb108-28" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(mapeDerMedia, <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4.54 5.19 6.88 8.93</code></pre>
</div>
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(mapeAliMedia, <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.74 2.18 4.08 5.67</code></pre>
</div>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(mapeAriMedia, <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3.15 3.25 4.84 7.06</code></pre>
</div>
</div>
<p>El método de Alisado ofrece mejores predicciones para todos los horizontes temporales y es especialmente bueno en sus predicciones a 1 o 2 años vista. El método Arima es el segundo en calidad de las predicciones, pero no puede competir contra el método de Alisado.</p>
<p><br>
<br>
</p>
</section>
</section>
<section id="resumen-de-los-comandos-utilizados" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> Resumen de los comandos utilizados</h1>
<table class="caption-top table">
<colgroup>
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 58%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Función</th>
<th style="text-align: left;">Paquete</th>
<th style="text-align: left;">Descripción</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>diff</code></td>
<td style="text-align: left;">base</td>
<td style="text-align: left;">Diferencia una vector de datos numéricos</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>rwf</code></td>
<td style="text-align: left;">forecast</td>
<td style="text-align: left;">Predicción por el método de la deriva</td>
</tr>
</tbody>
</table>
<p><br>
<br>
<br>
<br>
</p>



</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-Gardner85" class="csl-entry" role="listitem">
Gardner, Everette S., and Ed. Mckenzie. 1985. <span>“Forecasting Trends in Time Series.”</span> <em>Management Science</em> 31 (10): 1237–46. <a href="https://doi.org/10.1287/mnsc.31.10.1237">https://doi.org/10.1287/mnsc.31.10.1237</a>.
</div>
<div id="ref-Hyndman08" class="csl-entry" role="listitem">
Hyndman, Rob J., and Y. Khandakar. 2008. <span>“Automatic Time Series Forecasting: The Forecast Package for r.”</span> <em>Journal of Statistical Software</em> 27 (3): 1–22. <a href="https://doi.org/10.18637/jss.v027.i03">https://doi.org/10.18637/jss.v027.i03</a>.
</div>
<div id="ref-Hyndman08b" class="csl-entry" role="listitem">
Hyndman, Rob J., A. Koehler, K. Ord, and R. Snyder. 2008. <em>Forecasting with Exponential Smoothings. The State Space Approach</em>. Springer Berlin, Heidelberg. <a href="https://doi.org/10.1007/978-3-540-71918-2">https://doi.org/10.1007/978-3-540-71918-2</a>.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>© Copyright 2024, Iván Arribas. If you find any bugs please report them to <a href="mailto:ivan.arribas@uv.es">ivan.arribas@uv.es</a></p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>This page is built with <a href="https://quarto.org/">Quarto</a></p>
</div>
  </div>
</footer>




</body></html>