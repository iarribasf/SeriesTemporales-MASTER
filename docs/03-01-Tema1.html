<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Iván Arribas (Depto. Análisis Económico. Universitat de València)">

<title>Series Temporales - Series Temporales. Definición y componentes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Series Temporales</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Inicio</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="./01-Guia-curso.html"> 
<span class="menu-text">Guía del curso</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./02-Logistica.html"> 
<span class="menu-text">Logística</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-diapos" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Diapos</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-diapos">    
        <li class="dropdown-header">Teoría</li>
        <li>
    <a class="dropdown-item" href="./03-01-Tema1.html">
 <span class="dropdown-text">Tema 1: Definicion y Componentes</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-02-Tema2.html">
 <span class="dropdown-text">Tema 2: Alisado</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-03-Tema3.html">
 <span class="dropdown-text">Tema 3: Procesos estocásticos</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-04-Tema4.html">
 <span class="dropdown-text">Tema 4: ARIMA</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-05-Tema5.html">
 <span class="dropdown-text">Tema 5: SARIMA</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Ejemplo de aplicación</li>
        <li>
    <a class="dropdown-item" href="./03-06-Ejemplo1.html">
 <span class="dropdown-text">Ejemplo Tema 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-07-Ejemplo2.html">
 <span class="dropdown-text">Ejemplo Tema 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-08-Ejemplo3.html">
 <span class="dropdown-text">Ejemplo Tema 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-09-Ejemplo4.html">
 <span class="dropdown-text">Ejemplo Tema 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-10-Ejemplo5.html">
 <span class="dropdown-text">Ejemplo Tema 5</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Otro ejemplo</li>
        <li>
    <a class="dropdown-item" href="./03-11-Ejemplo-Pasajeros.html">
 <span class="dropdown-text">Ejemplo de Pasajeros</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-píldoras" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Píldoras</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-píldoras">    
        <li>
    <a class="dropdown-item" href="./04-01-Bootstrapping.html">
 <span class="dropdown-text">Bootstrapping para IC</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./04-02-Multiples_CS.html">
 <span class="dropdown-text">Múltiples componentes estacionales</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./04-03-Redes_neuronales.html">
 <span class="dropdown-text">Predicción con Redes Neuronales</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./04-04-Series_acotadas.html">
 <span class="dropdown-text">Series acotadas</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./04-05-Valores_perdidos_Outliers.html">
 <span class="dropdown-text">Valores perdidos y outliers</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./04-06-Covid_Nacimientos.html">
 <span class="dropdown-text">Efecto de la Covid-19 en Nacimientos</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./04-07-Combinando_predicciones.html">
 <span class="dropdown-text">Combinación de predicciones</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./04-08-Series_interrumpidas.html">
 <span class="dropdown-text">Series interrumpidas</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="./05-Recursos-R.html"> 
<span class="menu-text">Recursos de la asignatura</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./06-Practica.html"> 
<span class="menu-text">Practica</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-más" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Más</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-más">    
        <li class="dropdown-header">R</li>
        <li>
    <a class="dropdown-item" href="https://cran.r-project.org">
 <span class="dropdown-text">Dónde está R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://rstudio.com">
 <span class="dropdown-text">Donde está RStudio</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Markdown</li>
        <li>
    <a class="dropdown-item" href="https://bookdown.org/yihui/rmarkdown/">
 <span class="dropdown-text">Markdown</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://rmarkdown.rstudio.com/lesson-1.html">
 <span class="dropdown-text">R Markdown</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://www.rstudio.com/wp-content/uploads/2015/03/rmarkdown-reference.pdf">
 <span class="dropdown-text">R Markdown (pdf)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://quarto.org/docs/tools/rstudio.html">
 <span class="dropdown-text">Quatro</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Otros</li>
        <li>
    <a class="dropdown-item" href="https://www.r-bloggers.com">
 <span class="dropdown-text">Blog sobre R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://bookdown.org">
 <span class="dropdown-text">Libros online que debes conocer</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Índice</h2>
   
  <ul>
  <li><a href="#introducción" id="toc-introducción" class="nav-link active" data-scroll-target="#introducción"><span class="header-section-number">1</span> Introducción</a>
  <ul class="collapse">
  <li><a href="#qué-se-puede-predecir" id="toc-qué-se-puede-predecir" class="nav-link" data-scroll-target="#qué-se-puede-predecir"><span class="header-section-number">1.1</span> ¿Qué se puede predecir?</a></li>
  <li><a href="#para-qué-predecir" id="toc-para-qué-predecir" class="nav-link" data-scroll-target="#para-qué-predecir"><span class="header-section-number">1.2</span> ¿Para qué predecir?</a></li>
  <li><a href="#qué-haremos-y-qué-no-haremos-en-este-curso" id="toc-qué-haremos-y-qué-no-haremos-en-este-curso" class="nav-link" data-scroll-target="#qué-haremos-y-qué-no-haremos-en-este-curso"><span class="header-section-number">1.3</span> ¿Qué haremos y qué no haremos en este curso?</a></li>
  </ul></li>
  <li><a href="#series-temporales" id="toc-series-temporales" class="nav-link" data-scroll-target="#series-temporales"><span class="header-section-number">2</span> Series Temporales</a>
  <ul class="collapse">
  <li><a href="#definición" id="toc-definición" class="nav-link" data-scroll-target="#definición"><span class="header-section-number">2.1</span> Definición</a></li>
  <li><a href="#proceso-generador-de-datos" id="toc-proceso-generador-de-datos" class="nav-link" data-scroll-target="#proceso-generador-de-datos"><span class="header-section-number">2.2</span> Proceso generador de datos</a></li>
  <li><a href="#lectura-de-datos-y-representación-gráfica" id="toc-lectura-de-datos-y-representación-gráfica" class="nav-link" data-scroll-target="#lectura-de-datos-y-representación-gráfica"><span class="header-section-number">2.3</span> Lectura de datos y representación gráfica</a>
  <ul class="collapse">
  <li><a href="#generación-de-residuos-municipales-per-cápita" id="toc-generación-de-residuos-municipales-per-cápita" class="nav-link" data-scroll-target="#generación-de-residuos-municipales-per-cápita">Generación de residuos municipales per cápita</a></li>
  <li><a href="#nacimientos-en-españa" id="toc-nacimientos-en-españa" class="nav-link" data-scroll-target="#nacimientos-en-españa">Nacimientos en España</a></li>
  <li><a href="#demanda-eléctrica" id="toc-demanda-eléctrica" class="nav-link" data-scroll-target="#demanda-eléctrica">Demanda eléctrica</a></li>
  </ul></li>
  <li><a href="#funciones-útiles-para-objetos-de-clase-ts" id="toc-funciones-útiles-para-objetos-de-clase-ts" class="nav-link" data-scroll-target="#funciones-útiles-para-objetos-de-clase-ts"><span class="header-section-number">2.4</span> Funciones útiles para objetos de clase <code>ts</code></a></li>
  </ul></li>
  <li><a href="#componentes-de-una-serie-temporal-y-su-combinación" id="toc-componentes-de-una-serie-temporal-y-su-combinación" class="nav-link" data-scroll-target="#componentes-de-una-serie-temporal-y-su-combinación"><span class="header-section-number">3</span> Componentes de una serie temporal y su combinación</a>
  <ul class="collapse">
  <li><a href="#tendencia-t_t" id="toc-tendencia-t_t" class="nav-link" data-scroll-target="#tendencia-t_t"><span class="header-section-number">3.1</span> Tendencia, <span class="math inline">\(T_t\)</span></a></li>
  <li><a href="#ciclo-c_t" id="toc-ciclo-c_t" class="nav-link" data-scroll-target="#ciclo-c_t"><span class="header-section-number">3.2</span> Ciclo, <span class="math inline">\(C_t\)</span></a></li>
  <li><a href="#estacionalidad-s_t" id="toc-estacionalidad-s_t" class="nav-link" data-scroll-target="#estacionalidad-s_t"><span class="header-section-number">3.3</span> Estacionalidad, <span class="math inline">\(S_t\)</span></a></li>
  <li><a href="#intervención-i_t" id="toc-intervención-i_t" class="nav-link" data-scroll-target="#intervención-i_t"><span class="header-section-number">3.4</span> Intervención, <span class="math inline">\(I_t\)</span></a></li>
  <li><a href="#residuo-r_t" id="toc-residuo-r_t" class="nav-link" data-scroll-target="#residuo-r_t"><span class="header-section-number">3.5</span> Residuo, <span class="math inline">\(R_t\)</span></a></li>
  <li><a href="#esquema-aditivo-y-multiplicativo" id="toc-esquema-aditivo-y-multiplicativo" class="nav-link" data-scroll-target="#esquema-aditivo-y-multiplicativo"><span class="header-section-number">3.6</span> Esquema aditivo y multiplicativo</a></li>
  </ul></li>
  <li><a href="#manipulación-de-una-serie" id="toc-manipulación-de-una-serie" class="nav-link" data-scroll-target="#manipulación-de-una-serie"><span class="header-section-number">4</span> Manipulación de una serie</a>
  <ul class="collapse">
  <li><a href="#idea-general" id="toc-idea-general" class="nav-link" data-scroll-target="#idea-general"><span class="header-section-number">4.1</span> Idea general</a></li>
  <li><a href="#extracción-de-la-tendencia" id="toc-extracción-de-la-tendencia" class="nav-link" data-scroll-target="#extracción-de-la-tendencia"><span class="header-section-number">4.2</span> Extracción de la tendencia</a></li>
  <li><a href="#extracción-de-la-estacionalidad" id="toc-extracción-de-la-estacionalidad" class="nav-link" data-scroll-target="#extracción-de-la-estacionalidad"><span class="header-section-number">4.3</span> Extracción de la estacionalidad</a></li>
  <li><a href="#recorte-de-una-serie-y-extracción-de-una-subserie" id="toc-recorte-de-una-serie-y-extracción-de-una-subserie" class="nav-link" data-scroll-target="#recorte-de-una-serie-y-extracción-de-una-subserie"><span class="header-section-number">4.4</span> Recorte de una serie y extracción de una subserie</a></li>
  </ul></li>
  <li><a href="#descomposición-de-una-serie" id="toc-descomposición-de-una-serie" class="nav-link" data-scroll-target="#descomposición-de-una-serie"><span class="header-section-number">5</span> Descomposición de una serie</a>
  <ul class="collapse">
  <li><a href="#concepto" id="toc-concepto" class="nav-link" data-scroll-target="#concepto"><span class="header-section-number">5.1</span> Concepto</a></li>
  <li><a href="#descomposición-por-medias-móviles" id="toc-descomposición-por-medias-móviles" class="nav-link" data-scroll-target="#descomposición-por-medias-móviles"><span class="header-section-number">5.2</span> Descomposición por medias móviles</a>
  <ul class="collapse">
  <li><a href="#ideas-generales" id="toc-ideas-generales" class="nav-link" data-scroll-target="#ideas-generales">Ideas generales</a></li>
  <li><a href="#ejemplo-de-esquema-aditivo" id="toc-ejemplo-de-esquema-aditivo" class="nav-link" data-scroll-target="#ejemplo-de-esquema-aditivo">Ejemplo de esquema aditivo</a></li>
  <li><a href="#ejemplo-de-esquema-multiplicativo" id="toc-ejemplo-de-esquema-multiplicativo" class="nav-link" data-scroll-target="#ejemplo-de-esquema-multiplicativo">Ejemplo de Esquema Multiplicativo</a></li>
  </ul></li>
  <li><a href="#descomposición-por-regresiones-locales-ponderadas" id="toc-descomposición-por-regresiones-locales-ponderadas" class="nav-link" data-scroll-target="#descomposición-por-regresiones-locales-ponderadas"><span class="header-section-number">5.3</span> Descomposición por regresiones locales ponderadas</a>
  <ul class="collapse">
  <li><a href="#ideas-generales-1" id="toc-ideas-generales-1" class="nav-link" data-scroll-target="#ideas-generales-1">Ideas generales</a></li>
  <li><a href="#ejemplo" id="toc-ejemplo" class="nav-link" data-scroll-target="#ejemplo">Ejemplo</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#resumen-de-los-paquetes-y-funciones-utilizadas" id="toc-resumen-de-los-paquetes-y-funciones-utilizadas" class="nav-link" data-scroll-target="#resumen-de-los-paquetes-y-funciones-utilizadas"><span class="header-section-number">6</span> Resumen de los paquetes y funciones utilizadas</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Series Temporales. Definición y componentes</h1>
<p class="subtitle lead">Máster de Bioestadística (Modelización Estadística)</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Iván Arribas (Depto. Análisis Económico. Universitat de València) </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<p><br>
<br>
</p>
<section id="introducción" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introducción</h1>
<blockquote class="blockquote">
<p>“Hacer previsiones supone realizar la mejor apreciación posible de algún suceso futuro.” <span class="citation" data-cites="Wilson96">Wilson and Keating (<a href="#ref-Wilson96" role="doc-biblioref">1996</a>)</span></p>
</blockquote>
<blockquote class="blockquote">
<p>“Time series are analysed to understand the past and to predict the future.” <span class="citation" data-cites="metcalfe2009">Metcalfe and Cowpertwait (<a href="#ref-metcalfe2009" role="doc-biblioref">2009</a>)</span></p>
</blockquote>
<p>Los datos temporales, <strong>series temporales</strong>, se analizan para entender el pasado y predecir el futuro posibilitando a los agentes tomar decisiones adecuadamente informados.</p>
<ul>
<li><p>Algunas cabeceras de prensa determinan el número de ejemplares a imprimir cada día analizando la demanda pasada de su diario.</p></li>
<li><p><a href="https://demanda.ree.es/demanda.html">Red Eléctrica Española</a> predice el consumo eléctrico hora a hora para ajustar la oferta a la demanda.</p></li>
<li><p>El <a href="http://www.ine.es/dyngs/INEbase/es/operacion.htm?c=Estadistica_C&amp;cid=1254736176953&amp;menu=ultiDatos&amp;idp=1254735572981">Instituto Nacional de Estadística</a> (INE) predice la población española para los próximos 50 años.</p></li>
</ul>
<p>La predicción de series temporales es una herramienta a la hora de establecer políticas sociales, empresariales…</p>
<p><br>
</p>
<section id="qué-se-puede-predecir" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="qué-se-puede-predecir"><span class="header-section-number">1.1</span> ¿Qué se puede predecir?</h2>
<p>Algunos datos son más fáciles de prever que otros. Puedes consultar múltiples páginas web con la hora en que sale el Sol en Valencia desde mañana hasta dentro de un año y todas ellas coinciden. Sin embargo, no encontrarás ninguna con la valoración exacta de las acciones en bolsa de INDRA para los próximos días. En medio están las múltiples páginas que predicen el consumo eléctrico en el largo plazo (dentro de varios años); todas ofrecen valores similares, pero no coincidentes.</p>
<p>La calidad de una predicción depende de varios factores, entre ellos:</p>
<ol type="1">
<li>nuestro <strong>conocimiento</strong> sobre los determinantes del acontecimiento</li>
<li>la cantidad de <strong>información</strong> pasada disponible</li>
<li>la <strong>semejanza</strong> del pasado con el futuro</li>
<li>si las previsiones <strong>afectan</strong> a lo que estamos prediciendo.</li>
</ol>
<p><br>
</p>
</section>
<section id="para-qué-predecir" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="para-qué-predecir"><span class="header-section-number">1.2</span> ¿Para qué predecir?</h2>
<p>Algunas de las razones por las que empresas y organismos necesitan hacer predicciones son:</p>
<ul>
<li><p><strong>Tomar decisiones en el presente sobre el futuro</strong> con más información reduciendo la incertidumbre.</p>
<p>Red eléctrica española predice la demanda de electricidad de los próximos días para gestionar el complejo sistema producción de electricidad y ajustar la demanda a la oferta.</p>
<p>Un supermercado predice la demanda de sus productos para evitar tanto rupturas de stock en el lineal como pérdidas por caducidad.</p>
<p>Una aerolínea predice la demanda asientos en sus vuelos para gestionar su flota de aviones y ajustar los precios de los billetes.</p></li>
<li><p><strong>Medir el efecto de un shock en el mercado</strong>, un cambio en la regulación o una política empresarial.</p>
<p>¿La Covid-19 ha producido un cambio en la decisión de las parejas de tener hijos? ¿Se ha reducido o aumentado la natalidad tras la Covid-19?</p>
<p>La nueva regulación de apartamentos turísticos en la ciudad, ¿cómo afecta la ocupación hotelera?</p>
<p>¿En que medida un cambio en los parámetros o características de un juego de ordenador aumenta el tiempo de juego?</p></li>
<li><p><strong>Evaluar un efecto calendario</strong>.</p>
<p>La variación en el número de turistas en marzo y abril, según como caiga la Semana Santa.</p>
<p>El efecto de un febrero bisiesto sobre las ventas.</p>
<p>El efecto de la temperatura sobre un enfermedad respiratoria o el consumo de electricidad.</p></li>
</ul>
<p><br>
</p>
</section>
<section id="qué-haremos-y-qué-no-haremos-en-este-curso" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="qué-haremos-y-qué-no-haremos-en-este-curso"><span class="header-section-number">1.3</span> ¿Qué haremos y qué no haremos en este curso?</h2>
<p>En este curso <strong>nos vamos a centrar en los métodos objetivos</strong> más fiables para obtener predicciones. Métodos que son replicables, cuyos resultados –las predicciones– son verificables y que son usados ampliamente por parte de organizaciones y empresas.</p>
<p><strong>No podremos ver todos los métodos existentes</strong>, ¡ni aunque hubiera un grado solo para predicciones! Pero los que veremos te darán la base para aprender otros métodos de previsión: alisado exponencial con doble estacionalidad, el vecino más próximo, vectores autorregresivos, redes neuronales; y para aprender otros enfoques a la hora de hacer previsiones: modelos jerárquicos de series, boostrapping, bagging…</p>
<p><strong>No vamos a aprender a predecir cotizaciones de bolsa, relaciones entre divisas o ratios financieros</strong>. La metodología para predecir estas series es completamente diferente y muy poco exitosa. Si fuera fácil, estaríamos todos invirtiendo, no dando clases (yo) o recibiéndolas (vosotros).</p>
<p><strong>Predeciremos las series de una en una, asumiendo que son independientes</strong>. Este supuesto no siempre se da, pero simplifica enormemente el análisis de una serie. Por ejemplo, predeciremos la serie de pernoctaciones en España en hoteles usando solo datos de esta serie. Sin embargo, seria de ayuda predecir de forma simultánea la serie de turistas llegados a España porque el volumen de pernoctaciones depende del número de turistas. Otra estrategia sería predecir las pernoctaciones en cada comunidad autónoma y luego sumarlas para obtener el total nacional.</p>
<p><br>
<br>
</p>
</section>
</section>
<section id="series-temporales" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Series Temporales</h1>
<p><br>
</p>
<section id="definición" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="definición"><span class="header-section-number">2.1</span> Definición</h2>
<p><strong>Una serie temporal es una variable medida secuencialmente en el tiempo a intervalos equiespaciados</strong>.</p>
<p>La representaremos por,</p>
<p><span class="math display">\[\{y_t\}_{t=1}^T=\{y_1,y_2,\ldots,y_T\}.\]</span></p>
<p>La serie aparece indexada por su fechado <span class="math inline">\(t\)</span> y el valor <span class="math inline">\(T\)</span> hará siempre referencia a la fecha del último dato.</p>
<p>El fechado varía en su frecuencia, que puede ser anual (baja frecuencia), trimestral, mensual, semanal, diario (alta frecuencia) o disponer casi de un continuo de datos.</p>
<p><br>
</p>
</section>
<section id="proceso-generador-de-datos" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="proceso-generador-de-datos"><span class="header-section-number">2.2</span> Proceso generador de datos</h2>
<p>El proceso generador de los datos de una serie temporal es en general desconocido, pero se puede aproximar por un modelo estadístico. Estos modelos se pueden clasificar en tres grandes familias según su naturaleza: deterministas, estocásticos y mixtos</p>
<p>En ocasiones las series temporales pueden ser modeladas de forma <strong>determinista</strong> ajustando los datos a funciones matemáticas: <span class="math display">\[y_t=f(t)+\varepsilon_t.\]</span></p>
<p>Si las observaciones cercanas en el tiempo tienden a estar (cor)relacionadas, se puede aprovechar esta dependencia para entender la serie y predecirla con un <strong>modelo estocástico</strong>: <span class="math display">\[y_t=f(y_{t-1},y_{t-2},\ldots)+\varepsilon_t.\]</span></p>
<p>A veces, ambas situaciones se dan simultáneamente (<strong>modelos mixtos</strong>): <span class="math display">\[y_t=f(t,y_{t-1},y_{t-2},\ldots)+\varepsilon_t.\]</span></p>
<p>La <a href="#fig-procesosgeneradores" class="quarto-xref">Figura&nbsp;1</a> muestra un ejemplo gráfico de estos tres modelos estadísticos. La complejidad de la serie es mayor en los modelos con parte estocástica.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-procesosgeneradores" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-procesosgeneradores-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-01-Tema1_files/figure-html/fig-procesosgeneradores-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-procesosgeneradores-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;1: Ejemplos de procesos generadores
</figcaption>
</figure>
</div>
</div>
</div>
<p>En este curso se asumirá en todo momento que la serie temporal tiene una componente estocástica. Para series deterministas puedes usar los modelos de regresión verás en <em>Modelos lineales</em>.</p>
<p><br>
</p>
</section>
<section id="lectura-de-datos-y-representación-gráfica" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="lectura-de-datos-y-representación-gráfica"><span class="header-section-number">2.3</span> Lectura de datos y representación gráfica</h2>
<p>Antes de continuar vamos a importar con <code>R</code> tres de las series que usaremos de ejemplo en este tema: generación anual de residuos municipales per cápita (kg per cápita), los nacimientos mensuales y la demanda eléctrica diaria (GWh). Las tres series se refieren a España y servirán de ejemplo para el análisis de series con diferente fechado: anual, mensual y diario, respectivamente.</p>
<section id="generación-de-residuos-municipales-per-cápita" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="generación-de-residuos-municipales-per-cápita">Generación de residuos municipales per cápita</h3>
<p>Residuos es una <em>serie anual</em> de 1995 a 2022 (fuente <a href="https://www.ine.es">Instituto Nacional de Estadística</a>) que muestra los residuos recogidos por o en nombre de las autoridades municipales y eliminados a través del sistema de gestión de residuos. Los datos están disponibles en el fichero <code>Residuos.csv</code>, que contiene dos variables o columnas de datos. La primera columna corresponde al año de la serie y la segunda contiene los residuos recogidos en kg per cápita. En la primera fila del fichero aparece el nombre de cada columna. Los valores no tienen decimales y los datos de cada fila vienen separados por un punto y coma.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>residuos <span class="ot">&lt;-</span> <span class="fu">read.csv2</span>(<span class="st">"./series/Residuos.csv"</span>, </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>residuos <span class="ot">&lt;-</span> <span class="fu">ts</span>(residuos[, <span class="dv">2</span>], </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">start =</span> <span class="dv">1995</span>, </span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">frequency  =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Ojo con la lectura de datos
</div>
</div>
<div class="callout-body-container callout-body">
<p>Usamos para leer los datos <code>read.csv2</code>, indicando que la primera línea tiene el nombre de las variables. Esta función asume que el separador decimal es la coma “,” y que el separador entre variables es el punto y coma “;”.</p>
<p>Si el separador decimal es el punto “.” y el separador de variables es la coma “,”, debes usar <code>read.csv</code>.</p>
<p>En cualquiera de estas funciones puedes modificar el separador decimal por medio del argumento <code>dec</code>; también puedes usar el argumento <code>sep</code> para indicar el carácter usado como separador de variables.</p>
</div>
</div>
<p>La función <code>ts</code>, de la librería <code>stats</code>, convierte un objeto (vector o matriz) en la clase <em>serie temporal</em>. En este caso seleccionamos solo la segunda columna, la que contiene el número de residuos generados.</p>
<ul>
<li>Con <code>start</code> indicamos el fechado del primer dato.</li>
<li>Con <code>frequency</code> indicamos la frecuencia, que en este caso es un dato por año.</li>
</ul>
<p>Usa <code>help(ts)</code> para obtener más información y <code>str(residuos)</code> para ver qué contiene un objeto <em>serie temporal</em>.</p>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Nombre del fichero y nombre de la serie
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Por comodidad (o pereza), muchas veces el nombre del fichero con los datos, el nombre del data.frame con su contenido en <code>R</code> y el nombre de la serie es el mismo. No tiene por que ser así, aunque en estos apuntes es lo más habitual.</p>
<p>En este caso, observa que primero creamos “residuos”, una base de datos (data.frame) con el contenido del fichero “Residuos.csv” que tiene dos variables (fechado y valores de la serie). Luego creamos la serie temporal “residuos” extrayendo de la base de datos la segunda columna (valores de la serie) y fechándola. Por tanto, estamos machacando la base de datos al poner a la serie el mismo nombre.</p>
</div>
</div>
</div>
<p>Podemos dibujar la serie Residuos con la función <code>plot</code> o mejor con <code>autoplot</code>. Esta última está en el paquete <code>forecast</code>.</p>
<p>En general, las funciones gráficas que vamos a usar pertenecen a la librería <code>forecast</code>, pero en ocasiones las ampliaremos con funciones de la librería <code>ggplot2</code>. Te recomiendo cargar estas dos librerías desde el inicio. En casi todos los casos existe una versión de la función gráfica usada en la librería <code>stats</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forecast)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(residuos,</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"Kg per cápita"</span>,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-residuos" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-residuos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-01-Tema1_files/figure-html/fig-residuos-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-residuos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;2: Residuos generados
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="nacimientos-en-españa" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="nacimientos-en-españa">Nacimientos en España</h3>
<p>Nacimientos es una <em>serie mensual</em> de enero de 1975 a diciembre de 2023 (fuente: <a href="https://www.ine.es">Instituto Nacional de Estadística</a>). Los datos están disponibles en el fichero <code>Nacimientos.csv</code>. La primera columna del fichero tiene la fecha y la segunda la serie propiamente. En la primera fila aparece el nombre de cada columna. De nuevo seleccionamos solo la columna con los datos de nacimientos.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>nacimientos <span class="ot">&lt;-</span> <span class="fu">read.csv2</span>(<span class="st">"./series/Nacimientos.csv"</span>, </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>nacimientos <span class="ot">&lt;-</span> <span class="fu">ts</span>(nacimientos[, <span class="dv">2</span>],</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1975</span>, <span class="dv">1</span>),</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">frequency =</span> <span class="dv">12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
¿Sobrías responder a estas preguntas?
</div>
</div>
<div class="callout-body-container callout-body">
<p>¿Por qué se usa el argumento “header = TRUE”?</p>
<p>¿Por qué la serie corresponde a la segunda columna de la base de datos “nacimientos”?</p>
</div>
</div>
<p>En este caso:</p>
<ul>
<li>Con <code>start</code> indicamos que el primer dato es enero de 1975. También sería correcto <code>start = 1975</code>. Si el primer dato fuera, por ejemplo, marzo de 1975, podríamos poner <code>start = c(1975, 3)</code> o <code>start = 1975 + 2/12</code>.</li>
<li>Con <code>frequency</code> indicamos que se tienen 12 datos (meses) por año. Si la serie fuera trimestral pondríamos <code>frequency = 4</code>.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(nacimientos,</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"Nacimientos"</span>,</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-nacimientos" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-nacimientos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-01-Tema1_files/figure-html/fig-nacimientos-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-nacimientos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;3: Nacimientos mensuales
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="demanda-eléctrica" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="demanda-eléctrica">Demanda eléctrica</h3>
<p>Demanda eléctrica es una <em>serie diaria</em> desde el 1 enero de 2023 hasta el 31 diciembre de 2023 (fuente: <a href="https://demanda.ree.es/visiona/peninsula/demandaqh/total">Red Electrica de España</a>). Los datos están disponibles en el fichero <code>Consumo electrico.csv</code>. El fichero solo tiene una columna, encabezada con un nombre, con los datos de la serie y el carácter decimal es el punto.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>electricidad <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"./series/Consumo electrico.csv"</span>, </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>electricidad <span class="ot">&lt;-</span> <span class="fu">ts</span>(electricidad[, <span class="dv">1</span>],</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">7</span>),</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">frequency =</span> <span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>En este caso:</p>
<ul>
<li>Con <code>start</code> indicamos que el primer dato es un domingo (día 7 de la semana) de la primera semana. Como ves no hay referencia al año. También sería correcto <code>start = 1 + 6/7</code>.</li>
<li>Con <code>frequency</code> indicamos que se tienen 7 datos (días) por semana. Si la serie fuera de lunes a viernes pondríamos <code>frequency = 5</code>.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(electricidad,</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"GWh"</span>,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-consumoelectrico" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-consumoelectrico-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-01-Tema1_files/figure-html/fig-consumoelectrico-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-consumoelectrico-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;4: Consumo diario de electricidad
</figcaption>
</figure>
</div>
</div>
</div>
<p><br>
</p>
</section>
</section>
<section id="funciones-útiles-para-objetos-de-clase-ts" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="funciones-útiles-para-objetos-de-clase-ts"><span class="header-section-number">2.4</span> Funciones útiles para objetos de clase <code>ts</code></h2>
<p>Otras funciones relacionadas con los objetos de clase <em>serie temporal</em> que pueden ser útiles son:</p>
<ul>
<li><code>start</code> da el fechado del primer dato, y <code>end</code> da el fechado del último dato.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">start</span>(nacimientos); <span class="fu">end</span>(nacimientos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1975    1</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2023   12</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">start</span>(electricidad); <span class="fu">end</span>(electricidad)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 7</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 53  7</code></pre>
</div>
</div>
<ul>
<li><code>frequency</code> da la frecuencia de los datos.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">frequency</span>(nacimientos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 12</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">frequency</span>(electricidad)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 7</code></pre>
</div>
</div>
<ul>
<li><code>time</code> crea un vector con el fechado de una serie. Observa como guarda internamente <code>R</code> el fechado de una serie temporal. Esta es una función que usaremos constantemente.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">time</span>(nacimientos), <span class="at">n =</span> <span class="dv">48</span>)  <span class="co">#Mostramos sólo los 4 primeros años</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Jan      Feb      Mar      Apr      May      Jun      Jul      Aug
1975 1975.000 1975.083 1975.167 1975.250 1975.333 1975.417 1975.500 1975.583
1976 1976.000 1976.083 1976.167 1976.250 1976.333 1976.417 1976.500 1976.583
1977 1977.000 1977.083 1977.167 1977.250 1977.333 1977.417 1977.500 1977.583
1978 1978.000 1978.083 1978.167 1978.250 1978.333 1978.417 1978.500 1978.583
          Sep      Oct      Nov      Dec
1975 1975.667 1975.750 1975.833 1975.917
1976 1976.667 1976.750 1976.833 1976.917
1977 1977.667 1977.750 1977.833 1977.917
1978 1978.667 1978.750 1978.833 1978.917</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">time</span>(electricidad), <span class="at">n =</span> <span class="dv">28</span>)  <span class="co">#Mostramos sólo las 4 primeras semanas</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Time Series:
Start = c(1, 7) 
End = c(5, 6) 
Frequency = 7 
 [1] 1.857143 2.000000 2.142857 2.285714 2.428571 2.571429 2.714286 2.857143
 [9] 3.000000 3.142857 3.285714 3.428571 3.571429 3.714286 3.857143 4.000000
[17] 4.142857 4.285714 4.428571 4.571429 4.714286 4.857143 5.000000 5.142857
[25] 5.285714 5.428571 5.571429 5.714286</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Fechado de la serie
</div>
</div>
<div class="callout-body-container callout-body">
<p>¿Tienes claro cómo R guarda internamente el fechado de una serie? ¿Qué indican los valores decimales?</p>
</div>
</div>
<ul>
<li><code>cycle</code>, crea un vector con la posición en el ciclo de cada observación. Para una serie mensual sus valores van de 1 a 12, para una serie diaria sus valores irían 1 a 7. También usaremos esta función de forma regular.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">cycle</span>(nacimientos), <span class="at">n =</span> <span class="dv">48</span>) <span class="co">#Mostramos sólo los 4 primeros años</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec
1975   1   2   3   4   5   6   7   8   9  10  11  12
1976   1   2   3   4   5   6   7   8   9  10  11  12
1977   1   2   3   4   5   6   7   8   9  10  11  12
1978   1   2   3   4   5   6   7   8   9  10  11  12</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">cycle</span>(electricidad), <span class="at">n =</span> <span class="dv">28</span>) <span class="co">#Mostramos sólo las 4 primeras semanas</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Time Series:
Start = c(1, 7) 
End = c(5, 6) 
Frequency = 7 
 [1] 7 1 2 3 4 5 6 7 1 2 3 4 5 6 7 1 2 3 4 5 6 7 1 2 3 4 5 6</code></pre>
</div>
</div>
<p><br>
<br>
</p>
</section>
</section>
<section id="componentes-de-una-serie-temporal-y-su-combinación" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Componentes de una serie temporal y su combinación</h1>
<p>Toda serie temporal es la combinación de hasta cinco componentes: tendencia, ciclo, estacionalidad, intervención y residuo.</p>
<p><br>
</p>
<section id="tendencia-t_t" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="tendencia-t_t"><span class="header-section-number">3.1</span> Tendencia, <span class="math inline">\(T_t\)</span></h2>
<p><strong>Definición</strong>: la tendencia de una serie es su comportamiento a largo plazo (varios años). Describe los cambios sistemáticos de la serie temporal que no aparentan ser periódicos.</p>
<p>Respecto a la <strong>dirección del movimiento</strong> la tendencia puede ser:</p>
<ul>
<li><em>Creciente</em>: a largo plazo la serie aumenta su valor</li>
<li><em>Decreciente</em>: a largo plazo la serie disminuye su valor</li>
<li><em>Estacionaria</em>: a largo plazo la serie mantiene su valor</li>
</ul>
<p>Respecto del <strong>proceso generador</strong> de la tendencia, puede ser:</p>
<ul>
<li><em>Determinista</em>: <span class="math inline">\(T_t = f(t)\)</span></li>
<li><em>Estocástica</em>: <span class="math inline">\(T_t = f(T_{t-1}, T_{t-2},\ldots)\)</span></li>
<li><em>Mixta</em>: <span class="math inline">\(T_t = f(t,T_{t-1}, T_{t-2},\ldots)\)</span></li>
</ul>
<p>En la <a href="#fig-tipostendencia" class="quarto-xref">Figura&nbsp;5</a> se muestran ejemplos de series temporales según dirección del movimiento y pendiente de la tendencia.</p>
<p><br>
</p>
<div class="cell" data-layout="[[100],[33,33,33],[33,33,33]]" data-layout-align="center">
<div id="fig-tipostendencia" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-tipostendencia-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-tipostendencia" style="flex-basis: 100.0%;justify-content: center;">
<div id="fig-tipostendencia-1" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-tipostendencia-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-01-Tema1_files/figure-html/fig-tipostendencia-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%" data-ref-parent="fig-tipostendencia">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-tipostendencia-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Estacionaria
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-tipostendencia" style="flex-basis: 33.3%;justify-content: center;">
<div id="fig-tipostendencia-2" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-tipostendencia-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-01-Tema1_files/figure-html/fig-tipostendencia-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%" data-ref-parent="fig-tipostendencia">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-tipostendencia-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Creciente (lineal)
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-tipostendencia" style="flex-basis: 33.3%;justify-content: center;">
<div id="fig-tipostendencia-3" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-tipostendencia-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-01-Tema1_files/figure-html/fig-tipostendencia-3.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%" data-ref-parent="fig-tipostendencia">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-tipostendencia-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(c) Creciente (exponencial)
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-tipostendencia" style="flex-basis: 33.3%;justify-content: center;">
<div id="fig-tipostendencia-4" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-tipostendencia-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-01-Tema1_files/figure-html/fig-tipostendencia-4.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%" data-ref-parent="fig-tipostendencia">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-tipostendencia-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(d) Creciente (logarítmica)
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-tipostendencia" style="flex-basis: 33.3%;justify-content: center;">
<div id="fig-tipostendencia-5" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-tipostendencia-5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-01-Tema1_files/figure-html/fig-tipostendencia-5.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%" data-ref-parent="fig-tipostendencia">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-tipostendencia-5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(e) Decreciente (lineal)
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-tipostendencia" style="flex-basis: 33.3%;justify-content: center;">
<div id="fig-tipostendencia-6" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-tipostendencia-6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-01-Tema1_files/figure-html/fig-tipostendencia-6.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%" data-ref-parent="fig-tipostendencia">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-tipostendencia-6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(f) Decreciente (exponencial)
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-tipostendencia" style="flex-basis: 33.3%;justify-content: center;">
<div id="fig-tipostendencia-7" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-tipostendencia-7-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-01-Tema1_files/figure-html/fig-tipostendencia-7.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%" data-ref-parent="fig-tipostendencia">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-tipostendencia-7-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(g) Decreciente (logarítmica)
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-tipostendencia-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;5: Ejemplos de tendencia
</figcaption>
</figure>
</div>
</div>
<p><br>
</p>
<p>Si la serie temporal es suficientemente larga es posible observar cambios en la dirección del movimiento de la tendencia que definen los <strong>ciclos</strong>.</p>
<p><br>
</p>
</section>
<section id="ciclo-c_t" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="ciclo-c_t"><span class="header-section-number">3.2</span> Ciclo, <span class="math inline">\(C_t\)</span></h2>
<p><strong>Definición</strong>: Son patrones sin periodicidad fija que abarcan varios años.</p>
<p>Por ejemplo, los ciclos económicos, los cambios climáticos asociados al fenómeno El Niño, o las manchas solares (véase <a href="#fig-ciclossolares" class="quarto-xref">Figura&nbsp;6</a>).</p>
<div id="fig-ciclossolares" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ciclossolares-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="./imagenes/ciclo.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ciclossolares-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;6: Ciclos solares. Imagen tomada de <span class="citation" data-cites="Courtillot21">Courtillot, Lopes, and Mouël (<a href="#ref-Courtillot21" role="doc-biblioref">2021</a>)</span>
</figcaption>
</figure>
</div>
<p><br>
</p>
<p>La serie de <strong>Nacimientos</strong> es lo suficientemente larga como para observarse un ciclo completo, que queda identificado por dos cambios de tendencia consecutivos de signo opuesto (véase <a href="#fig-ciclosnacimientos" class="quarto-xref">Figura&nbsp;7</a>):</p>
<ul>
<li>A finales de la década de los 90 la tendencia decreciente en los nacimientos pasa a creciente por la llegada de inmigrantes con una mayor tasa de natalidad.</li>
<li>A finales de la primera década del 2000 la tendencia creciente pasa a decreciente porque la Gran Recesión provoca el regreso a sus países de origen de muchos de estos inmigrantes.</li>
</ul>
<p>De esta forma, observamos un ciclo completo desde 1975 hasta poco antes de 2010 (periodo entre dos cambios de tendencia), y el inicio del siguiente ciclo, en el que aun estamos.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-ciclosnacimientos" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ciclosnacimientos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-01-Tema1_files/figure-html/fig-ciclosnacimientos-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ciclosnacimientos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;7: Ciclos en la serie Nacimientos
</figcaption>
</figure>
</div>
</div>
</div>
<p><br>
</p>
</section>
<section id="estacionalidad-s_t" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="estacionalidad-s_t"><span class="header-section-number">3.3</span> Estacionalidad, <span class="math inline">\(S_t\)</span></h2>
<p><strong>Definición</strong>: Son patrones repetitivos de periodicidad fija e inferior al año.</p>
<p>El <strong>orden de la periodicidad lo denominaremos</strong> <span class="math inline">\(m\)</span>, por tanto el patrón estacional se repite cada <span class="math inline">\(m\)</span> periodos. Lógicamente, <span class="math inline">\(m\)</span> toma el valor 12 para datos mensuales, el valor 4 para datos trimestrales, 7 para datos diarios de lunes a domingo, etc.</p>
<p>La componente estacional surge por factores climatológicos, institucionales o sociales.</p>
<p>En ocasiones no es fácil determinar la existencia de estacionalidad o su orden. En este caso, se puede usar el análisis espectral, que no veremos en este curso, para analizar esta componente. La librería <code>forecast</code> dispone de la función <code>findfrequency</code> que devuelve la frecuencia dominante de una serie usando el análisis espectral.</p>
<p>La serie Nacimientos tiene una estacionalidad de orden 12, causada principalmente por el número de días del mes (véase la <a href="#fig-estacionalidadnacimientos" class="quarto-xref">Figura&nbsp;8</a>). Cada año se repite una misma pauta: los meses de febrero, por tener 28 (o 29 días en años bisiestos), presentan el menor número de nacimientos y son los valles en la <a href="#fig-estacionalidadnacimientos" class="quarto-xref">Figura&nbsp;8</a>; y, en general, en los meses de 31 días hay más nacimientos que en los demás meses del año.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-estacionalidadnacimientos" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-estacionalidadnacimientos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-01-Tema1_files/figure-html/fig-estacionalidadnacimientos-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-estacionalidadnacimientos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;8: Nacimientos
</figcaption>
</figure>
</div>
</div>
</div>
<p><br>
</p>
<p>La <a href="#fig-estacionalidadelectricidad" class="quarto-xref">Figura&nbsp;9</a> muestra la demanda eléctrica diariamente para cuatro semanas, desde el lunes 30 de enero hasta el domingo 26 de febrero (semanas 6 a 9 del año). Tiene, por tanto, una estacionalidad de orden 7. En el eje OX aparecen etiquetados los lunes de cada semana que permiten identificar el siguiente patrón semanal: de lunes a viernes un consumo similar, seguido de una caída en el consumo el sábado, y el domingo como el día de menor consumo</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-estacionalidadelectricidad" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-estacionalidadelectricidad-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-01-Tema1_files/figure-html/fig-estacionalidadelectricidad-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-estacionalidadelectricidad-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;9: Demanda diaria de electricidad
</figcaption>
</figure>
</div>
</div>
</div>
<p>Si el fechado de la serie es de muy alta frecuencia, puede ocurrir que se superponga más de una componente estacional. La <a href="#fig-estacionalidadmultiple" class="quarto-xref">Figura&nbsp;10</a> muestra la serie corresponde a la demanda eléctrica (GW) recogida cada hora durante el mes de febrero de 2021. El eje OX señala el consumo de la primera hora de cada día del mes (desde media noche hasta la una de la madrugada). Se aprecia una estacionalidad diaria de orden <span class="math inline">\(24\)</span>, otra semanal de orden <span class="math inline">\(168 =7 \times 24\)</span> y si mostráramos varios años de consumo, también se observaría otra mensual.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-estacionalidadmultiple" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-estacionalidadmultiple-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-01-Tema1_files/figure-html/fig-estacionalidadmultiple-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-estacionalidadmultiple-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;10: Estacionalidad múltiple para el consumo de electricidad por hora
</figcaption>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Series con más de una componente estacional
</div>
</div>
<div class="callout-body-container callout-body">
<p>En este curso no analizaremos series con más de una componente estacional. Si quieres tener una primera aproximación de como se hace, puedes ir a la píldora <em>Múltiples componentes estacionales</em>.</p>
</div>
</div>
<p><br>
</p>
</section>
<section id="intervención-i_t" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="intervención-i_t"><span class="header-section-number">3.4</span> Intervención, <span class="math inline">\(I_t\)</span></h2>
<p><strong>Definición</strong>: Es un factor sistemático no periódico, o irregular, que vendría determinado por fenómenos ocasionales que provocan observaciones anómalas y valores atípicos en la serie temporal.</p>
<p>Por su relación con fechas concretas, podemos distinguir dos tipos:</p>
<ul>
<li><em>Efectos calendario</em>: irregularidades específicas en la serie temporal que se producen durante determinados periodos de tiempo. Por ejemplos los días festivos en series diarias; o la Semana Santa, días laborales y febrero bisiesto en series mensuales.</li>
<li><em>Otros efectos no sujetos a calendario</em>: irregularidades no específicas ni sujetas a fechas concretas. Por ejemplo, pandemias, catástrofes naturales, huelgas, caída del sistema eléctrico o de los servidores de una red social, etc.</li>
</ul>
<p>En la serie mensual Nacimientos, los meses de febrero bisiestos (puntos rojos) presentan un número de nacimientos mayor que los meses de febrero no bisiestos (efecto calendario). Para algunos años este hecho es mas claro (véase <a href="#fig-intervencionnacimientos" class="quarto-xref">Figura&nbsp;11</a>). Además, a finales del año 2020 y principios del 2021 se observa una caída inusual en el número de nacimientos (puntos verdes) debido a que la pandemia causada por la Covid-19 retrasó la decisión de tener hijos de muchas parejas. Este es un ejemplo de intervención no sujeta a calendario.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-intervencionnacimientos" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-intervencionnacimientos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-01-Tema1_files/figure-html/fig-intervencionnacimientos-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-intervencionnacimientos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;11: Efecto de los febreros bisiestos y de la Covid-19 en Nacimientos
</figcaption>
</figure>
</div>
</div>
</div>
<p>En la serie diaria Electricidad cuando un día entre semana es festivo, el consumo se reduce notablemente, apareciendo un efecto calendario. Si se trata de un día aislado, el efecto es muy fácil de identificar y analizar. Un ejemplo, observable en la <a href="#fig-intervencionelectricidad" class="quarto-xref">Figura&nbsp;12</a>, es el miércoles 1 de noviembre de 2023, día de Todos los Santos, identificado con un punto rojo en la figura. Se aprecia que el consumo fue muy inferior al observado el miércoles precedente y posterior (puntos verdes). Si los festivos abarcan varios días, el efecto sigue siendo perfectamente identificable, pero es más complejo de analizar. Un ejemplo es la última semana de diciembre donde el consumo es muy inferior al observado en las semanas previas debido, por un lado, al efecto del día festivo de Navidad (punto azul) y, por otro lado, al periodo semi-vacacional que estas festividades supone en España. También se aprecia la intervención asociada a la semana que contiene los festivos de la Constitución y la Inmaculada (martes 6 y jueves 8 de diciembre).</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-intervencionelectricidad" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-intervencionelectricidad-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-01-Tema1_files/figure-html/fig-intervencionelectricidad-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-intervencionelectricidad-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;12: Efectos calendario en Electricidad
</figcaption>
</figure>
</div>
</div>
</div>
<p>Por su naturaleza, podemos distinguir tres tipos básicos de intervención (aunque hay más):</p>
<dl>
<dt><em>Pulso (Additive Outlier, AO)</em></dt>
<dd>
<p>En un periodo aislado la serie toma un valor anómalo (véase <a href="#fig-intervenciontipos" class="quarto-xref">Figura&nbsp;13</a>, panel izquierdo). Por ejemplo, un día entre semana es festivo y la demanda eléctrica es inferior a la usual; o el mes de agosto de 2024 la olimpiadas de París incrementan significativamente el turismo y la ocupación hotelera en la ciudad respecto de agostos precedentes.</p>
</dd>
<dt><em>Cambio transitorio (Transitory Change, TC)</em></dt>
<dd>
<p>En un periodo un <em>shock</em> genera un valor anómalo en la serie y el efecto del <em>shock</em> va desapareciendo poco a poco (véase <a href="#fig-intervenciontipos" class="quarto-xref">Figura&nbsp;13</a>, panel central). Por ejemplo, las redes sociales ponen de moda un producto que temporalmente aumenta sus ventas. Pero, conforme pasa el tiempo, los consumidores se olvidan del producto y sus ventas vuelven poco a poco a su nivel previo.</p>
</dd>
<dt><em>Cambio permanente (Level Shift, LS)</em></dt>
<dd>
<p>En un periodo la serie cambia de nivel y permanece de forma permanente en este nuevo nivel (véase <a href="#fig-intervenciontipos" class="quarto-xref">Figura&nbsp;13</a>, panel derecho). Por ejemplo, enfrente de un supermercado abre la competencia, de forma que sus ventas descienden bruscamente de forma permanente. La apertura en una ciudad de una nueva línea de tranvía incrementa de forma permanente los usuarios del transporte público en esa ciudad.</p>
</dd>
</dl>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-intervenciontipos" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-intervenciontipos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-01-Tema1_files/figure-html/fig-intervenciontipos-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-intervenciontipos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;13: Tipos de intervención
</figcaption>
</figure>
</div>
</div>
</div>
<p><br>
</p>
</section>
<section id="residuo-r_t" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="residuo-r_t"><span class="header-section-number">3.5</span> Residuo, <span class="math inline">\(R_t\)</span></h2>
<p><strong>Definición</strong>: No presenta un comportamiento sistemático a corto, medio o largo plazo por lo que no se puede predecir de modo alguno. Es la parte de la serie que se debe a puro azar.</p>
<p>Aunque inicialmente no se hará ningún supuesto sobre el residuo, se espera que sea ruido blanco: media cero, incorrelado y homocedástico. Es decir <span class="math inline">\(R_t \sim iid(0, \sigma^2\)</span>).</p>
<p><br>
</p>
</section>
<section id="esquema-aditivo-y-multiplicativo" class="level2" data-number="3.6">
<h2 data-number="3.6" class="anchored" data-anchor-id="esquema-aditivo-y-multiplicativo"><span class="header-section-number">3.6</span> Esquema aditivo y multiplicativo</h2>
<p>Una serie temporal siempre tiene tendencia y residuo. La presencia de estacionalidad, ciclo e intervención depende de la naturaleza de la serie. Por ejemplo, una serie anual no tendrá nunca estacionalidad y en una serie corta no se podrá observar el ciclo.</p>
<p><strong>Las componentes de una serie temporal se pueden combinar de múltiples formas.</strong></p>
<p>En el <strong>esquema aditivo</strong> cada componente suma su efecto sobre las demás, <span class="math display">\[y_t = T_t + S_t + C_t + I_t + R_t.\]</span> La demanda diaria de electricidad es un ejemplo de este tipo de esquema (<a href="#fig-esquemaaditivo" class="quarto-xref">Figura&nbsp;14</a>). El panel superior muestra la serie en el tiempo e identificamos el esquema aditivo porque la amplitud estacional (para cada semana la diferencia entre el día de más consumo y el de menos consumo) se mantiene constante en el tiempo. En el panel inferior tenemos una gráfica media-varianza, donde cada punto corresponde a una semana, la coordenada X es el consumo de esa semana y la coordenada Y la desviación típica del consumo para los días de esa semana (variabilidad intrasemanal). Este segundo panel revela el esquema aditivo de la serie porque no se observa un patrón creciente en los puntos: más consumo no implica una mayor desviación típica.</p>
<div id="fig-esquemaaditivo" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-esquemaaditivo-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-esquemaaditivo" style="flex-basis: 100.0%;justify-content: center;">
<div id="fig-esquemaaditivo-1" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-esquemaaditivo-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-01-Tema1_files/figure-html/fig-esquemaaditivo-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%" data-ref-parent="fig-esquemaaditivo">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-esquemaaditivo-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Consumo electrico diario
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-esquemaaditivo" style="flex-basis: 100.0%;justify-content: center;">
<div id="fig-esquemaaditivo-2" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-esquemaaditivo-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-01-Tema1_files/figure-html/fig-esquemaaditivo-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%" data-ref-parent="fig-esquemaaditivo">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-esquemaaditivo-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Gráfica media-varianza
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-esquemaaditivo-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;14: Ejemplo de esquema aditivo
</figcaption>
</figure>
</div>
<p>En el <strong>esquema multiplicativo</strong> cada componente supone un incremento porcentual respecto de las demás, <span class="math display">\[y_t = T_t \cdot S_t \cdot C_t \cdot I_t \cdot R_t.\]</span> La serie Nacimientos es un ejemplo de esquema multiplicativo. En el panel superior de la <a href="#fig-esquemamultiplicativo" class="quarto-xref">Figura&nbsp;15</a>, que muestra la serie, se observa que según decrece el número de nacimientos, también decrece la amplitud estacional. Además, en el panel inferior cada punto corresponde a un año: en el eje X los nacimientos de ese año y en el eje Y la desviación típica de los nacimientos mensuales de ese año (variación intraanual). En este panel se observa un patrón creciente en los puntos, revelando el esquema multiplicativo de la serie.</p>
<div id="fig-esquemamultiplicativo" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-esquemamultiplicativo-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-esquemamultiplicativo" style="flex-basis: 100.0%;justify-content: center;">
<div id="fig-esquemamultiplicativo-1" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-esquemamultiplicativo-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-01-Tema1_files/figure-html/fig-esquemamultiplicativo-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%" data-ref-parent="fig-esquemamultiplicativo">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-esquemamultiplicativo-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Nacimientos mensuales
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-esquemamultiplicativo" style="flex-basis: 100.0%;justify-content: center;">
<div id="fig-esquemamultiplicativo-2" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-esquemamultiplicativo-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-01-Tema1_files/figure-html/fig-esquemamultiplicativo-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%" data-ref-parent="fig-esquemamultiplicativo">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-esquemamultiplicativo-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Gráfica media-desviación anual
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-esquemamultiplicativo-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;15: Ejemplo de esquema multiplicativo
</figcaption>
</figure>
</div>
<p>Si una serie presenta un esquema multiplicativo, su logaritmo lo presentará aditivo. A lo largo del curso se verán otras razones por las que puede ser aconsejable analizar el logaritmo de una serie temporal.</p>
<p>En principio, cualquier combinación entre las componentes es posible:</p>
<ul>
<li><span class="math inline">\(y_t = (T_t + C_t) \cdot S_t + I_t + R_t\)</span></li>
<li><span class="math inline">\(y_t = (T_t + S_t + C_t + I_t)R_t\)</span></li>
<li><span class="math inline">\(y_t = T_t \cdot S_t \cdot C_t \cdot I_t + R_t\)</span></li>
<li>…</li>
</ul>
<p><br>
<br>
</p>
</section>
</section>
<section id="manipulación-de-una-serie" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Manipulación de una serie</h1>
<p><br>
</p>
<section id="idea-general" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="idea-general"><span class="header-section-number">4.1</span> Idea general</h2>
<p>Podemos <em>manipular</em> una serie temporal con diferentes fines:</p>
<ul>
<li><strong>extraer la tendencia</strong> (eliminando la estacionalidad), por ejemplo, pasando de una serie mensual a una anual, o de una serie diaria a una semanal.</li>
<li><strong>extraer la estacionalidad</strong> (eliminando la tendencia) de forma sencilla, aunque no muy precisa.</li>
<li><strong>recortar</strong> una serie para obtener una submuestra.</li>
<li><strong>extraer una subserie</strong> correspondiente a un único periodo estacional. Por ejemplo, los nacimientos en febrero o el consumo de electricidad de los domingos.</li>
</ul>
<p>Estas operaciones nos permitirán mejorar nuestra capacidad descriptiva de la serie, identificar mejor el tipo de esquema entre las componentes, facilitar la estimación del proceso generador o ampliar las herramientas de análisis y predicción de una serie temporal.</p>
<p><br>
</p>
</section>
<section id="extracción-de-la-tendencia" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="extracción-de-la-tendencia"><span class="header-section-number">4.2</span> Extracción de la tendencia</h2>
<p>Si tenemos una serie con estacionalidad y agregamos la serie –obteniendo un dato por año, si la serie es mensual, o un dato por semana, si es diaria– obtenemos una nueva serie sin estacionalidad, solo con <em>tendencia</em>.</p>
<p>Dependiendo de la naturaleza de la serie, convendrá agregar sumando los datos (consumo eléctrico, residuos generados, viajeros transportados, nacimientos) o sacando la media (temperatura, número de parados, ocupación hotelera).</p>
<p>Veamos como extraer la tendencia de la serie Nacimientos usando la función <code>aggregate</code> con el argumento <code>FUN = sum</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>nacimientosAnual <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(nacimientos, <span class="at">FUN =</span> sum)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(nacimientosAnual<span class="sc">/</span><span class="dv">1000</span>,</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"Nacimientos (miles)"</span>,</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-agregacionnacimientos" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-agregacionnacimientos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-01-Tema1_files/figure-html/fig-agregacionnacimientos-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-agregacionnacimientos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;16: Nacimientos por año
</figcaption>
</figure>
</div>
</div>
</div>
<p>Ahora para la demanda de electricidad.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>electricidadSemanal <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(electricidad, <span class="at">FUN =</span> sum)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(electricidadSemanal,</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">ylab =</span> <span class="st">"GWh"</span>,</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">main =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-agregacionelectricidad" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-agregacionelectricidad-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-01-Tema1_files/figure-html/fig-agregacionelectricidad-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-agregacionelectricidad-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;17: Consumo de electricidad por semana
</figcaption>
</figure>
</div>
</div>
</div>
<p>La función <code>aggregate</code> aplicada a una serie temporal agrega los datos de cada periodo estacional completo aplicando la función especificada en <code>FUN</code>.</p>
<ul>
<li>Una serie trimestral o mensual la transforma en anual, una serie diaria en semanal.</li>
<li>La función a usar dependerá de la naturaleza de los datos y del objetivo perseguido (<code>FUN=sum</code>, <code>FUN=mean</code>, <code>FUN=sd</code>…)</li>
<li>Esta función tiene un uso más amplio en <code>R</code>. Usa la función <code>help</code> para aprenderlo.</li>
</ul>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Atención
</div>
</div>
<div class="callout-body-container callout-body">
<p>La agregación no tiene por que empezar en el primera componente estacional. Por ejemplo, la serie Demanda eléctrica se inicia el domingo 1 de enero, así que el primer dato de la serie agregada irá del domingo 1 de enero al sábado 7 de enero, un periodo estacional completo; el segundo dato de la serie agregada ira del domingo 8 al sábado 14 de enero; y así sucesivamente. El último dato de la serie agregada será del domingo 24 al sábado 30 de diciembre. El 31 de diciembre no formará parte de la serie agregada.</p>
</div>
</div>
<p><br>
</p>
</section>
<section id="extracción-de-la-estacionalidad" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="extracción-de-la-estacionalidad"><span class="header-section-number">4.3</span> Extracción de la estacionalidad</h2>
<p>Tenemos varias alternativas gráficas para visualizar la estacionalidad y numéricas para calcular la estacionalidad de una serie.</p>
<p><strong>Visualización de la estacionalidad</strong></p>
<p>Podemos hacer una gráfico de la serie <em>contra</em> cada periodo estacional. Este gráfico permite identificar el patrón estacional de la serie y su evolución en el tiempo. Existen varias opciones para este tipo de gráficos, veremos dos de ellas: gráfico de subseries y gráfico de líneas.</p>
<p>Veamos primero un ejemplo de <em>gráfico de subseries</em> que muestra para cada periodo estacional la subserie de valores de ese periodo y el valor medio de la subserie (líneas horizontales).</p>
<p>Para la serie Nacimientos, recortada desde el año 2000 para facilitar la interpretación, la <a href="#fig-estacionalsubseriesnacimientos" class="quarto-xref">Figura&nbsp;18</a> muestra como el mes de febrero es el que presenta menor número de nacimientos. Por contra, los meses de 31 días presentan en media un número de nacimientos mayor que los meses de 30 días. La excepción es septiembre, un mes de 30 días pero donde el número de nacimientos supera el del mes de agosto de 31 días. Una explicación posible es que muchos nacimientos por cesárea que corresponderían a finales de agosto se programen en septiembre para <em>esquivar</em> este mes festivo.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>nacimientosb <span class="ot">&lt;-</span> <span class="fu">window</span>(nacimientos, <span class="at">start =</span> <span class="dv">2000</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsubseriesplot</span>(nacimientosb) <span class="sc">+</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Nacimientos"</span>) <span class="sc">+</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-estacionalsubseriesnacimientos" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-estacionalsubseriesnacimientos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-01-Tema1_files/figure-html/fig-estacionalsubseriesnacimientos-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-estacionalsubseriesnacimientos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;18: Gráfico estacional de subseries para Nacimientos
</figcaption>
</figure>
</div>
</div>
</div>
<p>Para las series con tendencia o esquema multiplicativo, el valor medio de las subseries puede llevarnos a una interpretación incorrecta de la estacionalidad. La función <code>monthplot</code> de <code>stats</code> realiza un gráfico similar.</p>
<p>Una alternativa es el <em>gráfico de líneas</em>, donde cada linea muestra la evolución de un periodo estacional. Para Nacimientos la <a href="#fig-estacionallineasnacimientos" class="quarto-xref">Figura&nbsp;19</a> muestra los nacimientos desde 2018 a 2023, donde cada año es una línea. Se observa perfectamente el efecto de la pandemia sobre el número de nacimientos desde noviembre de 2020. Si se incluye el argumento <code>polar=TRUE</code>, se obtiene una versión tipo <em>tela de araña</em> de este gráfico.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggseasonplot</span>(<span class="fu">window</span>(nacimientos, <span class="at">start =</span> <span class="dv">2018</span>),</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">year.labels =</span> <span class="cn">TRUE</span>, </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">ylab =</span> <span class="st">"Nacimientos"</span>,</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">main =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-estacionallineasnacimientos" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-estacionallineasnacimientos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-01-Tema1_files/figure-html/fig-estacionallineasnacimientos-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-estacionallineasnacimientos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;19: Gráfico estacional de lineas para Nacimientos
</figcaption>
</figure>
</div>
</div>
</div>
<p><strong>Cálculo de la componente estacionalidad</strong></p>
<p>Las gráficas ayudan a describir y entender un poco mejor el <em>patrón estacional</em>. Sin embargo, si deseamos estimar la <em>componente estacional</em>, debemos proceder de otra forma.</p>
<p>La siguiente sintaxis usa la función <code>tapply</code> para estimar numéricamente la componente estacional bajo un esquema multiplicativo. Básicamente, calcula para cada mes (argumento <code>cycle(nacimientosb)</code>) la media (<code>FUN = mean</code>) del cociente <code>nacimientosb / mean(nacimientosb)</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>componenteEstacional <span class="ot">&lt;-</span> <span class="fu">tapply</span>(nacimientosb<span class="sc">/</span><span class="fu">mean</span>(nacimientosb), </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">cycle</span>(nacimientosb), </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>                               <span class="at">FUN =</span> mean)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(componenteEstacional, <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   1    2    3    4    5    6    7    8    9   10   11   12 
1.00 0.91 1.00 0.96 1.01 0.97 1.03 1.03 1.04 1.05 1.00 1.00 </code></pre>
</div>
</div>
<p>Los valores de la tabla previa indican que en febrero nacen un 9% menos de bebés respecto de la media anual y que, en general, los meses de 30 días están en la media o debajo de la media general. Por contra, los meses de 31 días están en o encima de la media general, destacando julio un 3% por encima y octubre un 5%. La <em>anomalia</em> es septiembre que, siendo un mes de 30 días, tiene un 4% más de nacimientos de la media anual.</p>
<p>Los cambios necesarios para estimar la componente estacional bajo un esquema aditivo son mínimos. Veámoslo para la serie Demanda eléctrica.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>componenteEstacional <span class="ot">&lt;-</span> <span class="fu">tapply</span>(electricidad <span class="sc">-</span> <span class="fu">mean</span>(electricidad), </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">cycle</span>(electricidad), </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>                               <span class="at">FUN =</span> mean)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(componenteEstacional, <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     1      2      3      4      5      6      7 
 10.29  32.74  36.77  35.67  23.17 -47.56 -89.37 </code></pre>
</div>
</div>
<p>De lunes a viernes la demanda eléctrica está por encima de la media semanal, especialmente de martes a jueves con un consumo más de 30 GWh por encima de la media. El sábado la demanda cae 48 GWh y el domingo se da la menor demanda, 89 GWh por debajo de la media semanal.</p>
<p><br>
</p>
</section>
<section id="recorte-de-una-serie-y-extracción-de-una-subserie" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="recorte-de-una-serie-y-extracción-de-una-subserie"><span class="header-section-number">4.4</span> Recorte de una serie y extracción de una subserie</h2>
<p><code>R</code> proporciona varias funciones que permiten extraer una submuestra de la serie original. Podemos:</p>
<ul>
<li>seleccionar una submuestra especificando los puntos temporales de inicio y fin.</li>
<li>seleccionar una submuestra seleccionando un periodo estacional determinado.</li>
<li>quitar fácilmente un conjunto de datos usando índices.</li>
</ul>
<p>Veamos algunos ejemplos de extracción con la serie Nacimientos y las funciones <code>window</code> y <code>subset</code>:</p>
<p><strong>Función <code>window</code></strong>, que recorta especificando fechados exactos.</p>
<ul>
<li><code>window(nacimientos, start = c(2000, 1), end = c(2009, 12))</code> selecciona de la serie original los datos desde enero de 2000 a diciembre de 2009.</li>
<li><code>window(nacimientos, start = c(2010, 3))</code> selecciona de la serie original los datos desde marzo de 2010 hasta el último dato (diciembre de 2023).</li>
<li><code>window(nacimientos, end = c(1999, 12))</code> selecciona de la serie original los datos desde el primero (enero de 1975) hasta diciembre de 1999.</li>
<li><code>window(nacimientos, start = c(2000, 3), freq = TRUE)</code> selecciona de la serie original solo los meses de marzo desde 2000.</li>
</ul>
<p><strong>Función <code>subset</code></strong>, que recorta especificando posiciones de las observaciones.</p>
<ul>
<li><code>subset(nacimientos, start = 10, end = 34)</code> selecciona de la serie las observaciones que van desde la 10 a la 34, ambas inclusive.</li>
<li><code>subset(nacimientos, start = 121)</code> selecciona de la serie las observaciones que van desde la 121 hasta la última.</li>
<li><code>subset(nacimientos, start = length(nacimientos) - 47)</code> selecciona de la serie los últimos 4 años (2020 a 2023).</li>
<li><code>subset(nacimientos, end = length(nacimientos) - 48)</code> selecciona de la serie todo menos los últimos 4 años. Es decir, el último dato es diciembre de 2019.</li>
<li><code>subset(nacimientos, season  = 5)</code> selecciona de la serie todos los meses de mayo.</li>
</ul>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<code>window</code> y <code>subset</code>
</div>
</div>
<div class="callout-body-container callout-body">
<p>Durante el curso haremos un uso contante de la funciones <code>window</code> y <code>subset</code>. Practícalas para familiarizarte con su uso.</p>
</div>
</div>
<p>Además, puedes usar las funciones <code>head</code> y <code>tail</code> para extraer las primeras o las últimas observaciones.</p>
<p><br>
<br>
</p>
</section>
</section>
<section id="descomposición-de-una-serie" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Descomposición de una serie</h1>
<p><br>
</p>
<section id="concepto" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="concepto"><span class="header-section-number">5.1</span> Concepto</h2>
<p>Los métodos que hemos visto para la descripción de la tendencia y la componente estacional son muy sencillos, pero no son ni rigurosos ni precisos. Veamos métodos más adecuados para extraer de una serie sus componentes.</p>
<p>Si la serie es demasiado corta para poder extraer el ciclo, entonces el ciclo queda recogido dentro de la tendencia. Por otro lado, las técnicas de identificación de la intervención son complejas por lo que esta componente queda incorporada al residuo. Por tanto, <strong>asumiremos que una serie tiene sólo Tendencia, Estacionalidad y Residuo</strong>:</p>
<ul>
<li>Esquema aditivo <span class="math inline">\(y_t = T_t + C_t + S_t + I_t + R_t = (T_t + C_t) + S_t +(I_t + R_t) = T'_t + S_t + R'_t\)</span></li>
<li>Esquema multiplicativo <span class="math inline">\(y_t = T_t \cdot C_t \cdot S_t \cdot I_t \cdot R_t = (T_t \cdot C_t) \cdot S_t \cdot (I_t \cdot R_t) = T'_t \cdot S_t \cdot R'_t\)</span></li>
</ul>
<p>Veremos a continuación como extraer estas tres componentes a partir de una serie original. Este proceso se denomina descomposición.</p>
<p>Hay múltiples formas de realizar una descomposición. Aquí veremos dos de ellas, la más sencilla, basada en el concepto de medias móviles (<code>decompose</code>), y otra más versátil y compleja a partir de regresiones locales ponderadas (<code>stl</code>).</p>
<p>Además, <code>R</code> proporciona (a través de paquetes específicos) el método de descomposición que utiliza el <em>US Census Bureau and Statistics Canada</em>, denominado <strong>X11</strong>, y el método que utiliza el <em>Banco de España</em>, denominado <strong>SEATS</strong> (Seasonal Extraction in ARIMA Time Series), aunque estos métodos solo son válidos para series mensuales y trimestrales.</p>
<p>En origen, los métodos de descomposición no sirven para realizar predicciones, pero actualmente se usan también con este fin (véase las funciones <code>stlm</code> y <code>stlf</code> del paquete <code>forecast</code>).</p>
<p><br>
</p>
</section>
<section id="descomposición-por-medias-móviles" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="descomposición-por-medias-móviles"><span class="header-section-number">5.2</span> Descomposición por medias móviles</h2>
<section id="ideas-generales" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="ideas-generales">Ideas generales</h3>
<p>La función <code>decompose</code> estima las componentes de tendencia, estacionalidad y residuo usando el método de medias móviles. En concreto <code>decompose</code> sigue los siguientes pasos para obtener cada componente:</p>
<p><strong>Paso 1:</strong> Se estima la tendencia de una serie a partir de una media móvil centrada. Si el orden estacional es par, la media móvil es ponderada de orden <span class="math inline">\(m + 1\)</span>; y si el orden estacional es impar, la media móvil es de orden <span class="math inline">\(m\)</span>. En concreto,</p>
<ul>
<li>Si <span class="math inline">\(m=2k\)</span>: <span class="math inline">\(\hat{T}_t = \frac{\frac{1}{2}y_{t-k} + y_{t-k+1} + \ldots + y_t + \ldots + y_{t+k-1} + \frac{1}{2} y_{t+k}}{m}\)</span>,</li>
<li>Si <span class="math inline">\(m=2k+1\)</span>: <span class="math inline">\(\hat{T}_t = \frac{y_{t-k} + y_{t-k+1} + \ldots + y_t + \ldots + y_{t+k-1} + y_{t+k}}{m}\)</span>.</li>
</ul>
<p><strong>Paso 2:</strong> Para un modelo con esquema aditivo calculamos la serie sin tendencia como <span class="math inline">\(y_t - \hat{T}_t\)</span> y para un esquema multiplicativo como <span class="math inline">\(y_t/ \hat{T}_t\)</span>.</p>
<p><strong>Paso 3:</strong> Para estimar la componente estacional para cada periodo estacional, calculamos el valor medio de la serie sin tendencia (paso 2) de forma independiente para los datos de cada estación. Así, obtenemos un vector con la estimación de las <span class="math inline">\(m\)</span> componentes estacionales.</p>
<p>Después estos valores se ajustan para que sumen 0 (esquema aditivo) o para que sumen <span class="math inline">\(m\)</span> (esquema multiplicativo). La componente estacional se obtiene repitiendo el vector de <span class="math inline">\(m\)</span> componentes ajustadas hasta alcanzar la longitud de la serie original. Esto da <span class="math inline">\(\hat{S}_t\)</span></p>
<p><strong>Paso 4:</strong> El residuo se obtiene como <span class="math inline">\(\hat{R}_t = y_t - \hat{T}_t - \hat{S}_t\)</span> (esquema aditivo) o <span class="math inline">\(\hat{R}_t = y_t / (\hat{T}_t \cdot \hat{S}_t)\)</span> (esquema multiplicativo)</p>
<p>La <a href="#tbl-descomposicion" class="quarto-xref">Tabla&nbsp;1</a> muestra un ejemplo de descomposición aditiva por medias móviles para una serie simulada de orden estacional 5.</p>
<ul>
<li>La dos primeras columnas indican la estación de cada dato y el valor de la serie, para un total de 25 datos. La columna <em>Ten</em> ha sido obtenida siguiendo el paso 1 como una media móvil de orden 5: <span class="math display">\[Ten_t = (Serie_{t-2} + Serie_{t-1} + Serie_{t} + Serie_{t+1} + Serie_{t+2})/5.\]</span></li>
<li>La serie sin tendencia, columna <em>Est + Res</em>, se obtiene restando a la columna <em>Serie</em> la columna <em>Ten</em>, tal y como se indica en el paso 2.</li>
<li>Para el cálculo de la columna <em>Est</em>, que repite de forma periódica la primera estimación de las 5 componentes estacionales, se sigue el paso 3. Para cada estación se promedian los valores de la columna <em>Est + Res</em> correspondientes a dicha estación.</li>
<li>Puedes comprobar que la suma de los cinco valores de la componente estacional obtenidos en la columna <em>Est</em> vale 1.1. Para ajustar la componente estacional para que sume 0, a cada valor de la componente estacional se le resta su suma actual 1.1 dividida por 5, el número de estaciones. El resultado de este ajuste aparece en la columna <em>Est corregida</em> que será la componente estacional final.</li>
<li>Siguiendo el paso 4, la columna <em>Res</em> se calcula restando a la serie original (columna <em>Serie</em>) la tendencia y la estacionalidad (columnas <em>Ten</em> y <em>Est corregida</em>).</li>
</ul>
<p>Observa que en el proceso de descomposición se han perdido 4 datos para la tendencia y el residuo, dos al inicio de la serie y dos al final.</p>
<div class="cell" data-layout-align="center">
<div id="tbl-descomposicion" class="cell quarto-float anchored" data-layout-align="center">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-descomposicion-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabla&nbsp;1: Ejemplo de descomposición por medias móviles
</figcaption>
<div aria-describedby="tbl-descomposicion-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">Estacion</th>
<th style="text-align: right;">Serie</th>
<th style="text-align: right;">Ten</th>
<th style="text-align: right;">Est + Res</th>
<th style="text-align: right;">Est</th>
<th style="text-align: right;">Est corregida</th>
<th style="text-align: right;">Res</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">17.00</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">9.14</td>
<td style="text-align: right;">8.92</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">6.72</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">-10.89</td>
<td style="text-align: right;">-11.11</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">5.08</td>
<td style="text-align: right;">20.62</td>
<td style="text-align: right;">-15.54</td>
<td style="text-align: right;">-10.06</td>
<td style="text-align: right;">-10.28</td>
<td style="text-align: right;">-5.48</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">8.79</td>
<td style="text-align: right;">27.89</td>
<td style="text-align: right;">-19.10</td>
<td style="text-align: right;">-9.46</td>
<td style="text-align: right;">-9.68</td>
<td style="text-align: right;">-9.64</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: right;">65.53</td>
<td style="text-align: right;">28.00</td>
<td style="text-align: right;">37.53</td>
<td style="text-align: right;">22.37</td>
<td style="text-align: right;">22.15</td>
<td style="text-align: right;">15.16</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">53.31</td>
<td style="text-align: right;">28.58</td>
<td style="text-align: right;">24.73</td>
<td style="text-align: right;">9.14</td>
<td style="text-align: right;">8.92</td>
<td style="text-align: right;">15.59</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">7.28</td>
<td style="text-align: right;">29.79</td>
<td style="text-align: right;">-22.51</td>
<td style="text-align: right;">-10.89</td>
<td style="text-align: right;">-11.11</td>
<td style="text-align: right;">-11.62</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: right;">8.00</td>
<td style="text-align: right;">25.62</td>
<td style="text-align: right;">-17.62</td>
<td style="text-align: right;">-10.06</td>
<td style="text-align: right;">-10.28</td>
<td style="text-align: right;">-7.56</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: right;">14.84</td>
<td style="text-align: right;">19.13</td>
<td style="text-align: right;">-4.29</td>
<td style="text-align: right;">-9.46</td>
<td style="text-align: right;">-9.68</td>
<td style="text-align: right;">5.17</td>
</tr>
<tr class="even">
<td style="text-align: right;">5</td>
<td style="text-align: right;">44.67</td>
<td style="text-align: right;">20.08</td>
<td style="text-align: right;">24.59</td>
<td style="text-align: right;">22.37</td>
<td style="text-align: right;">22.15</td>
<td style="text-align: right;">2.22</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">20.85</td>
<td style="text-align: right;">21.78</td>
<td style="text-align: right;">-0.93</td>
<td style="text-align: right;">9.14</td>
<td style="text-align: right;">8.92</td>
<td style="text-align: right;">-10.07</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">12.02</td>
<td style="text-align: right;">21.64</td>
<td style="text-align: right;">-9.62</td>
<td style="text-align: right;">-10.89</td>
<td style="text-align: right;">-11.11</td>
<td style="text-align: right;">1.27</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">16.51</td>
<td style="text-align: right;">18.97</td>
<td style="text-align: right;">-2.46</td>
<td style="text-align: right;">-10.06</td>
<td style="text-align: right;">-10.28</td>
<td style="text-align: right;">7.60</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">14.14</td>
<td style="text-align: right;">22.07</td>
<td style="text-align: right;">-7.93</td>
<td style="text-align: right;">-9.46</td>
<td style="text-align: right;">-9.68</td>
<td style="text-align: right;">1.53</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: right;">31.31</td>
<td style="text-align: right;">23.08</td>
<td style="text-align: right;">8.23</td>
<td style="text-align: right;">22.37</td>
<td style="text-align: right;">22.15</td>
<td style="text-align: right;">-14.14</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">36.37</td>
<td style="text-align: right;">24.68</td>
<td style="text-align: right;">11.69</td>
<td style="text-align: right;">9.14</td>
<td style="text-align: right;">8.92</td>
<td style="text-align: right;">2.55</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">17.06</td>
<td style="text-align: right;">26.66</td>
<td style="text-align: right;">-9.60</td>
<td style="text-align: right;">-10.89</td>
<td style="text-align: right;">-11.11</td>
<td style="text-align: right;">1.29</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: right;">24.53</td>
<td style="text-align: right;">30.92</td>
<td style="text-align: right;">-6.39</td>
<td style="text-align: right;">-10.06</td>
<td style="text-align: right;">-10.28</td>
<td style="text-align: right;">3.67</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: right;">24.02</td>
<td style="text-align: right;">30.56</td>
<td style="text-align: right;">-6.54</td>
<td style="text-align: right;">-9.46</td>
<td style="text-align: right;">-9.68</td>
<td style="text-align: right;">2.92</td>
</tr>
<tr class="even">
<td style="text-align: right;">5</td>
<td style="text-align: right;">52.62</td>
<td style="text-align: right;">33.48</td>
<td style="text-align: right;">19.14</td>
<td style="text-align: right;">22.37</td>
<td style="text-align: right;">22.15</td>
<td style="text-align: right;">-3.23</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">34.59</td>
<td style="text-align: right;">33.51</td>
<td style="text-align: right;">1.08</td>
<td style="text-align: right;">9.14</td>
<td style="text-align: right;">8.92</td>
<td style="text-align: right;">-8.06</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">31.66</td>
<td style="text-align: right;">33.51</td>
<td style="text-align: right;">-1.85</td>
<td style="text-align: right;">-10.89</td>
<td style="text-align: right;">-11.11</td>
<td style="text-align: right;">9.04</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">24.65</td>
<td style="text-align: right;">32.95</td>
<td style="text-align: right;">-8.30</td>
<td style="text-align: right;">-10.06</td>
<td style="text-align: right;">-10.28</td>
<td style="text-align: right;">1.76</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">24.01</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">-9.46</td>
<td style="text-align: right;">-9.68</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: right;">49.86</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">22.37</td>
<td style="text-align: right;">22.15</td>
<td style="text-align: right;">NA</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p><br>
</p>
<p>Los principales <strong>inconvenientes de este método</strong> de descomposición son: i) se perderán datos al inicio y final de la serie –por ejemplo, si la serie es mensual se perderán seis datos al inicio y seis al final; ii) asume que la componente estacional no ha variado en el tiempo, cuando sabemos que para muchas series sociales y de consumo la componente estacional se ha suavizando con el tiempo; y iii) el cálculo de las componentes de tendencia y estacionalidad puede verse muy afectado por la presencia de datos muy anómalos.</p>
<p>Por el contrario, una de las <strong>ventajas de este método</strong>, además de su sencillez de cálculo, es que se puede usar tanto para esquemas aditivos (<code>type="addi"</code>) como multiplicativos (<code>type="multi"</code>).</p>
<p>La función <code>decompose</code> genera un objeto con las siguientes componentes:</p>
<ul>
<li><code>$x</code> para la serie original,</li>
<li><code>$trend</code> para la tendencia,</li>
<li><code>$seasonal</code> para la estacionalidad,</li>
<li><code>$random</code> para el residuo, y</li>
<li><code>$figure</code> que contiene las estimaciones de los <em>m</em> efectos estacionales ajustados. Es una extracción para un único año o semana de <code>$seasonal</code>.</li>
</ul>
<p>Siempre que generes nuevos objetos en <code>R</code> a partir de funciones te recomiendo que con <code>names</code> y <code>str</code> mires qué hay en su interior.</p>
<p>En los métodos de descomposición que vamos a ver, para extraer las componentes individualmente puedes usar la función <code>seasonal</code> para la componente estacional, <code>trendcycle</code> para el componente de tendencia, y <code>remainder</code> para el residuo.</p>
</section>
<section id="ejemplo-de-esquema-aditivo" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="ejemplo-de-esquema-aditivo">Ejemplo de esquema aditivo</h3>
<p>Vamos a descomponer la serie Demanda eléctrica asumiendo un esquema aditivo (<code>type = "addi</code>).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>eleDesAdi <span class="ot">&lt;-</span> <span class="fu">decompose</span>(electricidad, </span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">type =</span> <span class="st">"addi"</span>)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(eleDesAdi,</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-desadielec" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-desadielec-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-01-Tema1_files/figure-html/fig-desadielec-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-desadielec-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;20: Descomposición aditiva de la Demanda eléctrica por medias móviles
</figcaption>
</figure>
</div>
</div>
</div>
<p>La <a href="#fig-desadielec" class="quarto-xref">Figura&nbsp;20</a> muestra la serie original (panel superior) y sus tres componentes: tendencia (segundo panel), estacionalidad (tercer panel) y el residuo (panel inferior). Por tratarse de un esquema aditivo, la estacionalidad y el residuo se mueven en torno al valor de 0.</p>
<p>Es fácil verificar que si se suma para cada fecha la tendencia, la estacionalidad y el residuo se obtiene exactamente el valor de la serie:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> <span class="fu">trendcycle</span>(eleDesAdi) <span class="sc">+</span> <span class="fu">seasonal</span>(eleDesAdi) <span class="sc">+</span> <span class="fu">remainder</span>(eleDesAdi)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(electricidad <span class="sc">-</span> tmp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
      0       0       0       0       0       0       6 </code></pre>
</div>
</div>
<p>A continuación, tienes un ejemplo del manejo de las componentes extraídas para hacer una gráfica (véase la <a href="#fig-desadielec2" class="quarto-xref">Figura&nbsp;21</a>).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(electricidad, </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">series=</span><span class="st">"Demanda eléctrica"</span>,</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"MWh"</span>,</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(<span class="fu">trendcycle</span>(eleDesAdi), </span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">series=</span><span class="st">"Tendencia"</span>) <span class="sc">+</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">"Demanda eléctrica"</span><span class="ot">=</span><span class="st">"black"</span>,<span class="st">"Tendencia"</span><span class="ot">=</span><span class="st">"red"</span>),</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>                      <span class="at">breaks=</span><span class="fu">c</span>(<span class="st">"Demanda eléctrica"</span>,<span class="st">"Tendencia"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-desadielec2" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-desadielec2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-01-Tema1_files/figure-html/fig-desadielec2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-desadielec2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;21: Demanda eléctrica: serie y tendencia
</figcaption>
</figure>
</div>
</div>
</div>
<p>También podemos ver la componente estacional y verificar que suma 0. Ojo, como la serie empieza un domingo, el valor de la primera componente que se muestra es la del domingo y el valor de la última es la del sábado</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>eleDesAdi<span class="sc">$</span>figure</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -88.89633  10.71022  32.18633  36.60378  35.23633  22.42286 -48.26319</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(eleDesAdi<span class="sc">$</span>figure)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -8.881784e-15</code></pre>
</div>
</div>
<p>Por último, podemos realizar una gráfica de la componente estacional (véase la <a href="#fig-desadielec3" class="quarto-xref">Figura&nbsp;22</a>). Como la primera componente estacional es la del domingo, tenemos primero que ordenar las componentes. Esto es lo que hace la primera línea del siguiente código.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>compEstacional <span class="ot">&lt;-</span> eleDesAdi<span class="sc">$</span>figure[<span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">7</span>, <span class="dv">1</span>)]</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>, <span class="at">y =</span> compEstacional)) <span class="sc">+</span> </span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">colour =</span> <span class="st">"blue"</span>, <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"GWh"</span>) <span class="sc">+</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>, </span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Lunes"</span>, <span class="st">"Martes"</span>, <span class="st">"Miércoles"</span>, <span class="st">"Jueves"</span>, </span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Viernes"</span>, <span class="st">"Sábado"</span>, <span class="st">"Domingo"</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-desadielec3" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-desadielec3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-01-Tema1_files/figure-html/fig-desadielec3-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-desadielec3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;22: Componente estacional de Electricidad (esquema aditivo)
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="ejemplo-de-esquema-multiplicativo" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="ejemplo-de-esquema-multiplicativo">Ejemplo de Esquema Multiplicativo</h3>
<p>Veamos ahora la descomposición de Nacimientos bajo un esquema multiplicativo (<code>type = "mult"</code>).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>nacDesMul <span class="ot">&lt;-</span> <span class="fu">decompose</span>(nacimientos, </span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">type =</span> <span class="st">"mult"</span>)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(nacDesMul,</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-desmulnaci" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-desmulnaci-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-01-Tema1_files/figure-html/fig-desmulnaci-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-desmulnaci-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;23: Descomposición multiplicativa de Nacimientos por medias móviles
</figcaption>
</figure>
</div>
</div>
</div>
<p>Observa que por tratarse de un esquema multiplicativo en la <a href="#fig-desmulnaci" class="quarto-xref">Figura&nbsp;23</a> la componente estacional se mueve alrededor del valor 1 y debe interpretarse como una variación porcentual. Igualmente, el residuo también gira en torno al valor 1.</p>
<p>Los valores de la componente estacional se deben interpretar como variaciones porcentuales: en febrero nacen un 9.2% menos de niños y en octubre un 3.6% más, respecto de la media anual. Además, la suma de los valores de la componente estacional será 12.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>nacDesMul<span class="sc">$</span>figure</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 0.9960154 0.9083329 1.0061351 0.9806906 1.0299231 0.9824611 1.0372353
 [8] 1.0197587 1.0324610 1.0361829 0.9802669 0.9905370</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(nacDesMul<span class="sc">$</span>figure)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 12</code></pre>
</div>
</div>
<p><br>
</p>
</section>
</section>
<section id="descomposición-por-regresiones-locales-ponderadas" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="descomposición-por-regresiones-locales-ponderadas"><span class="header-section-number">5.3</span> Descomposición por regresiones locales ponderadas</h2>
<section id="ideas-generales-1" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="ideas-generales-1">Ideas generales</h3>
<p>La función <code>stl</code> estima las componentes de tendencia y estacionalidad a partir de regresiones locales ponderadas (técnica conocida como <em>loess</em>)</p>
<p>Sus <strong>ventajas</strong> son:</p>
<ul>
<li>No se perderán datos al inicio o al final de la serie.</li>
<li>Asume que tanto la tendencia como la estacionalidad pueden cambiar con el tiempo y posibilita controlar este cambio a partir de parámetros.</li>
<li>Es bastante robusta frente a valores atípicos.</li>
</ul>
<p>Su <strong>principal desventaja</strong> es que esta técnica de descomposición solo es válida para esquemas aditivos. Es posible obtener con <code>stl</code> una descomposición multiplicativa descomponiendo primero el logaritmo de la serie, para después calcular la exponencial de las componentes.</p>
<p>La función <code>stl</code> genera un objeto con la componente <code>$time.series</code> que contiene en columna tres series temporales: <em>seasonal</em>, <em>trend</em> y <em>remainder</em> (de nuevo usa <code>names</code> y <code>str</code> para aprender más).</p>
<p>Los dos parámetros principales que debes elegir cuando utilices <code>stl</code> son la ventana de tendencia (<code>t.window</code>) y la ventana estacional (<code>s.window</code>). Estos parámetros controlan la rapidez con la que pueden cambiar las componentes de tendencia y estacionalidad con el tiempo. Valores pequeños permiten cambios más rápidos, valores grandes implican que no hay cambios. Ambos parámetros deben ser números impares:</p>
<ul>
<li><code>t.window</code> es el número de observaciones consecutivas que se deben utilizar al estimar la tendencia. Consulta la ayuda para ver el valor por defecto.</li>
<li><code>s.window</code> está relacionado con el número observaciones que se deben utilizar al estimar cada valor de la componente estacional. No hay ningún valor por defecto para este parámetro. Establecerlo como <code>periodic</code> equivale a que la componente estacional sea periódica (es decir, idéntica a lo largo de los años). Si es un valor numérico, debe ser impar y mayor o igual a 7.</li>
</ul>
</section>
<section id="ejemplo" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="ejemplo">Ejemplo</h3>
<p>Veamos un ejemplo de su uso para la serie Demanda eléctrica (<a href="#fig-stladielec" class="quarto-xref">Figura&nbsp;24</a>). Se ha usado el valor por defecto para <code>t.window</code> y se ha indicado que la estacionalidad es constante en el tiempo (<code>s.window = "periodic"</code>). Además, se ha especificado que se tenga en cuenta la posible existencia de valores atípicos (<code>robust = TRUE</code>).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>eleStl <span class="ot">&lt;-</span> <span class="fu">stl</span>(electricidad, </span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">s.window =</span> <span class="st">"periodic"</span>,</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">robust =</span> <span class="cn">TRUE</span>)</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(eleStl<span class="sc">$</span>time.series, <span class="at">n =</span> <span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Time Series:
Start = c(1, 7) 
End = c(2, 6) 
Frequency = 7 
          seasonal    trend   remainder
1.857143 -91.43206 597.5375   -4.275429
2.000000  13.80810 610.2002   -6.288319
2.142857  32.33979 622.8630   17.517258
2.285714  35.70651 635.4299   13.673593
2.428571  35.28141 647.9968  -16.168242
2.571429  26.55179 658.5280 -109.769821
2.714286 -52.25554 669.0592    3.736320</code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(eleStl,</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-stladielec" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-stladielec-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-01-Tema1_files/figure-html/fig-stladielec-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-stladielec-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;24: Descomposición de Electricidad por regresiones locales ponderadas
</figcaption>
</figure>
</div>
</div>
</div>
<p>Podemos comprobar que los valores de la componente estacional suman cero.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">head</span>(<span class="fu">seasonal</span>(eleStl), <span class="dv">7</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -9.616439e-08</code></pre>
</div>
</div>
<p><br>
</p>
<p>Para Demanda eléctrica hemos obtenido tres estimaciones de la componente estacional: la primera obtenida con <code>tapply</code>, la segunda obtenida con <code>decompose</code> y la tercera con <code>stl</code>. Se puede observar que las tres estimaciones son muy similares, pero no coincidentes, y aunque los métodos de descomposición son preferibles a <code>tapply</code>, ninguna estimación es <em>a priori</em> mejor que otra.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># tapply</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">as.numeric</span>(componenteEstacional), <span class="dv">2</span>)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="co"># decompose</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">seasonal</span>(eleDesAdi)[<span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">7</span>, <span class="dv">1</span>)], <span class="dv">2</span>)</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="co"># stl</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">seasonal</span>(eleStl)[<span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">7</span>, <span class="dv">1</span>)], <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>              L     M     X     J     V      S      D
tapply    10.29 32.74 36.77 35.67 23.17 -47.56 -89.37
decompose 10.71 32.19 36.60 35.24 22.42 -48.26 -88.90
stl       13.81 32.34 35.71 35.28 26.55 -52.26 -91.43</code></pre>
</div>
</div>
<p><br>
</p>
<p>Si en lugar de <code>periodic</code>, fijamos el parámetro <code>s.window</code> a, por ejemplo, 11 (siempre un valor impar), estaremos permitiendo que la estacionalidad cambien en el tiempo. La <a href="#fig-stladielec2" class="quarto-xref">Figura&nbsp;25</a> muestra la componente estacional estimada previamente (bajo el supuesto de componente estacional constante) y la que se obtiene con el argumento <code>s.window = 11</code>. Para el periodo mostrado se observa que la componente estacional ha variando con el tiempo. Cuanto mayor es el valor (impar) de <code>s.window</code> más constante en el tiempo es la componente estacional.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-stladielec2" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-stladielec2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-01-Tema1_files/figure-html/fig-stladielec2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-stladielec2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;25: Componente estacional para Demanda eléctrica
</figcaption>
</figure>
</div>
</div>
</div>
<p><br>
<br>
</p>
</section>
</section>
</section>
<section id="resumen-de-los-paquetes-y-funciones-utilizadas" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Resumen de los paquetes y funciones utilizadas</h1>
<table class="caption-top table">
<colgroup>
<col style="width: 26%">
<col style="width: 26%">
<col style="width: 47%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Función</th>
<th style="text-align: left;">Paquete</th>
<th style="text-align: left;">Descripción</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">read.csv/read.csv2</td>
<td style="text-align: left;">utils</td>
<td style="text-align: left;">Importa un fichero como base de datos, donde las observaciones son las filas y las variables son las columnas</td>
</tr>
<tr class="even">
<td style="text-align: left;">subset</td>
<td style="text-align: left;">base</td>
<td style="text-align: left;">extrae un subconjunto de datos posibilitando el uso de índices</td>
</tr>
<tr class="odd">
<td style="text-align: left;">aggregate</td>
<td style="text-align: left;">stats</td>
<td style="text-align: left;">crea una serie agregada</td>
</tr>
<tr class="even">
<td style="text-align: left;">cycle</td>
<td style="text-align: left;">stats</td>
<td style="text-align: left;">devuelve la estación de cada valor de la serie</td>
</tr>
<tr class="odd">
<td style="text-align: left;">decompose</td>
<td style="text-align: left;">stats</td>
<td style="text-align: left;">descompone la serie usando medias móviles</td>
</tr>
<tr class="even">
<td style="text-align: left;">end</td>
<td style="text-align: left;">stats</td>
<td style="text-align: left;">da el fechado del último dato</td>
</tr>
<tr class="odd">
<td style="text-align: left;">frequency</td>
<td style="text-align: left;">stats</td>
<td style="text-align: left;">da la frecuencia de los datos</td>
</tr>
<tr class="even">
<td style="text-align: left;">start</td>
<td style="text-align: left;">stats</td>
<td style="text-align: left;">da el fechado del primer dato</td>
</tr>
<tr class="odd">
<td style="text-align: left;">stl</td>
<td style="text-align: left;">stats</td>
<td style="text-align: left;">descompone la serie usando alisado por regresiones locales ponderadas</td>
</tr>
<tr class="even">
<td style="text-align: left;">time</td>
<td style="text-align: left;">stats</td>
<td style="text-align: left;">extrae el fechado de una serie temporal</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ts</td>
<td style="text-align: left;">stats</td>
<td style="text-align: left;">produce un objeto de clase serie temporal</td>
</tr>
<tr class="even">
<td style="text-align: left;">window</td>
<td style="text-align: left;">stats</td>
<td style="text-align: left;">extrae un subconjunto de datos de una serie temporal</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ggplot</td>
<td style="text-align: left;">ggplot2</td>
<td style="text-align: left;">genera una gráfica</td>
</tr>
<tr class="even">
<td style="text-align: left;">autolayer</td>
<td style="text-align: left;">forecast</td>
<td style="text-align: left;">añade una serie temporal a un gráfico ya creado</td>
</tr>
<tr class="odd">
<td style="text-align: left;">autoplot</td>
<td style="text-align: left;">forecast</td>
<td style="text-align: left;">dibuja gráficos de series temporales de forma sencilla</td>
</tr>
<tr class="even">
<td style="text-align: left;">ggsubseriesplot</td>
<td style="text-align: left;">forecast</td>
<td style="text-align: left;">dibuja un gráfico donde cada componente estacional es dibujada como una subserie separada</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ggseasonplot</td>
<td style="text-align: left;">forecast</td>
<td style="text-align: left;">dibuja un gráfico donde cada año (o equivalente) es dibujado como una serie separada contra el periodo estacional</td>
</tr>
<tr class="even">
<td style="text-align: left;">remainder</td>
<td style="text-align: left;">forecast</td>
<td style="text-align: left;">extrae error de una descomposición</td>
</tr>
<tr class="odd">
<td style="text-align: left;">seasonal</td>
<td style="text-align: left;">forecast</td>
<td style="text-align: left;">extrae la componente estaciona de una descomposición</td>
</tr>
<tr class="even">
<td style="text-align: left;">trendcycle</td>
<td style="text-align: left;">forecast</td>
<td style="text-align: left;">extrae la tendencia de una descomposición</td>
</tr>
</tbody>
</table>
<p>Todas las funciones gráficas del paquete <code>forecast</code> requieren tener instalada en R la librería <code>ggplot2</code>.</p>
<p><br>
<br>
<br>
<br>
</p>



</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-Courtillot21" class="csl-entry" role="listitem">
Courtillot, V., F. Lopes, and J. L. Le Mouël. 2021. <span>“On the Prediction of Solar Cycles.”</span> <em>Solar Physics</em> 296 (21). <a href="https://doi.org/10.1007/s11207-020-01760-7">https://doi.org/10.1007/s11207-020-01760-7</a>.
</div>
<div id="ref-metcalfe2009" class="csl-entry" role="listitem">
Metcalfe, Andrew V., and Paul S. P. Cowpertwait. 2009. <em>Introductory Time Series with r</em>. Springer New York. <a href="https://doi.org/10.1007/978-0-387-88698-5">https://doi.org/10.1007/978-0-387-88698-5</a>.
</div>
<div id="ref-Wilson96" class="csl-entry" role="listitem">
Wilson, J. H., and B. Keating. 1996. <em>Previsiones En Los Negocios</em>. Irwin, Madrid.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>© Copyright 2023, Iván Arribas. If you find any bugs please report them to <a href="mailto:ivan.arribas@uv.es">ivan.arribas@uv.es</a></p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>This page is built with <a href="https://quarto.org/">Quarto</a></p>
</div>
  </div>
</footer>




</body></html>