<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Iván Arribas (Depto. Análisis Económico. Universitat de València)">

<title>Series Temporales - Series Temporales: Alisado Exponencial</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Series Temporales</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Inicio</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="./01-Guia-curso.html"> 
<span class="menu-text">Guía del curso</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./02-Logistica.html"> 
<span class="menu-text">Logística</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-diapos" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Diapos</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-diapos">    
        <li class="dropdown-header">Teoría</li>
        <li>
    <a class="dropdown-item" href="./03-01-Tema1.html">
 <span class="dropdown-text">Tema 1: Definicion y Componentes</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-02-Tema2.html">
 <span class="dropdown-text">Tema 2: Alisado</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-03-Tema3.html">
 <span class="dropdown-text">Tema 3: Procesos estocásticos</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-04-Tema4.html">
 <span class="dropdown-text">Tema 4: ARIMA</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-05-Tema5.html">
 <span class="dropdown-text">Tema 5: SARIMA</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Ejemplo de aplicación</li>
        <li>
    <a class="dropdown-item" href="./03-06-Ejemplo1.html">
 <span class="dropdown-text">Ejemplo Tema 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-07-Ejemplo2.html">
 <span class="dropdown-text">Ejemplo Tema 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-08-Ejemplo3.html">
 <span class="dropdown-text">Ejemplo Tema 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-09-Ejemplo4.html">
 <span class="dropdown-text">Ejemplo Tema 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-10-Ejemplo5.html">
 <span class="dropdown-text">Ejemplo Tema 5</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Otro ejemplo</li>
        <li>
    <a class="dropdown-item" href="./03-11-Ejemplo-Pasajeros.html">
 <span class="dropdown-text">Ejemplo de Pasajeros</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-píldoras" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Píldoras</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-píldoras">    
        <li>
    <a class="dropdown-item" href="./04-01-Bootstrapping.html">
 <span class="dropdown-text">Bootstrapping para IC</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./04-02-Multiples_CS.html">
 <span class="dropdown-text">Múltiples componentes estacionales</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./04-03-Redes_neuronales.html">
 <span class="dropdown-text">Predicción con Redes Neuronales</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./04-04-Series_acotadas.html">
 <span class="dropdown-text">Series acotadas</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./04-05-Valores_perdidos_Outliers.html">
 <span class="dropdown-text">Valores perdidos y outliers</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./04-06-Covid_Nacimientos.html">
 <span class="dropdown-text">Efecto de la Covid-19 en Nacimientos</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./04-07-Combinando_predicciones.html">
 <span class="dropdown-text">Combinación de predicciones</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./04-08-Series_interrumpidas.html">
 <span class="dropdown-text">Series interrumpidas</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="./05-Recursos-R.html"> 
<span class="menu-text">Recursos de la asignatura</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./06-Practica.html"> 
<span class="menu-text">Practica</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-más" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Más</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-más">    
        <li class="dropdown-header">R</li>
        <li>
    <a class="dropdown-item" href="https://cran.r-project.org">
 <span class="dropdown-text">Dónde está R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://posit.co/downloads/">
 <span class="dropdown-text">Donde está RStudio</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Markdown</li>
        <li>
    <a class="dropdown-item" href="https://bookdown.org/yihui/rmarkdown/">
 <span class="dropdown-text">R Markdown</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://rmarkdown.rstudio.com/lesson-1.html">
 <span class="dropdown-text">R Markdown</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://quarto.org/docs/guide/">
 <span class="dropdown-text">Quatro</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Otros</li>
        <li>
    <a class="dropdown-item" href="https://www.r-bloggers.com">
 <span class="dropdown-text">Blog sobre R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://bookdown.org">
 <span class="dropdown-text">Libros online que debes conocer</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Índice</h2>
   
  <ul>
  <li><a href="#introducción" id="toc-introducción" class="nav-link active" data-scroll-target="#introducción"><span class="header-section-number">1</span> Introducción</a></li>
  <li><a href="#criterios-de-calidad" id="toc-criterios-de-calidad" class="nav-link" data-scroll-target="#criterios-de-calidad"><span class="header-section-number">2</span> Criterios de calidad</a>
  <ul class="collapse">
  <li><a href="#notación-y-definiciones" id="toc-notación-y-definiciones" class="nav-link" data-scroll-target="#notación-y-definiciones"><span class="header-section-number">2.1</span> Notación y definiciones</a>
  <ul class="collapse">
  <li><a href="#calidad-de-ajuste-o-de-previsión" id="toc-calidad-de-ajuste-o-de-previsión" class="nav-link" data-scroll-target="#calidad-de-ajuste-o-de-previsión">¿Calidad de ajuste o de previsión?</a></li>
  </ul></li>
  <li><a href="#criterios-de-calidad-1" id="toc-criterios-de-calidad-1" class="nav-link" data-scroll-target="#criterios-de-calidad-1"><span class="header-section-number">2.2</span> Criterios de calidad</a></li>
  </ul></li>
  <li><a href="#métodos-sencillos-de-predicción" id="toc-métodos-sencillos-de-predicción" class="nav-link" data-scroll-target="#métodos-sencillos-de-predicción"><span class="header-section-number">3</span> Métodos sencillos de predicción</a>
  <ul class="collapse">
  <li><a href="#métodos-sencillos-de-predicción-1" id="toc-métodos-sencillos-de-predicción-1" class="nav-link" data-scroll-target="#métodos-sencillos-de-predicción-1"><span class="header-section-number">3.1</span> Métodos sencillos de predicción</a>
  <ul class="collapse">
  <li><a href="#series-sin-tendencia-y-sin-estacionalidad" id="toc-series-sin-tendencia-y-sin-estacionalidad" class="nav-link" data-scroll-target="#series-sin-tendencia-y-sin-estacionalidad">Series <em>sin</em> tendencia y <em>sin</em> estacionalidad</a></li>
  <li><a href="#series-con-tendencia-y-sin-estacionalidad" id="toc-series-con-tendencia-y-sin-estacionalidad" class="nav-link" data-scroll-target="#series-con-tendencia-y-sin-estacionalidad">Series <em>con</em> tendencia y <em>sin</em> estacionalidad</a></li>
  <li><a href="#series-sin-tendencia-y-con-estacionalidad" id="toc-series-sin-tendencia-y-con-estacionalidad" class="nav-link" data-scroll-target="#series-sin-tendencia-y-con-estacionalidad">Series <em>sin</em> tendencia y <em>con</em> estacionalidad</a></li>
  </ul></li>
  <li><a href="#ejemplo-de-aplicación" id="toc-ejemplo-de-aplicación" class="nav-link" data-scroll-target="#ejemplo-de-aplicación"><span class="header-section-number">3.2</span> Ejemplo de aplicación</a>
  <ul class="collapse">
  <li><a href="#serie-residuos" id="toc-serie-residuos" class="nav-link" data-scroll-target="#serie-residuos">Serie Residuos</a></li>
  <li><a href="#serie-nacimientos" id="toc-serie-nacimientos" class="nav-link" data-scroll-target="#serie-nacimientos">Serie Nacimientos</a></li>
  <li><a href="#serie-demanda-eléctrica" id="toc-serie-demanda-eléctrica" class="nav-link" data-scroll-target="#serie-demanda-eléctrica">Serie Demanda eléctrica</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#evaluación-de-las-predicciones" id="toc-evaluación-de-las-predicciones" class="nav-link" data-scroll-target="#evaluación-de-las-predicciones"><span class="header-section-number">4</span> Evaluación de las predicciones</a>
  <ul class="collapse">
  <li><a href="#validación-por-conjunto-de-datos-de-entrenamiento-y-prueba" id="toc-validación-por-conjunto-de-datos-de-entrenamiento-y-prueba" class="nav-link" data-scroll-target="#validación-por-conjunto-de-datos-de-entrenamiento-y-prueba"><span class="header-section-number">4.1</span> Validación por conjunto de datos de entrenamiento y prueba</a>
  <ul class="collapse">
  <li><a href="#serie-residuos-1" id="toc-serie-residuos-1" class="nav-link" data-scroll-target="#serie-residuos-1">Serie Residuos</a></li>
  <li><a href="#serie-nacimientos-1" id="toc-serie-nacimientos-1" class="nav-link" data-scroll-target="#serie-nacimientos-1">Serie Nacimientos</a></li>
  <li><a href="#serie-demanda-eléctrica-1" id="toc-serie-demanda-eléctrica-1" class="nav-link" data-scroll-target="#serie-demanda-eléctrica-1">Serie Demanda eléctrica</a></li>
  </ul></li>
  <li><a href="#origen-de-predicción-móvil" id="toc-origen-de-predicción-móvil" class="nav-link" data-scroll-target="#origen-de-predicción-móvil"><span class="header-section-number">4.2</span> Origen de predicción móvil</a>
  <ul class="collapse">
  <li><a href="#ejemplo-de-aplicación-con-nacimientos" id="toc-ejemplo-de-aplicación-con-nacimientos" class="nav-link" data-scroll-target="#ejemplo-de-aplicación-con-nacimientos">Ejemplo de aplicación con Nacimientos</a></li>
  <li><a href="#ejemplo-de-aplicación-con-demanda-eléctrica" id="toc-ejemplo-de-aplicación-con-demanda-eléctrica" class="nav-link" data-scroll-target="#ejemplo-de-aplicación-con-demanda-eléctrica">Ejemplo de aplicación con Demanda eléctrica</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#métodos-de-alisado-exponencial" id="toc-métodos-de-alisado-exponencial" class="nav-link" data-scroll-target="#métodos-de-alisado-exponencial"><span class="header-section-number">5</span> Métodos de Alisado Exponencial</a>
  <ul class="collapse">
  <li><a href="#introducción-1" id="toc-introducción-1" class="nav-link" data-scroll-target="#introducción-1"><span class="header-section-number">5.1</span> Introducción</a></li>
  <li><a href="#componentes-de-una-serie-en-el-contexto-del-alisado-exponencial" id="toc-componentes-de-una-serie-en-el-contexto-del-alisado-exponencial" class="nav-link" data-scroll-target="#componentes-de-una-serie-en-el-contexto-del-alisado-exponencial"><span class="header-section-number">5.2</span> Componentes de una serie en el contexto del alisado exponencial</a></li>
  <li><a href="#casos-posibles" id="toc-casos-posibles" class="nav-link" data-scroll-target="#casos-posibles"><span class="header-section-number">5.3</span> Casos posibles</a>
  <ul class="collapse">
  <li><a href="#las-funciones-ets-y-forecast" id="toc-las-funciones-ets-y-forecast" class="nav-link" data-scroll-target="#las-funciones-ets-y-forecast">Las funciones <code>ets</code> y <code>forecast</code></a></li>
  </ul></li>
  <li><a href="#alisado-exponencial-simple-a-n-n" id="toc-alisado-exponencial-simple-a-n-n" class="nav-link" data-scroll-target="#alisado-exponencial-simple-a-n-n"><span class="header-section-number">5.4</span> Alisado exponencial simple (A, N, N)</a>
  <ul class="collapse">
  <li><a href="#definición" id="toc-definición" class="nav-link" data-scroll-target="#definición">Definición</a></li>
  <li><a href="#estimación-de-los-parámetros-del-modelo" id="toc-estimación-de-los-parámetros-del-modelo" class="nav-link" data-scroll-target="#estimación-de-los-parámetros-del-modelo">Estimación de los parámetros del modelo</a></li>
  <li><a href="#ejemplo-de-aplicacion-a-la-serie-consumo-de-alimentos-en-hogar" id="toc-ejemplo-de-aplicacion-a-la-serie-consumo-de-alimentos-en-hogar" class="nav-link" data-scroll-target="#ejemplo-de-aplicacion-a-la-serie-consumo-de-alimentos-en-hogar">Ejemplo de aplicacion a la serie consumo de alimentos en hogar</a></li>
  </ul></li>
  <li><a href="#alisado-exponencial-de-holt-a-a-n" id="toc-alisado-exponencial-de-holt-a-a-n" class="nav-link" data-scroll-target="#alisado-exponencial-de-holt-a-a-n"><span class="header-section-number">5.5</span> Alisado exponencial de Holt (A, A, N)</a>
  <ul class="collapse">
  <li><a href="#formulas-interactivas-de-sus-componentes" id="toc-formulas-interactivas-de-sus-componentes" class="nav-link" data-scroll-target="#formulas-interactivas-de-sus-componentes">Formulas interactivas de sus componentes</a></li>
  <li><a href="#estimación-de-los-parámetros-del-modelo-1" id="toc-estimación-de-los-parámetros-del-modelo-1" class="nav-link" data-scroll-target="#estimación-de-los-parámetros-del-modelo-1">Estimación de los parámetros del modelo</a></li>
  <li><a href="#ejemplo-de-aplicación-a-la-serie-residuos" id="toc-ejemplo-de-aplicación-a-la-serie-residuos" class="nav-link" data-scroll-target="#ejemplo-de-aplicación-a-la-serie-residuos">Ejemplo de aplicación a la serie Residuos</a></li>
  </ul></li>
  <li><a href="#alisado-exponencial-con-pendiente-amortiguada-a-ad-n" id="toc-alisado-exponencial-con-pendiente-amortiguada-a-ad-n" class="nav-link" data-scroll-target="#alisado-exponencial-con-pendiente-amortiguada-a-ad-n"><span class="header-section-number">5.6</span> Alisado exponencial con pendiente amortiguada (A, Ad, N)</a>
  <ul class="collapse">
  <li><a href="#formulas-interactivas-de-sus-componentes-1" id="toc-formulas-interactivas-de-sus-componentes-1" class="nav-link" data-scroll-target="#formulas-interactivas-de-sus-componentes-1">Formulas interactivas de sus componentes</a></li>
  <li><a href="#ejemplo-de-aplicación-a-la-serie-residuos-1" id="toc-ejemplo-de-aplicación-a-la-serie-residuos-1" class="nav-link" data-scroll-target="#ejemplo-de-aplicación-a-la-serie-residuos-1">Ejemplo de aplicación a la serie Residuos</a></li>
  </ul></li>
  <li><a href="#alisado-de-holt-winters-aditivo-a-a-a-y-multiplicativo-m-a-m" id="toc-alisado-de-holt-winters-aditivo-a-a-a-y-multiplicativo-m-a-m" class="nav-link" data-scroll-target="#alisado-de-holt-winters-aditivo-a-a-a-y-multiplicativo-m-a-m"><span class="header-section-number">5.7</span> Alisado de Holt-Winters aditivo (A, A, A) y multiplicativo (M, A, M)</a>
  <ul class="collapse">
  <li><a href="#alisado-de-holt-winters-aditivo-a-a-a" id="toc-alisado-de-holt-winters-aditivo-a-a-a" class="nav-link" data-scroll-target="#alisado-de-holt-winters-aditivo-a-a-a"><span class="header-section-number">5.7.1</span> Alisado de Holt-Winters aditivo (A, A, A)</a></li>
  <li><a href="#alisado-de-holt-winters-multiplicativo-m-a-m" id="toc-alisado-de-holt-winters-multiplicativo-m-a-m" class="nav-link" data-scroll-target="#alisado-de-holt-winters-multiplicativo-m-a-m"><span class="header-section-number">5.7.2</span> Alisado de Holt-Winters multiplicativo (M, A, M)</a></li>
  <li><a href="#ejemplo-con-demanda-electrica" id="toc-ejemplo-con-demanda-electrica" class="nav-link" data-scroll-target="#ejemplo-con-demanda-electrica">Ejemplo con Demanda electrica</a></li>
  <li><a href="#ejemplo-con-nacimientos" id="toc-ejemplo-con-nacimientos" class="nav-link" data-scroll-target="#ejemplo-con-nacimientos">Ejemplo con Nacimientos</a></li>
  </ul></li>
  <li><a href="#ejemplo-con-transformación-logarítmica" id="toc-ejemplo-con-transformación-logarítmica" class="nav-link" data-scroll-target="#ejemplo-con-transformación-logarítmica"><span class="header-section-number">5.8</span> Ejemplo con transformación logarítmica</a></li>
  <li><a href="#casos-generales-de-alisado-exponencial-la-función-ets-de-nuevo" id="toc-casos-generales-de-alisado-exponencial-la-función-ets-de-nuevo" class="nav-link" data-scroll-target="#casos-generales-de-alisado-exponencial-la-función-ets-de-nuevo"><span class="header-section-number">5.9</span> Casos generales de alisado exponencial: la función <code>ets</code> (de nuevo)</a>
  <ul class="collapse">
  <li><a href="#criterios-de-optimización" id="toc-criterios-de-optimización" class="nav-link" data-scroll-target="#criterios-de-optimización">Criterios de optimización</a></li>
  <li><a href="#criterios-de-selección-de-modelos" id="toc-criterios-de-selección-de-modelos" class="nav-link" data-scroll-target="#criterios-de-selección-de-modelos">Criterios de selección de modelos</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#ejemplos-de-aplicación" id="toc-ejemplos-de-aplicación" class="nav-link" data-scroll-target="#ejemplos-de-aplicación"><span class="header-section-number">6</span> Ejemplos de aplicación</a>
  <ul class="collapse">
  <li><a href="#recogida-de-residuos" id="toc-recogida-de-residuos" class="nav-link" data-scroll-target="#recogida-de-residuos"><span class="header-section-number">6.1</span> Recogida de residuos</a>
  <ul class="collapse">
  <li><a href="#identificación-y-estimación-del-mejor-modelo" id="toc-identificación-y-estimación-del-mejor-modelo" class="nav-link" data-scroll-target="#identificación-y-estimación-del-mejor-modelo">Identificación y estimación del mejor modelo</a></li>
  <li><a href="#predicción" id="toc-predicción" class="nav-link" data-scroll-target="#predicción">Predicción</a></li>
  <li><a href="#análisis-del-residuo" id="toc-análisis-del-residuo" class="nav-link" data-scroll-target="#análisis-del-residuo">Análisis del residuo</a></li>
  <li><a href="#validación-error-extramuestral-a-varios-periodos-vista" id="toc-validación-error-extramuestral-a-varios-periodos-vista" class="nav-link" data-scroll-target="#validación-error-extramuestral-a-varios-periodos-vista">Validación: error extramuestral a varios periodos vista</a></li>
  </ul></li>
  <li><a href="#nacimientos" id="toc-nacimientos" class="nav-link" data-scroll-target="#nacimientos"><span class="header-section-number">6.2</span> Nacimientos</a>
  <ul class="collapse">
  <li><a href="#identificación-y-estimación-del-mejor-modelo-1" id="toc-identificación-y-estimación-del-mejor-modelo-1" class="nav-link" data-scroll-target="#identificación-y-estimación-del-mejor-modelo-1">Identificación y estimación del mejor modelo</a></li>
  <li><a href="#predicción-1" id="toc-predicción-1" class="nav-link" data-scroll-target="#predicción-1">Predicción</a></li>
  <li><a href="#análisis-del-error" id="toc-análisis-del-error" class="nav-link" data-scroll-target="#análisis-del-error">Análisis del error</a></li>
  <li><a href="#validación-error-extramuestral-según-horizonte-temporal" id="toc-validación-error-extramuestral-según-horizonte-temporal" class="nav-link" data-scroll-target="#validación-error-extramuestral-según-horizonte-temporal">Validación: error extramuestral según horizonte temporal</a></li>
  </ul></li>
  <li><a href="#demanda-eléctrica" id="toc-demanda-eléctrica" class="nav-link" data-scroll-target="#demanda-eléctrica"><span class="header-section-number">6.3</span> Demanda eléctrica</a>
  <ul class="collapse">
  <li><a href="#identificación-y-estimación-del-mejor-modelo-2" id="toc-identificación-y-estimación-del-mejor-modelo-2" class="nav-link" data-scroll-target="#identificación-y-estimación-del-mejor-modelo-2">Identificación y estimación del mejor modelo</a></li>
  <li><a href="#predicción-2" id="toc-predicción-2" class="nav-link" data-scroll-target="#predicción-2">Predicción</a></li>
  <li><a href="#análisis-del-error-1" id="toc-análisis-del-error-1" class="nav-link" data-scroll-target="#análisis-del-error-1">Análisis del error</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#otras-alternativas-para-ajustar-un-modelo-y-predecir" id="toc-otras-alternativas-para-ajustar-un-modelo-y-predecir" class="nav-link" data-scroll-target="#otras-alternativas-para-ajustar-un-modelo-y-predecir"><span class="header-section-number">7</span> Otras alternativas para ajustar un modelo y predecir</a></li>
  <li><a href="#resumen-de-los-comandos-utilizados" id="toc-resumen-de-los-comandos-utilizados" class="nav-link" data-scroll-target="#resumen-de-los-comandos-utilizados"><span class="header-section-number">8</span> Resumen de los comandos utilizados</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Series Temporales: Alisado Exponencial</h1>
<p class="subtitle lead">Máster de Bioestadística (Modelización Estadística)</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Iván Arribas (Depto. Análisis Económico. Universitat de València) </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<p><br>
<br>
</p>
<section id="introducción" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introducción</h1>
<p>En muchos casos es preciso aplicar un método de predicción rápido y sencillo:</p>
<ul>
<li>A causa del elevado número de series que tienen que ser analizadas.</li>
<li>Debido a la rapidez con que las predicciones se han de dar.</li>
</ul>
<p>Actualmente existen muchos métodos sencillos de predicción, entre los que cabe destacar dos:</p>
<ul>
<li><strong>Métodos de media móvil</strong></li>
<li><strong>Métodos de alisado exponencial</strong></li>
</ul>
<p>Estas técnicas, a pesar de su sencillez, son bastante adecuadas cuando la previsión es a corto plazo:</p>
<blockquote class="blockquote">
<p>“Statistically sophisticated or complex methods do not necessarily produce more accurate forecasts than simpler ones.” <span class="citation" data-cites="Makridakis00">Makridakis and Hibon (<a href="#ref-Makridakis00" role="doc-biblioref">2000</a>)</span></p>
</blockquote>
<p>Pero hay métodos aún más sencillos que quedan englobados bajo el paraguas de <strong>métodos sencillos</strong> que también veremos en este tema.</p>
<p><br>
<br>
</p>
</section>
<section id="criterios-de-calidad" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Criterios de calidad</h1>
<p>Dado que en este tema, y en los siguientes, vamos a ver diferentes métodos para predecir una serie temporal, es preciso definir criterios que permitan estimar tanto su calidad del ajuste (bondad de ajuste) como la precisión de sus predicciones, para poder elegir el <em>mejor</em> modelo.</p>
<blockquote class="blockquote">
<p>“The rankings of the performance of the various methods vary according to the accuracy measure being used.” <span class="citation" data-cites="Makridakis00">Makridakis and Hibon (<a href="#ref-Makridakis00" role="doc-biblioref">2000</a>)</span></p>
</blockquote>
<p><br>
</p>
<section id="notación-y-definiciones" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="notación-y-definiciones"><span class="header-section-number">2.1</span> Notación y definiciones</h2>
<p>Dada una serie temporal <span class="math inline">\(\{y_t\}_{t=1}^T\)</span>, se define:</p>
<ul>
<li><p><strong>Previsión</strong> <span class="math inline">\(h\)</span> periodos adelante, como la previsión de la serie para el periodo <span class="math inline">\(t+h\)</span> disponiendo de información hasta el periodo <span class="math inline">\(t\)</span>, y se denota por <span class="math inline">\(\hat{y}_{t+h|t}\)</span>. Por simplicidad lo escribiremos también como <span class="math inline">\(\hat{y}_{t+h}\)</span>.</p></li>
<li><p>Así, <span class="math inline">\(\hat{y}_{t+1|t}\)</span> es la <strong>previsión un periodo adelante</strong> o a un periodo vista. Es decir, la previsión de la serie en el periodo <span class="math inline">\(t+1\)</span> desde el periodo <span class="math inline">\(t\)</span>.</p>
<p>Por simplicidad denotaremos a <span class="math inline">\(\hat{y}_{t+1|t}\)</span> como <span class="math inline">\(\hat{y}_{t+1}\)</span>. Por tanto, <span class="math inline">\(\hat{y}_{t}\)</span> será la previsión en <span class="math inline">\(t\)</span> con datos hasta el periodo <span class="math inline">\(t-1\)</span> (<span class="math inline">\(\hat{y}_{t} = \hat{y}_{t|t-1}\)</span>).</p></li>
</ul>
<p>Si para un periodo <span class="math inline">\(t\)</span> se tiene la observación <span class="math inline">\(y_t\)</span> y una previsión <span class="math inline">\(\hat{y}_t\)</span>, se define como <strong>error</strong> a un periodo vista a <span class="math display">\[\hat{e}_t=y_t-\hat{y}_t,\]</span> de forma que la serie <span class="math inline">\(\{\hat{e}_t\}_{t=1}^T\)</span> nos permitirá definir varios criterios de calidad.</p>
<section id="calidad-de-ajuste-o-de-previsión" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="calidad-de-ajuste-o-de-previsión">¿Calidad de ajuste o de previsión?</h3>
<p>Los mismos criterios que se van a definir a continuación pueden ser criterios de calidad de ajuste o de calidad de las previsiones. Esta diferencia depende de cómo se ha obtenido <span class="math inline">\(\hat{y}_t\)</span>.</p>
<p>Si en el proceso de predicción hay parámetros cuyo ajuste o estimación se ha realizado usando toda la serie temporal, entonces hablaremos de calidad de ajuste: para obtener <span class="math inline">\(\hat{y}_t\)</span> se habrá usado el dato <span class="math inline">\(y_t\)</span> y los siguientes, es decir, datos posteriores al periodo <span class="math inline">\(t\)</span> y entonces <span class="math inline">\(\hat{e}_t\)</span> es un error de ajuste.</p>
<p>Por el contrario, si en el proceso de predicción no hay parámetros o habiéndolos su estimación se ha realizado usando la serie temporal hasta el periodo <span class="math inline">\(t-1\)</span>, entonces hablaremos de calidad de predicción: para obtener <span class="math inline">\(\hat{y}_t\)</span> solo se habrán usado datos hasta <span class="math inline">\(y_{t-1}\)</span>, es decir, datos anteriores al periodo <span class="math inline">\(t\)</span>, y entonces <span class="math inline">\(\hat{e}_t\)</span> es un error de predicción.</p>
<p>A veces al <em>error de ajuste</em> se le denomina <em>error de previsión intramuestral</em> y hablaremos de criterios de <em>calidad intramuestral</em>. De la misma forma al <em>error de previsión</em> se le denomina <em>error de previsión extramuestral</em> y hablaremos de criterios de <em>calidad extramuestral</em> o <em>precisión</em> de las predicciones.</p>
<p><br>
</p>
</section>
</section>
<section id="criterios-de-calidad-1" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="criterios-de-calidad-1"><span class="header-section-number">2.2</span> Criterios de calidad</h2>
<p>Dada una serie <span class="math inline">\(\{y_t\}_{t=1}^T\)</span>, un método de predicción y su vector de errores asociado <span class="math inline">\(\{\hat{e}_t\}_{t=1}^T\)</span>, podemos definir múltiples criterios de calidad de ajuste o predicción del método que hacen referencia a la presencia de sesgo en las predicciones, la magnitud del error cometido y la calidad del intervalo de confianza de las predicciones. Las más habituales son (siglas en inglés):</p>
<ul>
<li>Error medio (ME): <span class="math inline">\(\frac{1}{T}\sum_{t=1}^T \hat{e}_t\)</span></li>
</ul>
<ul>
<li>Raíz del error cuadrático medio (RMSE): <span class="math inline">\(\sqrt{\frac{1}{T}\sum_{t=1}^T \hat{e}^2_t}\)</span></li>
</ul>
<ul>
<li>Error absoluto medio (MAE): <span class="math inline">\(\frac{1}{T}\sum_{t=1}^T |\hat{e}_t|\)</span></li>
</ul>
<ul>
<li>Error porcentual medio (MPE): <span class="math inline">\(\frac{100}{T}\sum_{t=1}^T \frac{\hat{e}_t}{y_t}\)</span></li>
</ul>
<ul>
<li>Error porcentual absoluto medio (MAPE): <span class="math inline">\(\frac{100}{T}\sum_{t=1}^T \big|\frac{\hat{e}_t}{y_t}\big|\)</span></li>
</ul>
<ul>
<li>Error escalado absoluto medio (MASE): <span class="math inline">\(\big(\frac{1}{T}\sum_{t=1}^T |\hat{e}_t|\big)/q\)</span>, donde <span class="math inline">\(q\)</span> es el error absoluto medio para un método ingenuo de predicción: el método ingenuo I para series sin estacionalidad y el método ingenuo con estacionalidad para series con estacionalidad.</li>
</ul>
<ul>
<li>Correlación entre <span class="math inline">\(\hat{e}_t\)</span> y <span class="math inline">\(\hat{e}_{t-1}\)</span> (ACF1).</li>
</ul>
<p><br>
</p>
<p>ME y MPE permiten valorar el sesgo de las predicciones (que estén sistemáticamente por encima o por debajo de los valores reales).</p>
<ul>
<li>Lo esperado es un valor cercano a cero (en el caso de ME con relación al valor medio de la serie). Valores muy alejados de cero son indicadores de sesgo de predicción.</li>
<li>La más cómoda de interpretar es MPE. Asumiremos que si MPE es menor que 1% en valor absoluto, no hay sesgo.</li>
</ul>
<p>RMSE y MAE son medidas de calidad de ajuste/precisión. Indican el error medio cometido, independientemente del signo, medido en las mismas unidades que la serie temporal.</p>
<ul>
<li>Están acotadas inferiormente por el valor óptimo de 0, pero no hay cota superior.</li>
</ul>
<p>MAPE es una medida de calidad de ajuste/precisión alternativa que indica el error porcentual medio cometido.</p>
<ul>
<li>Está acotado inferiormente por el valor óptimo de 0%, y la cota superior natural es 100%, aunque podría sobrepasarse.</li>
<li>Si <span class="math inline">\(y_t\)</span> puede valer 0, entonces MAPE no se puede calcular. Además, MAPE penaliza más los errores negativos frente a los errores positivos. Se puede definir el error porcentual absoluto medio simétrico (sMAPE) <span class="math inline">\(\frac{200}{T}\sum_{t=1}^T \Big|\frac{\hat{e}_t}{y_t + \hat{y}_t}\Big|\)</span> a fin de corregir estos problemas.</li>
</ul>
<p>MASE es la ratio entre el MAE del método usado y el MAE de un método ingenuo de predicción. Permite saber cuánto ganamos en calidad de ajuste/predicción al pasar de un método ingenuo a otro más complicado.</p>
<ul>
<li>Un valor cercano a 1 indica que el método usado no es mejor que el método ingenuo</li>
<li>Cuanto más cercano a 0, mejor es el método usado respecto del método ingenuo</li>
<li>Su complementario a 1 se puede interpretar como la tasa de mejora</li>
</ul>
<p>ACF1 permite saber si el método empleado ha extraído toda la información disponible en los datos de la serie para hacer las predicciones. Si no es así, la fórmula usada para estimar el intervalo de confianza de las predicciones no será válida:</p>
<ul>
<li>Un valor muy cercano a 0 (menor que 0.1 en valor absoluto) indica que se ha extraído toda la información y la fórmula usada para estimar el intervalo de confianza de las predicciones es válida.</li>
<li>Valores minimamente alejados de 0 indican que la fórmula no es válida.</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Cálculo del intervalo de confianza de las predicciones
</div>
</div>
<div class="callout-body-container callout-body">
<p>Ve a la Píldora <em>Bootstrapping para intervalos de predicción</em> para saber más sobre las fórmulas usadas para estimar el intervalo de confianza de las predicciones y alternativas de cálculo cuando estas fórmulas no son válidas.</p>
</div>
</div>
<p><br>
</p>
<p><strong>En todas las fórmulas de criterios de calidad las <em>medias</em> se pueden sustituir por <em>medianas</em>.</strong> Esto es especialmente útil cuando hay observaciones atípicas que generan errores muy altos.</p>
<p>Los indicadores de calidad de ajuste que se basan en predicciones intramuestrales a un periodo vista, presentan dos problemas. Primero, evalúan el error a un periodo vista, cuando en muchas situaciones reales las predicciones se realizan sobre un horizonte temporal más amplio. Segundo, son errores intramuestrales, resultantes de predecir los mismos datos que ha usado el método para calcular la predicción y, por tanto, sobrestiman la capacidad predictiva del modelo.</p>
<p>Veremos en el epígrafe 4 de este tema métodos de evaluación de la precisión de las predicciones que superan estas limitaciones.</p>
<p><br>
<br>
</p>
</section>
</section>
<section id="métodos-sencillos-de-predicción" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Métodos sencillos de predicción</h1>
<p>Algunos métodos de predicción son extremadamente sencillos y sorprendentemente eficaces. A veces son denominados métodos ingenuos. Estos métodos:</p>
<ul>
<li>posibilitan realizar predicciones prácticamente sin realizar ningún cálculo.</li>
<li>como son muy sencillos, dan las previsiones con mayor error (menos precisas). El error de un método sencillo sirve de punto de referencia (<em>benchmark</em>) para valorar la necesidad de aplicar otros métodos más complicados con el objetivo de mejorar la calidad de las predicciones.</li>
</ul>
<p>Veamos algunos métodos sencillos y sus funciones en el paquete <code>forecast</code>.</p>
<p><br>
</p>
<section id="métodos-sencillos-de-predicción-1" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="métodos-sencillos-de-predicción-1"><span class="header-section-number">3.1</span> Métodos sencillos de predicción</h2>
<section id="series-sin-tendencia-y-sin-estacionalidad" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="series-sin-tendencia-y-sin-estacionalidad">Series <em>sin</em> tendencia y <em>sin</em> estacionalidad</h3>
<p><strong>Método de la Media</strong>: <span class="math inline">\(\hat{y}_{T+h}=(y_1+\ldots,y_T)/T\)</span>.</p>
<ul>
<li>La predicción para cualquier periodo futuro es la <strong>media</strong> de las observaciones disponibles previas.</li>
<li>Función de <code>R</code>: <code>meanf(y, h)</code></li>
</ul>
<p><strong>Método ingenuo I</strong>: <span class="math inline">\(\hat{y}_{T+h}=y_T\)</span>.</p>
<ul>
<li>La predicción para cualquier periodo futuro es la <strong>última</strong> observación disponible.</li>
<li>Función de <code>R</code>: <code>naive(y, h)</code> o <code>rwf(y, h)</code> (<em>rw</em> de random walk)</li>
<li>Para series sin estacionalidad este es el método ingenuo de comparación del MASE.</li>
</ul>
</section>
<section id="series-con-tendencia-y-sin-estacionalidad" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="series-con-tendencia-y-sin-estacionalidad">Series <em>con</em> tendencia y <em>sin</em> estacionalidad</h3>
<p><strong>Método ingenuo II</strong>: <span class="math inline">\(\hat{y}_{T+h}=y_T + h(y_T-y_{T-1})\)</span>.</p>
<ul>
<li>La predicción <span class="math inline">\(h\)</span> periodos adelante es la <strong>última observación</strong> disponible más <span class="math inline">\(h\)</span> veces el <strong>último incremento</strong> observado.</li>
<li>No tiene función en <code>R</code>, pero se podría emular mediante la función <code>ets</code> (véase epígrafe de 5.5, Alisado exponencial de Holt).</li>
</ul>
<p><strong>Método de la deriva</strong>: <span class="math inline">\(\hat{y}_{T+h}=y_T+h\frac{y_T - y_1}{T-1}\)</span>.</p>
<ul>
<li>La predicción <span class="math inline">\(h\)</span> periodos adelante es la <strong>última observación</strong> disponible más <span class="math inline">\(h\)</span> veces el <strong>incremento medio</strong> observado.</li>
<li>Función de <code>R</code>: <code>rwf(y, h, drift = TRUE)</code></li>
</ul>
</section>
<section id="series-sin-tendencia-y-con-estacionalidad" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="series-sin-tendencia-y-con-estacionalidad">Series <em>sin</em> tendencia y <em>con</em> estacionalidad</h3>
<p><strong>Método ingenuo con estacionalidad</strong>: <span class="math inline">\(\hat{y}_{T+h}=y_{T-m(k+1)}\)</span>.</p>
<ul>
<li><p>La predicción para un periodo es la <strong>última observación disponible de la misma estación que la fecha que se desea predecir</strong>.</p></li>
<li><p><span class="math inline">\(k\)</span> es la parte entera de <span class="math inline">\((h-1)/m\)</span>, es decir, el número de estaciones completas en el periodo de predicción previo al periodo <span class="math inline">\(T+h\)</span>.</p></li>
<li><p>Función de <code>R</code>: <code>snaive(y, h)</code></p></li>
<li><p>Para series con estacionalidad este es el método ingenuo de comparación del MASE</p></li>
</ul>
<p><strong>No hay métodos sencillos cuando la serie tiene tendencia y estacionalidad</strong>, así que se suele usar el método ingenuo con estacionalidad.</p>
<p><br>
</p>
</section>
</section>
<section id="ejemplo-de-aplicación" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="ejemplo-de-aplicación"><span class="header-section-number">3.2</span> Ejemplo de aplicación</h2>
<section id="serie-residuos" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="serie-residuos">Serie Residuos</h3>
<p>Analizaremos Residuos, una serie anual de 1995 a 2023 (fuente <a href="https://www.ine.es">Instituto Nacional de Estadística</a>) que muestra los residuos recogidos por o en nombre de las autoridades municipales y eliminados a través del sistema de gestión de residuos. La <a href="#fig-Residuos" class="quarto-xref">Figura&nbsp;1</a> muestra que es una serie con tendencia que ha cambiado con el tiempo.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>residuos <span class="ot">&lt;-</span> <span class="fu">read.csv2</span>(<span class="st">"./series/Residuos.csv"</span>, </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>residuos <span class="ot">&lt;-</span> <span class="fu">ts</span>(residuos[, <span class="dv">2</span>],</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">start =</span> <span class="dv">1995</span>, </span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">frequency  =</span> <span class="dv">1</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(residuos,</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>,</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"Kg per cápita"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-Residuos" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-Residuos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-02-Tema2_files/figure-html/fig-Residuos-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-Residuos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;1: Residuos per cápita recogidos
</figcaption>
</figure>
</div>
</div>
</div>
<p>Las siguientes salidas muestran el resultado de la aplicación de los métodos sencillos a la serie. Se ha fijado un horizonte de previsión de cinco años (<code>h = 5</code>). Los dos primeros métodos realizan una predicción constante, el método de la media da la media de la recogida de residuos per cápita en el periodo de análisis (530.52) y el Ingenuo I da el último dato observado (465). El método de la deriva da una previsión que decrece de año en año un valor igual a <span class="math inline">\((y_T - y_1)/(T-1)\)</span>, que en este caso vale <span class="math inline">\(-1.43\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>(mediaResiduos <span class="ot">&lt;-</span> <span class="fu">meanf</span>(residuos, <span class="at">h =</span> <span class="dv">5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Point Forecast   Lo 80    Hi 80    Lo 95    Hi 95
2024       530.5172 439.883 621.1514 389.0681 671.9663
2025       530.5172 439.883 621.1514 389.0681 671.9663
2026       530.5172 439.883 621.1514 389.0681 671.9663
2027       530.5172 439.883 621.1514 389.0681 671.9663
2028       530.5172 439.883 621.1514 389.0681 671.9663</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>(naiveResiduos <span class="ot">&lt;-</span> <span class="fu">naive</span>(residuos, <span class="at">h =</span> <span class="dv">5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Point Forecast    Lo 80    Hi 80    Lo 95    Hi 95
2024            465 437.9526 492.0474 423.6346 506.3654
2025            465 426.7492 503.2508 406.5005 523.4995
2026            465 418.1526 511.8474 393.3530 536.6470
2027            465 410.9053 519.0947 382.2692 547.7308
2028            465 404.5202 525.4798 372.5042 557.4958</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>(derivaResiduos <span class="ot">&lt;-</span> <span class="fu">rwf</span>(residuos, <span class="at">drift =</span> <span class="cn">TRUE</span> , <span class="at">h =</span> <span class="dv">5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Point Forecast    Lo 80    Hi 80    Lo 95    Hi 95
2024       463.5714 435.6045 491.5384 420.7997 506.3432
2025       462.1429 421.9155 502.3702 400.6204 523.6653
2026       460.7143 410.6316 510.7970 384.1194 537.3091
2027       459.2857 400.5299 518.0416 369.4264 549.1450
2028       457.8571 391.1476 524.5667 355.8337 559.8806</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>derivaResiduos<span class="sc">$</span>model<span class="sc">$</span>par<span class="sc">$</span>drift <span class="co"># Permite ver la pendiente del modelo.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -1.428571</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">#summary(derivaResiduos) Con summary se puede obtener una salida más completa</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>La <a href="#fig-residuossencillos" class="quarto-xref">Figura&nbsp;2</a> muestra el resultado gráfico de la aplicación de estos métodos. El argumento <code>PI = FALSE</code> hace que no se impriman los intervalos de confianza de las predicciones.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(residuos, </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">series =</span> <span class="st">"Residuos"</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"Kg per cápita"</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(mediaResiduos, <span class="at">series=</span><span class="st">"Media"</span>, <span class="at">PI =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(naiveResiduos, <span class="at">series=</span><span class="st">"Ingenuo"</span>, <span class="at">PI =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(derivaResiduos, <span class="at">series=</span><span class="st">"Deriva"</span>, <span class="at">PI =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_discrete</span>(<span class="at">limits=</span><span class="fu">c</span>(<span class="st">"Residuos"</span>, <span class="st">"Media"</span>, </span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"Ingenuo"</span>, <span class="st">"Deriva"</span>)) <span class="sc">+</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">colour=</span><span class="st">"Métodos"</span>) <span class="sc">+</span> </span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position.inside =</span><span class="fu">c</span>(<span class="fl">0.2</span>,<span class="fl">0.3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-residuossencillos" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-residuossencillos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-02-Tema2_files/figure-html/fig-residuossencillos-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-residuossencillos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;2: Recogida de residuos y predicción por métodos sencillos
</figcaption>
</figure>
</div>
</div>
</div>
<p>Con la función <code>accuracy</code> se puede obtener el error de ajuste a un periodo vista de cada método:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(mediaResiduos)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(naiveResiduos)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(derivaResiduos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>             ME  RMSE   MAE   MPE  MAPE MASE ACF1
Media      0.00 66.71 59.12 -1.53 11.11 3.68 0.93
Ingenuo I -1.43 21.11 16.07 -0.37  2.96 1.00 0.43
Deriva     0.00 21.06 16.00 -0.09  2.94 1.00 0.43</code></pre>
</div>
</div>
<p>Podemos destacar que:</p>
<ul>
<li>El método de la <em>deriva</em> presenta la mejor calidad de ajuste con un error de 21.06 kg per cápita (RMSE) o del 2.94% (MAPE). El método <em>Ingenuo I</em> tienen una calidad de ajuste casi igual, con un error medio de 21.11 kg per cápita (RMSE) y un error porcentual del 2.96% (MAPE).</li>
<li>Si se usa como criterio de calidad de ajuste el error absoluto medio (MAE), vuelve a ser mejor el método de la <em>deriva</em>.</li>
<li>Ningún método genera predicciones por intervalo fiables (ACF1 &gt; 0.1).</li>
<li>Los métodos <em>Ingenuo I</em> y de la <em>Deriva</em> no presentan sesgo (|MPE| &lt; 1%), pero si lo hace el de la <em>Media</em>. Además, el error medio (ME) siempre será nulo para el método de la <em>Media</em> y de la <em>Deriva</em>, lo que indica que en término medio nos equivocamos lo mismo por exceso como por defecto. Esta es una buena propiedad, que el método <em>Ingenuo I</em> no verifica.</li>
<li>Para series sin estacionalidad el método sencillo de comparación usado en el cálculo del MASE es el <em>Ingenuo I</em>. Es por ello que este indicador vale 1 para este método. Como el método de <em>Media</em> tiene un MAE superior al <em>Ingenuo I</em>, su MASE es mayor que 1. En concreto, MASE = 3.68 = 59.12 / 16.07.</li>
</ul>
<p>Concluimos que, con independencia del criterio usado, los métodos que mejor ajustan los datos son el el <em>Ingenuo I</em> y el de la <em>Deriva</em>.</p>
</section>
<section id="serie-nacimientos" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="serie-nacimientos">Serie Nacimientos</h3>
<p>Podemos usar el método ingenuo con estacionalidad con la serie Nacimientos para obtener una previsión a dos años vista.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>nacimientos <span class="ot">&lt;-</span> <span class="fu">read.csv2</span>(<span class="st">"./series/Nacimientos.csv"</span>, </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>nacimientos <span class="ot">&lt;-</span> <span class="fu">ts</span>(nacimientos[, <span class="dv">2</span>],</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1975</span>, <span class="dv">1</span>),</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">frequency =</span> <span class="dv">12</span>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>(snaive.nacimientos <span class="ot">&lt;-</span> <span class="fu">snaive</span>(nacimientos, </span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>                              <span class="at">h =</span> <span class="dv">24</span>, </span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>                              <span class="at">level =</span> <span class="dv">95</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         Point Forecast    Lo 95    Hi 95
Jul 2025          27439 24075.46 30802.54
Aug 2025          27644 24280.46 31007.54
Sep 2025          27196 23832.46 30559.54
Oct 2025          28348 24984.46 31711.54
Nov 2025          26767 23403.46 30130.54
Dec 2025          26665 23301.46 30028.54
Jan 2026          26792 23428.46 30155.54
Feb 2026          24288 20924.46 27651.54
Mar 2026          26338 22974.46 29701.54
Apr 2026          26011 22647.46 29374.54
May 2026          26140 22776.46 29503.54
Jun 2026          26066 22702.46 29429.54
Jul 2026          27439 22682.24 32195.76
Aug 2026          27644 22887.24 32400.76
Sep 2026          27196 22439.24 31952.76
Oct 2026          28348 23591.24 33104.76
Nov 2026          26767 22010.24 31523.76
Dec 2026          26665 21908.24 31421.76
Jan 2027          26792 22035.24 31548.76
Feb 2027          24288 19531.24 29044.76
Mar 2027          26338 21581.24 31094.76
Apr 2027          26011 21254.24 30767.76
May 2027          26140 21383.24 30896.76
Jun 2027          26066 21309.24 30822.76</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(snaive.nacimientos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                    ME     RMSE      MAE      MPE     MAPE MASE      ACF1
Training set -588.6936 1716.123 1355.481 -1.59859 3.692636    1 0.7134456</code></pre>
</div>
</div>
<p>El error absoluto porcentual medio es del 3.7% (que corresponde a unos 1700 bebés según RMSE). Es decir, aplicando algo tan simple como predecir el número de nacimientos para un mes como los nacimientos del mismo mes del año previo, tenemos ya un error de ajuste muy bajo. Sin embargo, este método en general sobreestima algo el número de nacimientos (|MPE| mayor que 1%) y sus predicciones por intervalo no son fiables.</p>
<p>La <a href="#fig-nacimientossencillo" class="quarto-xref">Figura&nbsp;3</a> muestra la serie y la predicción que, debido al método usado, no incorpora la tendencia decreciente de los últimos años.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(snaive.nacimientos,</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"Nacimientos"</span>,</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>,</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">PI =</span> <span class="cn">FALSE</span>,</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">2000</span>, <span class="dv">2028</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-nacimientossencillo" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-nacimientossencillo-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-02-Tema2_files/figure-html/fig-nacimientossencillo-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-nacimientossencillo-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;3: Nacimientos y predicción por el método Ingenuo con estacionalidad
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="serie-demanda-eléctrica" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="serie-demanda-eléctrica">Serie Demanda eléctrica</h3>
<p>Podemos usar el método ingenuo con estacionalidad con la serie Demanda eléctrica, que tiene una estacionalidad de orden 7, pero no parece presentar tendencia. El error absoluto porcentual medio es del 4.1% o 41 GWh (RMSE), un error razonablemente reducido. Sin embargo, el ACF1 indica que la fórmula usada para el cálculo del intervalo de confianza de las predicciones no es válida.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>electricidad <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"./series/Consumo electrico.csv"</span>, </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>electricidad <span class="ot">&lt;-</span> <span class="fu">ts</span>(electricidad[, <span class="dv">1</span>],</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">frequency =</span> <span class="dv">7</span>)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>snaive.electricidad <span class="ot">&lt;-</span> <span class="fu">snaive</span>(electricidad, </span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>                              <span class="at">h =</span> <span class="dv">28</span>, </span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>                              <span class="at">level =</span> <span class="dv">95</span>)</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(snaive.electricidad)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                     ME     RMSE      MAE        MPE     MAPE MASE      ACF1
Training set -0.4689415 41.42265 27.81256 -0.2537472 4.085628    1 0.7181066</code></pre>
</div>
</div>
<p>La <a href="#fig-electricidadsencillo" class="quarto-xref">Figura&nbsp;4</a> muestra la serie y la predicción a cuatro semanas vista. Debido a que la semana de referencia para predecir es la semana de Navidad, donde el consumo eléctrico es inferior al usual, las predicciones resultan ser claramente incorrectas. Este es un buen ejemplo de la diferencia entre calidad de ajuste y precisión de las predicciones.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(snaive.electricidad,</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"GWh"</span>,</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-electricidadsencillo" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-electricidadsencillo-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-02-Tema2_files/figure-html/fig-electricidadsencillo-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-electricidadsencillo-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;4: Demanda eléctrica y predicción por el método Ingenuo con estacionalidad
</figcaption>
</figure>
</div>
</div>
</div>
<p><br>
<br>
</p>
</section>
</section>
</section>
<section id="evaluación-de-las-predicciones" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Evaluación de las predicciones</h1>
<p>Las medidas que hemos usado hasta ahora para valorar la calidad de los modelos son medidas de bondad de ajuste, es decir, medidas de la calidad de <strong>previsiones intramuestrales a un periodo vista</strong>: valoran en qué medida los datos se ajustan a un modelo, pero no evalúan la precisión de las previsiones más allá del periodo muestral.</p>
<p>En este tema vamos a ver dos metodologías que podemos usar para valorar la precisión o calidad de las <strong>previsiones extramuestrales</strong>, que es realmente lo que nos interesa. Estas dos metodologías están relacionadas con los métodos de <em>Conjunto de datos de entrenamiento y prueba</em> (<em>Training set/Test set</em>) y <em>Validación cruzada</em> (<em>Cross-validation</em>), pero adaptadas a datos temporales.</p>
<p><br>
<br>
</p>
<section id="validación-por-conjunto-de-datos-de-entrenamiento-y-prueba" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="validación-por-conjunto-de-datos-de-entrenamiento-y-prueba"><span class="header-section-number">4.1</span> Validación por conjunto de datos de entrenamiento y prueba</h2>
<p>Vamos a estimar la calidad de las predicciones obteniendo medidas de error para <strong>previsiones extramuestrales a varios periodos vista</strong> usando la filosofía del <em>conjunto de datos de entrenamiento y prueba</em>.</p>
<p>Dividimos la serie temporal <span class="math inline">\(\{y_t\}_{t=1}^T\)</span> en dos subseries. Los primeros datos <span class="math inline">\(\{y_t\}_{t=1}^{T_0}\)</span>, <span class="math inline">\(T_0 &lt; T\)</span>, se usarán para estimar el modelo (conjunto de entrenamiento); y los últimos datos <span class="math inline">\(\{y_t\}_{t={T_0+1}}^{T}\)</span> para calcular la precisión de las predicciones (conjunto de prueba).</p>
<p>Esta metodología, muy efectiva para datos de corte transversal, genera dos problemas cuando se aplica a series temporales: <em>i</em>) el error obtenido es una mezcla de errores de predicción a diferentes horizontes temporales, difícil de interpretar; <em>ii</em>) los resultados dependen tremendamente del punto de corte temporal seleccionado <span class="math inline">\(T_0\)</span>.</p>
<section id="serie-residuos-1" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="serie-residuos-1">Serie Residuos</h3>
<p>Vamos a reservar, por ejemplo, las últimas 7 observaciones de la serie Residuos (años 2017 a 2023) y ajustar el modelo con las restantes. Después usaremos este modelo para calcular las predicciones a 7 periodos vista y compararlas con los valores reales de la serie.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Definimos las observaciones intra- y extramuestrales</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>residuosIntra <span class="ot">&lt;-</span> <span class="fu">subset</span>(residuos, <span class="at">end =</span> <span class="fu">length</span>(residuos) <span class="sc">-</span> <span class="dv">7</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>residuosExtra <span class="ot">&lt;-</span> <span class="fu">subset</span>(residuos, <span class="at">start =</span> <span class="fu">length</span>(residuos) <span class="sc">-</span> <span class="dv">6</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimamos el modelo con todos los datos menos los 7 ultimos y</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="co"># predecimos los 7 años que hemos quitado de la serie </span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>residuosExtraPre <span class="ot">&lt;-</span> <span class="fu">rwf</span>(residuosIntra,  <span class="at">h =</span> <span class="dv">7</span>, <span class="at">drift =</span> <span class="cn">TRUE</span>)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Vemos la calidad del ajuste. Primero la predicción y luego los datos reales</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(residuosExtraPre, residuosExtra)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>                ME  RMSE   MAE   MPE MAPE MASE ACF1 Theil's U
Training set  0.00 23.45 18.38 -0.13 3.30 0.99 0.46        NA
Test set     18.14 19.81 18.14  3.81 3.81 0.98 0.12      1.86</code></pre>
</div>
</div>
<p>Atendiendo al MAPE se tiene que el error de <strong>previsión a un periodo vista</strong> en el <strong>periodo intramuestral</strong> de <strong>1995 a 2016</strong> es del 3.3%, medio p.p. inferior al error de <strong>previsión a largo plazo</strong> en el <strong>periodo extramuestral</strong> de <strong>2017 a 2023</strong> igual a 3.8%. Además, para el periodo extramuestral el error medio (ME) es positivo y muy elevado, un indicativo de que las previsiones están segadas (subestiman la realidad).</p>
<p>La <a href="#fig-residuostraintest" class="quarto-xref">Figura&nbsp;5</a> puede ayudar a entender este proceso de validación:</p>
<ul>
<li>La línea de puntos vertical separa el periodo muestral (1995-2016) usado para estimar el modelo, del periodo extramuestral (2017-2023) usado sólo para hacer las previsiones.</li>
<li>La serie Residuos aparece como una línea sólida en negro, desde 1995 hasta 2023.</li>
<li>La previsión <em>intra</em>muestral (a un periodo vista) de la serie Residuos aparece como una línea azul.</li>
<li>La línea en rojo es la previsión <em>extra</em>muestral a largo plazo. Observa que todas las previsiones están por debajo del valor real de la serie.</li>
<li>Al lado de cada previsión (intra y extramuestral) se ha indicado el error estimado (MAPE).</li>
</ul>
<p>Claramente estos resultados dependen del punto de corte seleccionado.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-residuostraintest" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-residuostraintest-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-02-Tema2_files/figure-html/fig-residuostraintest-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-residuostraintest-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;5: Residuos, predicción intra- y extramuestral
</figcaption>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Importamcia del punto de corte
</div>
</div>
<div class="callout-body-container callout-body">
<p>Prueba a reservar las últimas 6 observaciones de la serie Residuos y repite el análisis.</p>
</div>
</div>
</section>
<section id="serie-nacimientos-1" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="serie-nacimientos-1">Serie Nacimientos</h3>
<p>Calculamos de nuevo los diferentes criterios de bondad de ajuste para valorar la calidad de las previsiones extramuestrales a largo plazo. En este caso vamos a reservar los últimos 36 meses como periodo extramuestral.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>nacimientosIntra <span class="ot">&lt;-</span> <span class="fu">subset</span>(nacimientos, <span class="at">end =</span> <span class="fu">length</span>(nacimientos) <span class="sc">-</span> <span class="dv">36</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>nacimientosExtra <span class="ot">&lt;-</span> <span class="fu">subset</span>(nacimientos, <span class="at">start =</span> <span class="fu">length</span>(nacimientos) <span class="sc">-</span> <span class="dv">35</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>nacimientosExtraPre <span class="ot">&lt;-</span> <span class="fu">snaive</span>(nacimientosIntra, <span class="at">h =</span> <span class="dv">36</span>)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(nacimientosExtraPre, nacimientosExtra)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>                   ME    RMSE     MAE   MPE MAPE MASE ACF1 Theil's U
Training set  -595.50 1755.83 1397.25 -1.59 3.76 1.00 0.72        NA
Test set     -1291.56 1562.25 1348.83 -4.77 4.99 0.97 0.34      1.29</code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-nacimientostraintest" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-nacimientostraintest-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-02-Tema2_files/figure-html/fig-nacimientostraintest-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-nacimientostraintest-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;6: Nacimientos, predicción intra- y extramuestral
</figcaption>
</figure>
</div>
</div>
</div>
<p>El método ingenuo con estacionalidad no captura el decrecimiento en el número de nacimientos y sus previsiones extramuestrales se mantienen constantes en el tiempo. Conforme se avanza en el horizonte temporal las previsiones se van alejando de la realidad y el error extramuestral es del 5.0%, más de un p.p. por encima del error de estimación intramuestral de 3.8%.</p>
</section>
<section id="serie-demanda-eléctrica-1" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="serie-demanda-eléctrica-1">Serie Demanda eléctrica</h3>
<p>Para la serie de consumo eléctrico vamos a reservar las 8 últimas semanas (56 días) como periodo extramuestral.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>electricidadIntra <span class="ot">&lt;-</span> <span class="fu">subset</span>(electricidad, <span class="at">end =</span> <span class="fu">length</span>(electricidad) <span class="sc">-</span> <span class="dv">56</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>electricidadExtra <span class="ot">&lt;-</span> <span class="fu">subset</span>(electricidad, <span class="at">start =</span> <span class="fu">length</span>(electricidad) <span class="sc">-</span> <span class="dv">55</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>electricidadExtraPre <span class="ot">&lt;-</span> <span class="fu">snaive</span>(electricidadIntra, <span class="at">h =</span> <span class="dv">56</span>)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(electricidadExtraPre, electricidadExtra)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>                ME  RMSE   MAE   MPE  MAPE MASE ACF1 Theil's U
Training set -0.91 37.31 25.83 -0.29  3.79 1.00 0.68        NA
Test set     62.80 83.66 70.17  8.74 10.01 2.72 0.59      1.37</code></pre>
</div>
</div>
<p>El error intramuestral obtenido es del 3.8%, que aumenta más de 6 p.p. al obtener el error de previsión extramuestral (10%). El elevado valor positivo del error medio indica que las previsiones extramuestrales subestiman el consumo real de electricidad debido a que no capturan el aumento del consumo asociado a un mayor gasto en calefacción.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-electricidadtraintest" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-electricidadtraintest-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-02-Tema2_files/figure-html/fig-electricidadtraintest-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-electricidadtraintest-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;7: Consumo eléctrico, predicción intra- y extramuestral
</figcaption>
</figure>
</div>
</div>
</div>
<p><br>
</p>
</section>
</section>
<section id="origen-de-predicción-móvil" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="origen-de-predicción-móvil"><span class="header-section-number">4.2</span> Origen de predicción móvil</h2>
<p>Veamos ahora una técnica, basada en el concepto de validación cruzada que permite obtener de forma individualizada los errores de previsión extramuestral a un periodo vista, a dos periodos vista, etc.</p>
<p>Supongamos que para estimar el modelo se necesita un mínimo de <span class="math inline">\(k\)</span> observaciones y que se desea predecir hasta un horizonte temporal <span class="math inline">\(h\)</span>.</p>
<ul>
<li><p>Seleccionamos las observaciones <span class="math inline">\(1,2,...,k\)</span> para estimar el modelo y predecimos las observaciones desde <span class="math inline">\(k+1\)</span> hasta <span class="math inline">\(k+h\)</span>. Tenemos, por tanto, <span class="math inline">\(h\)</span> predicciones.</p></li>
<li><p>Calculamos el error de predicción para las predicciones desde <span class="math inline">\(k+1\)</span> hasta <span class="math inline">\(k+h\)</span>. Tenemos <span class="math inline">\(h\)</span> errores, el primero a un periodo vista, el segundo a dos periodos vista y el último a <span class="math inline">\(h\)</span> perriodos vista.</p></li>
<li><p>Repetimos este proceso desplazando el número de observaciones seleccionadas para la estimación un periodo adelante. Es decir, ahora usamos las observaciones <span class="math inline">\(2,3,...,k+1\)</span> para estimar el modelo, predecimos las observaciones desde <span class="math inline">\(k+2\)</span> hasta <span class="math inline">\(k+1+h\)</span> y calculamos el error de predicción.</p></li>
<li><p>Iteramos el proceso, desplazando cada vez las observaciones de la estimación un periodo adelante.</p></li>
<li><p>En general para <span class="math inline">\(i=0,1,...,T-k-h\)</span>, donde <span class="math inline">\(T\)</span> es el número total de observaciones:</p>
<ol type="1">
<li>Seleccionamos las observaciones <span class="math inline">\(i+1,i+2,...,i+k\)</span> para estimar el modelo.</li>
<li>Predecimos las observaciones desde <span class="math inline">\(i+k+1\)</span> hasta <span class="math inline">\(i+k+h\)</span>.</li>
<li>Calculamos el error de predicción para las observaciones desde <span class="math inline">\(i+k+1\)</span> hasta <span class="math inline">\(i+k+h\)</span>.</li>
<li>Para cada horizonte temporal de predicción se calcula la medida de error deseada.</li>
</ol></li>
</ul>
<p><br>
</p>
<div id="fig-rollingwindows" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-rollingwindows-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="./imagenes/RollingWindows.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-rollingwindows-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;8: Descripción del proceso de origen de predicción móvil
</figcaption>
</figure>
</div>
<p>Este procedimiento se denomina <strong>origen de predicción móvil</strong>, en inglés <em>rolling forecast origin</em> o <em>rolling windows</em>.</p>
<p>Cuando se aplica esta metodología hay que tener en cuenta que los resultados pueden depender del número <span class="math inline">\(k\)</span> de datos usados para la estimación del modelo.</p>
<section id="ejemplo-de-aplicación-con-nacimientos" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="ejemplo-de-aplicación-con-nacimientos">Ejemplo de aplicación con Nacimientos</h3>
<p>Vamos a aplicar la metodología previa a la serie anual de Nacimientos. Asumimos que se precisan veinte años para hacer una buena estimación, <span class="math inline">\(k=20\)</span>, y que el horizonte temporal es de cinco años, <span class="math inline">\(h = 5\)</span>. Como la serie es anual, usaremos el método de la deriva para predecir. La siguiente rutina permite obtener el MAPE para previsiones con un horizonte temporal desde uno a cinco años.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>nacAnual <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(nacimientos, <span class="at">FUN =</span> sum)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">20</span>                   <span class="co">#Minimo numero de datos para estimar</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>h <span class="ot">&lt;-</span> <span class="dv">5</span>                    <span class="co">#Horizonte de las prediciciones</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>TT <span class="ot">&lt;-</span> <span class="fu">length</span>(nacAnual)    <span class="co">#Longitud serie</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> TT <span class="sc">-</span> k <span class="sc">-</span> h           <span class="co">#Total de estimaciones</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>mapeRwf <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, s <span class="sc">+</span> <span class="dv">1</span>, h)</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">0</span><span class="sc">:</span>s) {</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>  train.set <span class="ot">&lt;-</span> <span class="fu">subset</span>(nacAnual, <span class="at">start =</span> i <span class="sc">+</span> <span class="dv">1</span>, <span class="at">end =</span> i <span class="sc">+</span> k)</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>  test.set <span class="ot">&lt;-</span>  <span class="fu">subset</span>(nacAnual, <span class="at">start =</span> i <span class="sc">+</span> k <span class="sc">+</span> <span class="dv">1</span>, <span class="at">end =</span> i <span class="sc">+</span> k <span class="sc">+</span> h)</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>  fcast <span class="ot">&lt;-</span> <span class="fu">rwf</span>(train.set, <span class="at">h =</span> h, <span class="at">drift =</span> <span class="cn">TRUE</span>)</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>  mapeRwf[i <span class="sc">+</span> <span class="dv">1</span>,] <span class="ot">&lt;-</span> <span class="dv">100</span><span class="sc">*</span><span class="fu">abs</span>(test.set <span class="sc">-</span> fcast<span class="sc">$</span>mean)<span class="sc">/</span>test.set</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>La matriz <code>mapeRwf</code> contiene los errores de previsión extramuestral, donde cada columna corresponde a un horizonte temporal de previsión diferente. Ahora vamos a calcular el error medio por columna.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>mapeRwfMedia <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(mapeRwf)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(mapeRwfMedia, <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  4.20  8.21 12.29 16.39 20.45</code></pre>
</div>
</div>
<p>Para evitar el posible efecto datos atípicos, se puede calcular el <em>error mediano</em> en lugar del error medio. En este caso no hay una función directa en <code>R</code> y usaremos <code>apply</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>mapeRwfMediana <span class="ot">&lt;-</span> <span class="fu">apply</span>(mapeRwf, <span class="at">MARGIN =</span> <span class="dv">2</span>, <span class="at">FUN =</span> median)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(mapeRwfMediana, <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  4.21  8.73 12.83 18.03 21.59</code></pre>
</div>
</div>
<p>El error de previsión extramuestral (medio o mediano) crece gradualmente con el horizonte de previsión. Para el primer año el error de predicción se mantiene en un moderado 4.2%, para el segundo año de predicción el MAPE salta al 9% y para los restantes años sigue creciendo. Como la serie de Nacimientos no presenta años especialmente atípicos, para todos los horizontes de previsión el error medio y mediano es muy similar.</p>
</section>
<section id="ejemplo-de-aplicación-con-demanda-eléctrica" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="ejemplo-de-aplicación-con-demanda-eléctrica">Ejemplo de aplicación con Demanda eléctrica</h3>
<p>Ahora aplicaremos la metodología origen de predicción móvil la serie de Demanda eléctrica. En este caso se asumirá que se precisan veinte semanas para hacer una buena estimación, <span class="math inline">\(k = 140\)</span>, y que el horizonte temporal es de 4 semanas, <span class="math inline">\(h = 28\)</span>. Como la serie tiene estacionalidad, usaremos el método ingenuo con estacionalidad para predecir. La siguiente rutina permite obtener el RMSE para previsiones con un horizonte temporal desde uno a 28 días.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">140</span>                  <span class="co">#Minimo numero de datos para estimar</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>h <span class="ot">&lt;-</span> <span class="dv">28</span>                   <span class="co">#Horizonte de las prediciciones</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>TT <span class="ot">&lt;-</span> <span class="fu">length</span>(electricidad)<span class="co">#Longitud serie</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> TT <span class="sc">-</span> k <span class="sc">-</span> h           <span class="co">#Total de estimaciones</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>rmseRwf <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, s <span class="sc">+</span> <span class="dv">1</span>, h)</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">0</span><span class="sc">:</span>s) {</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  train.set <span class="ot">&lt;-</span> <span class="fu">subset</span>(electricidad, <span class="at">start =</span> i <span class="sc">+</span> <span class="dv">1</span>, <span class="at">end =</span> i <span class="sc">+</span> k)</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  test.set <span class="ot">&lt;-</span>  <span class="fu">subset</span>(electricidad, <span class="at">start =</span> i <span class="sc">+</span> k <span class="sc">+</span> <span class="dv">1</span>, <span class="at">end =</span> i <span class="sc">+</span> k <span class="sc">+</span> h)</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>  fcast <span class="ot">&lt;-</span> <span class="fu">snaive</span>(train.set, <span class="at">h =</span> h)</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>  rmseRwf[i <span class="sc">+</span> <span class="dv">1</span>,] <span class="ot">&lt;-</span> (test.set <span class="sc">-</span> fcast<span class="sc">$</span>mean)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>rmseRwfMedia <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">colMeans</span>(rmseRwf))</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(rmseRwfMedia, <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 32.35 32.34 32.87 32.87 32.89 32.92 33.18 42.63 42.95 43.21 43.46 43.71
[13] 44.02 44.29 48.64 48.71 48.74 48.75 48.72 48.56 48.81 57.07 57.39 57.46
[25] 57.46 57.47 57.45 57.58</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>rmseRwfMediana <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">apply</span>(rmseRwf, <span class="at">MARGIN =</span> <span class="dv">2</span>, <span class="at">FUN =</span> median))</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(rmseRwfMediana, <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 18.93 18.93 18.97 18.97 18.97 19.23 19.33 24.40 24.58 24.70 24.97 25.44
[13] 25.68 26.62 30.02 30.50 30.50 30.50 30.50 30.02 30.02 37.66 37.87 38.39
[25] 38.39 38.39 38.39 38.96</code></pre>
</div>
</div>
<p>En este caso, la presencia de muchos días atípicos (todos los festivos entre semana el consumo de electricidad es notablemente más bajo de lo esperado) y de una segunda componente estacional dentro del año hacen que el error medio sea más elevado que el mediano –aproximadamente, el primero es 18 GWh mayor que el segundo.</p>
<p>Respecto del error de previsión mediano, este crece semana tras semana con el horizonte de previsión. Para predicciones de uno a siete periodos vista el error de predicción está alrededor de los 13-14 GWh; desde 8 a 21 días vista sube hasta los 18 GWh; y de 22 a 28 días vista supera los 19 GWh.</p>
<p><br>
</p>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Código para cálculo del error deseado
</div>
</div>
<div class="callout-body-container callout-body">
<p>Para Nacimientos hemos visto el código necesario para calcular el MAPE por origen de predicción móvil. Las dos líneas clave del código son:</p>
<p><br>
</p>
<p><code>mapeRwf[i + 1,] &lt;- 100*abs(test.set - fcast$mean)/test.set</code></p>
<p><code>mapeRwfMedia &lt;- colMeans(mapeRwf)</code></p>
<p><br>
</p>
<p>La primera línea obtiene el error porcentual absoluto de cada observación y la segunda calcula la media de estos errores.</p>
<p><br>
</p>
<p>Para calcular el RMSE en el ejemplo de Demanda eléctrica ha sido necesario adaptar estás dos líneas de código adecuadamente. Ahora la primera línea calcula el error cuadrático de cada observación y la segunda la raíz de la media de estos errores:</p>
<p><br>
</p>
<p><code>rmseRwf[i + 1,] &lt;- (test.set - fcast$mean)^2</code></p>
<p><code>rmseRwfMedia &lt;- sqrt(colMeans(rmseRwf))</code></p>
<p><br>
</p>
<p>En general, según el error que desees obtener, deberás modificar estas dos líneas de código como corresponda.</p>
<p><br>
</p>
<p>Además, si hay valores atípicos, puede ser conveniente calcular el error mediano en lugar del error medio.</p>
</div>
</div>
<p><br>
<br>
</p>
</section>
</section>
</section>
<section id="métodos-de-alisado-exponencial" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Métodos de Alisado Exponencial</h1>
<section id="introducción-1" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="introducción-1"><span class="header-section-number">5.1</span> Introducción</h2>
<p>Los métodos de alisado exponencial aparecen en los años 50 del siglo pasado de la mano de Brown, Holt y Winters <span class="citation" data-cites="Brown59 Holt Winters60">(véase <a href="#ref-Brown59" role="doc-biblioref">Brown 1959</a>; <a href="#ref-Holt" role="doc-biblioref">Holt 2004</a>; <a href="#ref-Winters60" role="doc-biblioref">Winters 1960</a>)</span> y han sido la raíz de uno de los métodos de predicción más sencillos y eficaces. La idea básica es predecir usando una media ponderada de los datos pasados, donde los más recientes tienen un peso mayor y este decae exponencialmente conforme usamos observaciones más antiguas.</p>
<p>El alisado exponencial es una familia de métodos de ajuste y previsión que ofrece muy buenos resultados para predicciones a corto plazo o para predecir series con pocos datos o <em>sencillas</em> (sin mucho <em>ruido</em>).</p>
<p>Suponen un grado de modelización mayor que los métodos sencillos vistos previamente, pero sin alcanzar la complejidad de otras metodologías (modelos ARIMA).</p>
<p>En origen, son métodos descriptivos con el único objetivo de producir <strong>predicciones puntuales</strong>. Sin embargo, su enfoque como modelos de <em>espacio de estados</em> posibilita un marco teórico para obtener <strong>intervalos de confianza de las predicciones</strong>.</p>
<p><br>
</p>
</section>
<section id="componentes-de-una-serie-en-el-contexto-del-alisado-exponencial" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="componentes-de-una-serie-en-el-contexto-del-alisado-exponencial"><span class="header-section-number">5.2</span> Componentes de una serie en el contexto del alisado exponencial</h2>
<p>Para obtener una predicción en el periodo <span class="math inline">\(t+1\)</span> con datos hasta el periodo <span class="math inline">\(t\)</span> necesitamos tres componentes:</p>
<ul>
<li>La estimación del nivel de la serie en el periodo <span class="math inline">\(t\)</span>: <span class="math inline">\(l_t\)</span></li>
<li>La estimación de la pendiente de la serie en el periodo <span class="math inline">\(t\)</span>: <span class="math inline">\(b_t\)</span></li>
<li>La estimación de la estacionalidad en el mes correspondiente al periodo <span class="math inline">\(t+1\)</span> con datos hasta <span class="math inline">\(t\)</span>: <span class="math inline">\(s_{t + 1 - m}\)</span> (recuerda, <span class="math inline">\(m\)</span> es el orden estacional</li>
</ul>
<p>A partir de estas componentes obtenidas en el periodo <span class="math inline">\(t\)</span> y para un esquema aditivo, se tendría que la predicción en el periodo <span class="math inline">\(t+1\)</span> es:</p>
<p><span class="math display">\[\widehat{y}_{t+1} = l_t+b_t+s_{t+1-m}.\]</span></p>
<p>En general, las componentes pueden <strong>existir o no</strong> y se pueden combinar entre ellas <strong>aditiva o multiplicativamente</strong>. Veamos algunos casos:</p>
<ul>
<li><p>Existen todas y son multiplicativas: <span class="math inline">\(\widehat{y}_{t+1}=l_t \cdot b_t \cdot s_{t + 1 - m}\)</span></p></li>
<li><p>Existen todas, nivel y pendiente aditivas, y estacionalidad multiplicativa: <span class="math inline">\(\widehat{y}_{t+1}=(l_t+b_t)s_{t + 1 - m}\)</span></p></li>
<li><p>No hay pendiente y la estacionalidad es aditiva: <span class="math inline">\(\widehat{y}_{t+1}=l_t+s_{t + 1 - m}\)</span></p></li>
</ul>
<p><br>
</p>
<p>¿Como obtenemos los valores de <span class="math inline">\(l_t\)</span>, <span class="math inline">\(b_t\)</span> y <span class="math inline">\(s_{t + 1 - m}\)</span>? Mediante <strong>expresiones recursivas</strong>, donde cada componente se calcula a partir de los valores hasta <span class="math inline">\(t\)</span> de la serie y de las componentes:</p>
<p><span class="math display">\[
\begin{aligned}
l_t&amp; = f_l(y_t,y_{t-1}\ldots, l_{t-1},l_{t-2}\ldots,b_{t-1},b_{t-2}\ldots,s_{t-1},s_{t-2}\ldots) \\
b_t&amp; = f_b(y_t,y_{t-1}\ldots, l_{t},l_{t-1}\ldots,b_{t-1},b_{t-2}\ldots,s_{t-1},s_{t-2}\ldots) \\
s_t&amp; = f_s(y_t,y_{t-1}\ldots, l_{t},l_{t-1}\ldots,b_{t},b_{t-1}\ldots,s_{t-1},s_{t-2}\ldots)
\end{aligned}
\]</span></p>
<p>Por ejemplo, el <em>método ingenuo I</em> se puede interpretar dentro de este contexto como un método de alisado donde <span class="math inline">\(l_t = y_t\)</span> y no hay ni pendiente ni estacionalidad. Por tanto, <span class="math inline">\(\widehat{y}_{t+1} = l_{t} = y_{t}\)</span>.</p>
<p>De la misma forma, el <em>método ingenuo II</em> se puede interpretar como un método de alisado donde <span class="math inline">\(l_t = y_t\)</span>, <span class="math inline">\(b_t = y_t - y_{t-1}\)</span> y no hay estacionalidad. Entonces, <span class="math inline">\(\widehat{y}_{t+1}=l_t + b_t = y_t + (y_t - y_{t-1})\)</span>.</p>
<p>En las expresiones previas hemos supuesto que se quería obtener una predicción a un periodo vista (<span class="math inline">\(\widehat{y}_{t+1}\)</span>). Si el objetivo es estimar una previsión <span class="math inline">\(h\)</span> periodos hacia delante desde el periodo <span class="math inline">\(t\)</span>, <span class="math inline">\(\widehat{y}_{t+h}\)</span>, hay que modificar la ecuación de predicción adecuadamente. Por ejemplo, para el caso aditivo se tendría que</p>
<p><span class="math display">\[\widehat{y}_{t+h} = l_t+hb_t+s_{t+h-m(k+1)}\]</span> donde <span class="math inline">\(k = \lfloor (h-1)/m\rfloor\)</span>.</p>
<p>El concepto de componentes aquí visto no coincide con el definido en el Tema 1. Sin embargo, podemos asimilar la tendencia de una serie como la suma (o multiplicación) del nivel y la pendiente <span class="math inline">\(T_{t+1} = l_t + b_t\)</span> (o <span class="math inline">\(T_{t+1} = l_t \cdot b_t\)</span>) y de esta forma ambas definiciones de componentes de una serie se hacen compatibles.</p>
<p><br>
</p>
</section>
<section id="casos-posibles" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="casos-posibles"><span class="header-section-number">5.3</span> Casos posibles</h2>
<p>Todas las series tiene nivel, pero dependiendo del tipo de pendiente y estacionalidad hay 15 casos posibles, mostrados en la <a href="#tbl-taxonomia" class="quarto-xref">Tabla&nbsp;1</a>.</p>
<div id="tbl-taxonomia" class="quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-taxonomia-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabla&nbsp;1: Casos de alisado según el tipo de tendencia y estacionalidad
</figcaption>
<div aria-describedby="tbl-taxonomia-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 26%">
<col style="width: 24%">
<col style="width: 24%">
<col style="width: 24%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Tendencia</th>
<th style="text-align: center;"></th>
<th style="text-align: center;">Estacionalidad</th>
<th style="text-align: center;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: center;">Ninguna (N)</td>
<td style="text-align: center;">Aditiva (A)</td>
<td style="text-align: center;">Multiplicativa (M)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Ninguna (N)</td>
<td style="text-align: center;"><strong>N, N</strong></td>
<td style="text-align: center;">N, A</td>
<td style="text-align: center;">N, M</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Aditiva (A)</td>
<td style="text-align: center;"><strong>A, N</strong></td>
<td style="text-align: center;"><strong>A, A</strong></td>
<td style="text-align: center;"><strong>A, M</strong></td>
</tr>
<tr class="even">
<td style="text-align: left;">Aditiva Amortiguada (Ad)</td>
<td style="text-align: center;"><strong>Ad, N</strong></td>
<td style="text-align: center;">Ad, A</td>
<td style="text-align: center;">Ad, M</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Multiplicativa (M)</td>
<td style="text-align: center;">M, N</td>
<td style="text-align: center;">M, A</td>
<td style="text-align: center;">M, M</td>
</tr>
<tr class="even">
<td style="text-align: left;">Multiplicativa Amortiguada (Md)</td>
<td style="text-align: center;">Md, N</td>
<td style="text-align: center;">Md, A</td>
<td style="text-align: center;">Md, M</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>Cada caso difiere en las componentes que se observan y su esquema, dando lugar a un conjunto diferente de ecuaciones recursivas de actualización.</p>
<p><br>
</p>
<p><strong>Residuo aditivo versus residuo multiplicativo</strong></p>
<p>Todo modelo estimado tiene asociado un residuo. En los modelos usuales este error se define como, <span class="math inline">\(\widehat{\varepsilon}_t = y_t - \widehat{y}_t\)</span>, pero no tiene por que ser así,. En los modelos de Alisado el residuo estimado puede ser aditivo o multiplicativo.</p>
<p>Si el <strong>residuo es aditivo</strong>, entonces el modelo es <span class="math inline">\(y_t = \widehat{y}_t + \widehat{\varepsilon}_t\)</span> y el residuo se define de la forma usual <span class="math display">\[\widehat{\varepsilon}_t = y_t - \widehat{y}_t.\]</span></p>
<p>Ahora bien, si el <strong>residuo es multiplicativo</strong>, entonces el modelo es <span class="math inline">\(y_t = \widehat{y}_t \cdot (1 + \widehat{\varepsilon}_t)\)</span>, y no <span class="math inline">\(y_t = \widehat{y}_t \cdot \widehat{\varepsilon}_t\)</span> como se podría esperar. Por tanto, el residuo multiplicativo se define como <span class="math display">\[\widehat{\varepsilon}_t = (y_t - \widehat{y}_t)/\widehat{y}_t.\]</span></p>
<p>De esta forma en ambos casos –aditivo y multiplicativo– el residuo evoluciona alrededor del valor 0 y se le pueden imponer las hipótesis usuales de ruido blanco. Observa que el error multiplicativo tampoco es el error porcentual tal y como se define para el calculo del MPE o del MAPE.</p>
<p>En cualquiera de los casos y para cualquier modelo estimado con <code>R</code>, podemos obtener el residuo con la función <code>residuals</code>.</p>
<p><br>
</p>
<p><strong>Casos más comunes</strong></p>
<p>Si a la <a href="#tbl-taxonomia" class="quarto-xref">Tabla&nbsp;1</a> se añade que el error puede ser aditivo (A) o multiplicativo (M), tenemos 30 posibilidades. El tipo de error (aditivo o multiplicativo) es, sobre todo, relevante en el cálculo del intervalo de confianza de las predicciones.</p>
<p>Los modelos más usuales son (error, tendencia, estacionalidad):</p>
<ul>
<li>(A, N, N): Alisado exponencial simple</li>
<li>(A, A, N): Alisado de Holt</li>
<li>(A, Ad, N): Alisado con tendencia amortiguada (d de <em>damped</em>)</li>
<li>(A, A, A): Alisado de Holt-Winters aditivo</li>
<li>(M, A, M): Alisado de Holt-Winters multiplicativo<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></li>
</ul>
<p>Acude al artículo de <span class="citation" data-cites="Hyndman08">Hyndman and Khandakar (<a href="#ref-Hyndman08" role="doc-biblioref">2008</a>)</span> para saber más de cada modelo, o al libro de <span class="citation" data-cites="Hyndman08b">Hyndman et al. (<a href="#ref-Hyndman08b" role="doc-biblioref">2008</a>)</span>.</p>
<section id="las-funciones-ets-y-forecast" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="las-funciones-ets-y-forecast">Las funciones <code>ets</code> y <code>forecast</code></h3>
<p>Podemos estimar cualquiera de los treinta modelos usando la función <code>ets</code> del paquete <code>forecast</code>.</p>
<ul>
<li>El tipo de modelo en <code>ets</code> se especifica con el argumento <code>model</code>, un código de tres letras indicando el tipo de Error, Tendencia y eStacionalidad (ETS). Por ejemplo, <code>model = "ANN"</code> indica un modelo con error aditivo, sin tendencia ni estacionalidad, es decir, el alisado exponencial simple; <code>model = "AAN"</code> indica un modelo con error aditivo, pendiente aditiva, pero sin estacionalidad, el alisado exponencial de Holt. El alisado exponencial de Holt-Winters multiplicativo sería <code>model = "MAM"</code>.</li>
<li>Si se desea incluir amortiguamiento, hay que añadir el argumento <code>damped = TRUE</code>.</li>
<li>Por defecto <code>ets</code> no considera modelos con tendencia multiplicativa (últimas dos líneas de la <a href="#tbl-taxonomia" class="quarto-xref">Tabla&nbsp;1</a>). Debes fijar el parámetro <code>allow.multiplicative.trend=TRUE</code> para contemplar esta opción.</li>
</ul>
<p>A diferencia de las funciones vistas en el epígrafe 3.1 (<code>naive</code>, <code>meanf</code>, <code>rwf</code> y <code>snaive</code>), la función <code>ets</code> solo estima los modelos, pero no produce predicciones. Para ello habrá que usar la función <code>forecast</code> sobre un modelo estimado con <code>ets</code>. El argumento <code>h</code> de esta función especifica el horizonte temporal de predicción. También puedes usar <code>level</code> para fijar el nivel de confianza del intervalo de predicción.</p>
<p>Mira la ayuda de <code>R</code> para ver una explicación detallada de los argumentos de estas las funciones <code>ets</code> y <code>forecast</code>.</p>
<p><br>
</p>
</section>
</section>
<section id="alisado-exponencial-simple-a-n-n" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="alisado-exponencial-simple-a-n-n"><span class="header-section-number">5.4</span> Alisado exponencial simple (A, N, N)</h2>
<p><br>
</p>
<section id="definición" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="definición">Definición</h3>
<p>El alisado exponencial simple es adecuado para una serie estacionaria y sin estacionalidad. Es decir, una serie que se mueve alrededor de un nivel medio desconocido: <span class="math inline">\(y_t = \mu + \varepsilon_t\)</span>. Por tanto, para obtener una predicción en el periodo <span class="math inline">\(t+1\)</span> necesitamos la estimación del nivel de la serie con la información disponible hasta el periodo <span class="math inline">\(t\)</span>. Denominaremos a este nivel <span class="math inline">\(l_t\)</span>, de esta forma se tendrá que: <span class="math display">\[\widehat{y}_{t+1} = l_t.\]</span></p>
<p>Es decir, <span class="math inline">\(l_t\)</span> es la estimación del nivel desconocido <span class="math inline">\(\mu\)</span> con información hasta el periodo <span class="math inline">\(t\)</span>.</p>
<p>¿Pero cómo obtenemos <span class="math inline">\(l_t\)</span>? Mediante una expresión recursiva donde el nivel <span class="math inline">\(l_t\)</span> se calcula a partir de los valores hasta <span class="math inline">\(t\)</span> de la serie y los valores pasados estimados para el nivel. En concreto, para el Alisado exponencial simple la <strong>ecuación recursiva</strong> de suavizado es <span class="math display">\[l_t=\alpha y_t + (1-\alpha)l_{t-1}.\]</span> Dos estimaciones razonables de <span class="math inline">\(l_t\)</span>, el nivel de la serie en el periodo <span class="math inline">\(t\)</span>, son el valor observado para la serie en ese periodo <span class="math inline">\(y_t\)</span> y el nivel del periodo previo <span class="math inline">\(l_{t-1}\)</span>. La estimación final de <span class="math inline">\(l_t\)</span> es una media ponderada de ambas según el parámetro <span class="math inline">\(\alpha\)</span>, y esta estimación final es la previsión de la serie para el periodo siguiente.</p>
<p>El parámetro <span class="math inline">\(\alpha\)</span> se denomina parámetro de suavizado y verifica que <span class="math inline">\(0 \leq \alpha \leq 1\)</span>.</p>
<p>Ya hemos comentado que la ecuación de <strong>predicción intramuestral</strong> es <span class="math inline">\(\widehat{y}_{t+1} = l_t\)</span>. La ecuación de <strong>predicción extramuestral</strong> es <span class="math display">\[\widehat{y}_{T+h} = \widehat{y}_{T+1} = l_T.\]</span> El método de Alisado también ofrece predicciones constantes para series sin tendencia ni estacionalidad.</p>
</section>
<section id="estimación-de-los-parámetros-del-modelo" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="estimación-de-los-parámetros-del-modelo">Estimación de los parámetros del modelo</h3>
<p>Dado el proceso iterativo para el cálculo de <span class="math inline">\(l_t\)</span> se necesita un <strong>valor inicial</strong> de arranque <span class="math inline">\(l_0\)</span>. Cada programa estadístico usa su propio método para obtener <span class="math inline">\(l_0\)</span>.</p>
<p>Respecto de <span class="math inline">\(\alpha\)</span>, usualmente se estima el valor <strong>optimo</strong> según un criterio de calidad de ajuste. El parámetro <span class="math inline">\(\alpha\)</span> <strong>se puede interpretar</strong>:</p>
<ul>
<li>Si <span class="math inline">\(\alpha = 1\)</span>, la ecuación recursiva queda <span class="math inline">\(l_t = y_t\)</span>, es decir, el <em>método ingenuo I</em> (<span class="math inline">\(\widehat{y}_{t+1}=y_t\)</span>). Este caso es óptimo cuando el nivel de la serie varía constantemente en el tiempo.</li>
<li>Si <span class="math inline">\(\alpha = 0\)</span>, la ecuación recursiva queda <span class="math inline">\(l_t=l_{t-1}=\ldots = l_0\)</span>, es decir, <span class="math inline">\(\hat y_{t+1}= l_0\)</span>. Esto es óptimo cuando el nivel permanece constante en el tiempo.</li>
</ul>
<p>En concreto, <code>ets</code> por defecto estima los parámetros <span class="math inline">\(\alpha\)</span> y <span class="math inline">\(l_0\)</span> maximizando la función de verosimilitud, pero el argumento <code>opt.crit</code> permite cambiar de criterio. Esta búsqueda está restringida a <span class="math inline">\(0 &lt; \alpha &lt; 1\)</span>. Es decir el parámetro <span class="math inline">\(\alpha\)</span> nunca puede ser 0 o 1 y en la práctica sus valores limite son 0.0001 y 0.9999.</p>
</section>
<section id="ejemplo-de-aplicacion-a-la-serie-consumo-de-alimentos-en-hogar" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="ejemplo-de-aplicacion-a-la-serie-consumo-de-alimentos-en-hogar">Ejemplo de aplicacion a la serie consumo de alimentos en hogar</h3>
<p>Analizaremos el <strong>consumo alimentario en hogar per cápita</strong> en España. Esta serie está construida a partir de la serie de consumo alimentario en hogar (disponible en el Ministerio de Agricultura, Alimentación y Medio Ambiente), y la serie de población (disponible en el Instituto Nacional de Estadística). Es una serie anual de 1990 a 2024 (35 datos) y la unidad es el Kg per cápita. La <a href="#fig-Alimentos" class="quarto-xref">Figura&nbsp;9</a> muestra que es una serie estacionaria.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>alimentospc <span class="ot">&lt;-</span> <span class="fu">read.csv2</span>(<span class="st">"./series/Alimentacionpc.csv"</span>,</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>alimentospc <span class="ot">&lt;-</span> <span class="fu">ts</span>(alimentospc,</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">start =</span> <span class="dv">1990</span>, </span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">freq =</span> <span class="dv">1</span>)</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(alimentospc, </span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>, </span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"Kg per cápita"</span>,</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>,</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">700</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-Alimentos" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-Alimentos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-02-Tema2_files/figure-html/fig-Alimentos-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-Alimentos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;9: Consumo alimentario en hogar
</figcaption>
</figure>
</div>
</div>
</div>
<p>El pico en el año 2020 se debe al aumento del consumo de alimentos en el hogar causado por el periodo de confinamiento por la Covid-19 (marzo a junio) y el aumento del trabajo en casa. La caída de consumo en los años posteriores se debe a un aumento del gasto en ocio, que incluye la restauración.</p>
<p>Vamos a usar el método de Alisado exponencial simple para predecir la serie Consumo de alimentos en el hogar. Usaremos para ello la función <code>ets</code> con <code>model = "ZNN"</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>etsAlimentospc <span class="ot">&lt;-</span> <span class="fu">ets</span>(alimentospc, </span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">model =</span> <span class="st">"ZNN"</span>)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(etsAlimentospc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ETS(A,N,N) 

Call:
ets(y = alimentospc, model = "ZNN")

  Smoothing parameters:
    alpha = 0.9578 

  Initial states:
    l = 625.3094 

  sigma:  21.9533

     AIC     AICc      BIC 
344.6019 345.3761 349.2679 

Training set error measures:
                    ME    RMSE      MAE        MPE     MAPE      MASE
Training set -2.250486 21.3168 13.81233 -0.4446267 2.211916 0.9818223
                     ACF1
Training set 0.0007501672</code></pre>
</div>
</div>
<p>Veamos la salida en detalle:</p>
<ul>
<li>El modelo óptimo tiene error aditivo: <code>ETS(A,N,N)</code>.</li>
<li>El valor de <span class="math inline">\(\alpha\)</span> óptimo (minimiza la verosimilitud) es <span class="math inline">\(\alpha =\)</span> 0.96, un valor muy cercano a 1. Es decir, el nivel de Alimentos varía constantemente en el tiempo.</li>
<li>El valor de arranque <span class="math inline">\(l_0\)</span> óptimo es 625.31. Es decir, el año 1989 (año anterior al primero de la serie) se estima un nivel de consumo de 625.31 kg per cápita.</li>
<li><em>sigma</em> es la desviación típica del error (aditivo) de predicción. Se diferencia de RMSE en el denominador. Para calcular <em>sigma</em> en lugar de dividir por <span class="math inline">\(T\)</span> se divide por <span class="math inline">\(T-k\)</span>. En este caso <span class="math inline">\(k=3\)</span>: <span class="math inline">\(l_0\)</span>, <span class="math inline">\(\alpha\)</span> y <em>sigma</em>. Sí, <em>sigma</em> se considerará siempre otro parámetro estimado.</li>
<li>Se obtiene un AICc <span class="math inline">\(= 345.38\)</span>. Si estimamos un modelo con error multiplicativo, obtendremos un AICc mayor.</li>
<li>La calidad del ajuste es buena, como evidencia el error porcentual medio del 2.2%. Además, no hay sesgo (|MPE| = 0.44% &lt; 1%) y el cálculo de la predicciones por intervalo es correcto (|ACF1| = 0.00075 &lt; 0.1).</li>
<li>Como el valor de <span class="math inline">\(\alpha\)</span> es próximo a 1, el modelo de Alisado se aproxima mucho al Ingenuo I. Por este motivo el MASE es casi igual a 1.</li>
</ul>
<p>En el objeto <code>etsAlimentospc</code> la matriz <code>etsAlimentospc$states</code> guarda todos los valores del nivel obtenidos con la ecuación recursiva, incluido el valor de arranque, así que es una matriz con <span class="math inline">\(T+1\)</span> filas (36 en el ejemplo). Puedes ver en su última fila que el valor de <span class="math inline">\(l_{2024}\)</span>, el nivel del último año, vale 549.87.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(etsAlimentospc<span class="sc">$</span>states, <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Time Series:
Start = 2024 
End = 2024 
Frequency = 1 
            l
[1,] 549.8672</code></pre>
</div>
</div>
<p>Por tratarse de un modelo sin pendiente ni estacionalidad, la predicción es constante en el tiempo. Recuerda que <span class="math inline">\(\widehat{y}_{T+h} = l_T\)</span>. Así, la predicción para 2025 es <span class="math inline">\(\widehat{y}_{2025}=l_{2024}=\)</span> 549.87. Igualmente <span class="math inline">\(\widehat{y}_{2026}=l_{2024}=\)</span> 549.87. Todas las previsiones son iguales a <span class="math inline">\(l_{2024}\)</span>.</p>
<p>Mediante la función <code>forecast</code> podemos predecir el consumo de alimentos per cápita para los próximos cinco años y obteenr el intervalo de confianza de las predicciones.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>etsAlimentospcf <span class="ot">&lt;-</span> <span class="fu">forecast</span>(etsAlimentospc,</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>                            <span class="at">h =</span> <span class="dv">5</span>, </span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>                            <span class="at">level =</span> <span class="dv">95</span>)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>etsAlimentospcf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Point Forecast    Lo 95    Hi 95
2025       549.8672 506.8396 592.8948
2026       549.8672 490.2874 609.4470
2027       549.8672 477.4232 622.3112
2028       549.8672 466.5214 633.2129
2029       549.8672 456.8893 642.8451</code></pre>
</div>
</div>
<p>La <a href="#fig-alimentosANN" class="quarto-xref">Figura&nbsp;10</a> muestra la serie Consumo de alimentos, las previsiones extramuestrales que son constantes y el intervalo de confianza. Conforme aumentamos el horizonte de predicción, el intervalo de confianza es más amplio como reflejo de la mayor incertidumbre en la predicción.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(etsAlimentospcf,</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"Kg per cápita"</span>,</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-alimentosANN" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-alimentosANN-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-02-Tema2_files/figure-html/fig-alimentosANN-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-alimentosANN-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;10: Consumo de alimentos per cápita (1990 - 2024) y predicción con Alisado exponencial simple
</figcaption>
</figure>
</div>
</div>
</div>
<p><br>
</p>
</section>
</section>
<section id="alisado-exponencial-de-holt-a-a-n" class="level2" data-number="5.5">
<h2 data-number="5.5" class="anchored" data-anchor-id="alisado-exponencial-de-holt-a-a-n"><span class="header-section-number">5.5</span> Alisado exponencial de Holt (A, A, N)</h2>
<p>El alisado exponencial de Holt es adecuado para una serie no estacionaria y sin estacionalidad.</p>
<p><br>
</p>
<section id="formulas-interactivas-de-sus-componentes" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="formulas-interactivas-de-sus-componentes">Formulas interactivas de sus componentes</h3>
<p>Las <strong>ecuaciones recursivas</strong> son</p>
<p><span class="math display">\[
\begin{aligned}
l_t &amp; =\alpha y_t + (1-\alpha)(l_{t-1}+b_{t-1}) \\
b_t &amp; =\beta (l_t - l_{t-1}) + (1-\beta)b_{t-1}
\end{aligned}
\]</span></p>
<p>La ecuación de la <strong>predicción intramuestral</strong> a un periodo vista es</p>
<p><span class="math display">\[\widehat{y}_{t+1} = l_t + b_t,\]</span> de forma que la ecuación de <strong>predicción extramuestral</strong> es <span class="math display">\[\widehat{y}_{T+h}=l_T + h b_T.\]</span></p>
<p>Dos estimaciones razonables del nivel de la serie en el periodo <span class="math inline">\(t\)</span> son el valor observado para la serie en ese periodo <span class="math inline">\(y_t\)</span>, y una estimación del nivel del periodo <span class="math inline">\(t\)</span> realizada desde el periodo <span class="math inline">\(t-1\)</span>: <span class="math inline">\(l_{t-1} + b_{t-1}\)</span>. Por otro lado, dos estimaciones razonables de la pendiente de la serie en el periodo <span class="math inline">\(t\)</span> son el cambio de nivel de <span class="math inline">\(t-1\)</span> a <span class="math inline">\(t\)</span> (el último observado) <span class="math inline">\(l_t-l_{t-1}\)</span>, y el valor de la pendiente en el periodo previo, <span class="math inline">\(b_{t-1}\)</span>. En ambos casos, nivel y pendiente, la estimación final es una media ponderada, parametrizada por <span class="math inline">\(0 &lt; \alpha, \beta &lt; 1\)</span>.</p>
<p>Observa que el <em>método ingenuo II</em> es un caso concreto de Alisado de Holt. Si hacemos <span class="math inline">\(\alpha=\beta = 1,\)</span> queda <span class="math inline">\(l_t=y_t\)</span> y <span class="math inline">\(b_t=y_t-y_{t-1}\)</span>, por tanto <span class="math display">\[\widehat{y}_{t+1}=l_t + b_t = y_t + (y_t - y_{t-1})\]</span> y <span class="math display">\[\widehat{y}_{T+h}=l_T + h \cdot b_T = y_T + h(y_T - y_{T-1}).\]</span></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
¿Sabrías responder a estas preguntas?
</div>
</div>
<div class="callout-body-container callout-body">
<p>Hemos visto que en modelo de Alisado con tendencia, si <span class="math inline">\(\alpha = \beta = 1\)</span>, la ecuación de predicción que queda es la del método Ingenuo II.</p>
<p>¿Cómo quedaría la ecuación de predicción si <span class="math inline">\(\alpha = \beta = 0\)</span>?</p>
<p>¿Y si <span class="math inline">\(\alpha = 1\)</span> y <span class="math inline">\(\beta = 0\)</span>? ¿Y si <span class="math inline">\(\alpha = 0\)</span> y <span class="math inline">\(\beta = 1\)</span>?</p>
</div>
</div>
</section>
<section id="estimación-de-los-parámetros-del-modelo-1" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="estimación-de-los-parámetros-del-modelo-1">Estimación de los parámetros del modelo</h3>
<p>Para aplicar este método es necesario estimar unos valores iniciales <span class="math inline">\(l_0\)</span> y <span class="math inline">\(b_0\)</span> de las ecuaciones recursivas e identificar los valores más adecuados de los parámetros <span class="math inline">\(\alpha\)</span> y <span class="math inline">\(\beta\)</span>.</p>
<p>La función <code>ets</code> por defecto estima los parámetros <span class="math inline">\(\alpha\)</span>, <span class="math inline">\(\beta\)</span>, <span class="math inline">\(l_0\)</span> y <span class="math inline">\(b_0\)</span> maximizando la función de verosimilitud. En este caso la búsqueda está restringida a <span class="math inline">\(0 &lt; \beta &lt; \alpha &lt; 1\)</span>. Por tanto, <span class="math inline">\(\alpha\)</span> y <span class="math inline">\(\beta\)</span> nunca pueden ser 0 o 1 y en la práctica sus valores limite son 0.0001 y 0.9999.</p>
<p>La interpretación del parámetro <span class="math inline">\(\alpha\)</span> es similar al caso del alisado exponencial simple.</p>
<p><strong>Interpretación del parámetro</strong> <span class="math inline">\(\beta\)</span>:</p>
<ul>
<li>Si <span class="math inline">\(\beta = 1\)</span>, <span class="math inline">\(b_t = l_t - l_{t-1}\)</span>, la pendiente se actualiza constantemente porque varía periodo a periodo Puede ser un indicador de mal ajuste (tendencia no lineal o pendiente no aditiva).</li>
<li>Si <span class="math inline">\(\beta = 0\)</span>, <span class="math inline">\(b_t = b_{t-1}= \ldots = b_0\)</span>, la pendiente se mantiene constante en el tiempo.</li>
</ul>
</section>
<section id="ejemplo-de-aplicación-a-la-serie-residuos" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="ejemplo-de-aplicación-a-la-serie-residuos">Ejemplo de aplicación a la serie Residuos</h3>
<p>Vamos a usar el método de alisado de Holt para predecir la serie Residuos. Usaremos para ello la función <code>ets</code> con el argumento <code>model = "AAN"</code> (error y tendencia aditivas sin estacionalidad). Además, es necesario añadir el argumento <code>damped = FALSE</code> para prevenir el uso de tendencia amortiguada, que veremos en el siguiente epígrafe.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>etsResiduos <span class="ot">&lt;-</span> <span class="fu">ets</span>(residuos, </span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">model =</span> <span class="st">"AAN"</span>,</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">damped =</span> <span class="cn">FALSE</span>)</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(etsResiduos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ETS(A,A,N) 

Call:
ets(y = residuos, model = "AAN", damped = FALSE)

  Smoothing parameters:
    alpha = 0.9998 
    beta  = 0.4929 

  Initial states:
    l = 479.3655 
    b = 51.8543 

  sigma:  21.4529

     AIC     AICc      BIC 
281.1673 283.7760 288.0038 

Training set error measures:
                    ME     RMSE      MAE        MPE     MAPE      MASE
Training set -4.083149 19.91854 16.04773 -0.6775317 2.945818 0.9985256
                   ACF1
Training set 0.01027896</code></pre>
</div>
</div>
<p>Los valores óptimos de los cuatro parámetros estimados son <span class="math inline">\(\alpha=\)</span> 1, <span class="math inline">\(\beta=\)</span> 0.49, <span class="math inline">\(l_0 =\)</span> 479.37 y <span class="math inline">\(b_0 =\)</span> 51.85.</p>
<p>Observa que <span class="math inline">\(\alpha\)</span> es prácticamente 1, indicando que el nivel de la serie varía de forma constante; por otro lado, <span class="math inline">\(\beta\)</span> es aproximadamente 0.5, indicando que la pendiente varía moderadamente con el paso de los años. La calidad de las predicciones es razonable, con un error porcentual medio del 2.9%.</p>
<p>Por otro lado, el valor de <span class="math inline">\(l_0\)</span> indica que el nivel estimado para el volumen de residuos de 1994 es de 479.37. Además, el incremento entre 1994 y 1995 se estima en <span class="math inline">\(b_0 =\)</span> 51.85.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Parámetros estimados
</div>
</div>
<div class="callout-body-container callout-body">
<p>¿Cuántos parámetros se han estimado (y la respuesta no es 4)? ¿Cuál es el denominador en el cálculo de RMSE y de <em>sigma</em>?</p>
</div>
</div>
<p>En el objeto <code>etsResiduos</code> la matriz <code>etsResiduos$states</code> guarda todos los valores obtenidos con las ecuaciones recursivas, en este caso el nivel y la pendiente, incluidos los valores de arranque. Puedes ver los valores de <span class="math inline">\(l_{2023}\)</span> y <span class="math inline">\(b_{2023}\)</span> en su última fila, que valen respectivamente</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(etsResiduos<span class="sc">$</span>states, <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Time Series:
Start = 2023 
End = 2023 
Frequency = 1 
            l         b
2023 465.0041 -6.509018</code></pre>
</div>
</div>
<p>Así, la predicción para <span class="math inline">\(2024\)</span> es <span class="math inline">\(\widehat{y}_{2024}=l_{2023} + b_{2023}=\)</span> 465.00 <span class="math inline">\(+\)</span> -6.51 <span class="math inline">\(=\)</span> 458.50. Igualmente <span class="math inline">\(\widehat{y}_{2025}=l_{2023} + 2\cdot b_{2023}=\)</span> 451.99. Es decir, el variación entre previsiones es constante e igual a <span class="math inline">\(b_{2023}\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>etsResiduosf <span class="ot">&lt;-</span> <span class="fu">forecast</span>(etsResiduos,</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">h =</span> <span class="dv">5</span>, </span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">level =</span> <span class="dv">95</span>)</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>etsResiduosf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Point Forecast    Lo 95    Hi 95
2024       458.4951 416.4481 500.5421
2025       451.9861 376.4405 527.5317
2026       445.4771 332.8836 558.0705
2027       438.9680 285.5491 592.3869
2028       432.4590 234.6046 630.3135</code></pre>
</div>
</div>
<p>La <a href="#fig-residuosAAN" class="quarto-xref">Figura&nbsp;11</a> muestra la serie Residuos y las previsiones extramuestrales, que muestran una ligera tendencia decreciente.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(etsResiduosf,</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"Kg per cápita"</span>,</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-residuosAAN" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-residuosAAN-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-02-Tema2_files/figure-html/fig-residuosAAN-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-residuosAAN-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;11: Residuos y predicción con alisado de Holt
</figcaption>
</figure>
</div>
</div>
</div>
<p><br>
</p>
</section>
</section>
<section id="alisado-exponencial-con-pendiente-amortiguada-a-ad-n" class="level2" data-number="5.6">
<h2 data-number="5.6" class="anchored" data-anchor-id="alisado-exponencial-con-pendiente-amortiguada-a-ad-n"><span class="header-section-number">5.6</span> Alisado exponencial con pendiente amortiguada (A, Ad, N)</h2>
<p>Las previsiones con el método de Holt presentan siempre una pendiente constante. En previsiones a corto plazo esto no es un problema, pero para previsiones a largo plazo la experiencia indica que suele aparecer un sesgo de previsión. El alisado exponencial con pendiente amortiguada trata de corregir esta limitación. El mecanismo, propuesto por <span class="citation" data-cites="Gardner85">Gardner and Mckenzie (<a href="#ref-Gardner85" role="doc-biblioref">1985</a>)</span>, es introducir un nuevo parámetro <span class="math inline">\(0 \leq \phi \leq 1\)</span> que <em>amortigua</em> la tendencia hasta hacerla plana en el largo plazo.</p>
<section id="formulas-interactivas-de-sus-componentes-1" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="formulas-interactivas-de-sus-componentes-1">Formulas interactivas de sus componentes</h3>
<p>Las <strong>ecuaciones recursivas</strong> son</p>
<p><span class="math display">\[
\begin{aligned}
l_t &amp; =\alpha y_t + (1-\alpha)(l_{t-1}+\phi b_{t-1}) \\
b_t &amp; =\beta (l_t - l_{t-1}) + (1-\beta)\phi b_{t-1}
\end{aligned}
\]</span></p>
<p>La ecuación de la <strong>predicción intramuestral</strong> a un periodo vista es <span class="math display">\[\widehat{y}_{t+1} = l_t + \phi b_t,\]</span> de forma que la ecuación de <strong>predicción extramuestral</strong> es <span class="math display">\[\widehat{y}_{T+h}=l_T + (\phi + \phi^2 + \ldots + \phi^h) b_T.\]</span></p>
<p>Se ha añadido un nuevo parámetro <span class="math inline">\(\phi\in [0, 1]\)</span> que acompaña siempre a la pendiente <span class="math inline">\(b_t\)</span>. Si <span class="math inline">\(\phi = 1\)</span>, se tiene el alisado de Holt y si <span class="math inline">\(\phi = 0\)</span>, se tiene el alisado simple. Se puede comprobar que en el largo plazo las predicciones se hacen constantes e iguales a <span class="math inline">\(l_T + \phi b_T/(1 - \phi)\)</span>.</p>
<p>Por razones prácticas el rango de búsqueda de <span class="math inline">\(\phi\)</span> queda en el intervalo <span class="math inline">\([0.8, 0.98]\)</span>. Si el valor óptimo de <span class="math inline">\(\phi\)</span> fuera su valor máximo de <span class="math inline">\(0.98\)</span> o muy cercano a este, cabría plantearse si no sería más adecuado un modelo sin amortiguamiento.</p>
</section>
<section id="ejemplo-de-aplicación-a-la-serie-residuos-1" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="ejemplo-de-aplicación-a-la-serie-residuos-1">Ejemplo de aplicación a la serie Residuos</h3>
<p>Vamos a usar el método de Alisado con amortiguamiento para predecir, una vez más, la serie Residuos añadiendo a la función <code>ets</code> el argumento <code>damped = TRUE</code>. En este caso, para ver el efecto del <em>amortiguamiento</em> vamos a pedir un horizonte temporal de previsión más largo.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>etsDResiduos <span class="ot">&lt;-</span> <span class="fu">ets</span>(residuos, </span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">model =</span> <span class="st">"AAN"</span>, </span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">damped =</span> <span class="cn">TRUE</span>)</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(etsDResiduos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ETS(A,Ad,N) 

Call:
ets(y = residuos, model = "AAN", damped = TRUE)

  Smoothing parameters:
    alpha = 0.9766 
    beta  = 0.3826 
    phi   = 0.98 

  Initial states:
    l = 512.9683 
    b = 28.5828 

  sigma:  22.0143

     AIC     AICc      BIC 
283.4818 287.2999 291.6855 

Training set error measures:
                    ME     RMSE      MAE        MPE     MAPE      MASE
Training set -2.914249 20.02682 15.48305 -0.4657129 2.852787 0.9633898
                  ACF1
Training set 0.0363016</code></pre>
</div>
</div>
<p>El valor óptimo del parámetro <span class="math inline">\(\phi\)</span> es <span class="math inline">\(0.98\)</span> y el error porcentual 2.85%, básicamente el mismo que al obtenido con el alisado de Holt sin amortiguamiento. Sin embargo, el modelo de Alisado con amortiguamiento genera intervalos de predicción correctos, cosa que no estaba tan clara con el modelo de Alisado de Holt.</p>
<p>Ahora bien, ante un valor de amortiguamiento igual a <span class="math inline">\(\phi = 0.98\)</span>, tan próximo a <span class="math inline">\(1\)</span>, sería razonable descartar este modelo y volver al modelo de Alisado sin amortiguamiento.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Parámetros estimados
</div>
</div>
<div class="callout-body-container callout-body">
<p>¿Cuántos parámetros se han estimado en este caso? ¿Cuáles?</p>
</div>
</div>
<p>La <a href="#fig-residuosAAdN" class="quarto-xref">Figura&nbsp;12</a> muestra la serie Residuos, su estimación intramuestral y las predicciones a 15 años vista. Observa que la pendiente de las previsiones se <em>amortigua</em> con el paso del tiempo: al principio las previsiones decrecen más rápidamente que en los últimos años.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>etsDResiduosf <span class="ot">&lt;-</span> <span class="fu">forecast</span>(etsDResiduos, </span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>                          <span class="at">h =</span> <span class="dv">15</span>,</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">level =</span> <span class="dv">95</span>)</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>etsDResiduosf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Point Forecast        Lo 95     Hi 95
2024       461.1032  417.9559291  504.2505
2025       456.8149  384.2729204  529.3569
2026       452.6124  348.8660108  556.3588
2027       448.4939  311.3433660  585.6445
2028       444.4578  271.7711682  617.1445
2029       440.5024  230.2999688  650.7049
2030       436.6262  187.0897946  686.1625
2031       432.8274  142.2914159  723.3634
2032       429.1046   96.0420917  762.1672
2033       425.4563   48.4655515  802.4471
2034       421.8810   -0.3268045  844.0887
2035       418.3771  -50.2344575  886.9887
2036       414.9434 -101.1663947  931.0531
2037       411.5783 -153.0398942  976.1964
2038       408.2805 -205.7794835 1022.3404</code></pre>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(etsDResiduosf,</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"kg per cápita"</span>,</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>,</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">PI =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-residuosAAdN" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-residuosAAdN-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-02-Tema2_files/figure-html/fig-residuosAAdN-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-residuosAAdN-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;12: Residuos y predicción con alisado exponencial con amortiguamiento
</figcaption>
</figure>
</div>
</div>
</div>
<p><br>
</p>
</section>
</section>
<section id="alisado-de-holt-winters-aditivo-a-a-a-y-multiplicativo-m-a-m" class="level2" data-number="5.7">
<h2 data-number="5.7" class="anchored" data-anchor-id="alisado-de-holt-winters-aditivo-a-a-a-y-multiplicativo-m-a-m"><span class="header-section-number">5.7</span> Alisado de Holt-Winters aditivo (A, A, A) y multiplicativo (M, A, M)</h2>
<p>El método de alisado exponencial de Holt-Winters es adecuado para una serie con tendencia y estacionalidad. Existen dos versiones según que el esquema sea aditivo o multiplicativo.</p>
<section id="alisado-de-holt-winters-aditivo-a-a-a" class="level3" data-number="5.7.1">
<h3 data-number="5.7.1" class="anchored" data-anchor-id="alisado-de-holt-winters-aditivo-a-a-a"><span class="header-section-number">5.7.1</span> Alisado de Holt-Winters aditivo (A, A, A)</h3>
<p>Las <strong>ecuaciones recursivas</strong> de actualización son:</p>
<p><span class="math display">\[
\begin{aligned}
l_t &amp; =\alpha (y_t - s_{t-m} ) + (1-\alpha)(l_{t-1}+b_{t-1}) \\
b_t &amp; =\beta (l_t - l_{t-1}) + (1-\beta)b_{t-1} \\
s_t &amp; =\gamma (y_t - l_{t-1} - b_{t-1}) + (1 - \gamma)s_{t-m}
\end{aligned}
\]</span> con <span class="math inline">\(0 \leq \alpha, \beta, \gamma \leq 1\)</span>.</p>
<p>La ecuación de la <strong>predicción intramuestral</strong> a un periodo vista es <span class="math display">\[\widehat{y}_{t+1}  = l_t + b_t + s_{t+1-m},\]</span> de forma que la ecuación de <strong>predicción extramuestral es</strong>: <span class="math display">\[\widehat{y}_{T+h}=l_T + h b_T + s_{T+h - m(k+1)},\]</span> con <span class="math inline">\(k = \lfloor(h-1)/m\rfloor\)</span>.</p>
<p>Observa que las ecuaciones para el nivel y la pendiente son similares a las ya vistas para el método de Holt. Respecto de la ecuación de actualización de la estacionalidad, dos estimaciones razonables de esta componente en el periodo <span class="math inline">\(t\)</span> son su valor estimado a partir de la serie menos su tendencia <span class="math inline">\(y_t-l_{t-1} - b_{t-1}\)</span>, y la estimación que ya teníamos de la estacionalidad previamente, <span class="math inline">\(s_{t-m}\)</span>. La estimación final es una media ponderada, parametrizada por <span class="math inline">\(0 \leq \gamma &lt; 1 - \alpha\)</span>.</p>
<p><strong>Interpretación del parámetro</strong> <span class="math inline">\(\gamma\)</span>:</p>
<ul>
<li>Si <span class="math inline">\(\gamma = 1\)</span>, <span class="math inline">\(s_t = y_t - l_{t-1} - b_{t-1}\)</span>, la estacionalidad se actualiza constantemente porque varía periodo a periodo</li>
<li>Si <span class="math inline">\(\gamma = 0\)</span>, <span class="math inline">\(s_t = s_{t-m}= \ldots = s_0\)</span>, la estacionalidad se mantiene constante en el tiempo.</li>
</ul>
<p><br>
</p>
</section>
<section id="alisado-de-holt-winters-multiplicativo-m-a-m" class="level3" data-number="5.7.2">
<h3 data-number="5.7.2" class="anchored" data-anchor-id="alisado-de-holt-winters-multiplicativo-m-a-m"><span class="header-section-number">5.7.2</span> Alisado de Holt-Winters multiplicativo (M, A, M)</h3>
<p>Las <strong>ecuaciones recursivas</strong> de actualización son:</p>
<p><span class="math display">\[
\begin{aligned}
l_t &amp; =\alpha \frac{y_t}{s_{t-m}} + (1-\alpha)(l_{t-1}+b_{t-1}) \\
b_t &amp; =\beta (l_t - l_{t-1}) + (1-\beta)b_{t-1} \\
s_t &amp; =\gamma \frac{y_t}{l_{t-1} + b_{t-1}} + (1 - \gamma)s_{t-m}
\end{aligned}
\]</span></p>
<p>La ecuación de la <strong>predicción intramuestral</strong> a un periodo vista es <span class="math display">\[\widehat{y}_{t+1}  = (l_t + b_t)s_{t+1-m},\]</span> de forma que la ecuación de <strong>predicción extramuestral es</strong>: <span class="math display">\[\widehat{y}_{T+h}=(l_T + h b_T)s_{T+h - m(k+1)}.\]</span></p>
</section>
<section id="ejemplo-con-demanda-electrica" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="ejemplo-con-demanda-electrica">Ejemplo con Demanda electrica</h3>
<p>Vamos a usar el método de <strong>Holt-Winters Aditivo</strong> para predecir la serie Demanda eléctrica, que presentaba un esquema aditivo. Para ello usaremos la función <code>ets</code> con el argumento <code>model = "AAA"</code> (y <code>damped = FALSE</code>). Vamos a considerar la serie desde el 5 de febrero (lunes) hasta el 2 de junio (domingo), 17 semanas, y pedir una previsión a dos semanas vista.</p>
<p>En el proceso de estimación, el parámetro <span class="math inline">\(\gamma\)</span> que gobierna la componente estacional está restringido a <span class="math inline">\(0 &lt; \gamma &lt; 1 - \alpha\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Nos quedamos con los meses de febrero a mayo.</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>electricidadr <span class="ot">&lt;-</span> <span class="fu">window</span>(electricidad, </span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">1</span>), </span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">end =</span> <span class="fu">c</span>(<span class="dv">22</span>, <span class="dv">7</span>)) </span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>electricidadEts <span class="ot">&lt;-</span> <span class="fu">ets</span>(electricidadr, </span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">model =</span> <span class="st">"AAA"</span>, </span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>                       <span class="at">damped =</span> <span class="cn">FALSE</span>)</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(electricidadEts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ETS(A,A,A) 

Call:
ets(y = electricidadr, model = "AAA", damped = FALSE)

  Smoothing parameters:
    alpha = 0.6529 
    beta  = 1e-04 
    gamma = 2e-04 

  Initial states:
    l = 730.3177 
    b = -0.7317 
    s = -82.5663 -42.14 24.6768 31.6077 24.791 28.1604
           15.4703

  sigma:  19.9488

     AIC     AICc      BIC 
1293.548 1296.492 1326.898 

Training set error measures:
                     ME     RMSE     MAE         MPE    MAPE      MASE
Training set 0.02358221 19.00449 11.5782 -0.04038823 1.79318 0.5237777
                  ACF1
Training set 0.1161587</code></pre>
</div>
</div>
<p>Los valores óptimos de los parámetros son <span class="math inline">\(\alpha=\)</span> 0.65, <span class="math inline">\(\beta=\)</span> 0 y <span class="math inline">\(\gamma=\)</span> 0. Los valores nulos para <span class="math inline">\(\beta\)</span> y <span class="math inline">\(\gamma\)</span> indican que ambas, la pendiente y la estacionalidad, permanecen constantes en el tiempo (véase <a href="#fig-electricidadAAAComponentes" class="quarto-xref">Figura&nbsp;13</a>).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(electricidadEts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-electricidadAAAComponentes" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-electricidadAAAComponentes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-02-Tema2_files/figure-html/fig-electricidadAAAComponentes-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-electricidadAAAComponentes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;13: Componentes del modelo de Holt-Winters aditivo para Demanda eléctrica
</figcaption>
</figure>
</div>
</div>
</div>
<p>La calidad de las predicciones es notable, con un error porcentual medio del 1.8%.</p>
<p>Los últimos valores de las componentes son,</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>TT <span class="ot">&lt;-</span> <span class="fu">nrow</span>(electricidadEts<span class="sc">$</span>states)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>electricidadEts<span class="sc">$</span>states[TT,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>      l       b      s1      s2      s3      s4      s5      s6      s7 
644.537  -0.731 -82.564 -42.136  24.674  31.602  24.796  28.159  15.469 </code></pre>
</div>
</div>
<p>Como el último dato de la serie es domingo 2 de junio, los valores del nivel <span class="math inline">\(l\)</span> y la pendiente <span class="math inline">\(b\)</span> mostrados corresponden a ese día. Sin embargo, los valores de <strong>la componente estacional están ordenados al revés</strong> partiendo de domingo: s1 es el valor estacional para domingo (día del último dato, 2 de junio), s2 el de sábado, s3 de viernes, hasta s7 que sería lunes. Podemos reproducir las predicciones para los próximos 7 días, 3 a 9 de junio (ojo, el etiquetado de la salida no tiene sentido):</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>electricidadEts<span class="sc">$</span>states[TT, <span class="dv">1</span>] <span class="sc">+</span> (<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>)<span class="sc">*</span>electricidadEts<span class="sc">$</span>states[TT, <span class="dv">2</span>] <span class="sc">+</span> </span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  electricidadEts<span class="sc">$</span>states[TT, <span class="dv">9</span><span class="sc">:</span><span class="dv">3</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      s7       s6       s5       s4       s3       s2       s1 
659.2750 671.2336 667.1390 673.2131 665.5539 598.0128 556.8534 </code></pre>
</div>
</div>
<p>O mejor usar la función <code>forecast</code> para obtener las predicciones y sus intervalos a dos semanas vista.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>electricidadf <span class="ot">&lt;-</span> <span class="fu">forecast</span>(electricidadEts,</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>                          <span class="at">h =</span> <span class="dv">14</span>, </span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">level =</span> <span class="dv">95</span>)</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>electricidadf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         Point Forecast    Lo 95    Hi 95
23.00000       659.2750 620.1760 698.3740
23.14286       671.2336 624.5360 717.9312
23.28571       667.1390 613.9148 720.3632
23.42857       673.2131 614.1777 732.2485
23.57143       665.5539 601.2286 729.8793
23.71429       598.0128 528.7992 667.2265
23.85714       556.8534 483.0732 630.6337
24.00000       654.1553 576.0716 732.2390
24.14286       666.1139 583.9526 748.2753
24.28571       662.0193 575.9721 748.0665
24.42857       668.0935 578.3272 757.8597
24.57143       660.4343 567.0960 753.7726
24.71429       592.8932 496.1134 689.6729
24.85714       551.7338 451.6298 651.8377</code></pre>
</div>
</div>
<p>La <a href="#fig-electricidadAAA" class="quarto-xref">Figura&nbsp;14</a> muestra la serie Demanda eléctrica y las previsiones extramuestrales.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(electricidadf,</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"GWh"</span>,</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>,</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">PI =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-electricidadAAA" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-electricidadAAA-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-02-Tema2_files/figure-html/fig-electricidadAAA-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-electricidadAAA-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;14: Demanda eléctrica y predicción con alisado de Holt-Winters aditivo
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="ejemplo-con-nacimientos" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="ejemplo-con-nacimientos">Ejemplo con Nacimientos</h3>
<p>Vamos a usar el método de <strong>Holt-Winters multiplicativo</strong> para predecir la serie Nacimientos, que presentaba un esquema multiplicativo. En este caso usaremos el argumento <code>model = "MAM"</code>. Vamos a considerar la serie Nacimientos desde enero de 2000 y pedir una previsión a dos años vista.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>nacimientosb <span class="ot">&lt;-</span> <span class="fu">window</span>(nacimientos, <span class="at">start =</span> <span class="dv">2000</span>)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>nacimientosbEts <span class="ot">&lt;-</span> <span class="fu">ets</span>(nacimientosb, </span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">model =</span> <span class="st">"MAM"</span>, </span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">damped =</span> <span class="cn">FALSE</span>)</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nacimientosbEts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ETS(M,A,M) 

Call:
ets(y = nacimientosb, model = "MAM", damped = FALSE)

  Smoothing parameters:
    alpha = 0.6035 
    beta  = 0.069 
    gamma = 2e-04 

  Initial states:
    l = 33048.2136 
    b = 133.9574 
    s = 0.9959 1.0004 1.0561 1.0382 1.0313 1.0383
           0.9735 1.0043 0.9592 0.996 0.908 0.9988

  sigma:  0.0278

     AIC     AICc      BIC 
5967.022 5969.147 6030.323 

Training set error measures:
                    ME     RMSE      MAE         MPE     MAPE      MASE
Training set -6.188543 891.1403 668.3472 -0.05242082 1.962985 0.5067597
                   ACF1
Training set 0.01019654</code></pre>
</div>
</div>
<p>Los valores óptimos de los parámetros son <span class="math inline">\(\alpha=\)</span> 0.6, <span class="math inline">\(\beta=\)</span> 0.07 y <span class="math inline">\(\gamma=\)</span> 0. Los valores tan bajos para <span class="math inline">\(\beta\)</span> y <span class="math inline">\(\gamma\)</span> indican que ambas, la pendiente y la estacionalidad, modifican su valor muy lentamente (véase <a href="#fig-nacimientosMAMComponentes" class="quarto-xref">Figura&nbsp;15</a>).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(nacimientosbEts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-nacimientosMAMComponentes" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-nacimientosMAMComponentes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-02-Tema2_files/figure-html/fig-nacimientosMAMComponentes-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-nacimientosMAMComponentes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;15: Componentes del modelo de Holt-Winters multiplicativo para Nacimientos
</figcaption>
</figure>
</div>
</div>
</div>
<p>La calidad de las predicciones es notable, con un error porcentual medio inferior al 2%.</p>
<p>Los últimos valores de las componentes son,</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>TT <span class="ot">&lt;-</span> <span class="fu">nrow</span>(nacimientosbEts<span class="sc">$</span>states)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>nacimientosbEts<span class="sc">$</span>states[TT,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>        l         b        s1        s2        s3        s4        s5        s6 
26607.274    -5.338     0.973     1.004     0.959     0.996     0.908     0.999 
       s7        s8        s9       s10       s11       s12 
    0.996     1.000     1.056     1.038     1.031     1.038 </code></pre>
</div>
</div>
<p>Como el último dato de la serie es junio de 2025, los valores del nivel <span class="math inline">\(l\)</span> y la pendiente <span class="math inline">\(b\)</span> mostrados corresponden a ese mes. Sin embargo, recuerda que la componente estacional sigue un orden inverso: s1 es el valor estacional para junio (mes del último dato), s2 el de mayo, s3 de abril, hasta s11 que sería agosto y s12 que es julio.</p>
<p>Podemos reproducir las predicciones para los primeros 12 meses de julio de 2025 a junio de 2026 (recuerda, el etiquetado de la salida no es correcto) para ver que coinciden con las obtenidas con la función <code>forecast</code> (solo se muestran los primeros meses).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>(nacimientosbEts<span class="sc">$</span>states[TT, <span class="dv">1</span>] <span class="sc">+</span> (<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>)<span class="sc">*</span>nacimientosbEts<span class="sc">$</span>states[TT, <span class="dv">2</span>]) <span class="sc">*</span> </span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  nacimientosbEts<span class="sc">$</span>states[TT, <span class="dv">14</span><span class="sc">:</span><span class="dv">3</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     s12      s11      s10       s9       s8       s7       s6       s5 
27621.59 27430.07 27608.68 28077.16 26591.51 26465.81 26537.31 24119.46 
      s4       s3       s2       s1 
26452.03 25471.08 26662.84 25839.21 </code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>nacimientosbf <span class="ot">&lt;-</span> <span class="fu">forecast</span>(nacimientosbEts, </span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>                              <span class="at">h =</span> <span class="dv">24</span>, </span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>                              <span class="at">level =</span> <span class="dv">95</span>)</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>nacimientosbf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>         Point Forecast    Lo 95    Hi 95
Jul 2025       27621.59 26115.40 29127.78
Aug 2025       27430.07 25627.16 29232.99
Sep 2025       27608.68 25477.52 29739.84
Oct 2025       28077.16 25578.84 30575.48
Nov 2025       26591.51 23902.47 29280.55</code></pre>
</div>
</div>
<p>La <a href="#fig-nacimientosMAM" class="quarto-xref">Figura&nbsp;16</a> muestra la serie Nacimientos y las previsiones extramuestrales.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(nacimientosbf,</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"Nacimientos"</span>,</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>,</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">PI =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-nacimientosMAM" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-nacimientosMAM-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-02-Tema2_files/figure-html/fig-nacimientosMAM-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-nacimientosMAM-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;16: Nacimientos y predicción con alisado de Holt-Winters multiplicativo
</figcaption>
</figure>
</div>
</div>
</div>
<p><br>
</p>
</section>
</section>
<section id="ejemplo-con-transformación-logarítmica" class="level2" data-number="5.8">
<h2 data-number="5.8" class="anchored" data-anchor-id="ejemplo-con-transformación-logarítmica"><span class="header-section-number">5.8</span> Ejemplo con transformación logarítmica</h2>
<p>Una alternativa para predecir cualquier serie es predecir su transformación logarítmica. Después, se aplica la transformación inversa y se obtienen las predicciones de la serie original. No siempre, pero este procedimiento puede mejorar la calidad de las predicciones. Además, este proceso asegura que las predicciones y sus intervalos sean siempre positivas (ve a la píldora <em>Series acotadas</em> para aprender más sobre cómo garantizar que las predicciones sean positivas o que permanezcan dentro de cierto intervalo).</p>
<p>El uso de la transformación logarítmica en la estimación de modelos y predicción se puede realizar de forma sencilla y transparente con cualquiera de las funciones de que hemos visto a partir de los argumentos <code>lambda</code> y <code>biasadj</code>.</p>
<ul>
<li><p><code>lambda = 0</code> indica que se ha de realizar la transformación logarítmica de la serie previamente a su modelización. Es un parámetro de la transformación Box-Cox que no veremos en detalle en el tema 3.</p></li>
<li><p><code>biasadj = TRUE</code> es necesario si tras una transformación de la serie original queremos que las predicciones sean insesgadas. Es decir, queremos obtener la predicción <em>media</em>.</p>
<p>Sea <span class="math inline">\(y_t\)</span> la serie original y <span class="math inline">\(z_t=log(y_t)\)</span> su transformación logarítmica. Si obtenemos una predicción <span class="math inline">\(\widehat{y}_t\)</span> de la serie original, esta será insesgada <span class="math inline">\(E[\widehat{y}_t]=y_t\)</span>. Ahora bien, si obtenemos una predicción <span class="math inline">\(\widehat{z}_t\)</span> de la serie transformada, podemos pensar que <span class="math inline">\(e^{\widehat{z}_t}\)</span> es una predicción insesgada de la serie original, pero resulta que <span class="math inline">\(E[e^{\widehat{z}_t}] \neq y_t\)</span>. Es decir, la exponencial de la predicción de la serie con transformada logarítmica no es insesgada.</p>
<p>Si el argumento <code>biasadj</code> es fijado a FALSE, las predicciones se calcularán de forma directa deshaciendo la transformación y serán sesgadas. En concreto, lo que se obtiene es una predicción <em>mediana</em>. Si, por el contrario, es fijado a TRUE, las predicciones se calcularán por medio de una fórmula alternativa y serán insesgadas.</p>
<p>En ambos casos, para series largas no debería observarse mucha diferencia entre las dos alternativas.</p></li>
</ul>
<p>Vamos a practicar el uso de estos argumentos con la serie Nacimientos. Como se va a predecir el logaritmo de la serie, se debe indicar a la función <code>ets</code> <code>model = "AAA"</code> que estima el modelo Holt-Winters aditivo. Además, vamos a pedir que las predicciones sean insesgadas con <code>biasadj = TRUE</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>nacimientosbEtsl <span class="ot">&lt;-</span> <span class="fu">ets</span>(nacimientosb, </span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">model =</span> <span class="st">"AAA"</span>,</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">damped =</span> <span class="cn">FALSE</span>,</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">lambda =</span> <span class="dv">0</span>, </span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">biasadj =</span> <span class="cn">TRUE</span>)</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nacimientosbEtsl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ETS(A,A,A) 

Call:
ets(y = nacimientosb, model = "AAA", damped = FALSE, lambda = 0, 
    biasadj = TRUE)

  Box-Cox transformation: lambda= 0 

  Smoothing parameters:
    alpha = 0.1432 
    beta  = 0.0101 
    gamma = 0.249 

  Initial states:
    l = 10.411 
    b = 9e-04 
    s = 0.0045 0.0156 0.0603 0.063 0.0307 0.0133
           -0.0383 0.0205 -0.0304 -0.0033 -0.09 -0.046

  sigma:  0.0314

      AIC      AICc       BIC 
-348.5507 -346.4257 -285.2498 

Training set error measures:
                    ME     RMSE     MAE        MPE     MAPE      MASE      ACF1
Training set -40.89966 1011.194 772.584 -0.1295977 2.272043 0.5857951 0.4303813</code></pre>
</div>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>nacimientosbfl <span class="ot">&lt;-</span> <span class="fu">forecast</span>(nacimientosbEtsl,</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>                           <span class="at">h =</span> <span class="dv">24</span>,</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>                           <span class="at">level =</span> <span class="dv">95</span>,</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">biasadj =</span> <span class="cn">TRUE</span>)</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>nacimientosbfl</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         Point Forecast    Lo 95    Hi 95
Jul 2025       27877.76 26199.38 29634.38
Aug 2025       27981.87 26278.00 29766.11
Sep 2025       27759.83 26048.10 29553.37
Oct 2025       28496.48 26714.94 30364.41
Nov 2025       27059.11 25341.90 28860.91
Dec 2025       26506.84 24797.32 28302.02
Jan 2026       26513.34 24773.64 28341.79
Feb 2026       24306.74 22682.37 26015.61
Mar 2026       26334.48 24540.28 28223.91
Apr 2026       25188.27 23437.10 27034.41
May 2026       26101.51 24248.18 28057.61
Jun 2026       25982.92 24097.23 27975.60
Jul 2026       27839.46 25650.55 30163.59
Aug 2026       27944.14 25701.26 30328.64
Sep 2026       27723.14 25450.34 30142.72
Oct 2026       28459.61 26075.20 31001.62
Nov 2026       27024.89 24709.89 29496.56
Dec 2026       26474.12 24154.49 28954.57
Jan 2027       26481.44 24107.35 29024.22
Feb 2027       24278.30 22050.59 26668.28
Mar 2027       26304.55 23833.65 28960.03
Apr 2027       25160.53 22740.58 27765.93
May 2027       26073.71 23505.60 28843.73
Jun 2027       25956.21 23337.93 28785.72</code></pre>
</div>
</div>
<p>En este caso la calidad de las predicciones (MAPE = 2.3%) es algo superior a la obtenida con la serie sin transformar.</p>
<p>La <a href="#fig-nacimientoslog" class="quarto-xref">Figura&nbsp;17</a> muestra la serie Nacimientos y las previsiones extramuestrales obtenidas con y sin la transformación logarítmica. En este caso, las previsiones con la serie sin transformar son mayores que las obtenidas con la serie transformada en los meses de primavera e inferiores el resto del año.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-nacimientoslog" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-nacimientoslog-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-02-Tema2_files/figure-html/fig-nacimientoslog-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-nacimientoslog-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;17: Nacimientos y dos predicciones con alisado de Holt-Winters
</figcaption>
</figure>
</div>
</div>
</div>
<p>La <a href="#tbl-nacimientoslog" class="quarto-xref">Tabla&nbsp;2</a> muestra las predicciones de Nacimientos obtenidas sin transformar la serie, con transformación logarítmica y predicciones insesgadas (<code>biasadj = TRUE</code>), y con transformación logarítmica y predicciones sesgadas (<code>biasadj = FALSE</code>).</p>
<div class="cell" data-layout-align="center">
<div id="tbl-nacimientoslog" class="cell quarto-float anchored" data-layout-align="center">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-nacimientoslog-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabla&nbsp;2: Diferencias en la predicción según transformación logarítmica y corrección por sesgo
</figcaption>
<div aria-describedby="tbl-nacimientoslog-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">Sin transformar</th>
<th style="text-align: right;">log(Nac) insesgadas</th>
<th style="text-align: right;">log(Nac) sesgadas</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">27621.59</td>
<td style="text-align: right;">27877.76</td>
<td style="text-align: right;">27863.99</td>
</tr>
<tr class="even">
<td style="text-align: right;">27430.07</td>
<td style="text-align: right;">27981.87</td>
<td style="text-align: right;">27967.73</td>
</tr>
<tr class="odd">
<td style="text-align: right;">27608.68</td>
<td style="text-align: right;">27759.83</td>
<td style="text-align: right;">27745.44</td>
</tr>
<tr class="even">
<td style="text-align: right;">28077.16</td>
<td style="text-align: right;">28496.48</td>
<td style="text-align: right;">28481.28</td>
</tr>
<tr class="odd">
<td style="text-align: right;">26591.51</td>
<td style="text-align: right;">27059.11</td>
<td style="text-align: right;">27044.23</td>
</tr>
<tr class="even">
<td style="text-align: right;">26465.81</td>
<td style="text-align: right;">26506.84</td>
<td style="text-align: right;">26491.78</td>
</tr>
<tr class="odd">
<td style="text-align: right;">26537.31</td>
<td style="text-align: right;">26513.34</td>
<td style="text-align: right;">26497.73</td>
</tr>
<tr class="even">
<td style="text-align: right;">24119.46</td>
<td style="text-align: right;">24306.74</td>
<td style="text-align: right;">24291.88</td>
</tr>
<tr class="odd">
<td style="text-align: right;">26452.03</td>
<td style="text-align: right;">26334.48</td>
<td style="text-align: right;">26317.73</td>
</tr>
<tr class="even">
<td style="text-align: right;">25471.08</td>
<td style="text-align: right;">25188.27</td>
<td style="text-align: right;">25171.57</td>
</tr>
<tr class="odd">
<td style="text-align: right;">26662.84</td>
<td style="text-align: right;">26101.51</td>
<td style="text-align: right;">26083.44</td>
</tr>
<tr class="even">
<td style="text-align: right;">25839.21</td>
<td style="text-align: right;">25982.92</td>
<td style="text-align: right;">25964.10</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>Las predicciones sesgadas son menores que las insesgadas. Esto siempre es así. La diferencia depende fundamentalmente de la desviación típica del error, <em>sigma</em> en la salida de los métodos de alisado exponencial. Cuanto mayor es <em>sigma</em>, mayores son las diferencias.</p>
<p>Por otro lado, las predicciones obtenidas sin y con la transformación logarítmica no guardan ninguna relación.</p>
<p><strong>Ni la transformación logarítmica ni el uso de predicciones insesgadas aseguran mejores predicciones respecto de otras opciones</strong>, como puede ser trabajar con predicciones sesgadas o no realizar la transformación logarítmica. Hay que usar Origen de predicción móvil para determinar que transformación es la mejor.</p>
</section>
<section id="casos-generales-de-alisado-exponencial-la-función-ets-de-nuevo" class="level2" data-number="5.9">
<h2 data-number="5.9" class="anchored" data-anchor-id="casos-generales-de-alisado-exponencial-la-función-ets-de-nuevo"><span class="header-section-number">5.9</span> Casos generales de alisado exponencial: la función <code>ets</code> (de nuevo)</h2>
<p>En los epígrafes previos hemos visto cinco de los casos expuestos en la taxonomía de la <a href="#tbl-taxonomia" class="quarto-xref">Tabla&nbsp;1</a>, fijados a partir de los argumentos <code>model</code> y <code>damped</code> de la función <code>ets</code>. Veamos ahora como estimar cualquiera de los treinta modelos que surgen según las diferentes posibilidades de la tendencia (N, A, Ad, M y Md), la estacionalidad (N, A y M) y el error (A, M).</p>
<p>Recordemos que el tipo de error no influye en el cálculo de las previsiones, solo influye en el cálculo del intervalo de confianza de estas.</p>
<p><strong>Podemos estimar cualquiera de los treinta modelos usando la función <code>ets</code> del paquete <code>forecast</code>.</strong></p>
<p>Lo más habitual es no saber cual es el mejor modelo, entendiendo como tal, el que mejor se ajusta a la serie temporal. De hecho, si lo que buscamos es predecir bien, el mejor modelo será el que mejor prediga.</p>
<p>Si en una de las tres letras del código del modelo se indica “Z”, la función <code>ets</code> selecciona de entre los modelos posibles el que mejor se ajusta. Por ejemplo, <code>model = "AAZ"</code> indica un modelo con error y pendiente aditivos y dejaría a <code>ets</code> la búsqueda de la mejor opción para la estacionalidad (aditiva o multiplicativa). Si se especifica <code>model = "ZZZ</code> junto con <code>damped = NULL</code> (opciones por defecto) se dejaría a la función total libertad para buscar entre todos los modelos (excepto aquellos con pendiente multiplicativa). Si se desea restringir la búsqueda a modelos sin amortiguamiento basta indicar <code>damped = FALSE</code> y si se desea restringir la búsqueda solo a modelos aditivos se puede usar el argumento <code>additive.only = TRUE</code>.</p>
<section id="criterios-de-optimización" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="criterios-de-optimización">Criterios de optimización</h3>
<p>Fijado un modelo, <code>ets</code> estima por defecto sus parámetros maximizando la función de verosimilitud. Esta búsqueda esta restringida a <span class="math inline">\(0 &lt; \beta &lt; \alpha &lt; 1\)</span>, <span class="math inline">\(0 &lt; \gamma &lt; 1 - \alpha\)</span> y <span class="math inline">\(0.8 &lt; \phi &lt; 0.98\)</span>. Es decir, los tres primeros parámetros nunca pueden ser 0 o 1, y en la práctica sus valores límite son 0.0001 y 0.9999.</p>
<p>Puedes cambiar el criterio de optimización con el argumento <code>opt.crit</code>. Por defecto vale “lik” (de <em>likelihood</em> o verosimilitud), pero si lo fijas a <code>opt.crit = "mse"</code> se estiman los parámetros que minimizan el error cuadrático medio. Otra opción interesante es <code>opt.crit = "amse"</code> que minimiza la media de los errores cuadráticos medios obtenido sobre las previsiones hasta <code>nmse</code> periodos vista. En este caso usa el argumento <code>nmse</code> para fijar el valor numérico del horizonte temporal.</p>
</section>
<section id="criterios-de-selección-de-modelos" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="criterios-de-selección-de-modelos">Criterios de selección de modelos</h3>
<p>Queda pendiente saber que criterio se usa para seleccionar el modelo cuando se ofrece esta opción. Esto se hace a partir de un criterio de información entre Akaike (aic), Akaike corregido para pequeñas muestras (aicc) y el Bayesiano (bic). Sus fórmulas son: <span class="math display">\[aic = -2log(L) + 2k\]</span> <span class="math display">\[aicc = aic + \frac{k(k+1)}{T-k-1}\]</span> <span class="math display">\[bic=aic + k(log(T) - 2)\]</span> donde <span class="math inline">\(L\)</span> es la verosimilitud, <span class="math inline">\(T\)</span> el número de datos y <span class="math inline">\(k\)</span> el de parámetros estimados (incluidos los puntos iniciales de arranque y la desviación típica del error).</p>
<p><strong>Cuanto menor es el criterio de información, mejor modelo</strong>. Por defecto se usa Akaike corregido para pequeñas muestras (aicc), pero el argumento <code>ic</code> permite cambiar de criterio.</p>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Una reflexión sobre los métodos automáticos de selección de modelos
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Con el comando <code>forecast(ets(nacimientos),h=24)</code> obtenemos una predicción mensual a dos años vista del número de nacimientos en España. Así de simple, solo 31 caracteres. Todo esto gracias a que un algoritmo interno ha estimado los parámetros de múltiples modelos, elegido el mejor modelo de todos y lo ha usado para obtener las predicciones. Podemos afirmar que tenemos las mejores predicciones. Un momento, ¿podemos?</p>
<p>Parémonos a reflexionar sobre lo que hemos hecho o, más bien, lo que el algoritmo ha hecho y a contrastarlo con lo que nosotros queríamos. Por un lado, el algoritmo estima los parámetros de un menú fijo de modelos y para ello usa un criterio de optimización, que por defecto es maximizar la función de verosimilitud; cuando ya tiene estimados todos los modelos, elije el mejor usando el criterio de información de Akaike corregido para muestras pequeñas; y finalmente, nosotros medimos la capacidad predictiva del modelo seleccionado usando el error absoluto porcentual medio. Vaya, resulta que en los procesos de identificación y estimación del mejor modelo se usan dos criterios diferentes, que además no coinciden con nuestro criterio de calidad de las predicciones.</p>
<p>Si consideramos que la calidad de un modelo viene dada por el error absoluto porcentual medio en las predicciones intramuestrales a un periodo vista (lo que hemos decidido llamar MAPE), ¿no deberíamos estimar los parámetros del modelo usando como criterio la minimización del MAPE?, ¿no deberíamos elegir entre varios modelos aquel que presenta un MAPE menor? De esta forma, en todos los pasos del proceso se usa el mismo criterio, que es, además, el criterio que hemos considerado adecuado para valorar la calidad de las predicciones.</p>
<p>Pero no es esto lo que hacemos.</p>
<p>Nada nos garantiza que el modelo estimado y seleccionado por el algoritmo estime las mejores predicciones posibles. Y por <em>mejores</em> quiero decir que de entre todos los posibles modelos del menú y todos los posibles valores de sus parámetros, el seleccionado sea el que minimiza nuestro criterio de calidad de las predicciones.</p>
<p>Ahora ya podemos dar respuesta a la pregunta del primer párrafo: no, no podemos afirmar que nuestras predicciones sean las mejores.</p>
<p>Alguien dirá que casi seguro entre las predicciones subóptimas obtenidas por el algoritmo con su extraña mezcla de criterios y las predicciones óptimas de verdad no habrá mucha diferencia. Total, que más da una función de verosimilitud que un criterio de información que una medida del error medio. Pero lo cierto es que no lo sabemos, no tenemos ni idea de la distancia que hay entre lo óptimo y lo subóptimo, y si el coste de equivocarme en las predicciones es alto, puede que incluso una pequeña diferencia sea relevante.</p>
<p>Esta reflexión realizada en el contexto de series temporales y para la función <code>ets</code> es aplicable a todos los casos donde dejamos que un algoritmo ya programado elija el mejor modelo, y se basa en el hecho de que rara vez los criterios de estimación y elección que usan los algoritmos coinciden con el concepto de calidad de ajuste que estamos interesados.</p>
<p>A pesar de lo aquí expuesto, como es más cómodo (y rápido) tirar de rutinas ya programadas que escribir nuestro propio código, seguiremos trabajando con modelos subóptimos y obteniendo estimaciones subóptimas, pero diciendo que son las mejores.</p>
</div>
</div>
</div>
<p><br>
<br>
</p>
</section>
</section>
</section>
<section id="ejemplos-de-aplicación" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Ejemplos de aplicación</h1>
<p><br>
</p>
<section id="recogida-de-residuos" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="recogida-de-residuos"><span class="header-section-number">6.1</span> Recogida de residuos</h2>
<section id="identificación-y-estimación-del-mejor-modelo" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="identificación-y-estimación-del-mejor-modelo">Identificación y estimación del mejor modelo</h3>
<p>Si estimamos el mejor modelo de alisado exponencial para la serie Residuos sin ningún tipo de restricción, nos encontramos:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>residuosEts <span class="ot">&lt;-</span> <span class="fu">ets</span>(residuos)</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(residuosEts) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ETS(M,A,N) 

Call:
ets(y = residuos)

  Smoothing parameters:
    alpha = 0.9999 
    beta  = 0.4498 

  Initial states:
    l = 490.9216 
    b = 6.8509 

  sigma:  0.0358

     AIC     AICc      BIC 
273.6061 276.2148 280.4425 

Training set error measures:
                     ME     RMSE      MAE         MPE     MAPE      MASE
Training set -0.9595632 19.22314 15.12049 -0.08559712 2.768678 0.9408304
                   ACF1
Training set 0.03440538</code></pre>
</div>
</div>
<p>El modelo estimado es ETS(M,A,N) o “MAN”, un modelo con pendiente aditiva, sin estacionalidad y con error multiplicativo. Es decir, <span class="math inline">\(y_{t+1} = (l_t + b_t) \cdot (1 + \varepsilon_{t+1})\)</span>.</p>
<p>El valor de <span class="math inline">\(\alpha\)</span> técnicamente es 1, indicando que el nivel de la serie varia constantemente en el tiempo. El valor de <span class="math inline">\(\beta = 0.45\)</span> indica que también la pendiente cambia en el tiempo.</p>
<p>Respecto de la calidad del modelo, el valor de MAPE= <span class="math inline">\(2.8\)</span>% evidencia que estamos ante un modelo que se ajusta bien a los datos. MASE= <span class="math inline">\(0.94\)</span> indica que el modelo de alisado exponencial simple reduce en solo un <span class="math inline">\(6\)</span>% el error del método ingenuo I. Además, el modelo estimado no presenta sesgo.</p>
</section>
<section id="predicción" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="predicción">Predicción</h3>
<p>Mediante la función <code>forecast</code> podemos predecir la serie Residuos. La última pendiente estimada por Alisado es negativa (<span class="math inline">\(b_{2023}\)</span> = -5.67), por tanto, la predicción decrece en el tiempo (véase <a href="#fig-residuosETSLibre" class="quarto-xref">Figura&nbsp;18</a>).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>residuosEtsPre <span class="ot">&lt;-</span> <span class="fu">forecast</span>(residuosEts, </span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">h =</span> <span class="dv">5</span>,</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">level =</span> <span class="dv">95</span>)</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>residuosEtsPre</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Point Forecast    Lo 95    Hi 95
2024       459.3359 427.1431 491.5288
2025       453.6698 397.1732 510.1664
2026       448.0037 365.1582 530.8492
2027       442.3376 330.7965 553.8787
2028       436.6715 294.1520 579.1909</code></pre>
</div>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(residuosEtsPre,</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"Kg per cápita"</span>,</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-residuosETSLibre" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-residuosETSLibre-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-02-Tema2_files/figure-html/fig-residuosETSLibre-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-residuosETSLibre-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;18: Residuos y predicción a 5 años vista
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="análisis-del-residuo" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="análisis-del-residuo">Análisis del residuo</h3>
<p>El error de un modelo de alisado <em>contiene</em> la componente de <strong>Intervención</strong> y el propio término de <strong>Error</strong>. Ver numérica o gráficamente el error permite identificar fácilmente la presencia de valores atípicos (intervención). Obtenemos el error con la función <code>residuals</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>error <span class="ot">&lt;-</span> <span class="fu">residuals</span>(residuosEts)</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>sderror <span class="ot">&lt;-</span> <span class="fu">sd</span>(error)</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(error, <span class="at">series=</span><span class="st">"Error"</span>,</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">"Periodo"</span>,</span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"Error"</span>,</span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span> ,<span class="dv">3</span>)<span class="sc">*</span>sderror, </span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"blue"</span>, <span class="st">"blue"</span>, <span class="st">"red"</span>), <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span> <span class="fu">seq</span>(<span class="dv">1995</span>, <span class="dv">2023</span>, <span class="dv">2</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-residuoError" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-residuoError-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-02-Tema2_files/figure-html/fig-residuoError-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-residuoError-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;19: Error + Intervención
</figcaption>
</figure>
</div>
</div>
</div>
<p>La <a href="#fig-residuoError" class="quarto-xref">Figura&nbsp;19</a> muestra que aunque algún error supera las dos desviaciones típicas, ninguno puede ser considerado claramente como atípico.</p>
</section>
<section id="validación-error-extramuestral-a-varios-periodos-vista" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="validación-error-extramuestral-a-varios-periodos-vista">Validación: error extramuestral a varios periodos vista</h3>
<p>Vamos a mejorar la estimación de la calidad de las predicciones obteniendo el MAPE para <strong>previsiones extramuestrales a varios periodos vista</strong>. Para ello vamos a reservar, por ejemplo, las últimas 6 observaciones de la serie Residuos y ajustar el modelo con las restantes. Después usaremos este modelo para calcular las predicciones a 6 periodos vista y compararlas con los valores reales de la serie Residuos.</p>
<p>Recuerda, este método para valorar la calidad de las predicciones usa la filosofía del método <em>Conjunto de entrenamiento/Conjuto de prueba</em>: el periodo de datos usado en la estimación no se usa como periodo de datos para la validación. Sin embargo, tiene el problema de que el error obtenido es una mezcla de errores de predicción a corto, medio y largo plazo difícil de valorar. Además, los resultados dependen tremendamente del punto de corte temporal seleccionado.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Definimos las observaciones intra y extramuestrales</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>residuoIntra <span class="ot">&lt;-</span> <span class="fu">subset</span>(residuos, <span class="at">end =</span> <span class="fu">length</span>(residuos) <span class="sc">-</span> <span class="dv">6</span>)</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>residuoExtra <span class="ot">&lt;-</span> <span class="fu">subset</span>(residuos, <span class="at">start =</span> <span class="fu">length</span>(residuos) <span class="sc">-</span> <span class="dv">5</span>)</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimamos el modelo con todos los datos menos los 6 ultimos</span></span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>residuoIntraEts <span class="ot">&lt;-</span> <span class="fu">ets</span>(residuoIntra, <span class="at">model =</span> <span class="st">"MAN"</span>)</span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Predecimos los 6 años que hemos quitado de la serie y </span></span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a><span class="co"># vemos la calidad del ajuste.</span></span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a>residuoExtraPre <span class="ot">&lt;-</span> <span class="fu">forecast</span>(residuoIntraEts, <span class="at">h =</span> <span class="dv">6</span>)</span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(residuoExtraPre, residuoExtra)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                    ME      RMSE       MAE        MPE     MAPE      MASE
Training set -3.567170 26.775671 19.987941 -0.5625129 3.637451 1.0993368
Test set      3.771456  8.501916  6.681918  0.7726736 1.400719 0.3675055
                    ACF1 Theil's U
Training set  0.05629426        NA
Test set     -0.08588046 0.7548456</code></pre>
</div>
</div>
<p>Atendiendo al MAPE se tiene que el error de <strong>previsión a un periodo vista</strong> en el <strong>periodo intramuestral</strong> de <strong>1995 a 2017</strong> es del 3.6%; y el error de <strong>previsión a largo plazo</strong> en el <strong>periodo extramuestral</strong> de <strong>2018 a 2023</strong> es del 1.4%. Para el punto de corte elegido, la calidad de las previsiones no se deteriora cuanto nos salimos de las condiciones óptimas.</p>
<p>Un gráfico puede ayudar a entender este proceso de validación. En la <a href="#fig-residuosTSTS" class="quarto-xref">Figura&nbsp;20</a>:</p>
<ul>
<li>La línea de puntos vertical separa el periodo muestral (1995-2017) usado para estimar el modelo, del periodo extramuestral (2018-2023) usado sólo para hacer las previsiones.</li>
<li>La serie Residuos aparece como una línea sólida en negro, desde 1995 hasta 2023.</li>
<li>La previsión <em>intra</em>-muestral (a un periodo vista) de la serie Residuos aparece como una línea azul. Observa la previsión puede ser mayor o menor que la serie, no evidenciándose sesgo.</li>
<li>La línea en rojo es la previsión <em>extra</em>-muestral a largo plazo: <span class="math inline">\(\hat{y}_{T+h}=l_T\)</span>, donde <span class="math inline">\(T=2017\)</span>. Observa que casi todas las previsiones están por debajo del valor real de la serie.</li>
<li>Al lado de cada previsión se ha indicado el error estimado (MAPE). Para la previsión extramuestral, el error es la media de errores muy bajos (primeras previsiones) y errores muy elevados (últimas previsiones).</li>
</ul>
<p>Claramente estos resultados dependen del punto de corte seleccionado.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-residuosTSTS" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-residuosTSTS-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-02-Tema2_files/figure-html/fig-residuosTSTS-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-residuosTSTS-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;20: Residuos, predicción intra y extramuestral
</figcaption>
</figure>
</div>
</div>
</div>
<p><br>
</p>
</section>
</section>
<section id="nacimientos" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="nacimientos"><span class="header-section-number">6.2</span> Nacimientos</h2>
<p>Veamos un segundo ejemplo con la serie Nacimientos (desde el año 2000).</p>
<section id="identificación-y-estimación-del-mejor-modelo-1" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="identificación-y-estimación-del-mejor-modelo-1">Identificación y estimación del mejor modelo</h3>
<p>Si usamos a la función <code>ets</code> sin ningún tipo de restricción para que localice el mejor modelo para la serie Nacimientos, aparece un modelo con tendencia amortiguada y un valor de <span class="math inline">\(\phi = 0.98\)</span>, cercano al máximo valor permitido. Por este motivo, vamos a solicitar la identificación y estimación del mejor modelo excluyendo aquellos con tendencia amortiguada.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co">#nacimientosEts &lt;- ets(nacimientosb)</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>nacimientosEts <span class="ot">&lt;-</span> <span class="fu">ets</span>(nacimientosb, </span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">damped =</span> <span class="cn">FALSE</span>)</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nacimientosEts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ETS(A,A,A) 

Call:
ets(y = nacimientosb, damped = FALSE)

  Smoothing parameters:
    alpha = 0.4838 
    beta  = 0.0106 
    gamma = 1e-04 

  Initial states:
    l = 33045.5226 
    b = 146.0719 
    s = -0.3204 37.4571 1953.69 1402.23 1021.944 1226.764
           -957.5673 179.2031 -1379.473 -181.91 -3234.13 -67.8866

  sigma:  899.1074

     AIC     AICc      BIC 
5931.442 5933.567 5994.743 

Training set error measures:
                   ME     RMSE      MAE        MPE     MAPE      MASE
Training set -57.6172 875.2858 671.0568 -0.1823204 1.995274 0.5088143
                   ACF1
Training set 0.05823082</code></pre>
</div>
</div>
<p>El mejor modelo (A, A, A) tiene error, tendencia y estacionalidad aditivas: <span class="math inline">\(y_t = l_{t-1} + b_{t-1} + s_{t + 1 - m}\)</span>.</p>
<p>El bajo valor de <span class="math inline">\(\beta\)</span> y <span class="math inline">\(\gamma\)</span> indican que ambas, la pendiente y la estacionalidad, varían muy lentamente en el tiempo (véase la <a href="#fig-nacimientoscomponentes" class="quarto-xref">Figura&nbsp;21</a>).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(nacimientosEts,</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">"Periodo"</span>,</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-nacimientoscomponentes" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-nacimientoscomponentes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-02-Tema2_files/figure-html/fig-nacimientoscomponentes-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-nacimientoscomponentes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;21: Componentes del modelo óptimo para Nacimientos
</figcaption>
</figure>
</div>
</div>
</div>
<p>Respecto de la calidad del modelo, el MAPE de 2% indica que estamos ante un modelo que se ajusta muy bien a los datos; y el valor de MASE igual a 0.51 indica que este modelo reduce en un 49% el error del método ingenuo con estacionalidad, el más sencillo posible. El modelo no tiene sesgo y el valor de ACF1 de 0.06, inferior a 0.1, indica que el intervalo de confianza de las predicciones está bien calculado.</p>
<p>Podemos ver los últimos valores estimados del nivel, la pendiente y la estacionalidad para interpretarlos. Como el último dato de la serie es junio de 2025, los valores del nivel <span class="math inline">\(l\)</span> y la pendiente <span class="math inline">\(b\)</span> mostrados corresponden a ese mes. Pero recuerda que <em>los valores de la componente estacional están ordenados al revés</em> partiendo de junio: s1 es el valor estacional para junio, s2 el de mayo, s3 el se abril, y así hasta s12 que sería julio.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>TT <span class="ot">&lt;-</span> <span class="fu">nrow</span>(nacimientosEts<span class="sc">$</span>states)</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>nacimientosEts<span class="sc">$</span>states[TT,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            l             b            s1            s2            s3 
26731.4368760   -41.0779679  -957.7263395   178.9110540 -1379.6229104 
           s4            s5            s6            s7            s8 
 -182.1189222 -3234.1645446   -67.9123558    -0.4663169    37.3091214 
           s9           s10           s11           s12 
 1953.5428305  1402.0792378  1021.7948111  1226.6106455 </code></pre>
</div>
</div>
<p>Febrero (s5) es el mes con menor número de nacimientos: 3234 nacimientos menos que la media anual. Por contra, octubre (s9) es el mes con mayor número de nacimientos: 1954 más que la media anual.</p>
<p>Podemos usar estos valores para predecir los próximos 12 meses, julio de 2025 hasta junio de 2026 (ojo, el etiquetado de la salida no tiene sentido):</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>nacimientosEts<span class="sc">$</span>states[TT, <span class="dv">1</span>] <span class="sc">+</span> (<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>) <span class="sc">*</span> nacimientosEts<span class="sc">$</span>states[TT, <span class="dv">2</span>] <span class="sc">+</span> </span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>  nacimientosEts<span class="sc">$</span>states[TT, <span class="dv">14</span><span class="sc">:</span><span class="dv">3</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     s12      s11      s10       s9       s8       s7       s6       s5 
27916.97 27671.08 28010.28 28520.67 26563.36 26484.50 26375.98 23168.65 
      s4       s3       s2       s1 
26179.62 24941.03 26458.49 25280.77 </code></pre>
</div>
</div>
<p>Nuestra predicción para julio de 2025 es de 27916.97 bebés y para junio de 2026 de 25280.77 bebés.</p>
</section>
<section id="predicción-1" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="predicción-1">Predicción</h3>
<p>Si pedimos los valores de predicción tenemos (sólo se muestran los primeros meses):</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>nacimientosEtsPre <span class="ot">&lt;-</span> <span class="fu">forecast</span>(nacimientosEts, </span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>                              <span class="at">h =</span> <span class="dv">24</span>, </span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>                              <span class="at">level =</span> <span class="dv">95</span>)</span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>nacimientosEtsPre</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>         Point Forecast    Lo 95    Hi 95
Jul 2025       27916.97 26154.75 29679.19
Aug 2025       27671.08 25705.24 29636.91
Sep 2025       28010.28 25852.38 30168.19
Oct 2025       28520.67 26179.25 30862.09
Nov 2025       26563.36 24044.97 29081.74</code></pre>
</div>
</div>
<p>La <a href="#fig-nacimientosPrediccion" class="quarto-xref">Figura&nbsp;22</a> muestra la serie Nacimientos, su predicción a dos años vista y el intervalo de confianza.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(nacimientosEtsPre,</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"Nacimientos"</span>,</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-nacimientosPrediccion" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-nacimientosPrediccion-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-02-Tema2_files/figure-html/fig-nacimientosPrediccion-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-nacimientosPrediccion-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;22: Nacimientos y predicción
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="análisis-del-error" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="análisis-del-error">Análisis del error</h3>
<p>Se identifica varios valores claramente atípicos –superan las 3 desviaciones típicas– que corresponden a enero de 2011 y, aproximadamente, nueves después del confinamiento por la pandemia (diciembre de 2020, y febrero y marzo de 2021). Abril de 2008 y diciembre de 2010 son otros candidatos a intervención por superar las 2.5 desviaciones típicas.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>error <span class="ot">&lt;-</span> <span class="fu">residuals</span>(nacimientosEts)</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>sderror <span class="ot">&lt;-</span> <span class="fu">sd</span>(error)</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(error, <span class="at">series=</span><span class="st">"Error"</span>,</span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">"Periodo"</span>,</span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"Error"</span>,</span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span> ,<span class="dv">3</span>)<span class="sc">*</span>sderror, </span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"blue"</span>, <span class="st">"blue"</span>, <span class="st">"red"</span>), <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb99-11"><a href="#cb99-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span> <span class="fu">seq</span>(<span class="dv">2000</span>, <span class="dv">2026</span>, <span class="dv">2</span>)) </span>
<span id="cb99-12"><a href="#cb99-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-13"><a href="#cb99-13" aria-hidden="true" tabindex="-1"></a>fechas <span class="ot">&lt;-</span> <span class="fu">format</span>(<span class="fu">seq</span>(<span class="fu">as.Date</span>(<span class="st">"2000-01-01"</span>), <span class="fu">as.Date</span>(<span class="st">"2025-06-01"</span>), <span class="st">"month"</span>), <span class="st">"%Y-%m"</span>)</span>
<span id="cb99-14"><a href="#cb99-14" aria-hidden="true" tabindex="-1"></a>fechas[<span class="fu">abs</span>(error) <span class="sc">&gt;</span> <span class="dv">3</span> <span class="sc">*</span> sderror]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2011-01" "2020-12" "2021-02" "2021-03"</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-NacimientosError" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-NacimientosError-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-02-Tema2_files/figure-html/fig-NacimientosError-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-NacimientosError-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;23: Error + Intervención
</figcaption>
</figure>
</div>
</div>
</div>
<p>Un método alternativo para obtener valores atípicos es la prueba de Tukey (véase la píldora <em>Valores perdidos y valores atípicos</em>).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>atipicos <span class="ot">&lt;-</span> <span class="fu">tsoutliers</span>(error)</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>fechas[atipicos<span class="sc">$</span>index]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2020-12"</code></pre>
</div>
</div>
<p>En este caso solo se identifica como atípico el valor de diciembre de 2020.</p>
</section>
<section id="validación-error-extramuestral-según-horizonte-temporal" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="validación-error-extramuestral-según-horizonte-temporal">Validación: error extramuestral según horizonte temporal</h3>
<p>En este ejemplo calcularemos el error extramuestral según el horizonte temporal de previsión, una metodología que ya hemos visto anteriormente.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">120</span>                 </span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>h <span class="ot">&lt;-</span> <span class="dv">12</span>                  </span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>TT <span class="ot">&lt;-</span> <span class="fu">length</span>(nacimientosb)</span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> TT <span class="sc">-</span> k <span class="sc">-</span> h </span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a>mapeAlisado <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, s <span class="sc">+</span> <span class="dv">1</span>, h)</span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">0</span><span class="sc">:</span>s) {</span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a>  train.set <span class="ot">&lt;-</span> <span class="fu">subset</span>(nacimientosb, <span class="at">start =</span> i <span class="sc">+</span> <span class="dv">1</span>, <span class="at">end =</span> i <span class="sc">+</span> k)</span>
<span id="cb103-9"><a href="#cb103-9" aria-hidden="true" tabindex="-1"></a>  test.set <span class="ot">&lt;-</span>  <span class="fu">subset</span>(nacimientosb, <span class="at">start =</span> i <span class="sc">+</span> k <span class="sc">+</span> <span class="dv">1</span>, <span class="at">end =</span> i <span class="sc">+</span> k <span class="sc">+</span> h)</span>
<span id="cb103-10"><a href="#cb103-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-11"><a href="#cb103-11" aria-hidden="true" tabindex="-1"></a>  fit <span class="ot">&lt;-</span> <span class="fu">ets</span>(train.set, <span class="at">model =</span> <span class="st">"AAA"</span>, <span class="at">damped =</span> <span class="cn">FALSE</span>)</span>
<span id="cb103-12"><a href="#cb103-12" aria-hidden="true" tabindex="-1"></a>  fcast<span class="ot">&lt;-</span><span class="fu">forecast</span>(fit, <span class="at">h =</span> h)</span>
<span id="cb103-13"><a href="#cb103-13" aria-hidden="true" tabindex="-1"></a>  mapeAlisado[i <span class="sc">+</span> <span class="dv">1</span>,] <span class="ot">&lt;-</span> <span class="dv">100</span><span class="sc">*</span><span class="fu">abs</span>(test.set <span class="sc">-</span> fcast<span class="sc">$</span>mean)<span class="sc">/</span>test.set</span>
<span id="cb103-14"><a href="#cb103-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb103-15"><a href="#cb103-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-16"><a href="#cb103-16" aria-hidden="true" tabindex="-1"></a>errorAlisado <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(mapeAlisado)</span>
<span id="cb103-17"><a href="#cb103-17" aria-hidden="true" tabindex="-1"></a>errorAlisado</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 2.202293 2.511743 2.689947 2.947580 2.888890 2.965959 3.162538 3.196361
 [9] 3.219150 3.278137 3.133652 3.265335</code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">y =</span> errorAlisado)) <span class="sc">+</span></span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Horizonte temporal de predicción"</span>, <span class="at">y =</span> <span class="st">"MAPE"</span>, <span class="at">title =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-NacimientosErrorRW" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-NacimientosErrorRW-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-02-Tema2_files/figure-html/fig-NacimientosErrorRW-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-NacimientosErrorRW-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;24: Error de predicción según horizonte temporal
</figcaption>
</figure>
</div>
</div>
</div>
<p>La <a href="#fig-NacimientosErrorRW" class="quarto-xref">Figura&nbsp;24</a> muestra el error de previsión extramuestral según el horizonte temporal. El error extramuestral a un periodo vista es comparable al error intramuestral (2.2% frente a 2.0%). Aunque el error de previsión aumenta conforme lo hace el horizonte temporal, siempre se mantiene muy bajo. Por ejemplo, en las previsiones a 12 meses vista el error es del 3.3%.</p>
</section>
</section>
<section id="demanda-eléctrica" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="demanda-eléctrica"><span class="header-section-number">6.3</span> Demanda eléctrica</h2>
<p>Consideremos la serie de consumo eléctrico diario durante el año 2024.</p>
<p><br>
</p>
<section id="identificación-y-estimación-del-mejor-modelo-2" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="identificación-y-estimación-del-mejor-modelo-2">Identificación y estimación del mejor modelo</h3>
<p>El modelo óptimo sin restricciones es (AAdA), es decir, <span class="math inline">\(y_{t+1} = l_t + \phi b_t + s_{t+1-m} + \varepsilon_{t+1}\)</span>, con un elevado nivel de amortiguamiento <span class="math inline">\(\phi = 0.89\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>electricidadEts <span class="ot">&lt;-</span> <span class="fu">ets</span>(electricidad)</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(electricidadEts) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ETS(A,Ad,A) 

Call:
ets(y = electricidad)

  Smoothing parameters:
    alpha = 0.9239 
    beta  = 1e-04 
    gamma = 1e-04 
    phi   = 0.8857 

  Initial states:
    l = 644.3443 
    b = 14.8303 
    s = -84.5061 -47.067 22.048 32.1189 32.3575 31.6764
           13.3724

  sigma:  23.2475

     AIC     AICc      BIC 
4477.179 4478.213 4527.913 

Training set error measures:
                     ME     RMSE      MAE        MPE     MAPE     MASE
Training set -0.3561611 22.86319 14.43216 -0.1206147 2.171595 0.518908
                   ACF1
Training set 0.02118618</code></pre>
</div>
</div>
<p>El valor <span class="math inline">\(\beta=0\)</span> y <span class="math inline">\(\gamma = 0\)</span> indican que la pendiente y la estacionalidad se mantienen constante en el tiempo, mientras que el elevado valor de <span class="math inline">\(\alpha\)</span> indica que el nivel de la serie cambia de forma constante. Este cambio de nivel está relacionado con las variaciones en el consumo eléctrico debido a los cambios en la temperatura y el uso de aparatos de climatización.</p>
<p>Respecto de la calidad del modelo, el MAPE de 2.2% indica que estamos ante un modelo que se ajusta muy bien a los datos; no hay sesgo (MPE es inferior al 1%); y el valor de ACF1, muy bajo, indica que la fórmula usada para el cálculo del intervalo de confianza de las predicciones es válida.</p>
<p>Podemos ver los últimos valores estimados del nivel y la estacionalidad para interpretarlos. Recuerda que los valores de la componente estacional están ordenados al revés. En este caso, como el último dato (31 de diciembre de 2024) fue martes, s1 es martes, s2 es lunes…y s7 es miércoles.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>TT <span class="ot">&lt;-</span> <span class="fu">nrow</span>(electricidadEts<span class="sc">$</span>states)</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>electricidadEts<span class="sc">$</span>states[TT,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            l             b            s1            s2            s3 
638.703913172  -0.005458752  31.670093723  13.378175541 -84.511145443 
           s4            s5            s6            s7 
-47.074612082  22.050610389  32.121999595  32.351842678 </code></pre>
</div>
</div>
<p>El domingo la demanda eléctrica cae 84.5 GWh respecto de la media semanal. Por el contrario, el miércoles es el día de mayor incremento de demanda respecto de la media semanal, 32.4 GWh.</p>
</section>
<section id="predicción-2" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="predicción-2">Predicción</h3>
<p>Si pedimos los valores de predicción para las cuatro semanas siguientes, tenemos (sólo se muestran la primera):</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>electricidadEtsPre <span class="ot">&lt;-</span> <span class="fu">forecast</span>(electricidadEts, </span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>                               <span class="at">h =</span> <span class="dv">28</span>, </span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>                               <span class="at">level =</span> <span class="dv">95</span>)</span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>electricidadEtsPre</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>         Point Forecast    Lo 95    Hi 95
53.28571       671.0509 625.4867 716.6151
53.42857       670.8168 608.7810 732.8526
53.57143       660.7416 585.7674 735.7159
53.71429       591.6130 505.6238 677.6023
53.85714       554.1735 458.4268 649.9202
54.00000       652.0602 547.4612 756.6593
54.14286       670.3498 557.5903 783.1093</code></pre>
</div>
</div>
<p>La <a href="#fig-electricidadPrediccion" class="quarto-xref">Figura&nbsp;25</a> muestra la serie Demanda eléctrica, su predicción a cuatro semanas vista y el intervalo de confianza.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(electricidadEtsPre,</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"GWh"</span>,</span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-electricidadPrediccion" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-electricidadPrediccion-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-02-Tema2_files/figure-html/fig-electricidadPrediccion-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-electricidadPrediccion-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;25: Demanda eléctrica y predicción
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="análisis-del-error-1" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="análisis-del-error-1">Análisis del error</h3>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>error <span class="ot">&lt;-</span> <span class="fu">residuals</span>(electricidadEts)</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>sderror <span class="ot">&lt;-</span> <span class="fu">sd</span>(error)</span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(error, <span class="at">series=</span><span class="st">"Error"</span>,</span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">"Semana"</span>,</span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"Error"</span>,</span>
<span id="cb113-8"><a href="#cb113-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb113-9"><a href="#cb113-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span> ,<span class="dv">3</span>)<span class="sc">*</span>sderror, </span>
<span id="cb113-10"><a href="#cb113-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"blue"</span>, <span class="st">"blue"</span>, <span class="st">"red"</span>), <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb113-11"><a href="#cb113-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">52</span>, <span class="dv">4</span>)) </span>
<span id="cb113-12"><a href="#cb113-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-13"><a href="#cb113-13" aria-hidden="true" tabindex="-1"></a>fechas <span class="ot">&lt;-</span> <span class="fu">format</span>(<span class="fu">seq</span>(<span class="fu">as.Date</span>(<span class="st">"2024-1-1"</span>), <span class="fu">as.Date</span>(<span class="st">"2024-12-31"</span>), <span class="st">"day"</span>), <span class="st">"%Y-%m-%d"</span>)</span>
<span id="cb113-14"><a href="#cb113-14" aria-hidden="true" tabindex="-1"></a>fechas[<span class="fu">abs</span>(error) <span class="sc">&gt;</span> <span class="dv">3</span> <span class="sc">*</span> sderror]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "2024-01-01" "2024-01-02" "2024-03-28" "2024-03-30" "2024-05-01"
 [6] "2024-08-15" "2024-11-01" "2024-12-06" "2024-12-24" "2024-12-25"
[11] "2024-12-26"</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-electricidadError" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-electricidadError-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-02-Tema2_files/figure-html/fig-electricidadError-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-electricidadError-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;26: Error + Intervención
</figcaption>
</figure>
</div>
</div>
</div>
<p>En la <a href="#fig-electricidadError" class="quarto-xref">Figura&nbsp;26</a> se identifican múltiples días atípicos asociados con un consumo inferior al esperado debido a festividades: Año nuevo, Semana Santa (el Viernes Santo fue el 29 de abril), Día del trabajador, Virgen de agosto, Todos los Santos, Día de la Constitución y Navidad. El Día de Reyes (6 de enero), el Día de la Hispanidad (12 de octubre) y el Día de la Inmaculada (8 de diciembre) no aparecen porque cayeron en sábado o domingo, días para los que el consumo de electricidad ya es bajo.</p>
<p>También se observan tres días con un consumo mayor de lo esperado justo después de un festivo, el 2 de enero (tras Reyes), el 30 de abril (Sábado Santo) y el 26 de diciembre (tras Navidad). En este caso, la causa no es un incremento inesperado del consumo, sino la dinámica del propio método de estimación. Al llegar un día festivo, el método de Alisado falla ofreciendo una predicción más alta de la real y dando lugar a un error negativo. Al día siguiente, el método de Alisado ajusta su predicción a la baja, pero por no ser festivo vuelve a fallar, esta vez ofreciendo una predicción más baja de la real y dando lugar a un error positivo. Por este motivo en la <a href="#fig-electricidadError" class="quarto-xref">Figura&nbsp;26</a> después de un error negativo muy elevado se observa un error positivo también muy elevado.</p>
<p>Veamos como en este caso la prueba de Tukey identifica las mismas fechas y añade el 17 de agosto.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>atipicos <span class="ot">&lt;-</span> <span class="fu">tsoutliers</span>(error)</span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>fechas[atipicos<span class="sc">$</span>index]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "2024-01-01" "2024-01-02" "2024-03-28" "2024-03-30" "2024-05-01"
 [6] "2024-08-15" "2024-08-17" "2024-11-01" "2024-12-06" "2024-12-24"
[11] "2024-12-25" "2024-12-26"</code></pre>
</div>
</div>
<p><br>
<br>
</p>
</section>
</section>
</section>
<section id="otras-alternativas-para-ajustar-un-modelo-y-predecir" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Otras alternativas para ajustar un modelo y predecir</h1>
<p>A la hora de ajustar un modelo a una serie y predecir hay que ser un poco imaginativos, dedicarle tiempo y probar cosas. Por ejemplo, podríamos considerar la transformación logarítmica de la serie. O podríamos cambiar el criterio de estimación de los parámetros o el de selección del modelo óptimo.</p>
<p>Yendo un poco más lejos, para una serie mensual (como Nacimientos) dado que el valor de la serie dependerá forzosamente del número de días del mes, podríamos ajustar y predecir el valor medio de la serie por día del mes. Por ejemplo, los nacimientos medios por día: cociente entre los nacimientos de cada mes y el número de días del mes. Esta serie tendrá una componente estacional más suave, al eliminar el efecto de los meses de febrero bisiestos, y tendrá, previsiblemente, un mejor ajuste.</p>
<p>También podemos mezclar varios de los enfoques previos o ser aún más imaginativos.</p>
<p>El siguiente código muestra el MAPE (para previsiones intramuestrales a un periodo vista) para la serie Nacimientos usando varias de estas opciones.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimación: máxima verosimilitud</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(<span class="fu">ets</span>(nacimientos))[<span class="dv">5</span>]                        <span class="co"># Nacimientos</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.9503</code></pre>
</div>
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(<span class="fu">ets</span>(nacimientos, <span class="at">lambda =</span> <span class="dv">0</span>))[<span class="dv">5</span>]            <span class="co"># Log(nacimientos)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.931919</code></pre>
</div>
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(<span class="fu">ets</span>(nacimientos<span class="sc">/</span><span class="fu">monthdays</span>(nacimientos)))[<span class="dv">5</span>] <span class="co"># Nacimientos por día</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.87069</code></pre>
</div>
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimación: minimizar el error cuadrático</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(<span class="fu">ets</span>(nacimientos, <span class="at">opt.crit =</span> <span class="st">"mse"</span>))[<span class="dv">5</span>] </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.980923</code></pre>
</div>
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(<span class="fu">ets</span>(nacimientos, <span class="at">opt.crit =</span> <span class="st">"mse"</span>, <span class="at">lambda =</span> <span class="dv">0</span>, ))[<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.931919</code></pre>
</div>
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(<span class="fu">ets</span>(nacimientos<span class="sc">/</span><span class="fu">monthdays</span>(nacimientos), <span class="at">opt.crit =</span> <span class="st">"mse"</span>))[<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.888699</code></pre>
</div>
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimación: Minimizar el error cuadrático de las previsiones </span></span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a><span class="co"># hasta 4 periodos vista</span></span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(<span class="fu">ets</span>(nacimientos, <span class="at">opt.crit =</span> <span class="st">"amse"</span>, <span class="at">nmse =</span> <span class="dv">4</span>))[<span class="dv">5</span>] </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.977375</code></pre>
</div>
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(<span class="fu">ets</span>(nacimientos, <span class="at">opt.crit =</span> <span class="st">"amse"</span>, <span class="at">nmse =</span> <span class="dv">4</span>, <span class="at">lambda =</span> <span class="dv">0</span>))[<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.990393</code></pre>
</div>
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(<span class="fu">ets</span>(nacimientos<span class="sc">/</span><span class="fu">monthdays</span>(nacimientos), <span class="at">opt.crit =</span> <span class="st">"amse"</span>, <span class="at">nmse =</span> <span class="dv">4</span>))[<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.917734</code></pre>
</div>
</div>
<p>Para la serie Nacimientos, la principal conclusión es que salirse de la estimación directa sobre la serie original no reduce el error significativamente. Sin embargo, cabe destacar que,</p>
<ul>
<li>Con independencia del método de estimación, el error de ajuste de los nacimientos por día es menor que el error de ajuste obtenido con la serie original.</li>
<li>Usar la transformación logarítmica puede mejorar o no la calidad de ajuste del modelo, dependiendo del método de estimación.</li>
<li>El mejor modelo estima los nacimientos por día y estima los parámetros minimizando el error cuadrático medio (“mse”). No siempre el uso directo de la serie ofrece los mejores resultados.</li>
</ul>
<p>Puedes deducir que se está haciendo en cada caso a partir del código. Sería más adecuado usar otro criterio de validación diferente, pero el objetivo de este epígrafe es recalcar que no hay que quedarse con lo inmediato (predecir una serie con las opciones por defecto de las funciones), sino probar y probar.</p>
</section>
<section id="resumen-de-los-comandos-utilizados" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> Resumen de los comandos utilizados</h1>
<table class="caption-top table">
<colgroup>
<col style="width: 18%">
<col style="width: 14%">
<col style="width: 66%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Función</th>
<th style="text-align: left;">Paquete</th>
<th style="text-align: left;">Descripción</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>apply</code></td>
<td style="text-align: left;">base</td>
<td style="text-align: left;">Calcula el valor de una función aplicada a cada fila o columna de una matriz o base de datos</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>as.Date</code></td>
<td style="text-align: left;">base</td>
<td style="text-align: left;">Convierte una cadena de caracteres en una variable fecha</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>colMeans</code></td>
<td style="text-align: left;">base</td>
<td style="text-align: left;">Calcula el valor medio por columna de una matriz o base de datos</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>format</code></td>
<td style="text-align: left;">base</td>
<td style="text-align: left;">Da formato a un objeto de R para mejorar sus impresión</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>seq</code></td>
<td style="text-align: left;">base</td>
<td style="text-align: left;">Genera secuencias regulares, en particular de fechas de calendiario</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>residuals</code></td>
<td style="text-align: left;">stats</td>
<td style="text-align: left;">Obtiene el residuo de un modelo estimado</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>accuracy</code></td>
<td style="text-align: left;">forecast</td>
<td style="text-align: left;">Calculo de la precisión del modelo</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>ets</code></td>
<td style="text-align: left;">forecast</td>
<td style="text-align: left;">Estimación de una amplia familia de métodos de alisado exponencial</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>forecast</code></td>
<td style="text-align: left;">forecast</td>
<td style="text-align: left;">Predice valores extramuestrales futuros de la serie</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>meanf</code></td>
<td style="text-align: left;">forecast</td>
<td style="text-align: left;">Predicción por media</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>naive</code></td>
<td style="text-align: left;">forecast</td>
<td style="text-align: left;">Predicción por método ingenuo I</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>rwf</code></td>
<td style="text-align: left;">forecast</td>
<td style="text-align: left;">Predicción por tendencia media</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>snaive</code></td>
<td style="text-align: left;">forecast</td>
<td style="text-align: left;">Predicción por método ingenuo con estacionalidad</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>tsoutliers</code></td>
<td style="text-align: left;">forecast</td>
<td style="text-align: left;">Usa la prueba de Tukey para identificar valores atípicos</td>
</tr>
</tbody>
</table>
<p><br>
<br>
</p>



</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-Brown59" class="csl-entry" role="listitem">
Brown, Robert Goodell. 1959. <em>Statistical Forecasting for Inventory Control</em>. McGraw-Hill, New York.
</div>
<div id="ref-Gardner85" class="csl-entry" role="listitem">
Gardner, Everette S., and Ed. Mckenzie. 1985. <span>“Forecasting Trends in Time Series.”</span> <em>Management Science</em> 31 (10): 1237–46. <a href="https://doi.org/10.1287/mnsc.31.10.1237">https://doi.org/10.1287/mnsc.31.10.1237</a>.
</div>
<div id="ref-Holt" class="csl-entry" role="listitem">
Holt, Charles C. 2004. <span>“Forecasting Seasonals and Trends by Exponentially Weighted Moving Averages.”</span> <em>International Journal of Forecasting</em> 20 (1): 5–10. https://doi.org/<a href="https://doi.org/10.1016/j.ijforecast.2003.09.015">https://doi.org/10.1016/j.ijforecast.2003.09.015</a>.
</div>
<div id="ref-Hyndman08" class="csl-entry" role="listitem">
Hyndman, Rob J., and Y. Khandakar. 2008. <span>“Automatic Time Series Forecasting: The Forecast Package for r.”</span> <em>Journal of Statistical Software</em> 27 (3): 1–22. <a href="https://doi.org/10.18637/jss.v027.i03">https://doi.org/10.18637/jss.v027.i03</a>.
</div>
<div id="ref-Hyndman08b" class="csl-entry" role="listitem">
Hyndman, Rob J., A. Koehler, K. Ord, and R. Snyder. 2008. <em>Forecasting with Exponential Smoothings. The State Space Approach</em>. Springer Berlin, Heidelberg. <a href="https://doi.org/10.1007/978-3-540-71918-2">https://doi.org/10.1007/978-3-540-71918-2</a>.
</div>
<div id="ref-Makridakis00" class="csl-entry" role="listitem">
Makridakis, Spyros, and Michèle Hibon. 2000. <span>“The M3-Competition: Results, Conclusions and Implications.”</span> <em>International Journal of Forecasting</em> 16 (4): 451–76. <a href="https://doi.org/10.1016/S0169-2070(00)00057-1">https://doi.org/10.1016/S0169-2070(00)00057-1</a>.
</div>
<div id="ref-Winters60" class="csl-entry" role="listitem">
Winters, Peter R. 1960. <span>“Forecasting Sales by Exponentially Weighted Moving Averages.”</span> <em>Management Science</em> 6 (3): 324–42. <a href="https://doi.org/10.1287/mnsc.6.3.324">https://doi.org/10.1287/mnsc.6.3.324</a>.
</div>
</div></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Formalmente en el modelo de Holt-Winters multiplicativo el error es aditivo. Es decir, debería ser (A, A, M). Sin embargo, debido a que desde un punto de vista teórico este modelo, junto con otros, puede tener varianza infinita, la función <code>ets</code> no permite por defecto su estimación. Para poder estimar con la función <code>ets</code> el modelo (A, A, M) es necesario añadir el argumento <code>restrict = FALSE</code>. Los modelos que para poder ser estimados requieren este argumento son: ANM, AAM, AAdM, MMA, MMdA, AMN, AMdN, AMA, AMdA, AMM y AMdM.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Recuerda que el valor de 3 es uno de los posibles y debe ajustarse a las características de la serie y el análisis.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>© Copyright 2023, Iván Arribas. If you find any bugs please report them to <a href="mailto:ivan.arribas@uv.es">ivan.arribas@uv.es</a></p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>This page is built with <a href="https://quarto.org/">Quarto</a></p>
</div>
  </div>
</footer>




</body></html>