<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Iván Arribas (Depto. Análisis Económico. Universitat de València)">

<title>Predicción con Datos Temporales - Series sin tendencia ni estacionalidad</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Predicción con Datos Temporales</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Inicio</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="./01-Guia-curso.html"> 
<span class="menu-text">Guía del curso</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./02-Logistica.html"> 
<span class="menu-text">Logística</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-diapos" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Diapos</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-diapos">    
        <li class="dropdown-header">Teoría</li>
        <li>
    <a class="dropdown-item" href="./03-01-Tema1.html">
 <span class="dropdown-text">Tema 1: Introducción</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-02-Tema2.html">
 <span class="dropdown-text">Tema 2: Definición</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-03-Tema3.html">
 <span class="dropdown-text">Tema 3: Métodos de predicción</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-04-Tema4.html">
 <span class="dropdown-text">Tema 4: Series sin tendencia ni estacionalidad</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-05-Tema5.html">
 <span class="dropdown-text">Tema 5: Evaluación de las predicciones</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-06-Tema6.html">
 <span class="dropdown-text">Tema 6: Series sin tendencia y sin estacionalidad</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-07-Tema7.html">
 <span class="dropdown-text">Tema 7: Series con tendencia y estacionalidad (Alisado)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-08-Tema8.html">
 <span class="dropdown-text">Tema 8: Series con tendencia y estacionalidad (Arima)</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Ejemplo de aplicación</li>
        <li>
    <a class="dropdown-item" href="./03-10-Ejemplo1.html">
 <span class="dropdown-text">Ejemplo: Descriptiva</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-11-Ejemplo2.html">
 <span class="dropdown-text">Ejemplo: Métodos sencillos</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-13-Ejemplo3.html">
 <span class="dropdown-text">Ejemplo: Alisado exponencial</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-14-Ejemplo4.html">
 <span class="dropdown-text">Ejemplo: Arima sin estacionalidad</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-15-Ejemplo5.html">
 <span class="dropdown-text">Ejemplo: Arima con estacionalidad</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Otro ejemplo</li>
        <li>
    <a class="dropdown-item" href="./03-20-Ejemplo-Pasajeros.html">
 <span class="dropdown-text">Ejemplo de Pasajeros</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-píldoras" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Píldoras</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-píldoras">    
        <li>
    <a class="dropdown-item" href="./04-01-Bootstrapping.html">
 <span class="dropdown-text">Bootstrapping para IC</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./04-02-Multiples_CS.html">
 <span class="dropdown-text">Múltiples componentes estacionales</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./04-03-Redes_neuronales.html">
 <span class="dropdown-text">Predicción con Redes Neuronales</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./04-04-Series_acotadas.html">
 <span class="dropdown-text">Series acotadas</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./04-05-Valores_perdidos_Outliers.html">
 <span class="dropdown-text">Valores perdidos y outliers</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./04-06-Covid_Nacimientos.html">
 <span class="dropdown-text">Efecto de la Covid-19 en Nacimientos</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./04-07-Combinando_predicciones.html">
 <span class="dropdown-text">Combinación de predicciones</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./04-08-Series_interrumpidas.html">
 <span class="dropdown-text">Series interrumpidas</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="./05-Recursos-R.html"> 
<span class="menu-text">Recursos de la asignatura</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./06-Evaluacion_Continua.html"> 
<span class="menu-text">Evaluacion Continua</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-más" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Más</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-más">    
        <li class="dropdown-header">R</li>
        <li>
    <a class="dropdown-item" href="https://cran.r-project.org">
 <span class="dropdown-text">Dónde está R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://rstudio.com">
 <span class="dropdown-text">Donde está RStudio</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Markdown</li>
        <li>
    <a class="dropdown-item" href="https://bookdown.org/yihui/rmarkdown/">
 <span class="dropdown-text">Markdown</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://rmarkdown.rstudio.com/lesson-1.html">
 <span class="dropdown-text">R Markdown</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://www.rstudio.com/wp-content/uploads/2015/03/rmarkdown-reference.pdf">
 <span class="dropdown-text">R Markdown (pdf)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://quarto.org/docs/tools/rstudio.html">
 <span class="dropdown-text">Quatro</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Otros</li>
        <li>
    <a class="dropdown-item" href="https://www.r-bloggers.com">
 <span class="dropdown-text">Blog sobre R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://bookdown.org">
 <span class="dropdown-text">Libros online que debes conocer</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Índice</h2>
   
  <ul>
  <li><a href="#introducción" id="toc-introducción" class="nav-link active" data-scroll-target="#introducción"><span class="header-section-number">1</span> Introducción</a></li>
  <li><a href="#criterios-de-calidad" id="toc-criterios-de-calidad" class="nav-link" data-scroll-target="#criterios-de-calidad"><span class="header-section-number">2</span> Criterios de calidad</a>
  <ul class="collapse">
  <li><a href="#notación-y-definiciones" id="toc-notación-y-definiciones" class="nav-link" data-scroll-target="#notación-y-definiciones"><span class="header-section-number">2.1</span> Notación y definiciones</a>
  <ul class="collapse">
  <li><a href="#calidad-de-ajuste-o-de-previsión" id="toc-calidad-de-ajuste-o-de-previsión" class="nav-link" data-scroll-target="#calidad-de-ajuste-o-de-previsión">¿Calidad de ajuste o de previsión?</a></li>
  </ul></li>
  <li><a href="#criterios-de-calidad-1" id="toc-criterios-de-calidad-1" class="nav-link" data-scroll-target="#criterios-de-calidad-1"><span class="header-section-number">2.2</span> Criterios de calidad</a></li>
  </ul></li>
  <li><a href="#métodos-sencillos-de-predicción" id="toc-métodos-sencillos-de-predicción" class="nav-link" data-scroll-target="#métodos-sencillos-de-predicción"><span class="header-section-number">3</span> Métodos sencillos de predicción</a>
  <ul class="collapse">
  <li><a href="#métodos-sencillos-de-predicción-1" id="toc-métodos-sencillos-de-predicción-1" class="nav-link" data-scroll-target="#métodos-sencillos-de-predicción-1"><span class="header-section-number">3.1</span> Métodos sencillos de predicción</a></li>
  <li><a href="#ejemplo-de-aplicación-a-la-serie-consumo-alimentarios-en-el-hogar-per-cápita" id="toc-ejemplo-de-aplicación-a-la-serie-consumo-alimentarios-en-el-hogar-per-cápita" class="nav-link" data-scroll-target="#ejemplo-de-aplicación-a-la-serie-consumo-alimentarios-en-el-hogar-per-cápita"><span class="header-section-number">3.2</span> Ejemplo de aplicación a la serie consumo alimentarios en el hogar per cápita</a>
  <ul class="collapse">
  <li><a href="#identificación-del-orden-r-del-método-de-la-media-móvil" id="toc-identificación-del-orden-r-del-método-de-la-media-móvil" class="nav-link" data-scroll-target="#identificación-del-orden-r-del-método-de-la-media-móvil">Identificación del orden <span class="math inline">\(r\)</span> del método de la Media móvil</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#alisado-exponencial-simple" id="toc-alisado-exponencial-simple" class="nav-link" data-scroll-target="#alisado-exponencial-simple"><span class="header-section-number">4</span> Alisado exponencial simple</a>
  <ul class="collapse">
  <li><a href="#definición" id="toc-definición" class="nav-link" data-scroll-target="#definición"><span class="header-section-number">4.1</span> Definición</a></li>
  <li><a href="#térmimo-de-error" id="toc-térmimo-de-error" class="nav-link" data-scroll-target="#térmimo-de-error"><span class="header-section-number">4.2</span> Térmimo de error</a></li>
  <li><a href="#las-funciones-ets-y-forecast" id="toc-las-funciones-ets-y-forecast" class="nav-link" data-scroll-target="#las-funciones-ets-y-forecast"><span class="header-section-number">4.3</span> Las funciones <code>ets</code> y <code>forecast</code></a></li>
  <li><a href="#estimación-de-los-parámetros-del-modelo" id="toc-estimación-de-los-parámetros-del-modelo" class="nav-link" data-scroll-target="#estimación-de-los-parámetros-del-modelo"><span class="header-section-number">4.4</span> Estimación de los parámetros del modelo</a></li>
  <li><a href="#criterios-de-selección-de-modelos" id="toc-criterios-de-selección-de-modelos" class="nav-link" data-scroll-target="#criterios-de-selección-de-modelos"><span class="header-section-number">4.5</span> Criterios de selección de modelos</a></li>
  <li><a href="#ejemplo-de-aplicación-a-la-serie-consumo-alimentarios-en-el-hogar-per-cápita-1" id="toc-ejemplo-de-aplicación-a-la-serie-consumo-alimentarios-en-el-hogar-per-cápita-1" class="nav-link" data-scroll-target="#ejemplo-de-aplicación-a-la-serie-consumo-alimentarios-en-el-hogar-per-cápita-1"><span class="header-section-number">4.6</span> Ejemplo de aplicación a la serie consumo alimentarios en el hogar per cápita</a>
  <ul class="collapse">
  <li><a href="#identificación-de-valores-atípicos-intervención" id="toc-identificación-de-valores-atípicos-intervención" class="nav-link" data-scroll-target="#identificación-de-valores-atípicos-intervención">Identificación de valores atípicos (Intervención)</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#modelos-arima" id="toc-modelos-arima" class="nav-link" data-scroll-target="#modelos-arima"><span class="header-section-number">5</span> Modelos ARIMA</a>
  <ul class="collapse">
  <li><a href="#hipótesis-necesarias" id="toc-hipótesis-necesarias" class="nav-link" data-scroll-target="#hipótesis-necesarias"><span class="header-section-number">5.1</span> Hipótesis necesarias</a></li>
  <li><a href="#operador-retardo" id="toc-operador-retardo" class="nav-link" data-scroll-target="#operador-retardo"><span class="header-section-number">5.2</span> Operador Retardo</a></li>
  <li><a href="#procesos-arima" id="toc-procesos-arima" class="nav-link" data-scroll-target="#procesos-arima"><span class="header-section-number">5.3</span> Procesos ARIMA</a>
  <ul class="collapse">
  <li><a href="#procesos-autorregresivos-arp" id="toc-procesos-autorregresivos-arp" class="nav-link" data-scroll-target="#procesos-autorregresivos-arp">Procesos autorregresivos AR(p)</a></li>
  <li><a href="#procesos-en-medias-móviles-maq" id="toc-procesos-en-medias-móviles-maq" class="nav-link" data-scroll-target="#procesos-en-medias-móviles-maq">Procesos en medias móviles MA(q)</a></li>
  <li><a href="#integración-id" id="toc-integración-id" class="nav-link" data-scroll-target="#integración-id">Integración I(d)</a></li>
  <li><a href="#procesos-arimap-0-q" id="toc-procesos-arimap-0-q" class="nav-link" data-scroll-target="#procesos-arimap-0-q">Procesos ARIMA(p, 0, q)</a></li>
  </ul></li>
  <li><a href="#aproximación-de-box-jenkins" id="toc-aproximación-de-box-jenkins" class="nav-link" data-scroll-target="#aproximación-de-box-jenkins"><span class="header-section-number">5.4</span> Aproximación de Box-Jenkins</a>
  <ul class="collapse">
  <li><a href="#identificación-automática" id="toc-identificación-automática" class="nav-link" data-scroll-target="#identificación-automática">Identificación automática</a></li>
  </ul></li>
  <li><a href="#ejemplo-de-aplicación-a-la-serie-consumo-alimentarios-en-el-hogar-per-cápita-2" id="toc-ejemplo-de-aplicación-a-la-serie-consumo-alimentarios-en-el-hogar-per-cápita-2" class="nav-link" data-scroll-target="#ejemplo-de-aplicación-a-la-serie-consumo-alimentarios-en-el-hogar-per-cápita-2"><span class="header-section-number">5.5</span> Ejemplo de aplicación a la serie consumo alimentarios en el hogar per cápita</a>
  <ul class="collapse">
  <li><a href="#estacionariedad-de-la-serie" id="toc-estacionariedad-de-la-serie" class="nav-link" data-scroll-target="#estacionariedad-de-la-serie">Estacionariedad de la serie</a></li>
  <li><a href="#identificación-y-estimación" id="toc-identificación-y-estimación" class="nav-link" data-scroll-target="#identificación-y-estimación">Identificación y Estimación</a></li>
  <li><a href="#validación" id="toc-validación" class="nav-link" data-scroll-target="#validación">Validación</a></li>
  <li><a href="#medidas-de-error" id="toc-medidas-de-error" class="nav-link" data-scroll-target="#medidas-de-error">Medidas de error</a></li>
  <li><a href="#interpretación-del-modelo" id="toc-interpretación-del-modelo" class="nav-link" data-scroll-target="#interpretación-del-modelo">Interpretación del modelo</a></li>
  <li><a href="#predicciones-de-la-serie" id="toc-predicciones-de-la-serie" class="nav-link" data-scroll-target="#predicciones-de-la-serie">Predicciones de la serie</a></li>
  <li><a href="#comparación-entre-modelos" id="toc-comparación-entre-modelos" class="nav-link" data-scroll-target="#comparación-entre-modelos">Comparación entre modelos</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#aplicacion-al-número-de-defunciones-diarias-en-españa" id="toc-aplicacion-al-número-de-defunciones-diarias-en-españa" class="nav-link" data-scroll-target="#aplicacion-al-número-de-defunciones-diarias-en-españa"><span class="header-section-number">6</span> Aplicacion al número de defunciones diarias en España</a>
  <ul class="collapse">
  <li><a href="#método-ingenuo-i" id="toc-método-ingenuo-i" class="nav-link" data-scroll-target="#método-ingenuo-i"><span class="header-section-number">6.1</span> Método Ingenuo I</a></li>
  <li><a href="#método-de-la-media-móvil" id="toc-método-de-la-media-móvil" class="nav-link" data-scroll-target="#método-de-la-media-móvil"><span class="header-section-number">6.2</span> Método de la media móvil</a></li>
  <li><a href="#método-de-alisado" id="toc-método-de-alisado" class="nav-link" data-scroll-target="#método-de-alisado"><span class="header-section-number">6.3</span> Método de Alisado</a></li>
  <li><a href="#modelos-arima-1" id="toc-modelos-arima-1" class="nav-link" data-scroll-target="#modelos-arima-1"><span class="header-section-number">6.4</span> Modelos ARIMA</a>
  <ul class="collapse">
  <li><a href="#identificación-y-estimación-1" id="toc-identificación-y-estimación-1" class="nav-link" data-scroll-target="#identificación-y-estimación-1">Identificación y Estimación</a></li>
  <li><a href="#validación-1" id="toc-validación-1" class="nav-link" data-scroll-target="#validación-1">Validación</a></li>
  <li><a href="#medidas-de-error-1" id="toc-medidas-de-error-1" class="nav-link" data-scroll-target="#medidas-de-error-1">Medidas de error</a></li>
  <li><a href="#interpretación-del-modelo-1" id="toc-interpretación-del-modelo-1" class="nav-link" data-scroll-target="#interpretación-del-modelo-1">Interpretación del modelo</a></li>
  <li><a href="#predicciones" id="toc-predicciones" class="nav-link" data-scroll-target="#predicciones">Predicciones</a></li>
  </ul></li>
  <li><a href="#comparación-entre-métodos." id="toc-comparación-entre-métodos." class="nav-link" data-scroll-target="#comparación-entre-métodos."><span class="header-section-number">6.5</span> Comparación entre métodos.</a>
  <ul class="collapse">
  <li><a href="#comparación-de-los-criterios-de-calidad-de-ajuste" id="toc-comparación-de-los-criterios-de-calidad-de-ajuste" class="nav-link" data-scroll-target="#comparación-de-los-criterios-de-calidad-de-ajuste">Comparación de los criterios de calidad de ajuste</a></li>
  <li><a href="#comparación-de-las-predicciones" id="toc-comparación-de-las-predicciones" class="nav-link" data-scroll-target="#comparación-de-las-predicciones">Comparación de las predicciones</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#resumen-de-los-comandos-utilizados" id="toc-resumen-de-los-comandos-utilizados" class="nav-link" data-scroll-target="#resumen-de-los-comandos-utilizados"><span class="header-section-number">7</span> Resumen de los comandos utilizados</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Series sin tendencia ni estacionalidad</h1>
<p class="subtitle lead">Previsión con Datos Temporales (GBIA)</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Iván Arribas (Depto. Análisis Económico. Universitat de València) </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<p><br>
<br>
</p>
<section id="introducción" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introducción</h1>
<p>La series más sencillas que podemos encontrarnos son aquellas que no tienen tendencia ni estacionalidad, series que se mueven en torno a un valor central desconocido: <span class="math inline">\(y_t = \mu + \varepsilon_t\)</span>.</p>
<p>La <a href="#fig-ejemplos_no_tendencia" class="quarto-xref">Figura&nbsp;1</a> muestra dos ejemplos de este tipo de series. El panel de la izquierda muestra para España el consumo per cápita de alimentos en el hogar (kg per cápita) desde 1990 hasta 2023. Se observa claramente que en los últimos 30 años el volumen de consumo de alimentos per cápita en el hogar prácticamente no ha variado y se mantiene en torno a los 632 kg de media. El panel de la derecha muestra el número de defunciones diarias desde el 1 de enero de 2022 al 31 de diciembre de 2023. Esta serie también es estacionaria en torno al valor medio de 1220 defunciones y, aunque es una serie diaria, no muestra ningún patrón estacional. La Parca no muestra ninguna preferencia entre los días de la semana para citarnos.</p>
<div class="cell" data-layout="[[50,50]]" data-layout-align="center">
<div id="fig-ejemplos_no_tendencia" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ejemplos_no_tendencia-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-ejemplos_no_tendencia" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-ejemplos_no_tendencia-1" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-ejemplos_no_tendencia-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-04-Tema4_files/figure-html/fig-ejemplos_no_tendencia-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%" data-ref-parent="fig-ejemplos_no_tendencia">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-ejemplos_no_tendencia-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Alimentos per cápita
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-ejemplos_no_tendencia" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-ejemplos_no_tendencia-2" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-ejemplos_no_tendencia-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-04-Tema4_files/figure-html/fig-ejemplos_no_tendencia-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%" data-ref-parent="fig-ejemplos_no_tendencia">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-ejemplos_no_tendencia-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Defunciones diarias
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ejemplos_no_tendencia-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;1: Ejemplos de series sin tendencia ni estacionalidad
</figcaption>
</figure>
</div>
</div>
<p>En este tema veremos tres familias de métodos para analizar y predecir este tipo de series. Empezaremos por los métodos sencillos (incluido el de medias móviles) que no requerirán apenas de explicaciones. Luego veremos el método de Alisado exponencial simple, algo más complejo y donde ya habrá que ajustar algunos parámetros, ya veremos cómo. Terminaremos con el modelo Arima para el caso más simple, que nos llevará aun algo más de tiempo.</p>
<p>En los siguientes temas veremos como adaptar estos mismos métodos de predicción a una serie temporal creciente en complejidad al añadir primero la tendencia (Tema 6) y luego la estacionalidad (Temas 7 y 8).</p>
<p><br>
<br>
</p>
</section>
<section id="criterios-de-calidad" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Criterios de calidad</h1>
<p>Dado que en este tema, y en los siguientes, vamos a ver diferentes métodos para predecir una serie temporal, es preciso definir criterios que permitan estimar tanto su calidad del ajuste (bondad de ajuste) como su precisión con las predicciones, para poder elegir el <em>mejor</em> modelo.</p>
<blockquote class="blockquote">
<p>“The rankings of the performance of the various methods vary according to the accuracy measure being used.” <span class="citation" data-cites="Makridakis00">Makridakis and Hibon (<a href="#ref-Makridakis00" role="doc-biblioref">2000</a>)</span></p>
</blockquote>
<p><br>
</p>
<section id="notación-y-definiciones" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="notación-y-definiciones"><span class="header-section-number">2.1</span> Notación y definiciones</h2>
<p>Dada una serie temporal <span class="math inline">\(\{y_t\}_{t=1}^T\)</span>, se define:</p>
<ul>
<li><p><strong>Previsión</strong> <span class="math inline">\(h\)</span> periodos adelante, como la previsión de la serie para el periodo <span class="math inline">\(t+h\)</span> disponiendo de información hasta el periodo <span class="math inline">\(t\)</span>, y se denota por <span class="math inline">\(\hat{y}_{t+h|t}\)</span>. Por simplicidad lo escribiremos también como <span class="math inline">\(\hat{y}_{t+h}\)</span>.</p></li>
<li><p>Así, <span class="math inline">\(\hat{y}_{t+1|t}\)</span> es la <strong>previsión un periodo adelante</strong> o a un periodo vista. Es decir, la previsión de la serie en el periodo <span class="math inline">\(t+1\)</span> desde el periodo <span class="math inline">\(t\)</span>.</p>
<p>Por simplicidad denotaremos a <span class="math inline">\(\hat{y}_{t+1|t}\)</span> como <span class="math inline">\(\hat{y}_{t+1}\)</span>. Por tanto, <span class="math inline">\(\hat{y}_{t}\)</span> será la previsión en <span class="math inline">\(t\)</span> con datos hasta el periodo <span class="math inline">\(t-1\)</span> (<span class="math inline">\(\hat{y}_{t} = \hat{y}_{t|t-1}\)</span>).</p></li>
</ul>
<p>Si para un periodo <span class="math inline">\(t\)</span> se tiene la observación <span class="math inline">\(y_t\)</span> y una previsión <span class="math inline">\(\hat{y}_t\)</span>, se define como <strong>error</strong> a un periodo vista a <span class="math display">\[\hat{e}_t=y_t-\hat{y}_t,\]</span> de forma que la serie <span class="math inline">\(\{\hat{e}_t\}_{t=1}^T\)</span> nos permitirá definir varios criterios de calidad.</p>
<section id="calidad-de-ajuste-o-de-previsión" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="calidad-de-ajuste-o-de-previsión">¿Calidad de ajuste o de previsión?</h3>
<p>Los mismos criterios que se van a definir a continuación pueden ser criterios de calidad de ajuste o de calidad de las previsiones. Esta diferencia depende de cómo se ha obtenido <span class="math inline">\(\hat{y}_t\)</span>.</p>
<p>Si en el proceso de predicción hay parámetros cuyo ajuste o estimación se ha realizado usando toda la serie temporal, entonces hablaremos de calidad de ajuste: para obtener <span class="math inline">\(\hat{y}_t\)</span> se habrá usado el dato <span class="math inline">\(y_t\)</span> y los siguientes, es decir, datos posteriores al periodo <span class="math inline">\(t\)</span> y entonces <span class="math inline">\(\hat{e}_t\)</span> es un error de ajuste.</p>
<p>Por el contrario, si en el proceso de predicción no hay parámetros o habiéndolos su estimación se ha realizado usando la serie temporal hasta el periodo <span class="math inline">\(t-1\)</span>, entonces hablaremos de calidad de predicción: para obtener <span class="math inline">\(\hat{y}_t\)</span> solo se habrán usado el datos hasta <span class="math inline">\(y_{t-1}\)</span>, es decir, datos anteriores al periodo <span class="math inline">\(t\)</span>, y entonces <span class="math inline">\(\hat{e}_t\)</span> es un error de predicción.</p>
<p>A veces al <em>error de ajuste</em> se le denomina <em>error de previsión intramuestral</em> y hablaremos de criterios de <em>calidad intramuestral</em>. De la misma forma al <em>error de previsión</em> se le denomina <em>error de previsión extramuestral</em> y hablaremos de criterios de <em>calidad extramuestral</em> o <em>precisión</em> de las predicciones.</p>
<p><br>
</p>
</section>
</section>
<section id="criterios-de-calidad-1" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="criterios-de-calidad-1"><span class="header-section-number">2.2</span> Criterios de calidad</h2>
<p>Dada una serie <span class="math inline">\(\{y_t\}_{t=1}^T\)</span>, un método de predicción y su vector de errores asociado <span class="math inline">\(\{\hat{e}_t\}_{t=1}^T\)</span>, podemos definir múltiples criterios de calidad de ajuste o predicción del método que hacen referencia a la presencia de sesgo en las predicciones, la magnitud del error cometido y la calidad del intervalo de confianza de las predicciones. Las más habituales son (siglas en inglés):</p>
<ul>
<li>Error medio (ME): <span class="math inline">\(\frac{1}{T}\sum_{t=1}^T \hat{e}_t\)</span></li>
</ul>
<ul>
<li>Raíz del error cuadrático medio (RMSE): <span class="math inline">\(\sqrt{\frac{1}{T}\sum_{t=1}^T \hat{e}^2_t}\)</span></li>
</ul>
<ul>
<li>Error absoluto medio (MAE): <span class="math inline">\(\frac{1}{T}\sum_{t=1}^T |\hat{e}_t|\)</span></li>
</ul>
<ul>
<li>Error porcentual medio (MPE): <span class="math inline">\(\frac{100}{T}\sum_{t=1}^T \frac{\hat{e}_t}{y_t}\)</span></li>
</ul>
<ul>
<li>Error porcentual absoluto medio (MAPE): <span class="math inline">\(\frac{100}{T}\sum_{t=1}^T \big|\frac{\hat{e}_t}{y_t}\big|\)</span></li>
</ul>
<ul>
<li>Error escalado absoluto medio (MASE): <span class="math inline">\(\big(\frac{1}{T}\sum_{t=1}^T |\hat{e}_t|\big)/q\)</span>, donde <span class="math inline">\(q\)</span> es el error absoluto medio para un método ingenuo de predicción: el método ingenuo I para series sin estacionalidad y el método ingenuo con estacionalidad para series con estacionalidad.</li>
</ul>
<ul>
<li>Correlación entre <span class="math inline">\(\hat{e}_t\)</span> y <span class="math inline">\(\hat{e}_{t-1}\)</span> (ACF1).</li>
</ul>
<p><br>
</p>
<p>ME y MPE permiten valorar el sesgo de las predicciones (que estén sistemáticamente por encima o por debajo de los valores reales).</p>
<ul>
<li>Lo esperado es un valor cercano a cero (en el caso de ME con relación al valor medio de la serie). Valores muy alejados de cero son indicadores de sesgo de predicción.</li>
<li>La más cómoda de interpretar es MPE. Asumiremos que si MPE es menor que 1% en valor absoluto, no hay sesgo.</li>
</ul>
<p>RMSE y MAE son medidas de calidad de ajuste/precisión. Indican el error medio cometido, independientemente del signo, medido en las mismas unidades que la serie temporal.</p>
<ul>
<li>Están acotadas inferiormente por el valor óptimo de 0, pero no hay cota superior.</li>
</ul>
<p>MAPE es una medida de calidad de ajuste/precisión alternativa que indica el error porcentual medio cometido.</p>
<ul>
<li>Está acotado inferiormente por el valor óptimo de 0%, y la cota superior natural es 100%, aunque podría sobrepasarse.</li>
<li>Si <span class="math inline">\(y_t\)</span> puede valer 0, entonces MAPE no se puede calcular. Además, MAPE penaliza más los errores negativos frente a los errores positivos. Se puede definir el error porcentual absoluto medio simétrico (sMAPE) <span class="math inline">\(\frac{200}{T}\sum_{t=1}^T \Big|\frac{\hat{e}_t}{y_t + \hat{y}_t}\Big|\)</span> a fin de corregir estos problemas.</li>
</ul>
<p>MASE es la ratio entre el error del método usado y el error de un método ingenuo de predicción. Permite saber cuánto ganamos en capacidad predictiva al pasar de un método ingenuo a otro más complicado.</p>
<ul>
<li>Un valor cercano a 1 indica que el método usado no es mejor que el método ingenuo</li>
<li>Cuanto más cercano a 0, mejor es el método usado respecto del método ingenuo</li>
<li>Su complementario a 1 se puede interpretar como la tasa de mejora</li>
</ul>
<p>ACF1 permite saber si el método empleado ha extraído toda la información disponible en los datos de la serie para hacer las predicciones. Si no es así, la fórmula usada para estimar el intervalo de confianza de las predicciones no será válida:</p>
<ul>
<li>Un valor muy cercano a 0 (menor que 0.1) indica que se ha extraído toda la información y la fórmula usada para estimar el intervalo de confianza de las predicciones es válida.</li>
<li>Valores minimamente alejados de 0 indican que la fórmula no es válida.</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Cálculo del intervalo de confianza de las predicciones
</div>
</div>
<div class="callout-body-container callout-body">
<p>Ve a la Píldora <em>Bootstrapping para intervalos de predicción</em> para saber más sobre las fórmulas usadas para estimar el intervalo de confianza de las predicciones y alternativas de cálculo cuando estas fórmulas no son válidas.</p>
</div>
</div>
<p><strong>En todas las fórmulas de criterios de calidad las <em>medias</em> se pueden sustituir por <em>medianas</em>.</strong> Esto es especialmente útil cuando para hay observaciones atípicas que generan errores muy altos.</p>
<p><br>
</p>
<p>Los indicadores de calidad de ajuste que se basan en predicciones intramuestrales a un periodo vista, presentan dos problemas. Primero, evalúan el error a un periodo vista, cuando en muchas situaciones reales las predicciones se realizan sobre un horizonte temporal más amplio. Segundo, son errores intramuestrales, resultantes de predecir los mismos datos que ha usado el método para calcular la predicción y, por tanto, sobrestiman la capacidad predictiva del modelo.</p>
<p>Veremos en el <a href="https://iarribasf.github.io/PrediccionSeriesTemporales-GBIA/03-05-Tema5.html">Tema 5</a> métodos de evaluación de la precisión de las predicciones que superan estas limitaciones.</p>
<p><br>
<br>
</p>
</section>
</section>
<section id="métodos-sencillos-de-predicción" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Métodos sencillos de predicción</h1>
<p>Veamos algunos métodos sencillos para series sin tendencia ni estacionalidad, sus funciones en el paquete <code>forecast</code> y algún ejemplo de aplicación.</p>
<p>Incluiremos dentro del grupo de métodos sencillos la media móvil. Aunque en este método el analista debe fijar un parámetro, así que no es tan <em>sencillo</em>.</p>
<section id="métodos-sencillos-de-predicción-1" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="métodos-sencillos-de-predicción-1"><span class="header-section-number">3.1</span> Métodos sencillos de predicción</h2>
<p><strong>Método de la Media</strong>: <span class="math inline">\(\hat{y}_{T+h}=(y_1+\ldots,y_T)/T\)</span>.</p>
<ul>
<li>La predicción para cualquier periodo futuro es la <strong>media</strong> de las observaciones disponibles previas.</li>
<li>Función de <code>R</code>: <code>meanf(y, h)</code></li>
</ul>
<p><strong>Método ingenuo I</strong>: <span class="math inline">\(\hat{y}_{T+h}=y_T\)</span>.</p>
<ul>
<li>La predicción para cualquier periodo futuro es la <strong>última</strong> observación disponible.</li>
<li>Función de <code>R</code>: <code>naive(y, h)</code> o <code>rwf(y, h)</code> (<em>rw</em> de random walk)</li>
<li>Para series sin estacionalidad este es el método ingenuo de comparación del MASE.</li>
</ul>
<p><strong>Método de la media móvil</strong>: <span class="math inline">\(\hat{y}_{T+h}=\frac{1}{r}(y_T + y_{T-1} + \cdots + y_{T-r+1})\)</span>.</p>
<ul>
<li>La predicción para cualquier periodo futuro es la <strong>media de las últimas <span class="math inline">\(r\)</span> observaciones</strong>.</li>
<li>El valor de <span class="math inline">\(r\)</span> lo debe determinar el investigador. Cuanto mayor es su valor, más <em>suave</em> es la linea de predicciones obtenida y menos efecto tiene el valor de una observación individual sobre la predicción. En el caso límite <span class="math inline">\(r=1\)</span> se tiene el método <em>Ingenuo I</em> y para <span class="math inline">\(r=T\)</span> el método de la <em>Media</em>.</li>
<li>Para poder aplicar la media móvil de orden <span class="math inline">\(r\)</span> se necesitan al menos <span class="math inline">\(r\)</span> datos.</li>
<li>Para los <span class="math inline">\(r-1\)</span> periodos iniciales no es posible calcular la media móvil y, por tanto, para los <span class="math inline">\(r\)</span> periodos iniciales no es posible obtener una predicción intramuestral.</li>
</ul>
<p>Este método no tiene una función de <code>R</code>, así que usaremos una creada por nosotros: <code>mmf(x, r, h, level)</code>.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>mmf <span class="ot">&lt;-</span> <span class="cf">function</span> (x, <span class="at">r =</span> <span class="dv">3</span>, <span class="at">h =</span> <span class="dv">10</span>, <span class="at">level =</span> <span class="fu">c</span>(<span class="dv">80</span>, <span class="dv">95</span>)) </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(x)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  startx <span class="ot">&lt;-</span> <span class="fu">start</span>(x)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  frequencyx <span class="ot">&lt;-</span><span class="fu">frequency</span>(x)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  mm <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">filter</span>(x, <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">/</span>r, r), <span class="at">side =</span> <span class="dv">1</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  fits <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="cn">NA</span>, mm[<span class="sc">-</span>n])</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> x <span class="sc">-</span> fits</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  f <span class="ot">&lt;-</span> <span class="fu">rep</span>(mm[n], h)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">min</span>(level) <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> <span class="fu">max</span>(level) <span class="sc">&lt;</span> <span class="dv">1</span>) {</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    level <span class="ot">&lt;-</span> <span class="dv">100</span> <span class="sc">*</span> level</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">min</span>(level) <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">||</span> <span class="fu">max</span>(level) <span class="sc">&gt;</span> <span class="fl">99.99</span>) </span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"Confidence limit out of range"</span>)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  nconf <span class="ot">&lt;-</span> <span class="fu">length</span>(level)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  s <span class="ot">&lt;-</span> <span class="fu">sd</span>(res, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>  lower <span class="ot">&lt;-</span> upper <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> h, <span class="at">ncol =</span> nconf)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nconf) {</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (n <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>      tfrac <span class="ot">&lt;-</span> <span class="fu">qt</span>(<span class="fl">0.5</span> <span class="sc">-</span> level[i]<span class="sc">/</span><span class="dv">200</span>, n <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>      tfrac <span class="ot">&lt;-</span> <span class="sc">-</span><span class="cn">Inf</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>    w <span class="ot">&lt;-</span> <span class="sc">-</span>tfrac <span class="sc">*</span> s <span class="sc">*</span> <span class="fu">sqrt</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span>n)</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>    lower[, i] <span class="ot">&lt;-</span> f <span class="sc">-</span> w</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>    upper[, i] <span class="ot">&lt;-</span> f <span class="sc">+</span> w</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(lower) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(upper) <span class="ot">&lt;-</span> <span class="fu">paste</span>(level, <span class="st">"%"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>  fits <span class="ot">&lt;-</span> <span class="fu">ts</span>(fits, <span class="at">start =</span> startx, <span class="at">frequency =</span> frequencyx)</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">ts</span>(res, <span class="at">start =</span> startx, <span class="at">frequency =</span> frequencyx)</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>  f <span class="ot">&lt;-</span> <span class="fu">ts</span>(f, <span class="at">start =</span> <span class="fu">time</span>(x)[n] <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span>frequencyx, <span class="at">frequency =</span> frequencyx)</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>  lower <span class="ot">&lt;-</span> <span class="fu">ts</span>(lower, <span class="at">start =</span> <span class="fu">time</span>(x)[n] <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span>frequencyx, <span class="at">frequency =</span> frequencyx)</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>  upper <span class="ot">&lt;-</span> <span class="fu">ts</span>(upper, <span class="at">start =</span> <span class="fu">time</span>(x)[n] <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span>frequencyx, <span class="at">frequency =</span> frequencyx)</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">method =</span> <span class="st">"Moving average"</span>, <span class="at">level =</span> level, <span class="at">x =</span> x,</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>              <span class="at">mean =</span> f, <span class="at">lower =</span> lower, <span class="at">upper =</span> upper, <span class="at">fitted =</span> fits, </span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>              <span class="at">residuals =</span> res, <span class="at">order =</span> r)</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">structure</span>(out, <span class="at">class =</span> <span class="st">"forecast"</span>))</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>La función <code>mmf</code> precisa de tres argumentos, una serie temporal, el orden de la media móvil <span class="math inline">\(r\)</span> y el horizonte de previsión <span class="math inline">\(h\)</span>. Los valores por defecto de los dos últimos argumentos están fijados a 3, 10.</p>
</section>
<section id="ejemplo-de-aplicación-a-la-serie-consumo-alimentarios-en-el-hogar-per-cápita" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="ejemplo-de-aplicación-a-la-serie-consumo-alimentarios-en-el-hogar-per-cápita"><span class="header-section-number">3.2</span> Ejemplo de aplicación a la serie consumo alimentarios en el hogar per cápita</h2>
<p>Analizaremos el <strong>consumo alimentario en hogar per cápita</strong> en España. Esta serie está construida a partir de la serie de consumo alimentario en hogar (disponible en el Ministerio de Agricultura, Alimentación y Medio Ambiente) y la serie de población (disponible en el Instituto Nacional de Estadística). Es una serie anual de 1990 a 2023 (34 datos) y la unidad es el kg per cápita. El panel a) de la <a href="#fig-ejemplos_no_tendencia" class="quarto-xref">Figura&nbsp;1</a> muestra que es una serie estacionaria.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>alimentospc <span class="ot">&lt;-</span> <span class="fu">read.csv2</span>(<span class="st">"./series/Alimentacionpc.csv"</span>, </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>alimentospc <span class="ot">&lt;-</span> <span class="fu">ts</span>(alimentospc[, <span class="dv">1</span>], </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">start =</span> <span class="dv">1990</span>, </span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">freq =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Las siguientes salidas muestran el resultado de la aplicación de los métodos sencillos a la serie. Se ha fijado un horizonte de previsión de cinco años (<code>h = 5</code>). Todos estos métodos realizan una predicción constante, el método de la media da la media del consumo de alimentos per cápita en el periodo de análisis (632.14); el Ingenuo I da el último dato observado (555.47); y la media móvil de orden <span class="math inline">\(r=4\)</span>, valor fijado por nosotros, da la media de las cuatro últimas observaciones 604.63.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>(mediaAlimentospc <span class="ot">&lt;-</span> <span class="fu">meanf</span>(alimentospc, <span class="at">h =</span> <span class="dv">5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Point Forecast    Lo 80    Hi 80   Lo 95    Hi 95
2024       632.1406 598.4999 665.7812 579.804 684.4771
2025       632.1406 598.4999 665.7812 579.804 684.4771
2026       632.1406 598.4999 665.7812 579.804 684.4771
2027       632.1406 598.4999 665.7812 579.804 684.4771
2028       632.1406 598.4999 665.7812 579.804 684.4771</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>(naiveAlimentospc <span class="ot">&lt;-</span> <span class="fu">naive</span>(alimentospc, <span class="at">h =</span> <span class="dv">5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Point Forecast    Lo 80    Hi 80    Lo 95    Hi 95
2024        555.472 527.5726 583.3714 512.8036 598.1404
2025        555.472 516.0163 594.9277 495.1297 615.8143
2026        555.472 507.1488 603.7952 481.5681 629.3759
2027        555.472 499.6732 611.2708 470.1351 640.8089
2028        555.472 493.0871 617.8569 460.0625 650.8815</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>(mmAlimentospc    <span class="ot">&lt;-</span> <span class="fu">mmf</span>(alimentospc, <span class="at">r =</span> <span class="dv">4</span>, <span class="at">h =</span> <span class="dv">5</span>)) <span class="co">#Fijamos r = 4 años.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Point Forecast    Lo 80    Hi 80    Lo 95    Hi 95
2024       604.6273 572.4228 636.8317 554.5251 654.7294
2025       604.6273 572.4228 636.8317 554.5251 654.7294
2026       604.6273 572.4228 636.8317 554.5251 654.7294
2027       604.6273 572.4228 636.8317 554.5251 654.7294
2028       604.6273 572.4228 636.8317 554.5251 654.7294</code></pre>
</div>
</div>
<p>La <a href="#fig-alimentossencillos" class="quarto-xref">Figura&nbsp;2</a> muestra el resultado gráfico de la aplicación de estos métodos. El argumento <code>PI = FALSE</code> hace que no se impriman los intervalos de confianza de las predicciones.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(alimentospc, </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">series =</span> <span class="st">"Alimentos"</span>,</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"Kg per cápita"</span>,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">700</span>)) <span class="sc">+</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(mediaAlimentospc, <span class="at">series=</span><span class="st">"Media"</span>, <span class="at">PI =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(naiveAlimentospc, <span class="at">series=</span><span class="st">"Ingenuo"</span>, <span class="at">PI =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(mmAlimentospc, <span class="at">series=</span><span class="st">"Media móvil (r = 4)"</span>, <span class="at">PI =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_discrete</span>(<span class="at">limits=</span><span class="fu">c</span>(<span class="st">"Alimentos"</span>, <span class="st">"Media"</span>, </span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"Ingenuo"</span>, <span class="st">"Media móvil (r = 4)"</span>)) <span class="sc">+</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">colour=</span><span class="st">"Métodos"</span>) <span class="sc">+</span> </span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="fu">c</span>(<span class="fl">0.2</span>,<span class="fl">0.3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-alimentossencillos" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-alimentossencillos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-04-Tema4_files/figure-html/fig-alimentossencillos-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-alimentossencillos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;2: Consumo de alimentos en el hogar y predicción por métodos sencillos
</figcaption>
</figure>
</div>
</div>
</div>
<p>Con la función <code>accuracy</code> se puede obtener el error de ajuste a un periodo vista de cada método:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(mediaAlimentospc)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(naiveAlimentospc)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(mmAlimentospc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>               ME  RMSE   MAE   MPE MAPE MASE  ACF1
Media        0.00 24.98 18.59 -0.16 3.00 1.30  0.49
Ingenuo I   -2.09 21.77 14.32 -0.42 2.28 1.00 -0.03
Media móvil -5.49 24.49 18.27 -1.01 2.97 1.28  0.39</code></pre>
</div>
</div>
<p>Podemos destacar que:</p>
<ul>
<li>El método <em>Ingenuo I</em> presenta la mejor calidad de ajuste con un error de 22 kg per cápita (RMSE) o del 2.3% (MAPE). El método de <em>Media</em> y de la <em>Media móvil</em> tienen una calidad de ajuste similar, con un error medio en torno a los 24.5–25 kg per cápita (RMSE) y un error porcentual del 3% (MAPE).</li>
<li>Si se usa como criterio de calidad de ajuste el error absoluto medio (MAE), vuelve a ser mejor el método <em>Ingenuo I</em>.</li>
<li>Además, el método de <em>Ingenuo I</em> genera predicciones por intervalo fiables (ACF1 = -0.03), mientras que los métodos de la <em>Media</em> y de la <em>Media móvil</em> no (ACF1 de 0.49 y 0.39, respectivamente).</li>
<li>Los métodos de la <em>Media</em> e <em>Ingenuo I</em> no presentan sesgo (|MPE| &lt; 1%). Además, el error medio (ME) siempre será nulo para el método de la <em>Media</em>, lo que indica que nos equivocamos lo mismo por exceso como por defecto. Esta es una buena propiedad, que el método <em>Ingenuo I</em> y de la <em>Media móvil</em> no verifican.</li>
<li>Para series sin estacionalidad el método sencillo de comparación usado en el cálculo del MASE es el <em>Ingenuo I</em>. Es por ello que este indicador vale 1 para este método. Como el método de <em>Media</em> tiene un MAE superior al <em>Ingenuo I</em>, su MASE es mayor que 1. En concreto, MASE = 1.3 = 18.59 / 14.32. Lo mismo pasa con el método de la <em>Media móvil</em>.</li>
</ul>
<p>Concluimos que, con independencia del criterio usado, el método que mejor ajusta los datos es el <em>Ingenuo I</em>.</p>
<section id="identificación-del-orden-r-del-método-de-la-media-móvil" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="identificación-del-orden-r-del-método-de-la-media-móvil">Identificación del orden <span class="math inline">\(r\)</span> del método de la Media móvil</h3>
<p>En este ejemplo hemos fijado <span class="math inline">\(r=4\)</span>. ¿Es el mejor valor? ¿hay alguna forma de determinar el valor óptimo de <span class="math inline">\(r\)</span>?</p>
<p>Una forma sencilla de responder a estas preguntas consiste en aplicar el método de la media móvil para diferentes órdenes <span class="math inline">\(r\)</span> y comprobar para cual de ellos se obtiene el mejor valor del criterio de calidad deseado. Realizaremos este ejercicio considerando como indicador de bondad de ajuste el MAPE:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(r <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) {</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  error <span class="ot">&lt;-</span> <span class="fu">accuracy</span>(<span class="fu">mmf</span>(alimentospc, <span class="at">r =</span> r))[<span class="dv">5</span>]</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  error <span class="ot">&lt;-</span> <span class="fu">formatC</span>(error, <span class="at">format =</span> <span class="st">"f"</span>, <span class="at">digits =</span> <span class="dv">2</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Para un orden de"</span>, r, <span class="st">"el error es"</span>, error, <span class="st">"%"</span>)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Para un orden de 1 el error es 2.28 %
Para un orden de 2 el error es 2.65 %
Para un orden de 3 el error es 2.89 %
Para un orden de 4 el error es 2.97 %
Para un orden de 5 el error es 3.16 %</code></pre>
</div>
</div>
<p>Podemos concluir que el orden óptimo es 1, donde se alcanza el menor MAPE, es decir el método Ingenuo I.</p>
<p><br>
<br>
</p>
</section>
</section>
</section>
<section id="alisado-exponencial-simple" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Alisado exponencial simple</h1>
<p><br>
</p>
<section id="definición" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="definición"><span class="header-section-number">4.1</span> Definición</h2>
<p>Recordemos que las series sin tendencia ni estacionalidad giran en torno a un nivel medio desconocido: <span class="math inline">\(y_t = \mu + \varepsilon_t\)</span>. Por tanto, para obtener una predicción en el periodo <span class="math inline">\(t+1\)</span> necesitamos la estimación del nivel de la serie con la información disponible hasta el periodo <span class="math inline">\(t\)</span>. Denominaremos a este nivel <span class="math inline">\(l_t\)</span>, de esta forma se tendrá que: <span class="math display">\[\widehat{y}_{t+1} = l_t.\]</span></p>
<p>Es decir, <span class="math inline">\(l_t\)</span> es la estimación del nivel desconocido <span class="math inline">\(\mu\)</span> con información hasta el periodo <span class="math inline">\(t\)</span>.</p>
<p>¿Pero cómo obtenemos <span class="math inline">\(l_t\)</span>? Mediante una expresión recursiva donde el nivel <span class="math inline">\(l_t\)</span> se calcula a partir de los valores hasta <span class="math inline">\(t\)</span> de la serie y los valores pasados estimados para el nivel. En concreto, para el Alisado exponencial simple la <strong>ecuación recursiva</strong> de suavizado es <span class="math display">\[l_t=\alpha y_t + (1-\alpha)l_{t-1}.\]</span> Dos estimaciones razonables de <span class="math inline">\(l_t\)</span>, el nivel de la serie en el periodo <span class="math inline">\(t\)</span>, son el valor observado para la serie en ese periodo <span class="math inline">\(y_t\)</span> y el nivel del periodo previo <span class="math inline">\(l_{t-1}\)</span>. La estimación final de <span class="math inline">\(l_t\)</span> es una media ponderada de ambas según el parámetro <span class="math inline">\(\alpha\)</span>, y esta estimación final es la previsión de la serie para el periodo siguiente.</p>
<p>El parámetro <span class="math inline">\(\alpha\)</span> se denomina parámetro de suavizado y verifica que <span class="math inline">\(0 \leq \alpha \leq 1\)</span>.</p>
<p>Ya hemos comentado que la ecuación de <strong>predicción intramuestral</strong> es <span class="math inline">\(\widehat{y}_{t+1} = l_t\)</span>. La ecuación de <strong>predicción extramuestral</strong> es <span class="math display">\[\widehat{y}_{T+h} = \widehat{y}_{T+1} = l_T.\]</span> El método de Alisado también ofrece predicciones constantes para series sin tendencia ni estacionalidad.</p>
</section>
<section id="térmimo-de-error" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="térmimo-de-error"><span class="header-section-number">4.2</span> Térmimo de error</h2>
<p>Por otro lado, el término de error de los modelos de alisado puede seguir un esquema aditivo o multiplicativo. Si el <strong>residuo es aditivo</strong>, entonces el modelo es <span class="math inline">\(y_t = \widehat{y}_t + \widehat{\varepsilon}_t\)</span> y el residuo se define de la forma usual <span class="math display">\[\widehat{\varepsilon}_t = y_t - \widehat{y}_t.\]</span></p>
<p>Ahora bien, si el <strong>residuo es multiplicativo</strong>, entonces el modelo es <span class="math inline">\(y_t = \widehat{y}_t \cdot (1 + \widehat{\varepsilon}_t)\)</span>, y no <span class="math inline">\(y_t = \widehat{y}_t \cdot \widehat{\varepsilon}_t\)</span> como se podría esperar. Por tanto, el residuo multiplicativo se define como <span class="math display">\[\widehat{\varepsilon}_t = (y_t - \widehat{y}_t)/\widehat{y}_t.\]</span></p>
<p>Observa que el error multiplicativo no es el error porcentual tal y como se define para el calculo del MPE o del MAPE.</p>
<p>En ambos casos –error aditivo y multiplicativo– el residuo evoluciona alrededor del valor 0 y se le pueden imponer las hipótesis usuales de ruido blanco.</p>
<p>Según el tipo de error tenemos dos posibles casos de Alisado exponencial simple:</p>
<ul>
<li><span class="math inline">\(y_t = \widehat{y}_t + \widehat{\varepsilon}_t = l_{t-1} + \widehat{\varepsilon}_t\)</span></li>
<li><span class="math inline">\(y_t = \widehat{y}_t (1 + \widehat{\varepsilon}_t) = l_{t-1} \cdot (1 + \widehat{\varepsilon}_t)\)</span></li>
</ul>
<p>El tipo de error (aditivo o multiplicativo) es sobre todo relevante en el cálculo del intervalo de confianza de las predicciones.<br>
</p>
</section>
<section id="las-funciones-ets-y-forecast" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="las-funciones-ets-y-forecast"><span class="header-section-number">4.3</span> Las funciones <code>ets</code> y <code>forecast</code></h2>
<p>Podemos estimar cualquiera de los dos modelos usando la función <code>ets</code> del paquete <code>forecast</code>.</p>
<ul>
<li>El tipo de modelo en <code>ets</code> se especifica con el argumento <code>model</code>, un código de tres letras indicando el tipo de Error, Tendencia y eStacionalidad (ETS). Por ejemplo, <code>model = "ANN"</code> indica un modelo con error aditivo, sin tendencia ni estacionalidad y <code>model = "MNN"</code> indica un modelo con error multiplicativo sin tendencia ni estacionalidad. Es decir los dos casos de Alisado exponencial simple.</li>
<li>Si deseas que sea la función <code>ets</code> la que decida el tipo de error más adecuado, puedes escribir <code>model = "ZNN"</code>.</li>
</ul>
<p>A diferencia de las funciones vistas para métodos simples y media móvil (<code>naive</code>, <code>meanf</code> y <code>mmf</code>), la función <code>ets</code> solo estima los modelos, pero no produce predicciones. Para ello habrá que usar la función <code>forecast</code> sobre un modelo estimado con <code>ets</code>. El argumento <code>h</code> de esta función especifica el horizonte temporal de predicción. También puedes usar <code>level</code> para fijar el nivel de confianza del intervalo de predicción.</p>
<p>Mira la ayuda de <code>R</code> para ver una explicación detallada de los argumentos de estas las funciones <code>ets</code> y <code>forecast</code>.</p>
<p><br>
</p>
</section>
<section id="estimación-de-los-parámetros-del-modelo" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="estimación-de-los-parámetros-del-modelo"><span class="header-section-number">4.4</span> Estimación de los parámetros del modelo</h2>
<p>Dado el proceso iterativo para el cálculo de <span class="math inline">\(l_t\)</span> se necesita un <strong>valor inicial</strong> de arranque <span class="math inline">\(l_0\)</span>. Cada programa estadístico usa su propio método para obtener <span class="math inline">\(l_0\)</span>.</p>
<p>Respecto de <span class="math inline">\(\alpha\)</span>, usualmente se estima el valor <strong>optimo</strong> según un criterio de calidad de ajuste. El parámetro <span class="math inline">\(\alpha\)</span> <strong>se puede interpretar</strong>:</p>
<ul>
<li>Si <span class="math inline">\(\alpha = 1\)</span>, la ecuación recursiva queda <span class="math inline">\(l_t = y_t\)</span>, es decir, el <em>método ingenuo I</em> (<span class="math inline">\(\widehat{y}_{t+1}=y_t\)</span>). Este caso es óptimo cuando el nivel de la serie varía constantemente en el tiempo.</li>
<li>Si <span class="math inline">\(\alpha = 0\)</span>, la ecuación recursiva queda <span class="math inline">\(l_t=l_{t-1}=\ldots = l_0\)</span>, es decir, <span class="math inline">\(\hat y_{t+1}= l_0\)</span>. Esto es óptimo cuando el nivel permanece constante en el tiempo.</li>
</ul>
<p>En concreto, <code>ets</code> por defecto estima los parámetros <span class="math inline">\(\alpha\)</span> y <span class="math inline">\(l_0\)</span> maximizando la función de verosimilitud<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>, pero el argumento <code>opt.crit</code> permite cambiar de criterio. Esta búsqueda está restringida a <span class="math inline">\(0 &lt; \alpha &lt; 1\)</span>. Es decir el parámetro <span class="math inline">\(\alpha\)</span> nunca puede ser 0 o 1 y en la práctica sus valores limite son 0.0001 y 0.9999.</p>
</section>
<section id="criterios-de-selección-de-modelos" class="level2" data-number="4.5">
<h2 data-number="4.5" class="anchored" data-anchor-id="criterios-de-selección-de-modelos"><span class="header-section-number">4.5</span> Criterios de selección de modelos</h2>
<p>Queda pendiente saber que criterio se usa para seleccionar entre el modelo con error aditivo o multiplicativo. Este aspecto es muy importante porque en temas posteriores veremos que el conjunto de selección de modelos se va ampliando, hasta un total de 30 posibles modelos.</p>
<p>La selección se hace a partir de un criterio de información entre Akaike (aic), Akaike corregido para pequeñas muestras (aicc) y el Bayesiano (bic). Sus fórmulas son: <span class="math display">\[aic = -2log(L) + 2k\]</span> <span class="math display">\[aicc = aic + \frac{k(k+1)}{T-k-1}\]</span> <span class="math display">\[bic=aic + k(log(T) - 2)\]</span> donde <span class="math inline">\(L\)</span> es la verosimilitud, <span class="math inline">\(T\)</span> el número de datos y <span class="math inline">\(k\)</span> el número de parámetros estimados (incluidos los puntos iniciales de arranque y la desviación típica del error).</p>
<p><strong>Cuanto menor es el criterio de información, mejor modelo</strong>. Por defecto se usa Akaike corregido para pequeñas muestras (aicc), pero el argumento <code>ic</code> permite cambiar de criterio.</p>
<p><br>
</p>
</section>
<section id="ejemplo-de-aplicación-a-la-serie-consumo-alimentarios-en-el-hogar-per-cápita-1" class="level2" data-number="4.6">
<h2 data-number="4.6" class="anchored" data-anchor-id="ejemplo-de-aplicación-a-la-serie-consumo-alimentarios-en-el-hogar-per-cápita-1"><span class="header-section-number">4.6</span> Ejemplo de aplicación a la serie consumo alimentarios en el hogar per cápita</h2>
<p>Vamos a usar el método de alisado exponencial simple para predecir la serie Consumo de alimento en el hogar. Usaremos para ello la función <code>ets</code> con <code>model = "ZNN"</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>etsAlimentospc <span class="ot">&lt;-</span> <span class="fu">ets</span>(alimentospc, </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">model =</span> <span class="st">"ZNN"</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(etsAlimentospc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ETS(A,N,N) 

Call:
ets(y = alimentospc, model = "ZNN")

  Smoothing parameters:
    alpha = 0.954 

  Initial states:
    l = 625.4154 

  sigma:  22.0981

     AIC     AICc      BIC 
334.3284 335.1284 338.9074 

Training set error measures:
                    ME     RMSE      MAE        MPE     MAPE      MASE
Training set -2.138992 21.43828 14.04374 -0.4243009 2.243991 0.9810031
                    ACF1
Training set 0.004506905</code></pre>
</div>
</div>
<p>Veamos la salida en detalle:</p>
<ul>
<li>El modelo óptimo tiene error aditivo: <code>ETS(A,N,N)</code>.</li>
<li>El valor de <span class="math inline">\(\alpha\)</span> óptimo (minimiza la verosilimilitud) es <span class="math inline">\(\alpha =\)</span> 0.95, un valor muy cercano a 1. Es decir, el nivel de Alimentos varía constantemente en el tiempo.</li>
<li>El valor de arranque <span class="math inline">\(l_0\)</span> óptimo es 625.42. Es decir, el año 1989 (año anterior al primero de la serie) se estima un nivel de consumo de 625.42 kg per cápita.</li>
<li><em>sigma</em> es la desviación típica del error (aditivo) de predicción. Se diferencia de RMSE en el denominador. Para calcular <em>sigma</em> en lugar de dividir por <span class="math inline">\(T\)</span> se divide por <span class="math inline">\(T-k\)</span>. En este caso <span class="math inline">\(k=3\)</span>: <span class="math inline">\(l_0\)</span>, <span class="math inline">\(\alpha\)</span> y <em>sigma</em>. Sí, <em>sigma</em> se considerará siempre otro parámetro estimado.</li>
<li>Se obtiene un AICc <span class="math inline">\(= 335.13\)</span>. Si estimamos un modelo con error multiplicativo, obtendremos un AICc mayor.</li>
<li>La calidad del ajuste es buena, como evidencia el error porcentual medio del 2.2%. Además, no hay sesgo (MPE = -0.42%) y el cálculo de la predicciones por intervalo es correcto (ACF1 = 0.0045).</li>
<li>Como el valor de <span class="math inline">\(\alpha\)</span> es próximo a 1, el modelo de Alisado se aproxima mucho al Ingenuo I. Por este motivo el MASE es casi igual a 1.</li>
</ul>
<p>En el objeto <code>etsAlimentospc</code> la matriz <code>etsAlimentospc$states</code> guarda todos los valores del nivel obtenidos con la ecuación recursiva, incluido el valor de arranque, así que es una matriz con <span class="math inline">\(T+1\)</span> filas (35 en el ejemplo). Puedes ver en su última fila que el valor de <span class="math inline">\(l_{2023}\)</span>, el nivel del último año, vale 556.03.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(etsAlimentospc<span class="sc">$</span>states, <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Time Series:
Start = 2023 
End = 2023 
Frequency = 1 
            l
[1,] 556.0329</code></pre>
</div>
</div>
<p>Por tratarse de un modelo sin pendiente ni estacionalidad, la predicción es constante en el tiempo. Recuerda que <span class="math inline">\(\widehat{y}_{T+h} = l_T\)</span>. Así, la predicción para 2024 es <span class="math inline">\(\widehat{y}_{2024}=l_{2023}=\)</span> 556.03. Igualmente <span class="math inline">\(\widehat{y}_{2025}=l_{2023}=\)</span> 556.03. Todas las previsiones son iguales a <span class="math inline">\(l_{2023}\)</span>.</p>
<p>Mediante la función <code>forecast</code> podemos predecir el consumo de alimentos per cápita para los próximos cinco años.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>etsAlimentospcf <span class="ot">&lt;-</span> <span class="fu">forecast</span>(etsAlimentospc,</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>                            <span class="at">h =</span> <span class="dv">5</span>, </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>                            <span class="at">level =</span> <span class="dv">95</span>)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>etsAlimentospcf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Point Forecast    Lo 95    Hi 95
2024       556.0329 512.7215 599.3443
2025       556.0329 496.1726 615.8932
2026       556.0329 483.2962 628.7696
2027       556.0329 472.3789 639.6870
2028       556.0329 462.7303 649.3355</code></pre>
</div>
</div>
<p>La <a href="#fig-alimentosANN" class="quarto-xref">Figura&nbsp;3</a> muestra la serie Consumo de alimentos, las previsiones extramuestrales que son constantes y el intervalo de confianza. Conforme aumentamos el horizonte de predicción, el intervalo de confianza es más amplio como reflejo de la mayor incertidumbre en la predicción.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(etsAlimentospcf,</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"Kg per cápita"</span>,</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-alimentosANN" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-alimentosANN-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-04-Tema4_files/figure-html/fig-alimentosANN-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-alimentosANN-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;3: Consumo de alimentos per cápita (1990 - 2023) y predicción con Alisado exponencial simple
</figcaption>
</figure>
</div>
</div>
</div>
<section id="identificación-de-valores-atípicos-intervención" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="identificación-de-valores-atípicos-intervención">Identificación de valores atípicos (Intervención)</h3>
<p>En el método de alisado, como en cualquier otro método, el error de ajuste contiene tanto la propia componente del error como la intervención. Si hay años donde hubo un consumo de alimentos muy inusual, por alto o por bajo, quedarán identificados en el error del modelo.</p>
<p>A lo largo del curso prestaremos mucha atención al análisis del error y a la identificación de datos atípicos (o extremos).</p>
<p>Consideraremos un error como atípico si su valor sin signo supera un número determinado de veces la desviación típica del error. El error de un modelo lo obtendremos con la función <code>residuals</code> y su desviación típica con la función <code>sd</code>. Un error que supera las tres desviaciones típicas es claramente atípico (la probabilidad de ocurrir del 0.3%). Si solo supera dos desviaciones típicas, no está tan claro porque la probabilidad de ocurrir es del 5%.</p>
<p>Vamos a ver la gráfica de los residuos de este modelo para identificar rápidamente si hay valores atípicos (<a href="#fig-AlimentosErrorEts" class="quarto-xref">Figura&nbsp;4</a>).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>error <span class="ot">&lt;-</span> <span class="fu">residuals</span>(etsAlimentospc)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>sderror <span class="ot">&lt;-</span> <span class="fu">sd</span>(error)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(error, <span class="at">series=</span><span class="st">"Error"</span>,</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"Error"</span>,</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>)<span class="sc">*</span>sderror, </span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"green"</span>, <span class="st">"green"</span>, <span class="st">"red"</span>), </span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span> <span class="fu">seq</span>(<span class="dv">1990</span>, <span class="dv">2024</span>, <span class="dv">4</span>)) </span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Creamos un variable con todos las años de la serie</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>fechas <span class="ot">&lt;-</span> <span class="fu">format</span>(<span class="fu">seq</span>(<span class="fu">as.Date</span>(<span class="st">"1990-01-01"</span>), <span class="fu">as.Date</span>(<span class="st">"2023-01-01"</span>), <span class="st">"year"</span>), <span class="st">"%Y"</span>)</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Identificamos los años atípicos</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>fechas[<span class="fu">abs</span>(error) <span class="sc">&gt;</span> <span class="fl">2.5</span> <span class="sc">*</span> sderror]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2020" "2022"</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-AlimentosErrorEts" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-AlimentosErrorEts-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-04-Tema4_files/figure-html/fig-AlimentosErrorEts-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-AlimentosErrorEts-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;4: Error + Intervención
</figcaption>
</figure>
</div>
</div>
</div>
<p>Se identifican dos posibles valores extremos, dos intervenciones, en los años 2020 y 2022 (el error está cerca de las 3 desviaciones típicas). Cada una de las intervenciones es del tipo <em>pulso</em> porque solo afecta un periodo de la serie. En el año 2020 el consumo de alimentos en el hogar fue muy superior a lo esperado (por encima de las tres desviaciones típicas) debido a que el confinamiento durante la pandemia aumentó las comidas en el hogar. Por contra, en 2022 el consumo de alimentos en el hogar fue inferior a lo esperado en casi tres desviaciones típicas debido a que tras la pandemia se incrementó el deseo de ocio y de comer o cenar fuera de casa, especialmente entre los jóvenes.</p>
<p>Un método alternativo para obtener valores atípicos es la prueba de Tukey (véase la píldora <em>Valores perdidos y valores atípicos</em>). Si el error se distribuye como una normal, la prueba de Tukey identifica como atípicos los errores que superan 4.7 veces la desviación típica. Es decir, es un criterio muy conservador.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>atipicos <span class="ot">&lt;-</span> <span class="fu">tsoutliers</span>(error)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>fechas[atipicos<span class="sc">$</span>index]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2020" "2022"</code></pre>
</div>
</div>
<p>En este caso, con el método de Tukey se identifican los mismos años atípicos.</p>
<p><br>
<br>
</p>
</section>
</section>
</section>
<section id="modelos-arima" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Modelos ARIMA</h1>
<p>La predicción con modelos ARIMA es más compleja que la vista hasta ahora, donde una sola linea de comando permitía predecir. Primero, para aplicar los modelos ARIMA a una serie temporal se deben cumplir ciertos supuestos y, por tanto, hay que verificar previamente su cumplimento y saber qué hacer cuando no que se cumplen. En segundo lugar, como en los modelos de regresión que has visto en <em>Predicción con datos transversales</em>, hay que estimar parámetros y ver si son significativos. Finalmente, hay que saber qué modelo ARIMA estimar, proceso que se denomina <em>Identificación</em>.</p>
<p>¿Todo este trabajo a cambio de qué? De obtener, posiblemente, mejores predicciones y poder, por fin, incorporar la intervención en el análisis.</p>
<section id="hipótesis-necesarias" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="hipótesis-necesarias"><span class="header-section-number">5.1</span> Hipótesis necesarias</h2>
<p>La aplicación de los modelos Arima requiere el cumplimiento de una serie de hipótesis. No siendo muy riguroso en su planteamiento, para aplicar un modelo ARIMA a un serie temporal esta debe ser <strong>estacionaria en media</strong>, <strong>estacionaria en varianza</strong> y <strong>ergódica</strong>; y, además, el error del modelo debe seguir una <strong>distribución normal</strong>. No vamos a definir estos conceptos con rigor y nos limitaremos a dar su noción intuitiva.</p>
<ol type="1">
<li><p>Una serie temporal es <em>estacionaria en media</em> (o de primer orden) si su nivel se mantiene en el tiempo. Es decir, es el concepto de estacionariedad visto en el Tema 2.</p></li>
<li><p>Una serie temporal, ya estacionaria en media, es <em>estacionaria en varianza</em> si no presenta en unos periodos más variabilidad que en otros.</p></li>
<li><p>Una serie temporal es <em>ergódica</em> si cuanto más en el pasado está una observación, menos información aporta sobre los valores presentes. Es decir, que el pasado cada vez ayuda menos a entender el presente.</p></li>
<li><p>Asumiremos que el error del modelo <span class="math inline">\(\varepsilon_t\)</span> se distribuye como una <em>variable aleatoria normal</em> incorrelada. En este curso no vamos a prestar atención a esta hipótesis hipótesis porque no jugará ningún papel en la elección del modelo óptimo —aquel con mejores predicciones— y se puede relajar si la serie tiene suficientes datos.</p></li>
</ol>
<p><strong>En este tema, donde analizamos series estacionarias y sin estacionalidad, todas estas hipótesis se van a cumplir y no deben preocuparnos</strong>. Primero, ya estamos trabajando con series estacionarias en media. Segundo, por su naturaleza también serán estacionarias en varianza (no trabajaremos con series financieras). Tercero, una serie estacionaria y sin estacionalidad, siempre es ergódica. Por último, en general trabajaremos con series suficientemente largas como para no ser relevante la hipótesis de normalidad.</p>
<p>En concreto, el Consumo de alimentos en el hogar y el número diario de Defunciones verifican estas hipótesis.</p>
</section>
<section id="operador-retardo" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="operador-retardo"><span class="header-section-number">5.2</span> Operador Retardo</h2>
<p>Para escribir correctamente los modelos Arima y la ecuación de predicción es necesario definir un nuevo concepto, el <strong>operador retardo</strong>. Se define el operador retardo <span class="math inline">\(L\)</span> como <span class="math display">\[Ly_t = y_{t-1},\]</span> es decir, retrasa un periodo la serie. El operador retardo se puede aplicar <span class="math inline">\(k\)</span> veces, <span class="math display">\[L^k y_t = y_{t-k}.\]</span></p>
<p>En inglés se denomina <em>lag operator</em> (L) o <em>backward shift</em> (B). Aunque realmente este operador no será necesario hasta que no veamos las series con tendencia, vamos a empezar a trabajar con él ya para ir familiarizándonos con su uso.</p>
<p>La <a href="#tbl-operadorretardo" class="quarto-xref">Tabla&nbsp;1</a> muestra un sencillo ejemplo del efecto del operador retardo sobre la serie <span class="math inline">\(y_t\)</span></p>
<div class="cell" data-layout-align="center">
<div id="tbl-operadorretardo" class="cell quarto-float anchored" data-layout-align="center">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-operadorretardo-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabla&nbsp;1: Ejemplo de aplicación del operador retardo
</figcaption>
<div aria-describedby="tbl-operadorretardo-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">y</th>
<th style="text-align: right;">lag1_y</th>
<th style="text-align: right;">lag2_y</th>
<th style="text-align: right;">lag3_y</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="odd">
<td style="text-align: right;">7</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
</section>
<section id="procesos-arima" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="procesos-arima"><span class="header-section-number">5.3</span> Procesos ARIMA</h2>
<p>ARIMA surge de combinar las siglas de tres procesos diferentes: <strong>AR</strong> de AutoRegresive (autorregresivo), <strong>I</strong> de Integrated (integración) y <strong>MA</strong> de Moving Average (medias móviles). En este tema nos vamos a centrar en el primero (AR) y el ultimo (MA). La <strong>I</strong> tiene que ver con que la serie no sea estacionaria y lo veremos en el <a href="https://iarribasf.github.io/PrediccionSeriesTemporales-GBIA/03-06-Tema6.html">Tema 6</a>.</p>
<p>Por tanto, propiamente vamos a ver modelos ARMA y no ARIMA.</p>
<section id="procesos-autorregresivos-arp" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="procesos-autorregresivos-arp">Procesos autorregresivos AR(p)</h3>
<p>El modelo general <strong>autorregresivo de orden p</strong>, <span class="math inline">\(y_t \sim AR(p)\)</span> viene definido por <span class="math display">\[y_t=c + \phi_1 y_{t-1} + \phi_2 y_{t-2} + \ldots + \phi_p y_{t-p} + \varepsilon_t,\]</span> que usando el operador retardo queda <span class="math display">\[(1 - \phi_1 L - \phi_2 L^2 - \ldots - \phi_p L^p)y_t = c + \varepsilon_t\]</span></p>
<p>En este y en cualquier proceso ARIMA, al polinomio en <span class="math inline">\(L\)</span> que acompaña a <span class="math inline">\(y_t\)</span> se le denomina <strong>polinomio autorregresivo</strong>.</p>
<p>Algunos ejemplos son:</p>
<ul>
<li><span class="math inline">\(y_t \sim AR(1): \;\;y_t = c + \phi_1 y_{t-1} + \varepsilon_t\)</span> o <span class="math inline">\((1 - \phi_1 L)y_t = c + \varepsilon_t\)</span></li>
<li><span class="math inline">\(y_t \sim AR(2): \;\;y_t = c + \phi_1 y_{t-1} + \phi_2 y_{t-2} + \varepsilon_t\)</span> o <span class="math inline">\((1 - \phi_1 L - \phi_2 L^2)y_t = c + \varepsilon_t\)</span></li>
</ul>
<p><br>
</p>
</section>
<section id="procesos-en-medias-móviles-maq" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="procesos-en-medias-móviles-maq">Procesos en medias móviles MA(q)</h3>
<p>El modelo general <strong>en medias móviles de orden q</strong>, <span class="math inline">\(y_t \sim MA(q)\)</span> viene definido por <span class="math display">\[y_t=c + \varepsilon_t + \theta_1 \varepsilon_{t-1} + \theta_2 \varepsilon_{t-2} + \ldots + \theta_q \varepsilon_{t-q},\]</span> que usando el operador retardo queda <span class="math display">\[y_t = c + (1 + \theta_1 L + \theta_2 L^2 + \ldots + \theta_q L^q) \varepsilon_t\]</span></p>
<p>En este y en cualquier proceso ARIMA, al polinomio en <span class="math inline">\(L\)</span> que acompaña a <span class="math inline">\(\varepsilon_t\)</span> se le denomina <strong>polinomio en medias móviles</strong>.</p>
<p>Algunos ejemplos son:</p>
<ul>
<li><span class="math inline">\(y_t \sim MA(1): \;\;y_t = c + \varepsilon_t + \theta_1 \varepsilon_{t-1}\)</span> o <span class="math inline">\(y_t = c + (1 + \theta_1 L)\varepsilon_t\)</span></li>
<li><span class="math inline">\(y_t \sim MA(2): \;\;y_t=c + \varepsilon_t + \theta_1 \varepsilon_{t-1} + \theta_2 \varepsilon_{t-2}\)</span> o <span class="math inline">\(y_t = c + (1 + \theta_1 L + \theta_2 L^2)\varepsilon_t\)</span></li>
</ul>
<p><br>
</p>
</section>
<section id="integración-id" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="integración-id">Integración I(d)</h3>
<p>Al orden autorregresivo se le denomina <span class="math inline">\(p\)</span> y al de medias móviles <span class="math inline">\(q\)</span>. De la misma forma, al orden de integración <strong>I</strong> se le denomina <span class="math inline">\(d\)</span>. Si la serie es estacionaria, entonces <span class="math inline">\(d = 0\)</span>, indicando que la serie no tiene que ser transformada para que sea estacionaria (0 transformaciones), porque ya lo es.</p>
<p>De esta forma, los procesos que veremos en este tema son <span class="math inline">\(ARIMA(p, 0 ,q)\)</span>.</p>
<p><br>
</p>
</section>
<section id="procesos-arimap-0-q" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="procesos-arimap-0-q">Procesos ARIMA(p, 0, q)</h3>
<p>El modelo general <span class="math inline">\(y_t \sim ARMA(p, 0, q)\)</span> viene dado por <span class="math display">\[y_t = c + \phi_1 y_{t-1} + \phi_2 y_{t-2} + \ldots + \phi_p y_{t-p}  +
        \theta_1 \varepsilon_{t-1} + \theta_2 \varepsilon_{t-2} + \ldots +
        \theta_q \varepsilon_{t-q}+ \varepsilon_t,\]</span> que usando el operador retardo queda</p>
<span class="math display">\[\begin{equation*}
  \begin{array}{c@{\qquad}c@{\quad}ccc}
   (1 - \phi_1 L - \ldots - \phi_p L^p) y_t &amp; = &amp; c + (1 + \theta_1 L + ... + \theta_q L^q) \varepsilon_t \\
                           \uparrow                            &amp;   &amp; \uparrow \\
                           AR(p)                               &amp;   &amp; MA(q)
  \end{array}
\end{equation*}\]</span>
<p>Algunos ejemplos son:</p>
<ul>
<li><span class="math inline">\(y_t \sim ARIMA(1, 0, 1): \;\;y_t = c + \phi_1 y_{t-1} + \theta_1 \varepsilon_{t-1} + \varepsilon_{t}\)</span> o <span class="math inline">\((1 - \phi_1 L)y_t = c + (1 + \theta_1 L)\varepsilon_t\)</span></li>
<li><span class="math inline">\(y_t \sim ARIMA(0, 0, 0): \;\;y_t = c + \varepsilon_{t}\)</span>. Si <span class="math inline">\(c = 0\)</span>, a este proceso se le denomina <strong>ruido blanco</strong>.</li>
</ul>
<p><br>
</p>
</section>
</section>
<section id="aproximación-de-box-jenkins" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="aproximación-de-box-jenkins"><span class="header-section-number">5.4</span> Aproximación de Box-Jenkins</h2>
<p>La <a href="#fig-AproximacionBoxJenkins" class="quarto-xref">Figura&nbsp;5</a> muestra el flujo de procesos asociado a la modelización por modelos ARIMA, con cuatro grandes áreas:</p>
<ul>
<li><p><strong>Identificación</strong>, que requiere primero transformar la serie para que sea estacionaria y ergódica (no aplicable en este tema), para después identificar los valores de p y q.</p>
<p>Haremos uso de algunas funciones de <em>autoidentificación</em> que nos ayudaran en este punto.</p></li>
<li><p><strong>Estimación</strong> de los parámetros del modelo, incluidas las variables de intervención. El método usual de estimación de los parámetros es por máxima verosimilitud.</p></li>
<li><p><strong>Validación</strong> de las hipótesis sobre el modelo. Analizaremos que no es necesaria más intervención y veremos la pertinencia de los parámetros del modelo (bien contrastando su significatividad o bien por alguna regla más sencilla).</p>
<p>Si la validación no se pasa, puede ser necesario volver al proceso inicial y realizar una nueva identificación del modelo.</p></li>
<li><p><strong>Predicción</strong> e interpretación del modelo válido. Si las predicciones se alejan de los valores reales más de lo esperado o presentan sesgo, puede ser necesario identificar y estimar un nuevo modelo.</p></li>
</ul>
<div id="fig-AproximacionBoxJenkins" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-AproximacionBoxJenkins-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="./imagenes/BoxJenkins.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-AproximacionBoxJenkins-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;5: Esquema de la aproximación de Box-Jenkins a la modelización de procesos ARIMA
</figcaption>
</figure>
</div>
<section id="identificación-automática" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="identificación-automática">Identificación automática</h3>
<p>El paquete <code>forecast</code> dispone de la función <code>auto.arima()</code> que localiza el mejor modelo basándose en el AIC corregido para pequeñas muestras (<code>AICc</code>), el mismo criterio que usa la función <code>ets</code> para localizar el mejor modelo. Básicamente el algoritmo consiste:</p>
<ol type="1">
<li>Estiman una serie de modelos Arima básicos predeterminados</li>
<li>Usar el criterio AICc para seleccionar el mejor de estos modelos.</li>
<li>A partir del modelo seleccionado, se hacen pequeñas variaciones modificando en una unidad <em>p</em> y <em>q</em> y añadiendo/quitando la constante y se vuelve a seleccionar el mejor de los nuevos modelos.</li>
<li>Se repite el paso 3 hasta que no se puede mejorar el AICc.</li>
</ol>
<p>Cuando usemos la función <code>auto.arima</code>, debemos tener cuenta que:</p>
<ul>
<li>Si se desea hacer una búsqueda exhaustiva entre todos los modelos posibles, se debe usar el argumento <code>stepwise = FALSE</code>.</li>
<li>Si se desea que el cálculo de AICc sea exacto (por defecto para ganar tiempo calcula una aproximación), se debe usar el argumento <code>approximation = FALSE</code>.</li>
<li>Si se desea ver para todos los modelos analizados y su valor de AICc, se debe incluir el argumento <code>trace = TRUE</code>.</li>
</ul>
<p>No hay que fiarse ciegamente de los resultados de esta función, pero ayuda en la identificación. En concreto, la función <code>auto.arima</code> tiende a sobreparametrizar los modelos y es muy recomendable <em>ayudarla</em> indicando si la serie es estacionaria o no y la posible intervención.</p>
</section>
</section>
<section id="ejemplo-de-aplicación-a-la-serie-consumo-alimentarios-en-el-hogar-per-cápita-2" class="level2" data-number="5.5">
<h2 data-number="5.5" class="anchored" data-anchor-id="ejemplo-de-aplicación-a-la-serie-consumo-alimentarios-en-el-hogar-per-cápita-2"><span class="header-section-number">5.5</span> Ejemplo de aplicación a la serie consumo alimentarios en el hogar per cápita</h2>
<p>Vamos a usar el método de alisado exponencial simple para predecir la serie Consumo de alimento en el hogar (véase panel a) de la <a href="#fig-ejemplos_no_tendencia" class="quarto-xref">Figura&nbsp;1</a>.</p>
<p>El pico en el año 2020 se debe al aumento del consumo de alimentos en el hogar causado por el periodo de confinamiento por la Covid-19 (marzo a junio) y el aumento del trabajo desde casa. La aparente caída en 2022 y 2023 se debe a que como efecto rebote, los españoles ahora comemos y cenamos más fuera del hogar.<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></p>
<section id="estacionariedad-de-la-serie" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="estacionariedad-de-la-serie">Estacionariedad de la serie</h3>
<p>La <a href="#fig-ejemplos_no_tendencia" class="quarto-xref">Figura&nbsp;1</a> muestra que la serie original ya es estacionaria. Si hay dudas sobre la estacionariedad en media de una serie, puedes usar la función <code>ndiffs</code> que si vale cero confirma que la serie es estacionaria. Una vez más, no te fíes ciegamente de esta función y decide sobre la estacionariedad de una serie usando varios criterios.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ndiffs</span>(alimentospc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
</section>
<section id="identificación-y-estimación" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="identificación-y-estimación">Identificación y Estimación</h3>
<p>Un proceso ARIMA queda identificado por los valores de <span class="math inline">\(p\)</span>, <span class="math inline">\(d\)</span> y <span class="math inline">\(q\)</span>. Como la serie es estacionaria, sabemos que <span class="math inline">\(d = 0\)</span>. Vamos ahora a identificar los valores de <span class="math inline">\(p\)</span> y <span class="math inline">\(q\)</span>. Este es el proceso más difícil y para simplificar las cosas vamos a ayudarnos de la función <code>auto.arima</code>, fijando el parámetro <code>d = 0</code>.</p>
<p>Además, con el método de Alisado se han identificado dos posibles valores extremos, dos intervenciones, en los años 2020 y 2022 (el error casi alcanza las 3 desviaciones típicas). Vamos a incorporar esta información en nuestro modelo. Para ello crearemos una variable ficticia asociada a cada intervención, que denominaremos d2020 y d2022. La forma de definir la variable ficticia asociada a un pulso consiste en crear una variable de ceros, excepto para el periodo atípico en que la variable valdrá 1.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>d2020 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">*</span> (<span class="fu">time</span>(alimentospc) <span class="sc">==</span> <span class="dv">2020</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>d2022 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">*</span> (<span class="fu">time</span>(alimentospc) <span class="sc">==</span> <span class="dv">2022</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Por último, incluimos las dos variables ficticias en la autoidentificación.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">auto.arima</span>(alimentospc,</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">d =</span> <span class="dv">0</span>,</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">xreg =</span> <span class="fu">cbind</span>(d2020, d2022),</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">trace =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 Regression with ARIMA(2,0,2) errors : Inf
 Regression with ARIMA(0,0,0) errors : 312.8244
 Regression with ARIMA(1,0,0) errors : 294.6787
 Regression with ARIMA(0,0,1) errors : 301.2503
 Regression with ARIMA(0,0,0) errors : 539.8936
 Regression with ARIMA(2,0,0) errors : 296.3297
 Regression with ARIMA(1,0,1) errors : 295.8126
 Regression with ARIMA(2,0,1) errors : 299.0078
 Regression with ARIMA(1,0,0) errors : Inf

 Best model: Regression with ARIMA(1,0,0) errors </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: alimentospc 
Regression with ARIMA(1,0,0) errors 

Coefficients:
         ar1  intercept    d2020     d2022
      0.8437   621.3033  56.3963  -25.8095
s.e.  0.1165    15.9562  11.5793   11.6058

sigma^2 = 260:  log likelihood = -141.27
AIC=292.54   AICc=294.68   BIC=300.17</code></pre>
</div>
</div>
<p>Al poner el argumento <code>trace = TRUE</code> podemos ver todos los modelos que la función ha considerado. La identificación automática sugiere un proceso AR(1) con constante (intercept) por ser el que menor AICc tiene. Por tanto, ha estimado los coeficientes <span class="math inline">\(\phi_1\)</span> y <span class="math inline">\(\mu\)</span> (que denomina <code>ar1</code> e <code>intercept</code>) y los coeficientes de la intervención (<code>d2020</code> y <code>d2022</code>). ¿Pero son realmente relevantes (significativos) estos coeficientes?</p>
<p>Una forma rápida, aunque imprecisa, de determinar si un coeficiente es relevante (significativo) es compararlo con su error estándar (standard error, s.e). Si el coeficiente es mayor que dos veces su error estándar, hay evidencia de que es significativo. En la salida de <code>R</code>, en la tabla <code>Coefficients</code> tienes en la primera fila el nombre de los coeficientes; su valor estimado aparece en la segunda fila de la tabla; y los errores estándar en la tercera fila (precedida por s.e.). Todos los coeficientes estimados superan las dos desviaciones estándar y parece que son significativos.</p>
<p>Ahora vamos a estimar el modelo identificado. Aunque existe la función <code>arima</code> de <code>stats</code>, vamos a usar la función <code>Arima</code> de la librería <code>forecast</code> por ser más versátil. El argumento <code>order</code> indica los valores de (p, d, q) como un vector y el argumento lógico <code>include.constant</code> indica si se desea incluir la constante <span class="math inline">\(c\)</span> en el modelo.<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>ariAlimentospc <span class="ot">&lt;-</span> <span class="fu">Arima</span>(alimentospc, </span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">include.constant =</span> <span class="cn">TRUE</span>,</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">xreg =</span> <span class="fu">cbind</span>(d2020, d2022))</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>ariAlimentospc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: alimentospc 
Regression with ARIMA(1,0,0) errors 

Coefficients:
         ar1  intercept    d2020     d2022
      0.8437   621.3033  56.3963  -25.8095
s.e.  0.1165    15.9562  11.5793   11.6058

sigma^2 = 260:  log likelihood = -141.27
AIC=292.54   AICc=294.68   BIC=300.17</code></pre>
</div>
</div>
<p>Vamos a ver la gráfica de los residuos de este proceso para determinar si hay más valores extremos (<a href="#fig-AlimentosError" class="quarto-xref">Figura&nbsp;6</a>).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>error <span class="ot">&lt;-</span> <span class="fu">residuals</span>(ariAlimentospc)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>sderror <span class="ot">&lt;-</span> <span class="fu">sd</span>(error)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(error, <span class="at">series=</span><span class="st">"Error"</span>,</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"Error"</span>,</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>)<span class="sc">*</span>sderror, </span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"green"</span>, <span class="st">"green"</span>, <span class="st">"red"</span>), </span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span> <span class="fu">seq</span>(<span class="dv">1990</span>, <span class="dv">2024</span>, <span class="dv">4</span>)) </span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>fechas[<span class="fu">abs</span>(error) <span class="sc">&gt;</span> <span class="fl">2.5</span> <span class="sc">*</span> sderror]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2023"</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-AlimentosError" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-AlimentosError-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-04-Tema4_files/figure-html/fig-AlimentosError-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-AlimentosError-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;6: Error + Intervención
</figcaption>
</figure>
</div>
</div>
</div>
<p>Se identifican otro posible valor extremo para el año 2023 (el error supera las 2.5 desviaciones típicas). Parece que, tras la pandemia, los españoles tenemos más ganas de disfrutar de nuestro ocio y salimos mas a comer y cenar fuera, reduciendo el consumo de alimentos del hogar. Vamos a crear una variable para 2023. Además, si aplicamos <code>auto.arima</code> añadiendo esta nueva intervención, la identificación se mantiene.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>d2023 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">*</span> (<span class="fu">time</span>(alimentospc) <span class="sc">==</span> <span class="dv">2023</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>ariAlimentospc <span class="ot">&lt;-</span> <span class="fu">Arima</span>(alimentospc, </span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">include.constant =</span> <span class="cn">TRUE</span>,</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>                        <span class="at">xreg =</span> <span class="fu">cbind</span>(d2020, d2022, d2023))</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>ariAlimentospc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: alimentospc 
Regression with ARIMA(1,0,0) errors 

Coefficients:
         ar1  intercept    d2020     d2022     d2023
      0.6779   633.7288  55.2611  -62.9218  -74.1954
s.e.  0.1217     6.1392   9.8598   12.0579   14.7748

sigma^2 = 164:  log likelihood = -132.55
AIC=277.09   AICc=280.2   BIC=286.25</code></pre>
</div>
</div>
<p>Si se repite el análisis de intervención, aparece otro valor extremo en 1999, con un consumo inferior al esperado. Sin embargo, para este año no se identifica ninguna razón para la caída del consumo por lo que damos el modelo previo como definitivo. <strong>Toda intervención debe tener detrás una causa identificable, si no puede ser fruto de simple azar.</strong></p>
</section>
<section id="validación" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="validación">Validación</h3>
<p>La regla de que un coeficiente es relevante si supera dos veces su desviación típica es muy sencilla de aplicar, pero poco rigurosa. Para ver si un coeficiente es significativo (relevante) debemos realizar la prueba de significatividad correspondiente, obtener el valor de p y compararlo con el nivel de significatividad fijado (usualmente el 5%). Todo esto lo hace la función <code>coeftest</code> del paquete <code>lmtest</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(ariAlimentospc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
z test of coefficients:

           Estimate Std. Error  z value  Pr(&gt;|z|)    
ar1         0.67790    0.12175   5.5680 2.577e-08 ***
intercept 633.72878    6.13923 103.2262 &lt; 2.2e-16 ***
d2020      55.26113    9.85985   5.6047 2.087e-08 ***
d2022     -62.92176   12.05786  -5.2183 1.806e-07 ***
d2023     -74.19542   14.77481  -5.0218 5.120e-07 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Tanto <span class="math inline">\(\phi_1\)</span> como el intercepto <span class="math inline">\(\mu\)</span> y las variables de intervención son significativas porque sus valores de p (columna <code>Pr(&gt;|z|)</code>) son menores que 0.05, incluso menores que 0.01.</p>
<p>Consideraremos que <span class="math inline">\(alimentospc_t \sim ARIMA(1,0,0)\)</span> con constante e intervención.</p>
</section>
<section id="medidas-de-error" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="medidas-de-error">Medidas de error</h3>
<p>La precisión del ajuste es 11.8 kg per cápita (RMSE) y el error absoluto porcentual medio (MAPE) es 1.3%. No hay sesgo y los intervalos de confianza de las predicciones los vamos a considerar correctos.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(ariAlimentospc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>               ME  RMSE  MAE MPE MAPE MASE ACF1
Training set 0.25 11.83 8.33   0 1.32 0.58  0.1</code></pre>
</div>
</div>
</section>
<section id="interpretación-del-modelo" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="interpretación-del-modelo">Interpretación del modelo</h3>
<p>El <strong>modelo teórico</strong> identificado es <span class="math display">\[(1 - \phi_1 L) alimentospc_t = c +  \gamma_1 d2020 + \gamma_2 d2022 + \gamma_3 d2023 + \varepsilon_t,\]</span> que desarrollando queda <span class="math display">\[alimentospc_t = c + \phi_1 alimentospc_{t-1} + \gamma_1 d2020 + \gamma_2 d2022 + \gamma_3 d2023 + \varepsilon_t.\]</span></p>
<p>Finalmente, el <strong>modelo estimado</strong> es <span class="math display">\[\widehat{alimentospc}_t = 204.1 + 0.68 \cdot alimentospc_{t-1} +\]</span> <span class="math display">\[55.3\cdot d2020 - 62.9\cdot d2022 - 74.2\cdot d2023.\]</span></p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
La constante del modelo teórico y la media del modelo estimado
</div>
</div>
<div class="callout-body-container callout-body">
<p>El término contante <span class="math inline">\(\mu\)</span> que estima <code>R</code> no es el valor “c” que hemos visto en la teoría. Para convertir la contante estimada por <code>R</code> en “c” hemos de multiplicarla por el polinomio autorregresivo. En este caso, <span class="math display">\[c = (1 - \phi_1)\cdot \mu = (1 - 0.67790) \cdot 633.72878= 204.124\]</span></p>
</div>
</div>
<p>Cada año el consumo de alimentos per cápita en el hogar es 204 kilos más un 68% del consumo del año pasado.</p>
<p>En 2020, debido al efecto combinado del periodo de confinamiento entre marzo y junio y el incremento del trabajo en casa, se produjo un fuerte aumento del consumo de alimentos en el hogar, estimado en 55 kg per cápita. Por el contrario, en 2022 y 2023 se redujo en 63 y 74 kg, respectivamente, por el aumento del ocio.</p>
<p>Si el incremento en las salidas a comer y cenar fuera se mantiene, la caída en el consumo de alimentos en el hogar se hará permanente y debemos pensar en un cambio de nivel más que en la presencia de dos intervenciones independientes.</p>
</section>
<section id="predicciones-de-la-serie" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="predicciones-de-la-serie">Predicciones de la serie</h3>
<p>Como hemos incluido tres variables ficticias en el ajuste, de cara a predecir el consumo de alimentos hemos de indicar cuales serán los valores futuros para estas variables. En el caso de asumir que el consumo de alimentos en el hogar va a volver a sus valores prepandemia, el valor futuro de las variables intervención será cero. Estamos asumiendo que las causas detrás de estas intervenciones no se espera que se repitan en el futuro.</p>
<p>En <code>R</code> esto se hace incluyendo en el comando <code>forecast</code> el argumento <code>xreg = cbind(rep(0, 5), rep(0, 5), rep(0, 5))</code> que añade cinco ceros por cada variable de intervención porque la predicción va a ser a cinco años vista.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>ariAlimentospcf <span class="ot">&lt;-</span> <span class="fu">forecast</span>(ariAlimentospc, </span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>                            <span class="at">h =</span> <span class="dv">5</span>, </span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>                            <span class="at">level =</span> <span class="dv">95</span>,</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>                            <span class="at">xreg =</span> <span class="fu">cbind</span>(<span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">5</span>), <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">5</span>), <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">5</span>)))</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>ariAlimentospcf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Point Forecast    Lo 95    Hi 95
2024       630.9756 605.8746 656.0765
2025       631.8624 601.5375 662.1873
2026       632.4635 600.0188 664.9083
2027       632.8711 599.4973 666.2448
2028       633.1473 599.3552 666.9395</code></pre>
</div>
</div>
<p>Ahora bien, si pensamos que la caída del consumo de alimentos en el hogar por un aumento del ocio es un efecto permanente, podemos actualizar nuestras previsiones poniendo el valor de 1, en lugar de 0, como valores futuros de d2022 o de d2023, según creamos que el efecto va a ser mayor o menor.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>ariAlimentospcfb <span class="ot">&lt;-</span> <span class="fu">forecast</span>(ariAlimentospc, </span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>                             <span class="at">h =</span> <span class="dv">5</span>, </span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>                             <span class="at">level =</span> <span class="dv">95</span>,</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>                             <span class="at">xreg =</span> <span class="fu">cbind</span>(<span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">5</span>), <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">5</span>), <span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">5</span>)))</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>ariAlimentospcfb</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Point Forecast    Lo 95    Hi 95
2024       556.7802 531.6792 581.8811
2025       557.6670 527.3420 587.9919
2026       558.2681 525.8234 590.7129
2027       558.6757 525.3019 592.0494
2028       558.9519 525.1598 592.7441</code></pre>
</div>
</div>
<p>Observa que estas últimas predicciones son menores que las obtenidas previamente. Podemos ver gráficamente el efecto sobre las predicciones de cada supuesto (véase la <a href="#fig-AlimentosPre" class="quarto-xref">Figura&nbsp;7</a>).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(alimentospc, </span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">series =</span> <span class="st">"Alimentos"</span>,</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"Kg per cápita"</span>,</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>,</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">PI =</span> <span class="cn">FALSE</span>,</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">300</span>, <span class="dv">700</span>)) <span class="sc">+</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(ariAlimentospcf,  <span class="at">PI =</span> <span class="cn">FALSE</span>, <span class="at">series =</span> <span class="st">"Aumento ocio desaparece"</span>) <span class="sc">+</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(ariAlimentospcfb, <span class="at">PI =</span> <span class="cn">FALSE</span>, <span class="at">series =</span> <span class="st">"Aumento ocio se mantiene"</span>) <span class="sc">+</span></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span> <span class="fu">seq</span>(<span class="dv">1990</span>, <span class="dv">2028</span>, <span class="dv">4</span>)) <span class="sc">+</span></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_discrete</span>(<span class="at">limits=</span><span class="fu">c</span>(<span class="st">"Alimentos"</span>, <span class="st">"Aumento ocio desaparece"</span>, </span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"Aumento ocio se mantiene"</span>)) <span class="sc">+</span></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">colour=</span><span class="st">"Predicciones"</span>) <span class="sc">+</span> </span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="fu">c</span>(<span class="fl">0.2</span>,<span class="fl">0.2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-AlimentosPre" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-AlimentosPre-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-04-Tema4_files/figure-html/fig-AlimentosPre-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-AlimentosPre-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;7: Consumo de alimentos y predicción
</figcaption>
</figure>
</div>
</div>
</div>
<p><br>
</p>
</section>
<section id="comparación-entre-modelos" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="comparación-entre-modelos">Comparación entre modelos</h3>
<p>Vamos a comparar de forma sencilla la calidad de ajuste de los cuatro métodos empleados considerando el MAPE.</p>
<ul>
<li>Ingenuo I: <span class="math inline">\(2.28\%\)</span></li>
<li>Media simple: <span class="math inline">\(3.00\%\)</span></li>
<li>Media móvil: <span class="math inline">\(2.97\%\)</span></li>
<li>ETS: <span class="math inline">\(2.24\%\)</span> - ETS(A,N,N), <span class="math inline">\(\alpha = 0.95\)</span></li>
<li>ARIMA: <span class="math inline">\(1.32\%\)</span> - ARIMA(1,0,0) con constante e intervención</li>
</ul>
<p>Los modelos un poco más sofisticados (Alisado y Arima) muestran una mayor calidad de ajuste que los métodos sencillos. Arima es el más preciso al capturar la intervención. Alisado, prácticamente tiene la misma calidad de ajuste que el método Ingenuo I.</p>
<p>Finalmente, vamos a comparar gráficamente las predicciones (véase la <a href="#fig-alimentoscomparacion" class="quarto-xref">Figura&nbsp;8</a>).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(alimentospc, </span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">series =</span> <span class="st">"Alimentos"</span>,</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"Kg per cápita"</span>,</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(mediaAlimentospc, <span class="at">series=</span><span class="st">"Media"</span>, <span class="at">PI =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(naiveAlimentospc, <span class="at">series=</span><span class="st">"Ingenuo"</span>, <span class="at">PI =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(mmAlimentospc, <span class="at">series=</span><span class="st">"Media móvil"</span>, <span class="at">PI =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(etsAlimentospcf, <span class="at">series=</span><span class="st">"Alisado"</span>, <span class="at">PI =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(ariAlimentospcfb, <span class="at">series=</span><span class="st">"ARIMA"</span>, <span class="at">PI =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_discrete</span>(<span class="at">limits=</span><span class="fu">c</span>(<span class="st">"Alimentos"</span>, <span class="st">"Media"</span>, <span class="st">"Ingenuo"</span>,</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"Media móvil"</span>, <span class="st">"Alisado"</span>, <span class="st">"ARIMA"</span>)) <span class="sc">+</span></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">colour=</span><span class="st">"Métodos"</span>) <span class="sc">+</span> </span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="fu">c</span>(<span class="fl">0.1</span>,<span class="fl">0.3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-alimentoscomparacion" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-alimentoscomparacion-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-04-Tema4_files/figure-html/fig-alimentoscomparacion-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-alimentoscomparacion-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;8: Consumo de alimentos y predicción por cinco métodos
</figcaption>
</figure>
</div>
</div>
</div>
<p>Las predicciones por el método Ingenuo I, Alisado y Arima son las más bajas. La dos primeras casi coinciden porque el parámetro de alisado <span class="math inline">\(\alpha = 0.95\)</span> está próximo al valor de 1, caso en que ambos métodos son equivalentes.</p>
<p>Arima es la única que no muestra predicicones constantes.</p>
<p>Las predicciones más elevadas las ofrecen el método de la media y el método de la Media móvil da unas previsiones intermedias.</p>
<p><br>
<br>
</p>
</section>
</section>
</section>
<section id="aplicacion-al-número-de-defunciones-diarias-en-españa" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Aplicacion al número de defunciones diarias en España</h1>
<p>Vamos a aplicar cuatro métodos de predicción (Ingenuo I, media móvil, Alisado y Arima) a la serie Defunciones, número de defunciones diarias en España desde el 1 de enero de 2022 hasta el 31 de diciembre de 2023, 730 datos. Esta serie está disponible en Ministerio de Ciencia, Innovación y Universidades.</p>
<p>El número de defunciones aumenta en verano e invierno debido a las temperaturas extremas, las enfermedades asociadas a estas, o el agravamiento de los efectos de enfermedades benignas en periodos de extremo frío o calor. Por este motivo, muchas veces se trabaja con la serie corregida por temperatura, donde se han ajustado los datos para eliminar el efecto de la temperatura en las observaciones.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>defunciones <span class="ot">&lt;-</span> <span class="fu">read.csv2</span>(<span class="st">"./series/Defunciones.csv"</span>, </span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>defunciones <span class="ot">&lt;-</span> <span class="fu">ts</span>(defunciones, </span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">start =</span> <span class="dv">1</span>, </span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">freq =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(defunciones, </span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>, </span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">"Día"</span>, </span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">""</span>, </span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">500</span>, <span class="dv">2000</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-defunciones" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-defunciones-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-04-Tema4_files/figure-html/fig-defunciones-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-defunciones-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;9: Defunciones diarias corregidas por temperatura (2022-2023)
</figcaption>
</figure>
</div>
</div>
</div>
<p>La <a href="#fig-defunciones" class="quarto-xref">Figura&nbsp;9</a> muestra la serie Defunciones corregida por temperatura. Se observa que la serie presenta variabilidad entre días y que, aunque está corregida por temperatura, sigue mostrando que el número de defunciones aumenta en verano e invierno.</p>
<p>Como solo disponemos de datos para dos años, no podemos observar realmente cambios en la tendencia y vamos a suponer que la serie es estacionaria.</p>
<p>Vamos a aplicar las metodologías vistas en este tema a la serie Defunciones. En cada caso obtendremos los criterios de calidad de ajuste y las predicciones a cuatro semanas vista y compararemos los resultados.</p>
<section id="método-ingenuo-i" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="método-ingenuo-i"><span class="header-section-number">6.1</span> Método Ingenuo I</h2>
<p>Empezamos por en método más sencillo, que usa el último dato disponible como predicción. Aunque se ha pedido una predicción para los próximos 28 días (1 de enero a 28 de enero de 2024), solo se muestra la primera semana.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>naiveDefunciones <span class="ot">&lt;-</span> <span class="fu">naive</span>(defunciones, </span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">h =</span> <span class="dv">28</span>,</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">level =</span> <span class="dv">95</span>)</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(naiveDefunciones)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>
Forecast method: Naive method

Model Information:
Call: naive(y = defunciones, h = 7, level = 95) 

Residual sd: 68.5753 

Error measures:
                    ME     RMSE      MAE        MPE     MAPE MASE       ACF1
Training set 0.1893004 68.57527 55.47051 -0.1493542 4.605408    1 -0.2052727

Forecasts:
    Point Forecast    Lo 95    Hi 95
731           1528 1393.595 1662.405
732           1528 1337.923 1718.077
733           1528 1295.204 1760.796
734           1528 1259.190 1796.810
735           1528 1227.461 1828.539
736           1528 1198.776 1857.224
737           1528 1172.398 1883.602</code></pre>
</div>
</div>
<p>El método Ingenuo I predice 1528 defunciones de forma constante. Los criterios de calidad de ajuste muestran un error medio medido con el RMSE de 69 defunciones (o de 55 si usamos el MAE) y un error porcentual del 4.6%. El método no presenta sesgo (MPE = -0.15%) y las previsiones por intervalos no están correctamente calculadas (ACF1 = -0.21) y no serán fiables.</p>
</section>
<section id="método-de-la-media-móvil" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="método-de-la-media-móvil"><span class="header-section-number">6.2</span> Método de la media móvil</h2>
<p>Seguimos con el método de la media móvil, que aplicaremos con una orden elevado (10 semanas) para suavizar lo más posible la serie.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>mmDefunciones <span class="ot">&lt;-</span> <span class="fu">mmf</span>(defunciones, </span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">r =</span> <span class="dv">70</span>,</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">h =</span> <span class="dv">28</span>)</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mmDefunciones)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>
Forecast method: Moving average

Model Information:
NULL

Error measures:
                    ME     RMSE      MAE        MPE     MAPE    MASE      ACF1
Training set -3.795584 112.7603 87.60515 -0.9582865 7.249869 1.57931 0.8031665

Forecasts:
    Point Forecast    Lo 80   Hi 80    Lo 95    Hi 95
731       1230.914 1086.148 1375.68 1009.347 1452.482
732       1230.914 1086.148 1375.68 1009.347 1452.482
733       1230.914 1086.148 1375.68 1009.347 1452.482
734       1230.914 1086.148 1375.68 1009.347 1452.482
735       1230.914 1086.148 1375.68 1009.347 1452.482
736       1230.914 1086.148 1375.68 1009.347 1452.482
737       1230.914 1086.148 1375.68 1009.347 1452.482</code></pre>
</div>
</div>
<p>El método de la media móvil predice 1231 defunciones de forma constante. Los criterios de calidad de ajuste muestran un error (RMSE) de 113 defunciones (o de 88 si usamos MAE) y un error porcentual del 7.2%. El método no presenta sesgo (MPE = -0.96%) y las previsiones por intervalos no están correctamente calculadas (ACF1 = 0.80) y no serán fiables.</p>
</section>
<section id="método-de-alisado" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="método-de-alisado"><span class="header-section-number">6.3</span> Método de Alisado</h2>
<p>Vamos a localizar el mejor modelo con la función <code>ets</code>. Recuerda que en este método la función de ajuste <code>ets</code> no predice y hay que usar la función <code>forecast</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>etsDefunciones <span class="ot">&lt;-</span> <span class="fu">ets</span>(defunciones, </span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">model =</span> <span class="st">"ZNN"</span>)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(etsDefunciones)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ETS(M,N,N) 

Call:
ets(y = defunciones, model = "ZNN")

  Smoothing parameters:
    alpha = 0.3591 

  Initial states:
    l = 1405.5281 

  sigma:  0.0536

     AIC     AICc      BIC 
10911.46 10911.49 10925.24 

Training set error measures:
                    ME     RMSE     MAE        MPE     MAPE      MASE      ACF1
Training set 0.4817552 65.35745 52.3533 -0.2084728 4.345772 0.9438043 0.2428118</code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>etsDefuncionesf <span class="ot">&lt;-</span> <span class="fu">forecast</span>(etsDefunciones, </span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>                            <span class="at">h =</span> <span class="dv">28</span>,</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>                            <span class="at">level =</span> <span class="dv">95</span>)</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>etsDefuncionesf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>    Point Forecast    Lo 95    Hi 95
731       1531.814 1370.881 1692.747
732       1531.814 1360.791 1702.837
733       1531.814 1351.261 1712.367
734       1531.814 1342.206 1721.421
735       1531.814 1333.562 1730.066
736       1531.814 1325.275 1738.353
737       1531.814 1317.306 1746.322</code></pre>
</div>
</div>
<p>El método de Alisado exponencial simple ajusta un modelo con error multiplivativo y donde el parámetro <span class="math inline">\(\alpha = 0.36\)</span> indica que el nivel de la serie va cambiando poco a poco con el tiempo. Este cambio posiblemente esté asociado con el aumento del número de defunciones en invierno y verano, que persiste aunque trabajemos con la serie corregida por temperatura.</p>
<p>La predicción es de 1532 defunciones diarias. Los criterios de calidad de ajuste muestran un RMSE de 65 defunciones (o de 52 si usamos MAE) y un error porcentual del 4.3%. El método no presenta sesgo (MPE = -0.21%) y las previsiones por intervalos no están correctamente calculadas (ACF1 = 0.24).</p>
<p>Vamos a usar el error del método de Alisado para identificar los días donde el número de defunciones fue inusual por alto o por bajo. Dado el elevado número de observaciones, usaremos como criterio superar las 3 desviaciones típicas. Sin embargo, incluso para un nivel de confianza del 99.7%, con 730 datos cabe esperar que dos errores superen este umbral sin realmente corresponder a días atípicos.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>error <span class="ot">&lt;-</span> <span class="fu">residuals</span>(etsDefunciones)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>sderror <span class="ot">&lt;-</span> <span class="fu">sd</span>(error)</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(error, <span class="at">series=</span><span class="st">"Error"</span>,</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"Error"</span>,</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">3</span>)<span class="sc">*</span>sderror, </span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"red"</span>), </span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span> <span class="fu">seq</span>(<span class="dv">1990</span>, <span class="dv">2024</span>, <span class="dv">4</span>)) </span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Creamos un variable con todos las días de la serie</span></span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>fechas <span class="ot">&lt;-</span> <span class="fu">format</span>(<span class="fu">seq</span>(<span class="fu">as.Date</span>(<span class="st">"2022-1-1"</span>), <span class="fu">as.Date</span>(<span class="st">"2023-12-31"</span>), <span class="st">"day"</span>), <span class="st">"%Y-%m-%d"</span>)</span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Identificamos los días atípicos</span></span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>fechas[<span class="fu">abs</span>(error) <span class="sc">&gt;</span> <span class="dv">3</span> <span class="sc">*</span> sderror]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2022-08-15" "2023-03-26"</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-DefuncionesErrorEts" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-DefuncionesErrorEts-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-04-Tema4_files/figure-html/fig-DefuncionesErrorEts-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-DefuncionesErrorEts-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;10: Error + Intervención
</figcaption>
</figure>
</div>
</div>
</div>
<p>En la <a href="#fig-DefuncionesErrorEts" class="quarto-xref">Figura&nbsp;10</a> se identifica dos días atípicos, el 15 de agosto de 2022 y el 26 de marzo de 2023, pero pueden deberse a simple azar dado que en esos días no pasó nada excepcional. Además, la prueba de Tukey no identifica ningún valor atípico.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>atipicos <span class="ot">&lt;-</span> <span class="fu">tsoutliers</span>(error)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>fechas[atipicos<span class="sc">$</span>index]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>character(0)</code></pre>
</div>
</div>
</section>
<section id="modelos-arima-1" class="level2" data-number="6.4">
<h2 data-number="6.4" class="anchored" data-anchor-id="modelos-arima-1"><span class="header-section-number">6.4</span> Modelos ARIMA</h2>
<section id="identificación-y-estimación-1" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="identificación-y-estimación-1">Identificación y Estimación</h3>
<p>Vamos a ayudarnos de la función <code>auto.arima</code>, fijando el parámetro <code>d = 0</code> dado que la serie es estacionaria.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">auto.arima</span>(defunciones,</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">d =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: defunciones 
ARIMA(5,0,0) with non-zero mean 

Coefficients:
         ar1     ar2     ar3     ar4     ar5       mean
      0.6619  0.0280  0.0226  0.0514  0.1890  1243.4269
s.e.  0.0363  0.0438  0.0438  0.0440  0.0366    47.3757

sigma^2 = 3976:  log likelihood = -4058.96
AIC=8131.91   AICc=8132.07   BIC=8164.06</code></pre>
</div>
</div>
<p>La identificación automática sugiere un complejo proceso ARIMA(5, 0, 0) con constante (denominada <code>mean</code> en este caso porque no hay intervención) y por tanto ha estimado los coeficientes <span class="math inline">\(\phi_1\)</span> a <span class="math inline">\(\phi_5\)</span> y <span class="math inline">\(\mu\)</span>. Además, observamos que solo los coeficientes <span class="math inline">\(\phi_1\)</span> y <span class="math inline">\(\phi_5\)</span> son significativos.</p>
<p>Podemos usar el modelo identificado para predecir y no darle más vueltas. ¿Pero qué sentido tiene que las defunciones de hace 5 días sean relevantes para predecir las defunciones futuras, pero no lo sean las de hace 2, 3 o 4 días? Quizás el modelo está muy sobreidentificado y posiblemente baste un proceso AR(2) para obtener buenas predicciones. Se ha probado con las especificaciones AR(4) hasta AR(2) y se ha comprobado que esta última es la más adecuada por tener todos los coeficientes significativos y una adecuada calidad de ajuste.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>ariDefunciones <span class="ot">&lt;-</span> <span class="fu">Arima</span>(defunciones, </span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">include.constant =</span> <span class="cn">TRUE</span>)</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>ariDefunciones</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: defunciones 
ARIMA(2,0,0) with non-zero mean 

Coefficients:
         ar1     ar2       mean
      0.7498  0.1573  1227.8049
s.e.  0.0365  0.0367    25.8845

sigma^2 = 4355:  log likelihood = -4093.47
AIC=8194.94   AICc=8195   BIC=8213.31</code></pre>
</div>
</div>
<p>Parece que todos los coeficiente son significativos.</p>
<p>Vamos a ver la gráfica de los residuos de este proceso para identificar rápidamente si hay valores extremos (<a href="#fig-DefuncionesError" class="quarto-xref">Figura&nbsp;11</a>).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>error <span class="ot">&lt;-</span> <span class="fu">residuals</span>(ariDefunciones)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>sderror <span class="ot">&lt;-</span> <span class="fu">sd</span>(error)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(error, <span class="at">series=</span><span class="st">"Error"</span>,</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"Error"</span>,</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>)<span class="sc">*</span>sderror, </span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"green"</span>, <span class="st">"green"</span>, <span class="st">"red"</span>), </span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span> <span class="fu">seq</span>(<span class="dv">1990</span>, <span class="dv">2024</span>, <span class="dv">4</span>)) </span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a>fechas[<span class="fu">abs</span>(error) <span class="sc">&gt;</span> <span class="dv">3</span> <span class="sc">*</span> sderror]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2023-03-26"</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-DefuncionesError" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-DefuncionesError-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-04-Tema4_files/figure-html/fig-DefuncionesError-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-DefuncionesError-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;11: Error + Intervención
</figcaption>
</figure>
</div>
</div>
</div>
<p>Hay solo un día atípico, el 26 de marzo de 2023, donde el error supera las 3 desviaciones típicas sin una causa conocida. Esto se puede dar por simple azar, como indicamos al analizar el error de la serie por el método de Alisado. Tucky no identifica ningún valor atípico. Por tanto, vamos a considerar que no hay intervención y ya tenemos el modelo identificado.</p>
</section>
<section id="validación-1" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="validación-1">Validación</h3>
<p>Usamos la función <code>coeftest</code> para contrastar la significatividad de los coeficientes del modelo. Obtenemos que para un nivel de significatividad del 5% todos los coeficientes son significativos.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(ariDefunciones)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
z test of coefficients:

            Estimate Std. Error z value  Pr(&gt;|z|)    
ar1       7.4981e-01 3.6494e-02 20.5461 &lt; 2.2e-16 ***
ar2       1.5728e-01 3.6678e-02  4.2881 1.802e-05 ***
intercept 1.2278e+03 2.5884e+01 47.4341 &lt; 2.2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
</section>
<section id="medidas-de-error-1" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="medidas-de-error-1">Medidas de error</h3>
<p>El error de ajuste es de 66 defunciones (RMSE) o un 4.4% (MAPE). No hay sesgo y los intervalos de confianza de las predicciones son correctos.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(ariDefunciones)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>                ME  RMSE   MAE   MPE MAPE MASE  ACF1
Training set -0.43 65.85 52.95 -0.33  4.4 0.95 -0.02</code></pre>
</div>
</div>
</section>
<section id="interpretación-del-modelo-1" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="interpretación-del-modelo-1">Interpretación del modelo</h3>
<p>El <strong>modelo teórico</strong> identificado es <span class="math display">\[(1 - \phi_1 L - \phi_2 L^2) defunciones_t = c + \varepsilon_t \]</span> que desarrollando queda <span class="math display">\[defunciones_t = c + \phi_1 defunciones_{t-1} + \phi_2 defunciones_{t-2} + \varepsilon_t.\]</span> Finalmente, el <strong>modelo estimado</strong> es <span class="math display">\[\widehat{defunciones}_t = 114.1 + 0.75 \cdot defunciones_{t-1} + 0.16 \cdot defunciones_{t-2}.\]</span> La constante <em>c</em> se ha obtenido como <span class="math inline">\((1 - \phi_1 - \phi_2)\mu = (1 - 0.7498 - 0.1573) \cdot 1227.8049\)</span> <span class="math inline">\(= 114.0631\)</span>.</p>
<p>Cada día el número de defunciones es igual a 114 más un 75% de la defunciones del día previo más un 16% de las de hace dos días.</p>
</section>
<section id="predicciones" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="predicciones">Predicciones</h3>
<p>Podemos predecir el número de defunciones para las primeras 4 semanas de 2024 (aunque solo mostramos la primera).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>arimaDefuncionesf <span class="ot">&lt;-</span> <span class="fu">forecast</span>(ariDefunciones, </span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>                              <span class="at">h =</span> <span class="dv">28</span>,</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>                              <span class="at">level =</span> <span class="dv">95</span>)</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>arimaDefuncionesf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>    Point Forecast    Lo 95    Hi 95
731       1504.982 1375.644 1634.320
732       1482.847 1321.189 1644.505
733       1462.630 1276.102 1649.159
734       1443.990 1238.997 1648.984
735       1426.834 1207.364 1646.305
736       1411.039 1180.013 1642.065
737       1396.497 1156.112 1636.883</code></pre>
</div>
</div>
<p>Observa como en este caso, aunque la serie es estacionaria el número de defunciones previsto disminuye lentamente.</p>
</section>
</section>
<section id="comparación-entre-métodos." class="level2" data-number="6.5">
<h2 data-number="6.5" class="anchored" data-anchor-id="comparación-entre-métodos."><span class="header-section-number">6.5</span> Comparación entre métodos.</h2>
<p>Vamos a finalizar este ejemplo comparando primero la calidad de ajuste de los cuatro modelos utilizados para estudiar la serie de Defunciones, y después las predicciones.</p>
<section id="comparación-de-los-criterios-de-calidad-de-ajuste" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="comparación-de-los-criterios-de-calidad-de-ajuste">Comparación de los criterios de calidad de ajuste</h3>
<p>La siguiente table recoge los criterios de calidad de ajuste obtenidos para cada método.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>               ME   RMSE   MAE   MPE MAPE MASE  ACF1
Ingenuo I    0.19  68.58 55.47 -0.15 4.61 1.00 -0.21
Media móvil -3.80 112.76 87.61 -0.96 7.25 1.58  0.80
Alisado      0.48  65.36 52.35 -0.21 4.35 0.94  0.24
Arima       -0.43  65.85 52.95 -0.33 4.40 0.95 -0.02</code></pre>
</div>
</div>
<p>Por calidad de ajuste, los métodos de Alisado y Arima con comparables, ambos con un RMSE cercano a las 65 defunciones y un MAPE de 4.4%. El método Ingenuo I solo se muestra algo inferior en calidad y el método de la media móvil es claramente muy inferior. Sin embargo, solo el método Arima ofrece predicciones por intervalo correctamente calculadas.</p>
<p>Recordemos que un mejor ajuste no indica una mejor predicción. Habrá que esperar hasta el siguiente tema para ver cual de los métodos ofrece las mejores predicciones.</p>
</section>
<section id="comparación-de-las-predicciones" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="comparación-de-las-predicciones">Comparación de las predicciones</h3>
<p>La <a href="#fig-defuncionespre" class="quarto-xref">Figura&nbsp;12</a> muestra las predicciones para las próximas cuatro semanas de estos métodos.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(defunciones, </span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">series =</span> <span class="st">"Defunciones"</span>,</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">""</span>,</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>,</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">900</span>, <span class="dv">1600</span>)) <span class="sc">+</span></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">600</span>, <span class="dv">750</span>) <span class="sc">+</span></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(naiveDefunciones, <span class="at">series=</span><span class="st">"Ingenuo I"</span>, <span class="at">PI =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(mmDefunciones, <span class="at">series=</span><span class="st">"Media móvil (r = 70)"</span>, <span class="at">PI =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(etsDefuncionesf, <span class="at">series=</span><span class="st">"Alisado"</span>, <span class="at">PI =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(arimaDefuncionesf, <span class="at">series=</span><span class="st">"Arima"</span>, <span class="at">PI =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_discrete</span>(<span class="at">limits=</span><span class="fu">c</span>(<span class="st">"Defunciones"</span>, <span class="st">"Ingenuo I"</span>, <span class="st">"Media móvil (r = 70)"</span>, </span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"Alisado"</span>, <span class="st">"Arima"</span>)) <span class="sc">+</span></span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">colour=</span><span class="st">"Métodos"</span>) <span class="sc">+</span> </span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="fu">c</span>(<span class="fl">0.13</span>, <span class="fl">0.75</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-defuncionespre" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-defuncionespre-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-04-Tema4_files/figure-html/fig-defuncionespre-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-defuncionespre-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;12: Defunciones y predicción
</figcaption>
</figure>
</div>
</div>
</div>
<p>Solo las predicciones del método Arima muestan una progresiva caída en las defunciones para las cuatro próximas semanas. El método Ingenuo I y Alisado ofrecen las predicciones más elevadas, mientras que el método de la Media móvil de alto orden ofrece las predicciones más bajas.</p>
<p><br>
<br>
</p>
</section>
</section>
</section>
<section id="resumen-de-los-comandos-utilizados" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Resumen de los comandos utilizados</h1>
<table class="caption-top table">
<colgroup>
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 58%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Función</th>
<th style="text-align: left;">Paquete</th>
<th style="text-align: left;">Descripción</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>as.Date</code></td>
<td style="text-align: left;">base</td>
<td style="text-align: left;">Convierte una cadena de caracteres en una variable fecha</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>seq</code></td>
<td style="text-align: left;">base</td>
<td style="text-align: left;">Genera una secuencia de datos, por ejemplo fechas</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>residuals</code></td>
<td style="text-align: left;">stats</td>
<td style="text-align: left;">Obtiene el residuo de un modelo estimado</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>coeftest</code></td>
<td style="text-align: left;">lmtest</td>
<td style="text-align: left;">contrasta la significatividad individual de los parámetros de un modelo</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>Arima</code></td>
<td style="text-align: left;">forecast</td>
<td style="text-align: left;">estima un proceso ARIMA</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>auto.arima</code></td>
<td style="text-align: left;">forecast</td>
<td style="text-align: left;">identificación automática de un modelo ARIMA</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>ets</code></td>
<td style="text-align: left;">forecast</td>
<td style="text-align: left;">Estimación de una amplia familia de métodos de Alisado exponencial</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>forecast</code></td>
<td style="text-align: left;">forecast</td>
<td style="text-align: left;">Predice valores extramuestrales futuros de la serie</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>meanf</code></td>
<td style="text-align: left;">forecast</td>
<td style="text-align: left;">Predicción por media</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>naive</code></td>
<td style="text-align: left;">forecast</td>
<td style="text-align: left;">Predicción por método Ingenuo I</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>ndiffs</code></td>
<td style="text-align: left;">forecast</td>
<td style="text-align: left;">estima el número de diferencias necesarias para que una serie sea estacionaria</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>mmf</code></td>
<td style="text-align: left;">propia</td>
<td style="text-align: left;">Predice por el método de la Media móvil</td>
</tr>
</tbody>
</table>
<p><br>
<br>
<br>
<br>
</p>



</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-Makridakis00" class="csl-entry" role="listitem">
Makridakis, Spyros, and Michèle Hibon. 2000. <span>“The M3-Competition: Results, Conclusions and Implications.”</span> <em>International Journal of Forecasting</em> 16 (4): 451–76. <a href="https://doi.org/10.1016/S0169-2070(00)00057-1">https://doi.org/10.1016/S0169-2070(00)00057-1</a>.
</div>
</div></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>El cálculo de la media móvil se hace mediante la función <code>filter</code> (librería <code>stats</code>), que calcula la media móvil simple. Realmente la función <code>filter</code> calcula una media ponderada, tiene como primer argumento la serie y el segundo argumento son los pesos de la media móvil, es decir <span class="math inline">\(1/r\)</span> repetido <span class="math inline">\(r\)</span> veces o <code>rep(1/r, r)</code>. El tercer argumento indica si la media es centrada <code>side = 2</code> (como la usada en el método de descomposición de la media móvil visto en el Tema 2) o hacia atrás <code>side = 1</code>.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>No vamos a definir en detalle que es la función de verosimilitud. Basta saber que básicamente es la suma de los errores al cuadrado.<br>
<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>Según el INE, el gasto monetarios per cápita de los españoles en restauración y hoteles cayó ligeramente en 2018 y 2019, y retrocedió un 40% en 2020 a causa de la pandemia. Desde entonces, el gasto per cápita en esta partida ha crecido año tras año: un 30.7% en el 2021 y 2022 y un 13.6% en el 2023.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>La función <code>Arima</code> denomina a la constante de varias formas. Si la serie es estacionaria y no hay intervención, la denomina <code>mean</code>. Si es estacionaria y hay intervención (nuestro caso), la denomina <code>intercept</code>. Si la serie no es estacionaria, la denomina <code>drift</code>.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>© Copyright 2024, Iván Arribas. If you find any bugs please report them to <a href="mailto:ivan.arribas@uv.es">ivan.arribas@uv.es</a></p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>This page is built with <a href="https://quarto.org/">Quarto</a></p>
</div>
  </div>
</footer>




</body></html>